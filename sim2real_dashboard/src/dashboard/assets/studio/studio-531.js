"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[531],{10531:(ae,x,a)=>{a.r(x),a.d(x,{default:()=>te});var d=a(52322),T=a(1309),M=a(68234),Z=a(68434),A=a(20379),E=a(86232),c=a(2784),O=a(8740),V=a(94225),B=a(59506),W=a(14075),J=a(76479),v=a(93812),L=a(56770),$=a(23503),H="../../packages/studio-base/src/hooks/useCallbackWithToast.ts";const I=$.ZP.getLogger(H);function z(t,n){const{enqueueSnackbar:e}=(0,L.Ds)();return(0,c.useCallback)(async(...s)=>{try{return await t(...s)}catch(l){I.error(l),e(l.toString(),{variant:"error"})}},[e,...n])}var D=a(91004),b=a(42741),y=a(24304);function F({topic:t,schemaName:n,datatypes:e,name:s}){const[l]=(0,c.useState)(()=>(0,D.Z)()),o=(0,b.An)(i=>i.playerState.capabilities.includes(y.C.advertise)),r=(0,b.An)(i=>i.publish),m=(0,b.An)(i=>i.setPublishers);return(0,c.useEffect)(()=>{if(o&&t&&n)return m(l,[{topic:t,schemaName:n,options:{datatypes:e}}]),()=>m(l,[])},[l,t,n,e,s,m,o]),(0,c.useCallback)(i=>{o&&r({topic:t,msg:i})},[r,t,o])}var G=a(77075),R=a(67067),C=a(76635);const U={bool:!1,int8:0,uint8:0,int16:0,uint16:0,int32:0,uint32:0,int64:0,uint64:0,float32:0,float64:0,string:"",time:{sec:0,nsec:0},duration:{sec:0,nsec:0}};function N(t,n){const e=U[n];if(e!=null)return e;const s=t.get(n)?.definitions;if(!s)return;const l={};for(const o of s){if(o.isConstant??!1)continue;const r=N(t,o.type);o.isArray??!1?o.arrayLength!=null?l[o.name]=new Array(o.arrayLength).fill(r):l[o.name]=[r]:l[o.name]=r}return l}var S=a(39367);const K={buttonText:"Publish",buttonTooltip:"",advancedView:!0,value:"{}"};function Q(t,n){if(!n)return"Message schema cannot be empty";if(!t.includes(n))return"Schema name not found"}function X(t){if(!t)return"Topic cannot be empty"}const Y=(t,n,e)=>({general:{fields:{topicName:{label:"Topic",input:"autocomplete",error:X(t.topicName),value:t.topicName??"",items:e.map(s=>s.name)},datatype:{label:"Message schema",input:"autocomplete",error:Q(n,t.datatype),items:n,value:t.datatype??""},advancedView:{label:"Editing mode",input:"boolean",value:t.advancedView}}},button:{label:"Button",fields:{buttonText:{label:"Title",input:"string",value:t.buttonText},buttonTooltip:{label:"Tooltip",input:"string",value:t.buttonTooltip},buttonColor:{label:"Color",input:"rgb",value:t.buttonColor}}}}),j=(t,n)=>{if(n==null)return;const e=N(t,n);return e!=null?JSON.stringify(e,void 0,2):"{}"};function k(t,n,e,s){const l=(0,S.W0)(),[,o]=(0,S._N)(),r=(0,c.useMemo)(()=>Array.from(s.keys()).sort(),[s]),m=(0,c.useCallback)(i=>{if(i.action!=="update")return;const{path:p,value:u,input:P}=i.payload;n((0,R.Uy)(h=>{if(P==="autocomplete"){if((0,C.isEqual)(p,["general","topicName"])){const f=e.find(ne=>ne.name===u)?.schemaName,g=j(s,f);o(u?`Publish ${u}`:"Publish"),h.topicName=u,f&&(h.datatype=f),g&&(h.value=g)}else if((0,C.isEqual)(p,["general","datatype"])){const f=j(s,u);h.datatype=u,f&&(h.value=f)}}else(0,C.set)(h,p.slice(1),u)}))},[s,n,o,e]);(0,c.useEffect)(()=>{l({actionHandler:m,nodes:Y(t,r,e)})},[m,t,r,e,l])}var w=a(2784);const q=(0,O.ZL)()((t,{buttonColor:n})=>{const e=n?t.palette.augmentColor({color:{main:n}}):void 0;return{button:{backgroundColor:e?.main,color:e?.contrastText,"&:hover":{backgroundColor:e?.dark}},textarea:{height:"100%",[`.${T.Z.root}`]:{width:"100%",height:"100%",textAlign:"left",backgroundColor:t.palette.background.paper,overflow:"hidden",padding:t.spacing(1,.5),[`.${T.Z.input}`]:{height:"100% !important",lineHeight:1.4,fontFamily:G.R.MONOSPACE,overflow:"auto !important",resize:"none"}}}}});function _(t){let n,e;try{const s=JSON.parse(t);Array.isArray(s)?e="Message content must be an object, not an array":s==null?e="Message content must be an object, not null":typeof s!="object"?e=`Message content must be an object, not \u2018${typeof s}\u2019`:n=s}catch(s){e=t.length!==0?s.message:"Enter valid message content as JSON"}return{error:e,parsedObject:n}}function ee(t){const{saveConfig:n,config:e}=t,{topics:s,datatypes:l,capabilities:o}=(0,B.Ui)(),{classes:r}=q({buttonColor:e.buttonColor}),[m]=(0,V.Nr)(e.topicName??"",500),i=F({name:"Publish",topic:m,schemaName:e.datatype,datatypes:l}),{error:p,parsedObject:u}=(0,c.useMemo)(()=>_(e.value??""),[e.value]);k(e,n,s,l);const P=z(()=>{if(e.topicName!=null&&u!=null)i(u);else throw new Error("called _publish() when input was invalid")},[e.topicName,u,i]),h=Boolean(o.includes(y.C.advertise)&&e.value&&e.topicName&&e.datatype&&u!=null),f=(0,c.useMemo)(()=>{if(!o.includes(y.C.advertise))return"Connect to a data source that supports publishing";if(!e.topicName||!e.datatype)return"Configure a topic and message schema in the panel settings"},[o,e.datatype,e.topicName]);return(0,d.jsxs)(v.Z,{fullHeight:!0,children:[(0,d.jsx)(J.Z,{}),(0,d.jsxs)(v.Z,{flex:"auto",gap:1,padding:1.5,position:"relative",children:[e.advancedView&&(0,d.jsx)(v.Z,{flexGrow:"1",children:(0,d.jsx)(M.Z,{variant:"outlined",className:r.textarea,multiline:!0,size:"small",placeholder:"Enter message content as JSON",value:e.value,onChange:g=>n({value:g.target.value}),error:p!=null})}),(0,d.jsxs)(v.Z,{direction:e.advancedView?"row":"column-reverse",justifyContent:e.advancedView?"flex-end":"center",alignItems:"center",overflow:"hidden",flexGrow:0,gap:1.5,children:[(p||f)&&(0,d.jsx)(Z.Z,{variant:"caption",noWrap:!0,color:p?"error":void 0,children:p??f}),(0,d.jsx)(A.Z,{placement:e.advancedView?"left":void 0,title:e.buttonTooltip,children:(0,d.jsx)("span",{children:(0,d.jsx)(E.Z,{className:r.button,variant:"contained",disabled:!h,onClick:P,children:e.buttonText})})})]})]})]})}const te=(0,W.Z)(Object.assign(w.memo(ee),{panelType:"Publish",defaultConfig:K}))}}]);

//# sourceMappingURL=studio-531.js.map