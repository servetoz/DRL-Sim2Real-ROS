"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6503],{14571:(X,I,c)=>{c.d(I,{o:()=>O});var h=c(52322),a=c(2784);class O extends a.Component{state={hadError:!1};componentDidCatch(F){this.setState({hadError:!0}),this.props.onError(F)}render(){return this.state.hadError?(0,h.jsx)(h.Fragment,{}):this.props.children}}},6503:(X,I,c)=>{c.r(I),c.d(I,{default:()=>Ue});var h=c(52322),a=c(2784),O=c(7506),A=c(14075),F=c(77357),C=c(85062),w=c.n(C),H=c(41501),J=c(61232),$=c(2071),y=c(28316),x=c(14571),Q=c(67067),S=c(76635),Ce=c(5817),ye=c.n(Ce),Te=c(62515),Ae=c(94225),re=c(8220),_=c(44668),q=c(93812),Ye=c(30726),ae=c(70774),j=c(32975),U;(function(e){e[e.COVARIANCE_TYPE_UNKNOWN=0]="COVARIANCE_TYPE_UNKNOWN",e[e.COVARIANCE_TYPE_APPROXIMATED=1]="COVARIANCE_TYPE_APPROXIMATED",e[e.COVARIANCE_TYPE_DIAGONAL_KNOWN=2]="COVARIANCE_TYPE_DIAGONAL_KNOWN",e[e.COVARIANCE_TYPE_KNOWN=3]="COVARIANCE_TYPE_KNOWN"})(U||(U={}));var G;(function(e){e[e.STATUS_NO_FIX=-1]="STATUS_NO_FIX",e[e.STATUS_FIX=0]="STATUS_FIX",e[e.STATUS_SBAS_FIX=1]="STATUS_SBAS_FIX",e[e.STATUS_GBAS_FIX=2]="STATUS_GBAS_FIX"})(G||(G={}));var ie;(function(e){e[e.SERVICE_GPS=1]="SERVICE_GPS",e[e.SERVICE_GLONASS=2]="SERVICE_GLONASS",e[e.SERVICE_COMPASS=4]="SERVICE_COMPASS",e[e.SERVICE_GALILEO=8]="SERVICE_GALILEO"})(ie||(ie={}));function Se(e){const s=e.position_covariance;if(s)switch(e.position_covariance_type){case void 0:return;case U.COVARIANCE_TYPE_UNKNOWN:return;case U.COVARIANCE_TYPE_DIAGONAL_KNOWN:{const v=s[0],n=s[4];return!isFinite(v)||!isFinite(n)?void 0:{radii:[Math.sqrt(v),Math.sqrt(n)],tilt:0}}case U.COVARIANCE_TYPE_APPROXIMATED:case U.COVARIANCE_TYPE_KNOWN:{const v=s,n=[[v[0],v[1]],[v[3],v[4]]];try{const p=(0,ae.Gq_)(n),f=[p.vectors[0][1],p.vectors[1][1]],T=p.values;if(!(0,j.hj)(f[0])||!(0,j.hj)(f[1])||!(0,j.hj)(T[0])||!(0,j.hj)(T[1]))return;const m=-1*((0,ae.fvJ)(f[1],f[0])*180/Math.PI),g=Math.sqrt(T[1]),M=Math.sqrt(T[0]);return!isFinite(m)||!isFinite(g)||!isFinite(M)?void 0:{radii:[g,M],tilt:m}}catch{return}}}}const le=3;class Me extends C.CircleMarker{messageEvent}function Oe(e){const{navSatMessageEvents:s,bounds:v,map:n}=e,p={stroke:!1,color:e.color,fillOpacity:1},f=new C.FeatureGroup,T=v,d=[];for(const m of s){const g=m.message.latitude,M=m.message.longitude;if(!T.contains([g,M]))continue;const W=n.latLngToContainerPoint([g,M]),R=Math.trunc(W.x),N=Math.trunc(W.y);if(d[R]?.[N]===!0)continue;(d[R]=d[R]??[])[N]=!0;const D=new Me([g,M],{...p,radius:le});if(D.messageEvent=m,D.addTo(f),e.showAccuracy===!0){const P=Se(m.message);P!=null&&new C.Ellipse([g,M],P.radii,P.tilt,{color:e.color,fillOpacity:.2,stroke:!1}).addTo(f)}}return e.onHover&&(f.on("mouseover",m=>{const g=m.sourceTarget;g.setStyle({color:e.hoverColor}),g.bringToFront(),e.onHover?.(g.messageEvent)}),f.on("mouseout",m=>{m.sourceTarget.setStyle(p),e.onHover?.(void 0)})),e.onClick&&f.on("click",m=>{const g=m.sourceTarget;g.messageEvent&&e.onClick?.(g.messageEvent)}),f}const ee=Oe;var L=c(68071);function ce(e){const s=e.match(/\{.+?\}/g)??[],v=["{x}","{y}","{z}"];for(const n of s)if(!v.includes(n))return new Error(`Invalid placeholder ${n}`)}function Le(e){switch(e){case"foxglove_msgs/GeoJSON":case"foxglove_msgs/msg/GeoJSON":case"foxglove.GeoJSON":return!0;default:return!1}}function Ne(e,s){const v=(0,S.transform)(s,(d,m)=>{const g=e.topicColors[m.name];d[m.name]={label:m.name,fields:{enabled:{label:"Enabled",input:"boolean",value:!e.disabledTopics.includes(m.name)},coloring:{label:"Coloring",input:"select",value:g?"Custom":"Automatic",options:[{label:"Automatic",value:"Automatic"},{label:"Custom",value:"Custom"}]},color:g?{label:"Color",input:"rgb",value:g}:void 0}}},{}),n=(0,re.Z)(s,d=>e.disabledTopics.includes(d.name)||Le(d.schemaName)?void 0:{label:d.name,value:d.name}),p=[{label:"Off",value:""},...n],f={layer:{label:"Tile layer",input:"select",value:e.layer,options:[{label:"Map",value:"map"},{label:"Satellite",value:"satellite"},{label:"Custom",value:"custom"}]}};if(e.layer==="custom"){let d;e.customTileUrl.length>0&&(d=ce(e.customTileUrl)?.message),f.customTileUrl={label:"Custom map tile URL",input:"string",value:e.customTileUrl,error:d},f.maxNativeZoom={label:"Max tile level",input:"select",value:e.maxNativeZoom,options:[18,19,20,21,22,23,24].map(m=>({label:String(m),value:m})),help:"Highest zoom supported by the custom map source. See https://leafletjs.com/examples/zoom-levels/ for more information."}}return f.followTopic={label:"Follow topic",input:"select",value:e.followTopic,options:p},{general:{label:"General",fields:f},topics:{label:"Topics",children:v}}}function be(e){switch(e.message.status?.status){case G.STATUS_GBAS_FIX:case G.STATUS_SBAS_FIX:case G.STATUS_FIX:return!0;case G.STATUS_NO_FIX:case void 0:default:return!1}}function oe(e){const s=e.schemaName;return s==="foxglove_msgs/GeoJSON"||s==="foxglove_msgs/msg/GeoJSON"||s==="foxglove.GeoJSON"}function ue(e){if(oe(e))return!0;const s=e.message;return s.latitude!=null&&isFinite(s.latitude)&&s.longitude!=null&&isFinite(s.longitude)&&s.status?.status!==G.STATUS_NO_FIX}function me(e){switch(e){case"sensor_msgs/NavSatFix":case"sensor_msgs/msg/NavSatFix":case"ros.sensor_msgs.NavSatFix":case"foxglove_msgs/LocationFix":case"foxglove_msgs/msg/LocationFix":case"foxglove.LocationFix":case"foxglove_msgs/GeoJSON":case"foxglove_msgs/msg/GeoJSON":case"foxglove.GeoJSON":return!0;default:return!1}}function Ie(e){try{const s=JSON.parse(e);return(s?Array.isArray(s)?s:[s]:[]).flatMap(n=>{switch(n.type){case"Feature":{const p=n.properties?.style??{};return{object:n,style:p}}case"FeatureCollection":return(n.features??[]).map(p=>{const f=p.properties?.style??{};return{object:p,style:f}});default:return{object:n,style:{}}}})}catch(s){return console.error(s),[]}}const Fe=ye()(e=>e.filter(ue));function Pe(e){const{context:s}=e,v=(0,a.useRef)(null),[n,p]=(0,a.useState)(()=>{const o=e.context.initialState;return{center:o.center,customTileUrl:o.customTileUrl??"",disabledTopics:o.disabledTopics??[],followTopic:o.followTopic??"",layer:o.layer??"map",topicColors:o.topicColors??{},zoomLevel:o.zoomLevel,maxNativeZoom:o.maxNativeZoom??18}}),[f]=(0,a.useState)(new C.TileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',maxNativeZoom:18,maxZoom:24})),[T]=(0,a.useState)(new C.TileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"&copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community",maxNativeZoom:18,maxZoom:24})),[d]=(0,a.useState)(new C.TileLayer("https://example.com/{z}/{y}/{x}",{attribution:"",maxNativeZoom:18,maxZoom:24})),[m,g]=(0,a.useState)([]),[M,W]=(0,a.useState)([]),[R,N]=(0,a.useMemo)(()=>(0,S.partition)(m,oe),[m]),[D,P]=(0,a.useMemo)(()=>(0,S.partition)(M,oe),[M]),[se,Re]=(0,a.useState)([]),[Y,Be]=(0,a.useState)(),[i,De]=(0,a.useState)(void 0),{width:fe,height:de,ref:Ze}=(0,Te.NB)({refreshRate:0,refreshMode:"debounce"});(0,a.useEffect)(()=>{i?.invalidateSize()},[fe,de,i]);const[pe,ze]=(0,a.useState)(()=>()=>{}),Z=(0,a.useMemo)(()=>(0,re.Z)(se,o=>{if(me(o.schemaName))return o;if(o.convertibleTo){for(const t of o.convertibleTo)if(me(t))return{name:o.name,schemaName:t}}}),[se]),ge=(0,a.useCallback)(o=>{if(o.action!=="update")return;const{path:t,input:l,value:u}=o.payload;if(t[0]==="topics"&&l==="boolean"){const r=t[1];r&&p((0,Q.Uy)(E=>{E.disabledTopics=u===!0?(0,S.difference)(E.disabledTopics,[r]):(0,S.union)(E.disabledTopics,[r])}))}if(t[0]==="topics"&&t[2]==="coloring"){const r=t[1];r&&p((0,Q.Uy)(E=>{u==="Custom"?E.topicColors[r]=L.Hm[0]:delete E.topicColors[r]}))}if(t[0]==="topics"&&t[2]==="color"&&l==="rgb"&&u!=null){const r=t[1];r&&p((0,Q.Uy)(E=>{E.topicColors[r]=u}))}t[1]==="layer"&&l==="select"&&p(r=>({...r,layer:String(u)})),t[1]==="customTileUrl"&&l==="string"&&p(r=>({...r,customTileUrl:String(u)})),t[1]==="maxNativeZoom"&&l==="select"&&p(r=>{const E=parseInt(String(u));return{...r,maxNativeZoom:isFinite(E)?E:r.maxNativeZoom}}),t[1]==="followTopic"&&l==="select"&&p(r=>({...r,followTopic:String(u)}))},[]);(0,a.useEffect)(()=>{n.layer==="map"?(i?.addLayer(f),i?.removeLayer(T),i?.removeLayer(d)):n.layer==="satellite"?(i?.addLayer(T),i?.removeLayer(f),i?.removeLayer(d)):n.layer==="custom"&&(i?.addLayer(d),i?.removeLayer(f),i?.removeLayer(T))},[n.layer,i,d,T,f]),(0,a.useEffect)(()=>{if(n.layer==="custom"){if(ce(n.customTileUrl))return;d.setUrl(n.customTileUrl)}},[n.layer,n.customTileUrl,d]),(0,a.useEffect)(()=>{n.layer==="custom"&&(d.options.maxNativeZoom=n.maxNativeZoom)},[n.layer,n.maxNativeZoom,d]),(0,a.useEffect)(()=>{const o=[];for(const l of Z)n.disabledTopics.includes(l.name)||o.push({topic:l.name,convertTo:l.schemaName,preload:!0});s.subscribe(o);const t=Ne(n,Z);return s.updatePanelSettingsEditor({actionHandler:ge,nodes:t}),()=>{s.unsubscribeAll()}},[n,s,Z,ge]);const b=(0,a.useMemo)(()=>{const o=new Map;let t=0;for(const l of Z){const u=new C.FeatureGroup,r=new C.FeatureGroup,E=new C.LayerGroup([u,r]);o.set(l.name,{topicGroup:E,allFrames:u,currentFrame:r,baseColor:n.topicColors[l.name]??L.Hm[t]}),t=(t+1)%L.Hm.length}return o},[n.topicColors,Z]);(0,a.useLayoutEffect)(()=>{if(!i)return;const o=[...b.entries()];for(const[t,l]of o)n.disabledTopics.includes(t)||i.addLayer(l.topicGroup);return()=>{for(const[t,l]of o)i.removeLayer(l.topicGroup)}},[n.disabledTopics,i,b]),(0,a.useLayoutEffect)(()=>{if(!v.current)return;const o=new C.Map(v.current);return o.attributionControl.setPrefix(!1),o.setView(n.center?[n.center.lat,n.center.lon]:[0,0],n.zoomLevel??10),De(o),s.watch("topics"),s.watch("currentFrame"),s.watch("allFrames"),s.watch("previewTime"),s.onRender=(t,l)=>{ze(()=>l),Be(t.previewTime),t.topics&&Re(u=>(0,S.isEqual)(u,t.topics)?u:t.topics??[]),t.allFrames&&g(Fe(t.allFrames)),t.currentFrame&&t.currentFrame.length>0&&W(t.currentFrame.filter(ue))},()=>{o.remove(),s.onRender=void 0}},[n.center,n.zoomLevel,s]);const z=(0,a.useCallback)(o=>{s.setPreviewTime(o==null?void 0:(0,_.toSec)(o.receiveTime))},[s]),k=(0,a.useCallback)(o=>{s.seekPlayback?.(o.receiveTime)},[s]),[B,Ve]=(0,a.useState)(n.center),[V,we]=(0,a.useState)(),ve=(0,a.useCallback)((o,t,l)=>{const u=o.properties?.name;typeof u=="string"&&u.length>0&&l.bindTooltip(u),l.on("mouseover",()=>{z(t),l.openTooltip()}),l.on("mouseout",()=>{z(void 0),l.closeTooltip()}),l.on("click",()=>{k(t)})},[k,z]),K=(0,a.useCallback)((o,t)=>{const l=Ie(o.message.geojson);for(const{object:u,style:r}of l)(0,C.geoJSON)(u,{onEachFeature:(E,ne)=>ve(E,o,ne),style:n.topicColors[o.topic]?{color:n.topicColors[o.topic],...r}:r}).addTo(t)},[ve,n.topicColors]);(0,a.useEffect)(()=>{Ve(o=>{if(!n.followTopic&&o)return o;for(const t of[P,N])for(const l of t)if(!(n.followTopic&&o&&l.topic!==n.followTopic))return{lat:l.message.latitude,lon:l.message.longitude};return o})},[N,P,n]),(0,a.useEffect)(()=>{if(i)for(const[o,t]of b){t.allFrames.clearLayers();const l=N.filter(r=>r.topic===o),u=ee({map:i,navSatMessageEvents:l,bounds:V??i.getBounds(),color:(0,L.UX)(t.baseColor),hoverColor:(0,L.eE)(t.baseColor),onHover:z,onClick:k});t.allFrames.addLayer(u),u.bringToBack(),R.filter(r=>r.topic===o).forEach(r=>K(r,t.allFrames))}},[K,R,N,i,V,k,z,b]),(0,a.useEffect)(()=>{if(!i)return;const o=(0,S.groupBy)(P,l=>l.topic);for(const[l,u]of Object.entries(o)){const r=b.get(l);if(!r)continue;r.currentFrame.clearLayers();const[E,ne]=(0,S.partition)(u,be),je=ee({map:i,navSatMessageEvents:ne,bounds:V??i.getBounds(),color:(0,L.eE)(r.baseColor),hoverColor:(0,L.eE)(r.baseColor),showAccuracy:!0}),We=ee({map:i,navSatMessageEvents:E,bounds:V??i.getBounds(),color:r.baseColor,hoverColor:(0,L.eE)(r.baseColor),showAccuracy:!0});r.currentFrame.addLayer(je),r.currentFrame.addLayer(We)}const t=(0,S.groupBy)(D,l=>l.topic);for(const[l,u]of Object.entries(t)){const r=b.get(l);if(r){r.currentFrame.clearLayers();for(const E of u)K(E,r.currentFrame)}}},[K,D,i,P,V,b]),(0,a.useEffect)(()=>{if(!i||Y==null)return;const o=N.filter(r=>(0,_.toSec)(r.receiveTime)<=Y),t=(0,S.minBy)(o,r=>Y-(0,_.toSec)(r.receiveTime));if(!t)return;const l=b.get(t.topic),u=new C.CircleMarker([t.message.latitude,t.message.longitude],{radius:le,color:l?(0,L.eE)(l.baseColor):void 0,stroke:!1,fillOpacity:1,interactive:!1});return u.addTo(i),()=>{u.remove()}},[N,i,Y,b]),(0,a.useEffect)(()=>{if(!i)return;const o=()=>{s.saveState({center:{lat:i.getCenter().lat,lon:i.getCenter().lng}})},t=()=>{s.saveState({zoomLevel:i.getZoom()})};return i.on("move",o),i.on("zoom",t),()=>{i.off("move",o),i.off("zoom",t)}},[s,i]),(0,a.useEffect)(()=>{s.saveState(n)},[s,n]);const Ee=(0,Ae.y1)(o=>{we(o.getBounds())},100,{leading:!1,maxWait:100});(0,a.useEffect)(()=>{if(!i)return;const o=()=>Ee(i);return i.on("move",o),()=>{i.off("move",o)}},[i,Ee]);const he=(0,a.useRef)(!1);return(0,a.useEffect)(()=>{if(!B)return;const o=he.current?i?.getZoom():n.zoomLevel??10;i?.setView([B.lat,B.lon],o),he.current=!0},[B,n.zoomLevel,i]),(0,a.useEffect)(()=>{pe()},[pe]),(0,h.jsxs)(q.Z,{ref:Ze,fullHeight:!0,fullWidth:!0,position:"relative",children:[!B&&(0,h.jsx)(q.Z,{alignItems:"center",justifyContent:"center",position:"absolute",style:{top:0,right:0,bottom:0,left:0},children:"Waiting for first GPS point..."}),(0,h.jsx)(q.Z,{position:"absolute",ref:v,style:{inset:0,cursor:"auto",visibility:B?"visible":"hidden"}})]})}const xe=Pe;var ke=c(92037);w().Marker.prototype.options.icon=w().icon({iconUrl:J,iconRetinaUrl:H,shadowUrl:$,iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]});function Ge(e,s){return y.render((0,h.jsx)(a.StrictMode,{children:(0,h.jsx)(x.o,{onError:e,children:(0,h.jsx)(xe,{context:s})})}),s.panelElement),()=>{y.unmountComponentAtNode(s.panelElement)}}function te(e){const s=(0,O.iY)(),v=(0,a.useMemo)(()=>Ge.bind(void 0,s),[s]);return(0,h.jsx)(F._,{config:e.config,saveConfig:e.saveConfig,initPanel:v,highestSupportedConfigVersion:1})}te.panelType="map",te.defaultConfig={};const Ue=(0,A.Z)(te)},68071:(X,I,c)=>{c.d(I,{A2:()=>w,Hm:()=>F,UX:()=>H,eE:()=>J,wi:()=>$});var h=c(76635),a=c.n(h),O=c(1547),A=c(25302);const F=[A.Y.blue.medium,A.Y.orange.medium,A.Y.yellow.medium,A.Y.green.medium,A.Y.cyan.medium,A.Y.purple.medium,A.Y.paleGreen.medium],C=F.map(y=>[y,...(0,O.Z)(y).tetrad().map(x=>x.toHexString())]),w=(0,h.uniq)((0,h.range)(0,C[0].length).map(y=>C.map(x=>x[y])).flat()),H=(0,h.memoize)(y=>(0,O.Z)(y).brighten(15).toString()),J=(0,h.memoize)(y=>(0,O.Z)(y).darken(30).toString());function $(y,x){return y??F[x%F.length]}},25302:(X,I,c)=>{c.d(I,{B:()=>O,Y:()=>a});var h=c(1547);const a={base:{dark:"#1F1E27",medium:"#8B8B8D",light:"#F7F7F3"},red:{dark:"#F24366",medium:"#ff7c96",light:"#FFAABB"},blue:{dark:"#1b83ec",medium:"#4e98e2",light:"#77AADD"},paleGreen:{dark:"#B4CC00",medium:"#cad660",light:"#CDD67E"},orange:{dark:"#ea531f",medium:"#f5774d",light:"#faa487"},cyan:{dark:"#22b5ff",medium:"#61cbff",light:"#99DDFF"},green:{dark:"#05d27d",medium:"#5cd6a9",light:"#8de0c9"},purple:{dark:"#6E51EE",medium:"#a395e2",light:"#c7c0e7"},yellow:{dark:"#EDCC28",medium:"#f7df71",light:"#f1e4aa"}},O=(0,h.Z)("hsv(0, 0%, 75%)").toHexString()}}]);

//# sourceMappingURL=studio-6503.js.map