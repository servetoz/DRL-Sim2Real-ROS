{"version":3,"file":"studio-686.js","mappings":"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","sources":["webpack:///../../packages/studio-base/src/components/MessagePathSyntax/grammar.ne","webpack:///../../packages/den/async/LazilyInitialized.ts","webpack:///../../packages/den/async/MutexLocked.ts","webpack:///../../packages/den/async/debouncePromise.ts","webpack:///../../packages/den/async/promiseTimeout.ts","webpack:///../../packages/den/async/Condvar.ts","webpack:///../../packages/den/collection/filterMap.ts","webpack:///../../packages/hooks/src/useChangeDetector.ts","webpack:///../../packages/hooks/src/useDeepMemo.ts","webpack:///../../packages/hooks/src/useGuaranteedContext.ts","webpack:///../../packages/hooks/src/useMustNotChange.ts","webpack:///../../packages/hooks/src/useRethrow.ts","webpack:///../../packages/hooks/src/useShallowMemo.ts","webpack:///../../packages/hooks/src/useValueChangedDebugLog.ts","webpack:///../../packages/hooks/src/useVisibilityState.ts","webpack:///../../packages/hooks/src/useWarnImmediateReRender.ts","webpack:///../../packages/hooks/src/useMemoryInfo.ts","webpack:///../../packages/hooks/src/selectWithUnstableIdentityWarning.ts","webpack:///../../packages/hooks/src/useCrash.ts","webpack:///../../packages/hooks/src/useSessionStorageValue.ts","webpack:///../../packages/hooks/src/useSynchronousMountedState.ts","webpack:///../../packages/studio-base/src/AppSetting.ts","webpack:///../../packages/studio-base/src/PanelAPI/useDataSourceInfo.ts","webpack:///../../packages/studio-base/src/PanelAPI/useMessageReducer.ts","webpack:///../../packages/studio-base/src/util/concatAndTruncate.ts","webpack:///../../packages/studio-base/src/PanelAPI/useMessagesByTopic.ts","webpack:///../../packages/studio-base/src/PanelAPI/useBlocksByTopic.ts","webpack:///../../packages/studio-base/src/PanelAPI/useConfigById.ts","webpack:///../../packages/studio-base/src/components/AppBar/constants.ts","webpack:///../../packages/studio-base/src/components/CopyButton.tsx","webpack:///../../packages/studio-base/src/hooks/useTopicPublishFrequences.ts","webpack:///../../packages/studio-base/src/components/DirectTopicStatsUpdater.tsx","webpack:///../../packages/studio-base/src/components/EmptyPanelLayout.tsx","webpack:///../../packages/studio-base/src/components/EmptyState.tsx","webpack:///../../packages/studio-base/src/components/ErrorBoundary.tsx","webpack:///../../packages/studio-base/src/components/ErrorDisplay.tsx","webpack:///../../packages/studio-base/src/components/HoverableIconButton.tsx","webpack:///../../packages/studio-base/src/util/validators.ts","webpack:///../../packages/studio-base/src/components/JsonInput.tsx","webpack:///../../packages/studio-base/src/components/KeyListener.tsx","webpack:///../../packages/studio-base/src/components/ReactWindowListboxAdapter.tsx","webpack:///../../packages/studio-base/src/components/Autocomplete.tsx","webpack:///../../packages/studio-base/src/components/MessagePathSyntax/MessagePathInput.tsx","webpack:///../../packages/studio-base/src/components/MessagePathSyntax/isTypicalFilterName.ts","webpack:///../../packages/studio-base/src/util/naturalSort.ts","webpack:///../../packages/studio-base/src/components/MessagePathSyntax/constants.ts","webpack:///../../packages/studio-base/src/components/MessagePathSyntax/messagePathsForDatatype.ts","webpack:///../../packages/studio-base/src/components/MessagePathSyntax/parseRosPath.ts","webpack:///../../packages/studio-base/src/components/MessagePipeline/MessageOrderTracker.ts","webpack:///../../packages/studio-base/src/components/MessagePipeline/pauseFrameForPromise.ts","webpack:///../../packages/studio-base/src/components/MessagePipeline/store.ts","webpack:///../../packages/studio-base/src/components/MessagePipeline/index.tsx","webpack:///../../packages/studio-base/src/components/MosaicPathContext.ts","webpack:///../../packages/studio-base/src/components/PanelErrorBoundary.tsx","webpack:///../../packages/studio-base/src/hooks/usePanelDrag.tsx","webpack:///../../packages/studio-base/src/components/Panel.tsx","webpack:///../../packages/studio-base/src/components/TextHighlight.tsx","webpack:///../../packages/studio-base/src/components/PanelCatalog/PanelGridCard.tsx","webpack:///../../packages/studio-base/src/components/PanelCatalog/PanelGrid.tsx","webpack:///../../packages/studio-base/src/components/PanelCatalog/PanelListItem.tsx","webpack:///../../packages/studio-base/src/components/PanelCatalog/PanelList.tsx","webpack:///../../packages/studio-base/src/components/PanelCatalog/PanelCatalog.tsx","webpack:///../../packages/studio-base/src/components/PanelContext.ts","webpack:///../../packages/studio-base/src/components/PanelExtensionAdapter/PanelConfigVersionError.tsx","webpack:///../../packages/studio-base/src/components/PanelExtensionAdapter/messageProcessing.ts","webpack:///../../packages/studio-base/src/components/PanelExtensionAdapter/renderState.ts","webpack:///../../packages/studio-base/src/components/PanelExtensionAdapter/PanelExtensionAdapter.tsx","webpack:///../../packages/studio-base/src/components/PanelRemounter.tsx","webpack:///../../packages/studio-base/src/components/UnknownPanel.tsx","webpack:///../../packages/studio-base/src/components/PanelLayout.tsx","webpack:///../../packages/studio-base/src/components/PanelRoot.tsx","webpack:///../../packages/studio-base/src/components/PanelToolbar/ToolbarIconButton.tsx","webpack:///../../packages/studio-base/src/components/PanelToolbar/ChangePanelMenu.tsx","webpack:///../../packages/studio-base/src/components/PanelToolbar/utils.ts","webpack:///../../packages/studio-base/src/components/PanelToolbar/PanelActionsDropdown.tsx","webpack:///../../packages/studio-base/src/components/PanelToolbar/PanelToolbarControls.tsx","webpack:///../../packages/studio-base/src/components/PanelToolbar/index.tsx","webpack:///../../packages/studio-base/src/components/TimeBasedChart/HoverBar.tsx","webpack:///../../packages/studio-base/src/components/TimeBasedChart/VerticalBarWrapper.tsx","webpack:///../../packages/studio-base/src/services/NullAnalytics.ts","webpack:///../../packages/studio-base/src/context/AnalyticsContext.ts","webpack:///../../packages/studio-base/src/context/AppConfigurationContext.ts","webpack:///../../packages/studio-base/src/context/AppContext.ts","webpack:///../../packages/studio-base/src/providers/CurrentLayoutProvider/toggleSelectedPanel.ts","webpack:///../../packages/studio-base/src/context/CurrentLayoutContext/index.ts","webpack:///../../packages/studio-base/src/context/CurrentUserContext.ts","webpack:///../../packages/studio-base/src/context/ExtensionCatalogContext.ts","webpack:///../../packages/studio-base/src/context/PanelCatalogContext.ts","webpack:///../../packages/studio-base/src/context/PanelStateContext.ts","webpack:///../../packages/studio-base/src/context/PlayerSelectionContext.ts","webpack:///../../packages/studio-base/src/context/TimelineInteractionStateContext.tsx","webpack:///../../packages/studio-base/src/context/UserNodeStateContext.tsx","webpack:///../../packages/studio-base/src/context/Workspace/WorkspaceContext.ts","webpack:///../../packages/studio-base/src/util/showOpenFilePicker.tsx","webpack:///../../packages/studio-base/src/context/Workspace/useOpenFile.tsx","webpack:///../../packages/studio-base/src/context/Workspace/useWorkspaceActions.ts","webpack:///../../packages/studio-base/src/hooks/useAppTimeFormat.ts","webpack:///../../packages/studio-base/src/hooks/useAppConfigurationValue.ts","webpack:///../../packages/studio-base/src/hooks/useGlobalVariables.ts","webpack:///../../packages/studio-base/src/hooks/useShouldNotChangeOften.ts","webpack:///../../packages/studio-base/src/context/DialogHostIdContext.ts","webpack:///../../packages/studio-base/src/components/GlobalCss.tsx","webpack:///../../packages/studio-base/src/context/EventsContext.ts","webpack:///../../packages/studio-base/src/providers/EventsProvider.tsx","webpack:///../../packages/studio-base/src/context/StudioLogsSettingsContext.ts","webpack:///../../packages/studio-base/src/providers/StudioLogsSettingsProvider/store.ts","webpack:///../../packages/studio-base/src/providers/StudioLogsSettingsProvider/StudioLogsSettingsProvider.tsx","webpack:///../../packages/studio-base/src/providers/TimelineInteractionStateProvider.tsx","webpack:///../../packages/studio-base/src/components/AppBar/AppBarIconButton.tsx","webpack:///../../packages/studio-base/src/components/TextMiddleTruncate.tsx","webpack:///../../packages/studio-base/src/components/AppBar/NestedMenuItem.tsx","webpack:///../../packages/studio-base/src/components/AppBar/AppMenu.tsx","webpack:///../../packages/studio-base/src/components/AppBar/CustomWindowControls.tsx","webpack:///../../packages/studio-base/src/components/FoxgloveLogo.tsx","webpack:///../../packages/studio-base/src/components/MemoryUseIndicator.tsx","webpack:///../../packages/studio-base/src/hooks/useAddPanel.ts","webpack:///../../packages/studio-base/src/components/AppBar/AddPanelMenu.tsx","webpack:///../../packages/studio-base/src/components/WssErrorModal.tsx","webpack:///../../packages/studio-base/src/components/AppBar/DataSource.tsx","webpack:///../../packages/studio-base/src/hooks/useConfirm.tsx","webpack:///../../packages/studio-base/src/components/AppBar/UserMenu.tsx","webpack:///../../packages/studio-base/src/components/AppBar/index.tsx","webpack:///../../packages/studio-base/src/components/DataSourceDialog/Snow.tsx","webpack:///../../packages/studio-base/src/components/BlockheadFilledIcon.tsx","webpack:///../../packages/studio-base/src/components/BlockheadIcon.tsx","webpack:///../../packages/studio-base/src/assets/database-settings.svg","webpack:///../../packages/studio-base/src/assets/panel-layout.svg","webpack:///../../packages/studio-base/src/assets/panel-settings.svg","webpack:///../../packages/studio-base/src/theme/icons.tsx","webpack:///../../packages/studio-base/src/components/BuiltinIcon.tsx","webpack:///../../packages/studio-base/src/components/DataSourceDialog/FormField.tsx","webpack:///../../packages/studio-base/src/components/DataSourceDialog/View.tsx","webpack:///../../packages/studio-base/src/components/DataSourceDialog/Connection.tsx","webpack:///../../packages/studio-base/src/components/FoxgloveLogoText.tsx","webpack:///../../packages/studio-base/src/components/DataSourceDialog/Start.tsx","webpack:///../../packages/studio-base/src/components/DataSourceDialog/DataSourceDialog.tsx","webpack:///../../packages/studio-base/src/components/DropOverlay.tsx","webpack:///../../packages/studio-base/src/components/DocumentDropListener.tsx","webpack:///../../packages/studio-base/src/components/HighlightedText.tsx","webpack:///../../packages/studio-base/src/components/EventView.tsx","webpack:///../../packages/studio-base/src/components/EventsList.tsx","webpack:///../../packages/studio-base/src/components/MultiProvider.tsx","webpack:///../../packages/studio-base/src/components/PanelSettings/ActionMenu.tsx","webpack:///../../packages/studio-base/src/components/SettingsTreeEditor/inputs/ColorPickerControl.tsx","webpack:///../../packages/studio-base/src/components/SettingsTreeEditor/inputs/ColorSwatch.tsx","webpack:///../../packages/studio-base/src/components/SettingsTreeEditor/inputs/ColorPickerInput.tsx","webpack:///../../packages/studio-base/src/components/SettingsTreeEditor/inputs/ColorGradientInput.tsx","webpack:///../../packages/studio-base/src/components/SettingsTreeEditor/inputs/NumberInput.tsx","webpack:///../../packages/studio-base/src/components/SettingsTreeEditor/inputs/Vec2Input.tsx","webpack:///../../packages/studio-base/src/components/SettingsTreeEditor/inputs/Vec3Input.tsx","webpack:///../../packages/studio-base/src/components/SettingsTreeEditor/FieldEditor.tsx","webpack:///../../packages/studio-base/src/components/SettingsTreeEditor/icons.ts","webpack:///../../packages/studio-base/src/components/SettingsTreeEditor/NodeActionsMenu.tsx","webpack:///../../packages/studio-base/src/components/SettingsTreeEditor/VisibilityToggle.tsx","webpack:///../../packages/studio-base/src/components/SettingsTreeEditor/utils.ts","webpack:///../../packages/studio-base/src/components/SettingsTreeEditor/NodeEditor.tsx","webpack:///../../packages/studio-base/src/components/SettingsTreeEditor/index.tsx","webpack:///../../packages/studio-base/src/components/ShareJsonModal.tsx","webpack:///../../packages/studio-base/src/components/PanelSettings/index.tsx","webpack:///../../packages/studio-base/src/components/CreateEventDialog.tsx","webpack:///../../packages/studio-base/src/components/Timestamp.tsx","webpack:///../../packages/studio-base/src/components/MultilineMiddleTruncate.tsx","webpack:///../../packages/studio-base/src/components/DataSourceInfoView.tsx","webpack:///../../packages/studio-base/src/components/EventIcon.tsx","webpack:///../../packages/studio-base/src/components/EventOutlinedIcon.tsx","webpack:///../../packages/studio-base/src/components/PlaybackSpeedControls.tsx","webpack:///../../packages/studio-base/src/components/PlaybackControls/PlaybackTimeDisplayMethod.tsx","webpack:///../../packages/studio-base/src/components/PlaybackControls/PlaybackTimeDisplay.tsx","webpack:///../../packages/studio-base/src/components/PlaybackControls/RepeatAdapter.tsx","webpack:///../../packages/studio-base/src/components/PlaybackControls/EventsOverlay.tsx","webpack:///../../packages/studio-base/src/components/PlaybackControls/PlaybackBarHoverTicks.tsx","webpack:///../../packages/studio-base/src/components/PlaybackControls/PlaybackControlsTooltipContent.tsx","webpack:///../../packages/studio-base/src/components/PlaybackControls/ProgressPlot.tsx","webpack:///../../packages/den/math/utils.ts","webpack:///../../packages/studio-base/src/components/PlaybackControls/Slider.tsx","webpack:///../../packages/studio-base/src/components/PlaybackControls/Scrubber.tsx","webpack:///../../packages/studio-base/src/components/PlaybackControls/sharedHelpers.ts","webpack:///../../packages/studio-base/src/components/PlaybackControls/index.tsx","webpack:///../../packages/studio-base/src/components/ProblemsList.tsx","webpack:///../../packages/studio-base/src/components/RemountOnValueChange.tsx","webpack:///../../packages/studio-base/src/components/Sidebars/Sidebar.tsx","webpack:///../../packages/studio-base/src/components/Sidebars/Sidebars.tsx","webpack:///../../packages/studio-base/src/components/AccountSyncGraphic.tsx","webpack:///../../packages/studio-base/src/components/SigninForm.tsx","webpack:///../../packages/studio-base/src/components/SignInFormModal.tsx","webpack:///../../packages/studio-base/src/components/StudioLogsSettings/useStudioLogsSettingsTree.ts","webpack:///../../packages/studio-base/src/components/StudioLogsSettings/StudioLogsSettings.tsx","webpack:///../../packages/studio-base/src/context/LayoutManagerContext.ts","webpack:///../../packages/studio-base/src/components/CurrentLayoutSyncAdapter.tsx","webpack:///../../packages/studio-base/src/util/appURLState.ts","webpack:///../../packages/studio-base/src/hooks/useStateToURLSynchronization.ts","webpack:///../../packages/studio-base/src/components/URLStateSyncAdapter.tsx","webpack:///../../packages/studio-base/src/components/SyncAdapters.tsx","webpack:///../../packages/studio-base/src/components/TopicList.tsx","webpack:///../../packages/studio-base/src/components/VariablesList/Variable.tsx","webpack:///../../packages/studio-base/src/components/VariablesList/index.tsx","webpack:///../../packages/studio-base/src/OsContextSingleton.ts","webpack:///../../packages/studio-base/src/components/ExperimentalFeatureSettings.tsx","webpack:///../../packages/studio-base/src/context/LinkHandlerContext.ts","webpack:///../../packages/studio-base/src/components/TextContent.tsx","webpack:///../../packages/studio-base/src/context/ExtensionMarketplaceContext.ts","webpack:///../../packages/studio-base/src/components/ExtensionDetails.tsx","webpack:///../../packages/studio-base/src/components/ExtensionsSettings/index.tsx","webpack:///../../packages/studio-base/src/types/LaunchPreferenceValue.ts","webpack:///../../packages/studio-base/src/components/AppSettingsDialog/settings.tsx","webpack:///../../packages/studio-base/src/components/AppSettingsDialog/AppSettingsDialog.tsx","webpack:///../../packages/studio-base/src/components/WorkspaceDialogs.tsx","webpack:///../../packages/studio-base/src/context/NativeAppMenuContext.ts","webpack:///../../packages/studio-base/src/hooks/useDefaultWebLaunchPreference.ts","webpack:///../../packages/studio-base/src/hooks/useElectronFilesToOpen.ts","webpack:///../../packages/studio-base/src/hooks/useInitialDeepLinkState.ts","webpack:///../../packages/studio-base/src/hooks/useNativeAppMenuEvent.ts","webpack:///../../packages/studio-base/src/context/Workspace/migrations.ts","webpack:///../../packages/studio-base/src/providers/WorkspaceContextProvider.tsx","webpack:///../../packages/studio-base/src/Workspace.tsx","webpack:///../../packages/studio-base/src/components/ColorSchemeThemeProvider.tsx","webpack:///../../packages/studio-base/src/components/DocumentTitleAdapter.tsx","webpack:///../../packages/studio-base/src/context/NativeWindowContext.ts","webpack:///../../packages/studio-base/src/hooks/useIndexedDbRecents.ts","webpack:///../../packages/studio-base/src/players/AnalyticsMetricsCollector.ts","webpack:///../../packages/studio-base/src/players/TopicAliasingPlayer/aliasing.ts","webpack:///../../packages/studio-base/src/players/TopicAliasingPlayer/TopicAliasingPlayer.ts","webpack:///../../packages/studio-base/src/players/UserNodePlayer/MemoizedLibGenerator.ts","webpack:///../../packages/studio-base/src/players/UserNodePlayer/utils.ts","webpack:///../../packages/studio-base/src/util/basicDatatypes.ts","webpack:///../../packages/studio-base/src/players/UserNodePlayer/index.ts","webpack:///../../packages/studio-base/src/components/PlayerManager.tsx","webpack:///../../packages/studio-base/src/components/NotificationModal.tsx","webpack:///../../packages/studio-base/src/components/SendNotificationToastAdapter.tsx","webpack:///../../packages/studio-base/src/components/StudioToastProvider.tsx","webpack:///../../packages/studio-base/src/context/LayoutStorageContext.ts","webpack:///../../packages/studio-base/src/context/UserProfileStorageContext.ts","webpack:///../../packages/studio-base/src/providers/CurrentLayoutProvider/reducers.ts","webpack:///../../packages/studio-base/src/providers/CurrentLayoutProvider/defaultLayout.ts","webpack:///../../packages/studio-base/src/providers/CurrentLayoutProvider/IncompatibleLayoutVersionAlert.tsx","webpack:///../../packages/studio-base/src/providers/CurrentLayoutProvider/index.tsx","webpack:///../../packages/studio-base/src/providers/ExtensionCatalogProvider.tsx","webpack:///../../packages/studio-base/src/providers/ExtensionMarketplaceProvider.tsx","webpack:///../../packages/studio-base/src/context/RemoteLayoutStorageContext.ts","webpack:///../../packages/studio-base/src/services/ILayoutStorage.ts","webpack:///../../packages/studio-base/src/services/LayoutManager/NamespacedLayoutStorage.ts","webpack:///../../packages/studio-base/src/services/LayoutManager/WriteThroughLayoutCache.ts","webpack:///../../packages/studio-base/src/services/LayoutManager/compareLayouts.ts","webpack:///../../packages/studio-base/src/services/LayoutManager/computeLayoutSyncOperations.ts","webpack:///../../packages/studio-base/src/services/migrateLayout/replacePanel.ts","webpack:///../../packages/studio-base/src/services/migrateLayout/migrateLegacyToNew3DPanels.ts","webpack:///../../packages/studio-base/src/services/migrateLayout/migrateLegacyToNewImagePanels.ts","webpack:///../../packages/studio-base/src/services/migrateLayout/migrateLayout.ts","webpack:///../../packages/studio-base/src/services/LayoutManager/LayoutManager.ts","webpack:///../../packages/studio-base/src/util/delay.ts","webpack:///../../packages/studio-base/src/providers/LayoutManagerProvider.tsx","webpack:///../../packages/studio-base/src/panels/index.ts","webpack:///../../packages/studio-base/src/providers/PanelCatalogProvider.tsx","webpack:///../../packages/studio-base/src/providers/UserProfileLocalStorageProvider.tsx","webpack:///../../packages/studio-base/src/screens/LaunchPreferenceScreen.tsx","webpack:///../../packages/studio-base/src/screens/LaunchingInDesktopScreen.tsx","webpack:///../../packages/studio-base/src/screens/LaunchPreference.tsx","webpack:///../../packages/studio-base/src/App.tsx","webpack:///../../packages/studio-base/src/util/installDevtoolsFormatters.ts","webpack:///../../packages/studio-base/src/util/waitForFonts.ts","webpack:///../../packages/studio-base/src/i18n/en/addPanel.ts","webpack:///../../packages/studio-base/src/i18n/en/appBar.ts","webpack:///../../packages/studio-base/src/i18n/en/appSettings.ts","webpack:///../../packages/studio-base/src/i18n/en/dataSourceInfo.ts","webpack:///../../packages/studio-base/src/i18n/en/general.ts","webpack:///../../packages/studio-base/src/i18n/en/incompatibleLayoutVersion.ts","webpack:///../../packages/studio-base/src/i18n/en/log.ts","webpack:///../../packages/studio-base/src/i18n/en/openDialog.ts","webpack:///../../packages/studio-base/src/i18n/en/panelConfigVersionGuard.ts","webpack:///../../packages/studio-base/src/i18n/en/panels.ts","webpack:///../../packages/studio-base/src/i18n/en/panelSettings.ts","webpack:///../../packages/studio-base/src/i18n/en/plot.ts","webpack:///../../packages/studio-base/src/i18n/en/settingsEditor.ts","webpack:///../../packages/studio-base/src/i18n/en/threeDee.ts","webpack:///../../packages/studio-base/src/i18n/ja/appSettings.ts","webpack:///../../packages/studio-base/src/i18n/ja/general.ts","webpack:///../../packages/studio-base/src/i18n/ja/panels.ts","webpack:///../../packages/studio-base/src/i18n/ja/addPanel.ts","webpack:///../../packages/studio-base/src/i18n/ja/panelSettings.ts","webpack:///../../packages/studio-base/src/i18n/ja/log.ts","webpack:///../../packages/studio-base/src/i18n/ja/plot.ts","webpack:///../../packages/studio-base/src/i18n/ja/dataSourceInfo.ts","webpack:///../../packages/studio-base/src/i18n/ja/openDialog.ts","webpack:///../../packages/studio-base/src/i18n/ja/settingsEditor.ts","webpack:///../../packages/studio-base/src/i18n/ja/threeDee.ts","webpack:///../../packages/studio-base/src/i18n/ja/appBar.ts","webpack:///../../packages/studio-base/src/i18n/zh/appSettings.ts","webpack:///../../packages/studio-base/src/i18n/zh/general.ts","webpack:///../../packages/studio-base/src/i18n/zh/panels.ts","webpack:///../../packages/studio-base/src/i18n/zh/addPanel.ts","webpack:///../../packages/studio-base/src/i18n/zh/panelSettings.ts","webpack:///../../packages/studio-base/src/i18n/zh/log.ts","webpack:///../../packages/studio-base/src/i18n/zh/plot.ts","webpack:///../../packages/studio-base/src/i18n/zh/dataSourceInfo.ts","webpack:///../../packages/studio-base/src/i18n/zh/openDialog.ts","webpack:///../../packages/studio-base/src/i18n/zh/settingsEditor.ts","webpack:///../../packages/studio-base/src/i18n/zh/threeDee.ts","webpack:///../../packages/studio-base/src/i18n/zh/appBar.ts","webpack:///../../packages/studio-base/src/i18n/index.ts","webpack:///../../packages/studio-base/src/services/IdbExtensionStorage.ts","webpack:///../../packages/studio-base/src/services/IdbExtensionLoader.ts","webpack:///../../packages/mcap-support/src/parseJsonSchema.ts","webpack:///../../packages/mcap-support/src/protobufDefinitionsToDatatypes.ts","webpack:///../../packages/mcap-support/src/parseFlatbufferSchema.ts","webpack:///../../packages/mcap-support/src/parseProtobufSchema.ts","webpack:///../../packages/mcap-support/src/parseChannel.ts","webpack:///../../packages/studio-base/src/players/PlayerProblemManager.ts","webpack:///../../packages/studio-base/src/util/rosDatatypesToMessageDefinition.ts","webpack:///../../packages/studio-base/src/players/FoxgloveWebSocketPlayer/JsonMessageWriter.ts","webpack:///../../packages/studio-base/src/players/FoxgloveWebSocketPlayer/WorkerSocketAdapter.ts","webpack:///../../packages/studio-base/src/players/FoxgloveWebSocketPlayer/index.ts","webpack:///../../packages/studio-base/src/dataSources/FoxgloveWebSocketDataSourceFactory.ts","webpack:///../../packages/studio-base/src/players/NoopMetricsCollector.ts","webpack:///../../packages/studio-base/src/players/IterablePlayer/IteratorCursor.ts","webpack:///../../packages/studio-base/src/players/IterablePlayer/BlockLoader.ts","webpack:///../../packages/den/collection/VecQueue.ts","webpack:///../../packages/den/collection/binarySearch.ts","webpack:///../../packages/den/collection/minIndexBy.ts","webpack:///../../packages/studio-base/src/players/IterablePlayer/CachingIterableSource.ts","webpack:///../../packages/studio-base/src/players/IterablePlayer/BufferedIterableSource.ts","webpack:///../../packages/studio-base/src/players/IterablePlayer/IterablePlayer.ts","webpack:///../../packages/comlink-transfer-handlers/src/abortSignalTransferHandler.ts","webpack:///../../packages/studio-base/src/players/IterablePlayer/WorkerIterableSource.ts","webpack:///../../packages/studio-base/src/dataSources/Ros1LocalBagDataSourceFactory.ts","webpack:///../../packages/studio-base/src/players/Ros1Player.ts","webpack:///../../packages/studio-base/src/dataSources/Ros1SocketDataSourceFactory.ts","webpack:///../../packages/studio-base/src/dataSources/Ros2LocalBagDataSourceFactory.ts","webpack:///../../packages/studio-base/src/util/bagConnectionsHelper.ts","webpack:///../../packages/studio-base/src/players/RosbridgePlayer.ts","webpack:///../../packages/studio-base/src/dataSources/RosbridgeDataSourceFactory.ts","webpack:///../../packages/studio-base/src/dataSources/UlogLocalDataSourceFactory.ts","webpack:///../../packages/studio-base/src/dataSources/RemoteDataSourceFactory.tsx","webpack:///../../packages/studio-base/src/players/VelodynePlayer.ts","webpack:///../../packages/studio-base/src/dataSources/VelodyneDataSourceFactory.ts","webpack:///../../packages/studio-base/src/dataSources/McapLocalDataSourceFactory.ts","webpack:///../../packages/studio-base/src/dataSources/SampleNuscenesDataSourceFactory.ts","webpack:///../../packages/studio-base/src/panels/ThreeDeeRender/SceneExtension.ts","webpack:///../../packages/studio-base/src/panels/ThreeDeeRender/camera.ts","webpack:///../../packages/studio-base/src/panels/ThreeDeeRender/renderables/PublishSettings.ts","webpack:///../../packages/studio-base/src/panels/ThreeDeeRender/renderables/transforms.ts","webpack:///../../packages/studio-base/src/panels/ThreeDeeRender/transforms/geometry.ts","webpack:///../../packages/den/collection/ArrayMap.ts","webpack:///../../packages/studio-base/src/panels/ThreeDeeRender/transforms/Transform.ts","webpack:///../../packages/studio-base/src/panels/ThreeDeeRender/transforms/time.ts","webpack:///../../packages/studio-base/src/panels/ThreeDeeRender/transforms/CoordinateFrame.ts","webpack:///../../packages/studio-base/src/panels/ThreeDeeRender/transforms/TransformTree.ts","webpack:///../../packages/studio-base/src/panels/ThreeDeeRender/updatePose.ts","webpack:///../../packages/studio-base/src/players/UserNodePlayer/nodeTransformerWorker/generateTypesLib.ts","webpack:///../../packages/studio-base/src/players/UserNodePlayer/nodeTransformerWorker/typescript/ros.ts","webpack:///../../packages/studio-base/src/players/UserNodePlayer/nodeTransformerWorker/typescript/userUtils/time.ts","webpack:///../../packages/studio-base/src/players/UserNodePlayer/types.ts","webpack:///../../packages/studio-base/src/players/types.ts","webpack:///../../packages/studio-base/src/providers/PanelStateContextProvider.tsx","webpack:///../../packages/studio-base/src/reportError.ts","webpack:///../../packages/studio-base/src/services/IAnalytics.ts","webpack:///../../packages/studio-base/src/theme/ThemeProvider.tsx","webpack:///../../packages/studio-base/src/util/Rpc.ts","webpack:///../../packages/studio-base/src/util/assertNever.ts","webpack:///../../packages/studio-base/src/util/clipboard.ts","webpack:///../../packages/studio-base/src/util/download.ts","webpack:///../../packages/studio-base/src/util/errors.ts","webpack:///../../packages/studio-base/src/util/parseFuzzyRosTime.ts","webpack:///../../packages/studio-base/src/util/formatTime.ts","webpack:///../../packages/studio-base/src/util/globalConstants.ts","webpack:///../../packages/studio-base/src/util/isDesktopApp.ts","webpack:///../../packages/studio-base/src/util/layout.ts","webpack:///../../packages/studio-base/src/util/maybeCast.ts","webpack:///../../packages/studio-base/src/util/mightActuallyBePartial.ts","webpack:///../../packages/studio-base/src/util/overwriteFetch.ts","webpack:///../../packages/studio-base/src/util/process.ts","webpack:///../../packages/studio-base/src/util/selectors.ts","webpack:///../../packages/studio-base/src/util/sendNotification.ts","webpack:///../../packages/studio-base/src/util/setImmediate.ts","webpack:///../../packages/studio-base/src/util/time.ts","webpack:///../../packages/studio-base/src/util/workers.ts"],"sourcesContent":["// Generated automatically by nearley, version unknown\n// http://github.com/Hardmath123/nearley\n(function () {\nfunction id(x) { return x[0]; }\nvar grammar = {\n    Lexer: undefined,\n    ParserRules: [\n    {\"name\": \"main$ebnf$1\", \"symbols\": [\"messagePath\"], \"postprocess\": id},\n    {\"name\": \"main$ebnf$1\", \"symbols\": [], \"postprocess\": function(d) {return null;}},\n    {\"name\": \"main$ebnf$2\", \"symbols\": [\"modifier\"], \"postprocess\": id},\n    {\"name\": \"main$ebnf$2\", \"symbols\": [], \"postprocess\": function(d) {return null;}},\n    {\"name\": \"main\", \"symbols\": [\"topicName\", \"main$ebnf$1\", \"main$ebnf$2\"], \"postprocess\": (d) => ({ topicName: d[0].value, topicNameRepr: d[0].repr, messagePath: d[1] || [], modifier: d[2] })},\n    {\"name\": \"id$ebnf$1\", \"symbols\": [/[a-zA-Z0-9_-]/]},\n    {\"name\": \"id$ebnf$1\", \"symbols\": [\"id$ebnf$1\", /[a-zA-Z0-9_-]/], \"postprocess\": function arrpush(d) {return d[0].concat([d[1]]);}},\n    {\"name\": \"id\", \"symbols\": [\"id$ebnf$1\"], \"postprocess\": (d) => d[0].join(\"\")},\n    {\"name\": \"integer$ebnf$1\", \"symbols\": [{\"literal\":\"-\"}], \"postprocess\": id},\n    {\"name\": \"integer$ebnf$1\", \"symbols\": [], \"postprocess\": function(d) {return null;}},\n    {\"name\": \"integer$ebnf$2\", \"symbols\": [/[0-9]/]},\n    {\"name\": \"integer$ebnf$2\", \"symbols\": [\"integer$ebnf$2\", /[0-9]/], \"postprocess\": function arrpush(d) {return d[0].concat([d[1]]);}},\n    {\"name\": \"integer\", \"symbols\": [\"integer$ebnf$1\", \"integer$ebnf$2\"], \"postprocess\": (d) => ({ value: BigInt((d[0] ?? \"\") + d[1].join(\"\")), repr: (d[0] ?? \"\") + d[1].join(\"\") })},\n    {\"name\": \"string$ebnf$1\", \"symbols\": []},\n    {\"name\": \"string$ebnf$1\", \"symbols\": [\"string$ebnf$1\", /[^']/], \"postprocess\": function arrpush(d) {return d[0].concat([d[1]]);}},\n    {\"name\": \"string\", \"symbols\": [{\"literal\":\"'\"}, \"string$ebnf$1\", {\"literal\":\"'\"}], \"postprocess\": (d) => ({ value: d[1].join(\"\"), repr: `'${d[1].join(\"\")}'` })},\n    {\"name\": \"string$ebnf$2\", \"symbols\": []},\n    {\"name\": \"string$ebnf$2\", \"symbols\": [\"string$ebnf$2\", /[^\"]/], \"postprocess\": function arrpush(d) {return d[0].concat([d[1]]);}},\n    {\"name\": \"string\", \"symbols\": [{\"literal\":\"\\\"\"}, \"string$ebnf$2\", {\"literal\":\"\\\"\"}], \"postprocess\": (d) => ({ value: d[1].join(\"\"), repr: `\"${d[1].join(\"\")}\"` })},\n    {\"name\": \"variable$ebnf$1\", \"symbols\": [\"id\"], \"postprocess\": id},\n    {\"name\": \"variable$ebnf$1\", \"symbols\": [], \"postprocess\": function(d) {return null;}},\n    {\"name\": \"variable\", \"symbols\": [{\"literal\":\"$\"}, \"variable$ebnf$1\"], \"postprocess\": (d, loc) => ({ value: {variableName: d[1] || \"\", startLoc: loc }, repr: `$${d[1] || \"\"}` })},\n    {\"name\": \"value\", \"symbols\": [\"integer\"], \"postprocess\": (d) => d[0]},\n    {\"name\": \"value\", \"symbols\": [\"string\"], \"postprocess\": (d) => d[0]},\n    {\"name\": \"value$string$1\", \"symbols\": [{\"literal\":\"t\"}, {\"literal\":\"r\"}, {\"literal\":\"u\"}, {\"literal\":\"e\"}], \"postprocess\": function joiner(d) {return d.join('');}},\n    {\"name\": \"value\", \"symbols\": [\"value$string$1\"], \"postprocess\": (d) => ({ value: true, repr: \"true\" })},\n    {\"name\": \"value$string$2\", \"symbols\": [{\"literal\":\"f\"}, {\"literal\":\"a\"}, {\"literal\":\"l\"}, {\"literal\":\"s\"}, {\"literal\":\"e\"}], \"postprocess\": function joiner(d) {return d.join('');}},\n    {\"name\": \"value\", \"symbols\": [\"value$string$2\"], \"postprocess\": (d) => ({ value: false, repr: \"false\" })},\n    {\"name\": \"value\", \"symbols\": [\"variable\"], \"postprocess\": (d) => d[0]},\n    {\"name\": \"topicName$ebnf$1\", \"symbols\": [\"slashID\"]},\n    {\"name\": \"topicName$ebnf$1\", \"symbols\": [\"topicName$ebnf$1\", \"slashID\"], \"postprocess\": function arrpush(d) {return d[0].concat([d[1]]);}},\n    {\"name\": \"topicName\", \"symbols\": [\"topicName$ebnf$1\"], \"postprocess\": (d) => ({ value: d[0].join(\"\"), repr: d[0].join(\"\") })},\n    {\"name\": \"topicName$ebnf$2\", \"symbols\": []},\n    {\"name\": \"topicName$ebnf$2\", \"symbols\": [\"topicName$ebnf$2\", \"slashID\"], \"postprocess\": function arrpush(d) {return d[0].concat([d[1]]);}},\n    {\"name\": \"topicName\", \"symbols\": [\"id\", \"topicName$ebnf$2\"], \"postprocess\": (d) => ({ value: d[0] + d[1].join(\"\"), repr: d[0] + d[1].join(\"\") })},\n    {\"name\": \"topicName\", \"symbols\": [\"quotedString\"], \"postprocess\": id},\n    {\"name\": \"slashID$ebnf$1\", \"symbols\": [\"id\"], \"postprocess\": id},\n    {\"name\": \"slashID$ebnf$1\", \"symbols\": [], \"postprocess\": function(d) {return null;}},\n    {\"name\": \"slashID\", \"symbols\": [{\"literal\":\"/\"}, \"slashID$ebnf$1\"], \"postprocess\": (d) => d.join(\"\")},\n    {\"name\": \"quotedString$ebnf$1\", \"symbols\": []},\n    {\"name\": \"quotedString$ebnf$1$subexpression$1\", \"symbols\": [/[^\"\\\\]/]},\n    {\"name\": \"quotedString$ebnf$1$subexpression$1$string$1\", \"symbols\": [{\"literal\":\"\\\\\"}, {\"literal\":\"\\\\\"}], \"postprocess\": function joiner(d) {return d.join('');}},\n    {\"name\": \"quotedString$ebnf$1$subexpression$1\", \"symbols\": [\"quotedString$ebnf$1$subexpression$1$string$1\"], \"postprocess\": d => \"\\\\\"},\n    {\"name\": \"quotedString$ebnf$1$subexpression$1$string$2\", \"symbols\": [{\"literal\":\"\\\\\"}, {\"literal\":\"\\\"\"}], \"postprocess\": function joiner(d) {return d.join('');}},\n    {\"name\": \"quotedString$ebnf$1$subexpression$1\", \"symbols\": [\"quotedString$ebnf$1$subexpression$1$string$2\"], \"postprocess\": d => `\"`},\n    {\"name\": \"quotedString$ebnf$1\", \"symbols\": [\"quotedString$ebnf$1\", \"quotedString$ebnf$1$subexpression$1\"], \"postprocess\": function arrpush(d) {return d[0].concat([d[1]]);}},\n    {\"name\": \"quotedString\", \"symbols\": [{\"literal\":\"\\\"\"}, \"quotedString$ebnf$1\", {\"literal\":\"\\\"\"}], \"postprocess\": \n        d => ({\n          value: d[1].join(''),\n          repr: `\"${d[1].join('').replace(/[\\\\\"]/g, char => `\\\\${char}`)}\"`\n        })\n          },\n    {\"name\": \"messagePath$ebnf$1\", \"symbols\": []},\n    {\"name\": \"messagePath$ebnf$1\", \"symbols\": [\"messagePath$ebnf$1\", \"messagePathElement\"], \"postprocess\": function arrpush(d) {return d[0].concat([d[1]]);}},\n    {\"name\": \"messagePath$ebnf$2\", \"symbols\": [{\"literal\":\".\"}], \"postprocess\": id},\n    {\"name\": \"messagePath$ebnf$2\", \"symbols\": [], \"postprocess\": function(d) {return null;}},\n    {\"name\": \"messagePath\", \"symbols\": [\"messagePath$ebnf$1\", \"messagePath$ebnf$2\"], \"postprocess\": \n        (d) =>\n          d[0]\n            .reduce((acc, arr) => acc.concat(arr), [])\n            .concat(d[1] ? [{ type: \"name\", name: \"\", repr: \"\" }] : [])\n          },\n    {\"name\": \"messagePathElement$ebnf$1\", \"symbols\": [\"slice\"], \"postprocess\": id},\n    {\"name\": \"messagePathElement$ebnf$1\", \"symbols\": [], \"postprocess\": function(d) {return null;}},\n    {\"name\": \"messagePathElement$ebnf$2\", \"symbols\": [\"filter\"], \"postprocess\": id},\n    {\"name\": \"messagePathElement$ebnf$2\", \"symbols\": [], \"postprocess\": function(d) {return null;}},\n    {\"name\": \"messagePathElement\", \"symbols\": [{\"literal\":\".\"}, \"name\", \"messagePathElement$ebnf$1\", \"messagePathElement$ebnf$2\"], \"postprocess\": (d) => [d[1], d[2], d[3]].filter(x => x !== null)},\n    {\"name\": \"messagePathElement\", \"symbols\": [\"filter\"], \"postprocess\": id},\n    {\"name\": \"name\", \"symbols\": [\"id\"], \"postprocess\": (d) => ({ type: \"name\", name: d[0], repr: d[0] })},\n    {\"name\": \"name\", \"symbols\": [\"quotedString\"], \"postprocess\": (d) => ({ type: \"name\", name: d[0].value, repr: d[0].repr })},\n    {\"name\": \"sliceVal\", \"symbols\": [\"integer\"], \"postprocess\": (d) => Number(d[0].value)},\n    {\"name\": \"sliceVal\", \"symbols\": [\"variable\"], \"postprocess\": (d) => (d[0].value)},\n    {\"name\": \"slice\", \"symbols\": [{\"literal\":\"[\"}, \"sliceVal\", {\"literal\":\"]\"}], \"postprocess\": (d) => ({ type: \"slice\", start: d[1], end: d[1] })},\n    {\"name\": \"slice$ebnf$1\", \"symbols\": [\"sliceVal\"], \"postprocess\": id},\n    {\"name\": \"slice$ebnf$1\", \"symbols\": [], \"postprocess\": function(d) {return null;}},\n    {\"name\": \"slice$ebnf$2\", \"symbols\": [\"sliceVal\"], \"postprocess\": id},\n    {\"name\": \"slice$ebnf$2\", \"symbols\": [], \"postprocess\": function(d) {return null;}},\n    {\"name\": \"slice\", \"symbols\": [{\"literal\":\"[\"}, \"slice$ebnf$1\", {\"literal\":\":\"}, \"slice$ebnf$2\", {\"literal\":\"]\"}], \"postprocess\": (d) => ({ type: \"slice\", start: d[1] === null ? 0 : d[1], end: d[3] === null ? Infinity : d[3] })},\n    {\"name\": \"simplePath$ebnf$1\", \"symbols\": []},\n    {\"name\": \"simplePath$ebnf$1$subexpression$1\", \"symbols\": [{\"literal\":\".\"}, \"id\"]},\n    {\"name\": \"simplePath$ebnf$1\", \"symbols\": [\"simplePath$ebnf$1\", \"simplePath$ebnf$1$subexpression$1\"], \"postprocess\": function arrpush(d) {return d[0].concat([d[1]]);}},\n    {\"name\": \"simplePath\", \"symbols\": [\"id\", \"simplePath$ebnf$1\"], \"postprocess\": (d) => [d[0]].concat(d[1].map((d) => d[1]))},\n    {\"name\": \"filter$ebnf$1\", \"symbols\": [\"simplePath\"], \"postprocess\": id},\n    {\"name\": \"filter$ebnf$1\", \"symbols\": [], \"postprocess\": function(d) {return null;}},\n    {\"name\": \"filter\", \"symbols\": [{\"literal\":\"{\"}, \"filter$ebnf$1\", {\"literal\":\"}\"}], \"postprocess\": \n        (d, loc) => ({\n          type: \"filter\",\n          path: d[1] || [],\n          value: undefined,\n          nameLoc: loc+1,\n          valueLoc: loc+1,\n          repr: (d[1] || []).join(\".\"),\n        })\n                    },\n    {\"name\": \"filter$ebnf$2\", \"symbols\": [\"simplePath\"], \"postprocess\": id},\n    {\"name\": \"filter$ebnf$2\", \"symbols\": [], \"postprocess\": function(d) {return null;}},\n    {\"name\": \"filter$string$1\", \"symbols\": [{\"literal\":\"=\"}, {\"literal\":\"=\"}], \"postprocess\": function joiner(d) {return d.join('');}},\n    {\"name\": \"filter\", \"symbols\": [{\"literal\":\"{\"}, \"filter$ebnf$2\", \"filter$string$1\", \"value\", {\"literal\":\"}\"}], \"postprocess\": \n        (d, loc) => ({\n          type: \"filter\",\n          path: d[1] || [],\n          value: d[3].value,\n          nameLoc: loc+1,\n          valueLoc: loc+1+(d[1] || []).join(\".\").length+d[2].length,\n          repr: `${(d[1] || []).join(\".\")}==${d[3].repr}`,\n        })\n                    },\n    {\"name\": \"modifier$string$1\", \"symbols\": [{\"literal\":\".\"}, {\"literal\":\"@\"}], \"postprocess\": function joiner(d) {return d.join('');}},\n    {\"name\": \"modifier$ebnf$1\", \"symbols\": [\"id\"], \"postprocess\": id},\n    {\"name\": \"modifier$ebnf$1\", \"symbols\": [], \"postprocess\": function(d) {return null;}},\n    {\"name\": \"modifier\", \"symbols\": [\"modifier$string$1\", \"modifier$ebnf$1\"], \"postprocess\": (d) => d[1] || \"\"}\n]\n  , ParserStart: \"main\"\n}\nif (typeof module !== 'undefined'&& typeof module.exports !== 'undefined') {\n   module.exports = grammar;\n} else {\n   window.grammar = grammar;\n}\n})();\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\n/**\n * Holds a value generated from a calling a given async function. The function is called at most\n * once and is not called until the first `get()` of the LazilyInitialized object.\n */\nexport default class LazilyInitialized<T> {\n  // The promise and compute function are held separately so the function can be garbage collected\n  // when it is no longer needed.\n  #state: { promise: Promise<T> } | { promise?: undefined; compute: () => Promise<T> };\n\n  public constructor(compute: () => Promise<T>) {\n    this.#state = { compute };\n  }\n\n  public async get(): Promise<T> {\n    if (this.#state.promise) {\n      return await this.#state.promise;\n    }\n    const promise = this.#state.compute();\n    this.#state = { promise };\n    return await promise;\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Mutex } from \"async-mutex\";\n\n/**\n * A wrapper around an object that ensures all accesses are guarded by a mutex lock.\n *\n * This is less race-prone than using an async-mutex directly because it requires all external\n * access to be protected by the mutex.\n */\nexport default class MutexLocked<T> {\n  #mutex = new Mutex();\n  public constructor(private value: T) {}\n\n  public async runExclusive<Result>(body: (value: T) => Promise<Result>): Promise<Result> {\n    return await this.#mutex.runExclusive(async () => await body(this.value));\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\ntype DebouncedFn<Args extends unknown[]> = ((...args: Args) => void) & {\n  // the currently executing promise, if any\n  currentPromise?: Promise<void>;\n};\n\n// debouncePromise returns a function which wraps calls to `fn`.\n// The returned debounceFn ensures that only one `fn` call is executing at a time.\n// If debounceFn is called while `fn` is still executing, it will queue the call until the\n// current invocation is complete.\n// If debounceFn is called multiple times while `fn` is still executing, then only the last\n// call's arguments will be saved for the next execution of `fn`.\nexport default function debouncePromise<Args extends unknown[]>(\n  fn: (...args: Args) => Promise<void>,\n): DebouncedFn<Args> {\n  // Whether we are currently waiting for a promise returned by `fn` to resolve.\n  let calling = false;\n  // Whether another call to the debounced function was made while a call was in progress.\n  let callPending: Args | undefined;\n\n  const debouncedFn: DebouncedFn<Args> = (...args: Args) => {\n    if (calling) {\n      callPending = args;\n    } else {\n      start(args);\n    }\n  };\n\n  function start(args: Args) {\n    calling = true;\n    callPending = undefined;\n\n    debouncedFn.currentPromise = fn(...args).finally(() => {\n      calling = false;\n      debouncedFn.currentPromise = undefined;\n      if (callPending) {\n        start(callPending);\n      }\n    });\n  }\n\n  return debouncedFn;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\n/** Error for promise timeouts from `promiseTimeout()` */\nclass PromiseTimeoutError extends Error {\n  public override name = \"PromiseTimeoutError\";\n}\n\n/**\n * Executes a promise with a timeout.\n *\n * If the promise takes longer than the specified timeout duration (in milliseconds), it will be\n * rejected with a timeout error.\n *\n * Note: Make sure the input promise resolves, rejects, or otherwise go out of scope. A long-lived\n * promise that never resolves holds onto its resolution callbacks.\n *\n * @param promise The promise to execute\n * @param ms The timeout duration in milliseconds.\n * @returns A promise that resolves with the result of the input promise or rejects with a\n * PromiseTimeoutError.\n */\nasync function promiseTimeout<T>(promise: Promise<T>, ms: number): Promise<T> {\n  // We avoid using Promise.race here since it is susceptible to memory leaks for unresolved promises\n  // https://github.com/nodejs/node/issues/17469\n  //\n  // With Promise.race you might be tempted to race the input promise against a promise that resolve\n  // after a timeout. However, if you clear the timeout when the input promise resolves, you'll be\n  // left with a promise that never resolves passed as a contender to `Promise.race`.\n  return await new Promise<T>((resolve, reject) => {\n    const id = setTimeout(() => {\n      reject(new PromiseTimeoutError(`Promise timed out after ${ms}ms`));\n    }, ms);\n    promise.then(resolve, reject).finally(() => {\n      clearTimeout(id);\n    });\n  });\n}\n\nexport { promiseTimeout, PromiseTimeoutError };\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\n/**\n * Condvar provides a condition variable interface for async code\n *\n * Callers can wait on the condition variable and other callers can notify any\n * waiters. An example use case could be a producer/consumer queue where the consumer\n * waits for the producer to notify it that there are items to consume.\n *\n * See: https://en.wikipedia.org/wiki/Monitor_(synchronization)#Condition_variables_2\n */\nclass Condvar {\n  #waitQueue: Array<() => void> = [];\n\n  /**\n   * Wait on a notification.\n   *\n   * @return a promise which resolves when notified.\n   *\n   * ```\n   * await condvar.wait();\n   * ```\n   */\n  public async wait(): Promise<void> {\n    await new Promise<void>((resolve) => {\n      this.#waitQueue.push(resolve);\n    });\n  }\n\n  /**\n   * Notify one wait.\n   */\n  public notifyOne(): void {\n    const item = this.#waitQueue.shift();\n    item?.();\n  }\n\n  /**\n   * Notify all waiting.\n   */\n  public notifyAll(): void {\n    for (const item of this.#waitQueue) {\n      item();\n    }\n    this.#waitQueue.length = 0;\n  }\n}\n\nexport { Condvar };\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\n/**\n * filterMap creates a new array populated with the results of calling a provided function on every\n * element in the calling array. Results which resolve to a javascript \"false\" value are discarded\n * from the array.\n *\n * This is a more efficient version of [...values].map(mapFn).filter(Boolean) that avoids two\n * iterations of the array.\n */\nexport default function filterMap<T, U>(\n  values: Iterable<T>,\n  mapFn: (arg0: T, arg1: number) => U | undefined,\n): U[] {\n  const results: Array<U> = [];\n  let index = 0;\n  for (const item of values) {\n    const mappedItem = mapFn(item, index++);\n    // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n    if (mappedItem) {\n      results.push(mappedItem);\n    }\n  }\n  return results;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { useRef } from \"react\";\nimport shallowequal from \"shallowequal\";\n\n/**\n * Return initiallyTrue the first time, and again if any of the given deps have changed.\n * @deprecated Render functions may be called more than once before effects are run, so relying on\n * the result of useChangeDetector is dangerous. Instead, track the previously used values at the\n * point they are being used.\n */\nexport default function useChangeDetector(\n  deps: unknown[],\n  { initiallyTrue }: { initiallyTrue: boolean },\n): boolean {\n  const ref = useRef(initiallyTrue ? undefined : deps);\n  const changed = !shallowequal(ref.current, deps);\n  ref.current = deps;\n  return changed;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { isEqual } from \"lodash\";\nimport { useRef } from \"react\";\n\n// Continues to return the same instance as long as deep equality is maintained.\nexport default function useDeepMemo<T>(value: T): T {\n  const ref = useRef(value);\n  if (isEqual(value, ref.current)) {\n    return ref.current;\n  }\n  ref.current = value;\n  return value;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { useContext, Context } from \"react\";\n\nexport default function useGuaranteedContext<T>(\n  contextType: Context<T | undefined>,\n  debugContextName?: string,\n): T {\n  const context = useContext(contextType);\n  if (context == undefined) {\n    throw new Error(\n      `useGuaranteedContext got null for contextType${\n        debugContextName != undefined ? `: '${debugContextName}'` : \"\"\n      }`,\n    );\n  }\n  return context;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useRef } from \"react\";\n\nimport Logger from \"@foxglove/log\";\n\nconst log = Logger.getLogger(__filename);\n\nconst useMustNotChangeImpl = (value: unknown): void => {\n  const valueRef = useRef<unknown | undefined>(value);\n  if (valueRef.current !== value) {\n    log.error(\"Value must not change\", valueRef.current);\n  }\n  valueRef.current = value;\n};\n\nconst noOpImpl = () => {};\n\n/**\n * useMustNotChange throws if the value provided as the first argument ever changes.\n *\n * Note: In production builds this hook is a no-op.\n *\n */\nconst useMustNotChange = process.env.NODE_ENV !== \"development\" ? noOpImpl : useMustNotChangeImpl;\n\nexport default useMustNotChange;\n\n// for tests\nexport { useMustNotChangeImpl };\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useCallback, useState } from \"react\";\n\ntype Fn<A extends unknown[], R> = (...args: A) => R;\n\n/**\n * React error boundaries do not catch errors from user event handlers (clicks, etc).\n * This hook wraps a function which may throw, and re-throws the error within a render context.\n * This allows react error boundaries to capture the error.\n *\n * see: https://github.com/facebook/react/issues/11409\n * @param fn function to wrap in a try/catch\n * @returns wrapped fn with the same signature as fn\n */\nexport default function useRethrow<Args extends unknown[], Ret>(\n  fn: Fn<Args, Ret>,\n): Fn<Args, Ret | void> {\n  const [_, setError] = useState(undefined);\n  return useCallback(\n    (...args: Args): Ret | void => {\n      try {\n        return fn(...args);\n      } catch (err) {\n        // throwing within a setError happens within a react render context\n        setError(() => {\n          throw err;\n        });\n      }\n    },\n    [fn],\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\nimport { useRef } from \"react\";\nimport shallowequal from \"shallowequal\";\n\n/** Continues to return the same instance as long as shallow equality is maintained. */\nexport default function useShallowMemo<T>(value: T): T {\n  const ref = useRef(value);\n  if (shallowequal(value, ref.current)) {\n    return ref.current;\n  }\n  ref.current = value;\n  return value;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useRef, useLayoutEffect } from \"react\";\n\nimport Logger from \"@foxglove/log\";\n\nconst log = Logger.getLogger(__filename);\n\nconst noOpImpl = () => {};\n\nfunction useValueChangedDebugLogImpl(value: unknown, msg: string): void {\n  const prevValue = useRef<unknown>(value);\n  if (prevValue.current !== value) {\n    log.debug(`value changed: ${msg}`);\n  }\n  useLayoutEffect(() => {\n    prevValue.current = value;\n  });\n}\n\n/**\n * useValueChangedDebugLog logs `msg` if `value` changes\n *\n * Note: In production builds this hook is a no-op.\n */\nconst useValueChangedDebugLog =\n  process.env.NODE_ENV !== \"development\" && process.env.NODE_ENV !== \"test\"\n    ? noOpImpl\n    : useValueChangedDebugLogImpl;\n\nexport default useValueChangedDebugLog;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\nimport { useState, useEffect } from \"react\";\n\n/** Returns the value of `document.visibilityState` and tracks changes. */\nexport default function useVisibilityState(): DocumentVisibilityState {\n  const [visibility, setVisibility] = useState(document.visibilityState);\n  useEffect(() => {\n    // Update if state changed between the initial call and this effect\n    setVisibility(document.visibilityState);\n\n    const listener = () => setVisibility(document.visibilityState);\n    document.addEventListener(\"visibilitychange\", listener);\n    return () => document.removeEventListener(\"visibilitychange\", listener);\n  }, []);\n  return visibility;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\nimport { useLayoutEffect, useRef } from \"react\";\n\nimport Log from \"@foxglove/log\";\n\nconst log = Log.getLogger(__filename);\n\n// useWarnImmediateReRender will warn if the component re-renders before the next animation frame\n// This typically indicates that the component state is changing in rapid succession and more\n// work is being done than necessary.\n//\n// Note: This detects state change triggers in useLayoutEffect. It does not detect state changes from\n// useEffect which run on the next animation frame.\nconst useWarnImmediateReRender =\n  process.env.NODE_ENV !== \"development\"\n    ? () => {}\n    : () => {\n        const renderedRef = useRef(false);\n        useLayoutEffect(() => {\n          if (renderedRef.current) {\n            log.warn(\"Component re-rendered immediately\");\n          }\n          renderedRef.current = true;\n          const raf = requestAnimationFrame(() => {\n            renderedRef.current = false;\n          });\n          return () => cancelAnimationFrame(raf);\n        });\n      };\n\nexport default useWarnImmediateReRender;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\n// foxglove-depcheck-used: @types/foxglove__web\n\nimport { useEffect, useState } from \"react\";\n\nimport Logger from \"@foxglove/log\";\n\nconst log = Logger.getLogger(__filename);\n\ntype UseMemoryInfoOptions = {\n  refreshIntervalMs: number;\n};\n\nexport function useMemoryInfo(opt: UseMemoryInfoOptions): MemoryInfo | undefined {\n  const { refreshIntervalMs } = opt;\n  const [memoryInfo, setMemoryInfo] = useState<MemoryInfo | undefined>(window.performance.memory);\n\n  useEffect(() => {\n    if (!window.performance.memory) {\n      log.info(\"No memory information available\");\n      return;\n    }\n\n    const interval = setInterval(() => {\n      setMemoryInfo(window.performance.memory);\n    }, refreshIntervalMs);\n    return () => {\n      clearInterval(interval);\n    };\n  }, [refreshIntervalMs]);\n\n  return memoryInfo;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\nimport Log from \"@foxglove/log\";\n\nconst log = Log.getLogger(__filename);\n\nexport function selectWithUnstableIdentityWarning<T, U>(value: T, selector: (value: T) => U): U {\n  const result = selector(value);\n  if (process.env.NODE_ENV === \"development\") {\n    const secondResult = selector(value);\n    if (result !== secondResult) {\n      log.warn(`Selector ${selector.toString()} produced different values for the same input.\n  This will cause unecesessery re-renders of your component.`);\n    }\n    return secondResult;\n  }\n  return result;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useReducer } from \"react\";\n\n// Throwing in a reducer call will make the error catchable by an error boundary.\nfunction reducer(_: unknown, err: Error) {\n  throw err;\n}\n\n/**\n * useCrash returns a function you can call with an Error instance and it will re-throw the instance\n * within the react loop allowing a react error boundary to handle the error.\n *\n * See: https://reactjs.org/docs/error-boundaries.html#how-about-event-handlers\n */\nexport function useCrash(): (err: Error) => void {\n  const [_, dispatch] = useReducer(reducer, undefined);\n  return dispatch;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useCallback, useEffect, useState } from \"react\";\n\n/**\n * This provides a convenience wrapper around sessionStorage and triggers\n * a react state change when values change.\n *\n * @param key sessionStorage key to manage.\n * @returns [value, setValue] tuple for that key.\n */\nexport function useSessionStorageValue(\n  key: string,\n): [value: string | undefined, setValue: (newValue: string | undefined) => void] {\n  const [value, updateValue] = useState<string | undefined>(\n    sessionStorage.getItem(key) ?? undefined,\n  );\n\n  const setValue = useCallback(\n    (newValue: string | undefined) => {\n      // Hack a manual event for now. Unfortunately the browser only fires \"storage\"\n      // events when triggered outside our current tab.\n      if (newValue) {\n        sessionStorage.setItem(key, newValue);\n        window.dispatchEvent(\n          new StorageEvent(\"storage\", { key, newValue, storageArea: sessionStorage }),\n        );\n      } else {\n        sessionStorage.removeItem(key);\n        window.dispatchEvent(\n          new StorageEvent(\"storage\", { key, newValue: undefined, storageArea: sessionStorage }),\n        );\n      }\n    },\n    [key],\n  );\n\n  const changeListener = useCallback(\n    (event: StorageEvent) => {\n      if (event.key === key) {\n        updateValue(event.newValue ?? undefined);\n      }\n    },\n    [key],\n  );\n\n  useEffect(() => {\n    window.addEventListener(\"storage\", changeListener);\n    return () => window.removeEventListener(\"storage\", changeListener);\n  }, [changeListener]);\n\n  return [value ?? undefined, setValue];\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useCallback, useLayoutEffect, useRef } from \"react\";\n\n/**\n * Registers and unregisters mounted state during useLayoutEffect instead of useEffect.\n *\n * If you're using useLayoutEffect in your component and want to track your component's\n * mounted state you need to use this instead of useMountedState.\n */\nexport function useSynchronousMountedState(): () => boolean {\n  const mountedRef = useRef<boolean>(false);\n  const get = useCallback(() => {\n    return mountedRef.current;\n  }, []);\n\n  useLayoutEffect(() => {\n    mountedRef.current = true;\n\n    return () => {\n      mountedRef.current = false;\n    };\n  }, []);\n\n  return get;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nexport enum AppSetting {\n  // General\n  COLOR_SCHEME = \"colorScheme\",\n  TIMEZONE = \"timezone\",\n  TIME_FORMAT = \"time.format\",\n  MESSAGE_RATE = \"messageRate\",\n  UPDATES_ENABLED = \"updates.enabled\",\n  LANGUAGE = \"language\",\n\n  // ROS\n  ROS_PACKAGE_PATH = \"ros.ros_package_path\",\n\n  // Privacy\n  TELEMETRY_ENABLED = \"telemetry.telemetryEnabled\",\n  CRASH_REPORTING_ENABLED = \"telemetry.crashReportingEnabled\",\n\n  // Experimental features\n  SHOW_DEBUG_PANELS = \"showDebugPanels\",\n\n  // Miscellaneous\n  HIDE_SIGN_IN_PROMPT = \"hideSignInPrompt\",\n  LAUNCH_PREFERENCE = \"launchPreference\",\n  SHOW_OPEN_DIALOG_ON_STARTUP = \"ui.open-dialog-startup\",\n\n  // Dev only\n  ENABLE_LAYOUT_DEBUGGING = \"enableLayoutDebugging\",\n  ENABLE_MEMORY_USE_INDICATOR = \"dev.memory-use-indicator\",\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { useMemo } from \"react\";\n\nimport { Immutable, Time } from \"@foxglove/studio\";\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport { Topic } from \"@foxglove/studio-base/players/types\";\nimport { RosDatatypes } from \"@foxglove/studio-base/types/RosDatatypes\";\n\nfunction selectDatatypes(ctx: MessagePipelineContext) {\n  return ctx.datatypes;\n}\n\nfunction selectTopics(ctx: MessagePipelineContext) {\n  return ctx.sortedTopics;\n}\n\nfunction selectStartTime(ctx: MessagePipelineContext) {\n  return ctx.playerState.activeData?.startTime;\n}\n\nfunction selectCapabilities(ctx: MessagePipelineContext) {\n  return ctx.playerState.capabilities;\n}\n\nfunction selectPlayerId(ctx: MessagePipelineContext) {\n  return ctx.playerState.playerId;\n}\n\n// Metadata about the source of data currently being displayed.\n// This is not expected to change often, usually when changing data sources.\nexport type DataSourceInfo = {\n  topics: readonly Topic[];\n  datatypes: RosDatatypes;\n  capabilities: string[];\n  startTime?: Time; // Only `startTime`, since `endTime` can change rapidly when connected to a live system.\n  playerId: string;\n};\n\n/**\n * Data source info\" encapsulates **rarely-changing** metadata about the source from which\n * Foxglove Studio is loading data.\n *\n * A data source might be a local file, a remote file, or a streaming source.\n */\nexport function useDataSourceInfo(): Immutable<DataSourceInfo> {\n  const datatypes = useMessagePipeline(selectDatatypes);\n  const topics = useMessagePipeline(selectTopics);\n  const startTime = useMessagePipeline(selectStartTime);\n  const capabilities = useMessagePipeline(selectCapabilities);\n  const playerId = useMessagePipeline(selectPlayerId);\n\n  // we want the returned object to have a stable identity\n  return useMemo(() => {\n    return {\n      topics,\n      datatypes,\n      capabilities,\n      startTime,\n      playerId,\n    };\n  }, [capabilities, datatypes, playerId, startTime, topics]);\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { useRef, useMemo, useState, useEffect, useCallback } from \"react\";\nimport { v4 as uuidv4 } from \"uuid\";\n\nimport { useShallowMemo } from \"@foxglove/hooks\";\nimport Log from \"@foxglove/log\";\nimport {\n  useMessagePipeline,\n  MessagePipelineContext,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport useShouldNotChangeOften from \"@foxglove/studio-base/hooks/useShouldNotChangeOften\";\nimport {\n  MessageEvent,\n  PlayerStateActiveData,\n  SubscribePayload,\n  SubscriptionPreloadType,\n} from \"@foxglove/studio-base/players/types\";\n\nconst log = Log.getLogger(__filename);\n\ntype MessageReducer<T> = (arg0: T, message: MessageEvent) => T;\ntype MessagesReducer<T> = (arg0: T, messages: readonly MessageEvent[]) => T;\n\ntype Params<T> = {\n  topics: readonly string[];\n  preloadType?: SubscriptionPreloadType;\n\n  // Functions called when the reducers change and for each newly received message.\n  // The object is assumed to be immutable, so in order to trigger a re-render, the reducers must\n  // return a new object.\n  restore: (arg: T | undefined) => T;\n  addMessage?: MessageReducer<T>;\n  addMessages?: MessagesReducer<T>;\n};\n\nfunction selectSetSubscriptions(ctx: MessagePipelineContext) {\n  return ctx.setSubscriptions;\n}\n\nexport function useMessageReducer<T>(props: Params<T>): T {\n  const [id] = useState(() => uuidv4());\n  const { restore, addMessage, addMessages, preloadType = \"partial\" } = props;\n\n  // only one of the add message callbacks should be provided\n  if ([props.addMessage, props.addMessages].filter(Boolean).length !== 1) {\n    throw new Error(\n      \"useMessageReducer must be provided with exactly one of addMessage or addMessages\",\n    );\n  }\n\n  useShouldNotChangeOften(props.restore, () =>\n    log.warn(\n      \"useMessageReducer restore() is changing frequently. \" +\n        \"restore() will be called each time it changes, so a new function \" +\n        \"shouldn't be created on each render. (If you're using Hooks, try useCallback.)\",\n    ),\n  );\n  useShouldNotChangeOften(props.addMessage, () =>\n    log.warn(\n      \"useMessageReducer addMessage() is changing frequently. \" +\n        \"addMessage() will be called each time it changes, so a new function \" +\n        \"shouldn't be created on each render. (If you're using Hooks, try useCallback.)\",\n    ),\n  );\n  useShouldNotChangeOften(props.addMessages, () =>\n    log.warn(\n      \"useMessageReducer addMessages() is changing frequently. \" +\n        \"addMessages() will be called each time it changes, so a new function \" +\n        \"shouldn't be created on each render. (If you're using Hooks, try useCallback.)\",\n    ),\n  );\n\n  const requestedTopics = useShallowMemo(props.topics);\n\n  const subscriptions = useMemo<SubscribePayload[]>(() => {\n    return requestedTopics.map((topic) => ({ topic, preloadType }));\n  }, [preloadType, requestedTopics]);\n\n  const setSubscriptions = useMessagePipeline(selectSetSubscriptions);\n  useEffect(() => setSubscriptions(id, subscriptions), [id, setSubscriptions, subscriptions]);\n  useEffect(() => {\n    return () => {\n      setSubscriptions(id, []);\n    };\n  }, [id, setSubscriptions]);\n\n  const state = useRef<\n    | Readonly<{\n        messageEvents: PlayerStateActiveData[\"messages\"] | undefined;\n        lastSeekTime: number | undefined;\n        reducedValue: T;\n        restore: typeof restore;\n        addMessage: typeof addMessage;\n        addMessages: typeof addMessages;\n      }>\n    | undefined\n  >();\n\n  return useMessagePipeline(\n    useCallback(\n      // To compute the reduced value from new messages:\n      // - Call restore() to initialize state, if lastSeekTime has changed, or if reducers have changed\n      // - Call addMessage() or addMessages() if any new messages of interest have arrived\n      // - Otherwise, return the previous reducedValue so that we don't trigger an unnecessary render.\n      function selectReducedMessages(ctx: MessagePipelineContext): T {\n        const messageEvents = ctx.messageEventsBySubscriberId.get(id);\n        const lastSeekTime = ctx.playerState.activeData?.lastSeekTime;\n\n        let newReducedValue: T;\n        if (!state.current || lastSeekTime !== state.current.lastSeekTime) {\n          newReducedValue = restore(undefined);\n        } else if (\n          restore !== state.current.restore ||\n          addMessage !== state.current.addMessage ||\n          addMessages !== state.current.addMessages\n        ) {\n          newReducedValue = restore(state.current.reducedValue);\n        } else {\n          newReducedValue = state.current.reducedValue;\n        }\n\n        if (\n          messageEvents &&\n          messageEvents.length > 0 &&\n          messageEvents !== state.current?.messageEvents\n        ) {\n          if (addMessages) {\n            if (messageEvents.length > 0) {\n              newReducedValue = addMessages(newReducedValue, messageEvents);\n            }\n          } else if (addMessage) {\n            for (const messageEvent of messageEvents) {\n              newReducedValue = addMessage(newReducedValue, messageEvent);\n            }\n          }\n        }\n\n        state.current = {\n          messageEvents,\n          lastSeekTime,\n          reducedValue: newReducedValue,\n          restore,\n          addMessage,\n          addMessages,\n        };\n\n        return state.current.reducedValue;\n      },\n      [id, addMessage, addMessages, restore],\n    ),\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nexport default function concatAndTruncate<T>(\n  array1: readonly T[],\n  array2: readonly T[],\n  limit: number,\n): T[] {\n  const toTakeFromArray1 = limit - array2.length;\n  const ret = toTakeFromArray1 <= 0 ? [] : array1.slice(-toTakeFromArray1);\n  const toTakeFromArray2 = limit - ret.length;\n  for (let i = Math.max(0, array2.length - toTakeFromArray2); i < array2.length; ++i) {\n    ret.push(array2[i] as T);\n  }\n  return ret;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { groupBy } from \"lodash\";\nimport { useCallback } from \"react\";\n\nimport { useDeepMemo } from \"@foxglove/hooks\";\nimport { MessageEvent } from \"@foxglove/studio-base/players/types\";\nimport concatAndTruncate from \"@foxglove/studio-base/util/concatAndTruncate\";\n\nimport { useMessageReducer } from \"./useMessageReducer\";\n\n// Topic types that are not known at compile time\ntype UnknownMessageEventsByTopic = Record<string, readonly MessageEvent[]>;\n\n/**\n * useMessagesByTopic makes it easy to request some messages on some topics.\n *\n * Using this hook will cause the panel to re-render when new messages arrive on the requested topics.\n * - During file playback the panel will re-render when the file is playing or when the user is scrubbing.\n * - During live playback the panel will re-render when new messages arrive.\n */\nexport function useMessagesByTopic(params: {\n  topics: readonly string[];\n  historySize: number;\n}): Record<string, readonly MessageEvent[]> {\n  const { historySize, topics } = params;\n  const requestedTopics = useDeepMemo(topics);\n\n  const addMessages = useCallback(\n    (prevMessagesByTopic: UnknownMessageEventsByTopic, messages: readonly MessageEvent[]) => {\n      const newMessagesByTopic = groupBy(messages, \"topic\");\n      const ret: UnknownMessageEventsByTopic = { ...prevMessagesByTopic };\n      Object.entries(newMessagesByTopic).forEach(([topic, newMessages]) => {\n        const retTopic = ret[topic];\n        if (retTopic) {\n          ret[topic] = concatAndTruncate(retTopic, newMessages, historySize);\n        }\n      });\n      return ret;\n    },\n    [historySize],\n  );\n\n  const restore = useCallback(\n    (prevMessagesByTopic?: UnknownMessageEventsByTopic) => {\n      const newMessagesByTopic: UnknownMessageEventsByTopic = {};\n      // When changing topics, we try to keep as many messages around from the previous set of\n      // topics as possible.\n      for (const topic of requestedTopics) {\n        const prevMessages = prevMessagesByTopic?.[topic];\n        newMessagesByTopic[topic] = prevMessages?.slice(-historySize) ?? [];\n      }\n      return newMessagesByTopic;\n    },\n    [requestedTopics, historySize],\n  );\n\n  return useMessageReducer({\n    topics: requestedTopics,\n    restore,\n    addMessages,\n  });\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport memoizeWeak from \"memoize-weak\";\nimport { useCallback, useEffect, useMemo, useState } from \"react\";\nimport { v4 as uuidv4 } from \"uuid\";\n\nimport { useShallowMemo } from \"@foxglove/hooks\";\nimport { Immutable } from \"@foxglove/studio\";\nimport {\n  useMessagePipeline,\n  MessagePipelineContext,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport {\n  SubscribePayload,\n  MessageEvent,\n  MessageBlock as PlayerMessageBlock,\n} from \"@foxglove/studio-base/players/types\";\n\nexport type MessageBlock = Immutable<{\n  [topicName: string]: MessageEvent[];\n}>;\n\n// Memoization probably won't speed up the filtering appreciably, but preserves return identity.\n// That said, MessageBlock identity will change when the set of topics changes, so consumers should\n// prefer to use the identity of topic-block message arrays where possible.\nconst filterBlockByTopics = memoizeWeak(\n  (block: Immutable<PlayerMessageBlock> | undefined, topics: readonly string[]): MessageBlock => {\n    if (!block) {\n      // For our purposes, a missing MemoryCacheBlock just means \"no topics have been cached for\n      // this block\". This is semantically different to an empty array per topic, but not different\n      // to a MemoryCacheBlock with no per-topic arrays.\n      return {};\n    }\n    const ret: Record<string, readonly MessageEvent[]> = {};\n    for (const topic of topics) {\n      // Don't include an empty array when the data has not been cached for this topic for this\n      // block. The missing entry means \"we don't know the message for this topic in this block\", as\n      // opposed to \"we know there are no messages for this topic in this block\".\n      const blockMessages = block.messagesByTopic[topic];\n      if (blockMessages) {\n        ret[topic] = blockMessages;\n      }\n    }\n    return ret;\n  },\n);\n\nconst useSubscribeToTopicsForBlocks = (topics: readonly string[]) => {\n  const [id] = useState(() => uuidv4());\n\n  const setSubscriptions = useMessagePipeline(\n    useCallback(\n      ({ setSubscriptions: pipelineSetSubscriptions }: MessagePipelineContext) =>\n        pipelineSetSubscriptions,\n      [],\n    ),\n  );\n  const subscriptions: SubscribePayload[] = useMemo(() => {\n    return topics.map((topic) => ({ topic, preloadType: \"full\" }));\n  }, [topics]);\n  useEffect(() => setSubscriptions(id, subscriptions), [id, setSubscriptions, subscriptions]);\n\n  useEffect(() => {\n    return () => {\n      setSubscriptions(id, []);\n    };\n  }, [id, setSubscriptions]);\n};\n\n// A note: for the moment,\n//  - not all players provide blocks, and\n//  - topics for nodes are not available in blocks when blocks _are_ provided,\n// so all consumers need a \"regular playback\" pipeline fallback for now.\n//\n// Semantics of blocks:\n//   - Missing topics have not been cached.\n//   - Adjacent elements are contiguous\n//   - Each block represents the same duration of time\n//   - The number of blocks is consistent for the data source\n//   - Blocks are stored in increasing order of time\nexport function useBlocksByTopic(topics: readonly string[]): readonly MessageBlock[] {\n  const requestedTopics = useShallowMemo(topics);\n\n  useSubscribeToTopicsForBlocks(requestedTopics);\n\n  const allBlocks = useMessagePipeline<Immutable<(PlayerMessageBlock | undefined)[] | undefined>>(\n    useCallback((ctx) => ctx.playerState.progress.messageCache?.blocks, []),\n  );\n\n  const blocks = useMemo(() => {\n    if (!allBlocks) {\n      return [];\n    }\n    return allBlocks.map((block) => filterBlockByTopics(block, requestedTopics));\n  }, [allBlocks, requestedTopics]);\n\n  return blocks;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useCallback } from \"react\";\nimport { DeepPartial } from \"ts-essentials\";\n\nimport {\n  LayoutState,\n  useCurrentLayoutActions,\n  useCurrentLayoutSelector,\n} from \"@foxglove/studio-base/context/CurrentLayoutContext\";\nimport { SaveConfig } from \"@foxglove/studio-base/types/panels\";\nimport { maybeCast } from \"@foxglove/studio-base/util/maybeCast\";\n\n/**\n * Like `useConfig`, but for a specific panel id. This generally shouldn't be used by panels\n * directly, but is for use in internal code that's running outside of regular context providers.\n */\nexport default function useConfigById<Config extends Record<string, unknown>>(\n  panelId: string | undefined,\n): [Config | undefined, SaveConfig<Config>] {\n  const { getCurrentLayoutState, savePanelConfigs } = useCurrentLayoutActions();\n\n  const configSelector = useCallback(\n    (state: DeepPartial<LayoutState>) => {\n      if (panelId == undefined) {\n        return undefined;\n      }\n      return maybeCast<Config>(state.selectedLayout?.data?.configById?.[panelId]);\n    },\n    [panelId],\n  );\n\n  const config = useCurrentLayoutSelector(configSelector);\n\n  const saveConfig: SaveConfig<Config> = useCallback(\n    (newConfig) => {\n      if (panelId == undefined) {\n        return;\n      }\n\n      if (typeof newConfig === \"function\") {\n        // We use a getter here instead of referring directly to the config object\n        // so that this callback is stable across config changes.\n        const currentConfig = getCurrentLayoutState().selectedLayout?.data?.configById[panelId] as\n          | undefined\n          | Config;\n        if (currentConfig) {\n          savePanelConfigs({\n            configs: [{ id: panelId, config: newConfig(currentConfig) }],\n          });\n        }\n      } else {\n        savePanelConfigs({\n          configs: [{ id: panelId, config: newConfig }],\n        });\n      }\n    },\n    [getCurrentLayoutState, panelId, savePanelConfigs],\n  );\n\n  return [config, saveConfig];\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nexport const APP_BAR_HEIGHT = 44;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport CheckIcon from \"@mui/icons-material/Check\";\nimport CopyAllIcon from \"@mui/icons-material/CopyAll\";\nimport {\n  Button,\n  ButtonProps,\n  IconButton,\n  IconButtonProps,\n  SvgIconProps,\n  Tooltip,\n  Typography,\n} from \"@mui/material\";\nimport { useCallback, useState, PropsWithChildren } from \"react\";\n\nimport clipboard from \"@foxglove/studio-base/util/clipboard\";\n\nfunction CopyButtonComponent(\n  props: PropsWithChildren<{\n    getText: () => string;\n    size?: \"small\" | \"medium\" | \"large\";\n    iconSize?: SvgIconProps[\"fontSize\"];\n    color?: ButtonProps[\"color\"] | IconButtonProps[\"color\"];\n    className?: string;\n    edge?: IconButtonProps[\"edge\"];\n  }>,\n): JSX.Element {\n  const {\n    children,\n    className,\n    color = \"primary\",\n    edge,\n    size = \"medium\",\n    iconSize = \"medium\",\n    getText,\n  } = props;\n  const [copied, setCopied] = useState(false);\n\n  const handleCopy = useCallback(() => {\n    clipboard\n      .copy(getText())\n      .then(() => {\n        setCopied(true);\n        setTimeout(() => setCopied(false), 1500);\n      })\n      .catch((err) => console.warn(err));\n  }, [getText]);\n\n  if (children == undefined) {\n    return (\n      <Tooltip arrow title={copied ? \"Copied\" : \"Copy to clipboard\"}>\n        <IconButton\n          edge={edge}\n          className={className}\n          size={size}\n          onClick={handleCopy}\n          color={copied ? \"success\" : color}\n        >\n          {copied ? <CheckIcon fontSize={iconSize} /> : <CopyAllIcon fontSize={iconSize} />}\n        </IconButton>\n      </Tooltip>\n    );\n  }\n\n  return (\n    <Button\n      size={size}\n      color=\"inherit\"\n      className={className}\n      onClick={handleCopy}\n      startIcon={\n        copied ? (\n          <CheckIcon fontSize={iconSize} color=\"success\" />\n        ) : (\n          <CopyAllIcon fontSize={iconSize} color=\"primary\" />\n        )\n      }\n    >\n      <Typography color={copied ? \"text.primary\" : color} variant=\"body2\">\n        {children}\n      </Typography>\n    </Button>\n  );\n}\n\nexport default React.memo(CopyButtonComponent);\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useMemo, useRef } from \"react\";\n\nimport { areEqual, fromMillis, Time, toSec } from \"@foxglove/rostime\";\nimport { Immutable } from \"@foxglove/studio\";\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport { subtractTimes } from \"@foxglove/studio-base/players/UserNodePlayer/nodeTransformerWorker/typescript/userUtils/time\";\nimport { PlayerCapabilities, TopicStats } from \"@foxglove/studio-base/players/types\";\n\nconst EMPTY_TOPIC_STATS = new Map<string, TopicStats>();\n\n// Empirically this seems to strike a good balance between stable values\n// and reasonably quick reactions to change.\nfunction smoothValues(oldValue: undefined | number, newValue: number): number {\n  return 0.7 * (oldValue ?? newValue) + 0.3 * newValue;\n}\n\nfunction calculateStaticItemFrequency(\n  numMessages: number,\n  firstMessageTime: undefined | Time,\n  lastMessageTime: undefined | Time,\n  duration: Time,\n): undefined | number {\n  // Message count but no timestamps, use the full connection duration\n  if (firstMessageTime == undefined || lastMessageTime == undefined) {\n    const durationSec = toSec(duration);\n    if (durationSec > 0) {\n      return numMessages / durationSec;\n    } else {\n      return undefined;\n    }\n  }\n\n  // Not enough messages or time span to calculate a frequency\n  if (numMessages < 2 || areEqual(firstMessageTime, lastMessageTime)) {\n    return undefined;\n  }\n\n  const topicDurationSec = toSec(subtractTimes(lastMessageTime, firstMessageTime));\n  if (topicDurationSec > 0) {\n    return (numMessages - 1) / topicDurationSec;\n  } else {\n    return undefined;\n  }\n}\n\nfunction calculateLiveItemFrequency(numMessages: number, duration: Time) {\n  const durationSec = toSec(duration);\n\n  return durationSec > 0 ? numMessages / durationSec : undefined;\n}\n\nconst selectCurrentTime = ({ playerState }: MessagePipelineContext) =>\n  playerState.activeData?.currentTime;\nconst selectStartTime = ({ playerState }: MessagePipelineContext) =>\n  playerState.activeData?.startTime;\nconst selectEndTime = ({ playerState }: MessagePipelineContext) => playerState.activeData?.endTime;\nconst selectTopicStats = (ctx: MessagePipelineContext) =>\n  ctx.playerState.activeData?.topicStats ?? EMPTY_TOPIC_STATS;\nconst selectPlayerCapabilities = (ctx: MessagePipelineContext) => ctx.playerState.capabilities;\n\ntype StatSample = {\n  time: Time;\n  count: number;\n  frequency: undefined | number;\n};\n\ntype FrequenciesByTopic = Record<string, undefined | number>;\nconst EMPTY_FREQUENCIES: FrequenciesByTopic = {};\n\n/**\n * Encapsulates logic for directly updating topic stats DOM elements, bypassing\n * react for performance. To use this component mount it directly under your component\n * containing topics you want to update. Tag each topic stat field with data-topic\n * and data-topic-stat attributes.\n *\n * @property interval - the interval, in frames, between updates.\n */\nexport function useTopicPublishFrequencies(): Immutable<FrequenciesByTopic> {\n  const playerCurrentTime = useMessagePipeline(selectCurrentTime);\n  const startTime = useMessagePipeline(selectStartTime);\n  const endTime = useMessagePipeline(selectEndTime);\n  const topicStats = useMessagePipeline(selectTopicStats);\n  const playerCapabilities = useMessagePipeline(selectPlayerCapabilities);\n  const duration = useMemo(\n    () => (endTime && startTime ? subtractTimes(endTime, startTime) : { sec: 0, nsec: 0 }),\n    [endTime, startTime],\n  );\n\n  const samplesByTopic = useRef<Record<string, StatSample>>({});\n\n  const playerIsStaticSource = useMemo(\n    () => playerCapabilities.includes(PlayerCapabilities.playbackControl),\n    [playerCapabilities],\n  );\n\n  const frequencies = useMemo(() => {\n    if (!playerCurrentTime) {\n      return EMPTY_FREQUENCIES;\n    }\n    const currentTime = fromMillis(Date.now());\n\n    const result: FrequenciesByTopic = {};\n    for (const [topic, stat] of topicStats) {\n      if (playerIsStaticSource) {\n        // For a static source we calculate frequency across all messages.\n        const frequency = calculateStaticItemFrequency(\n          stat.numMessages,\n          stat.firstMessageTime,\n          stat.lastMessageTime,\n          duration,\n        );\n        result[topic] = frequency;\n      } else {\n        // For a live source we calculate a running average of frequency.\n        const sample = samplesByTopic.current[topic];\n        if (sample == undefined) {\n          samplesByTopic.current[topic] = {\n            time: currentTime,\n            count: stat.numMessages,\n            frequency: undefined,\n          };\n        } else {\n          const messageDelta = stat.numMessages - sample.count;\n          if (messageDelta > 0) {\n            const timeDelta = subtractTimes(currentTime, sample.time);\n            const newFrequency = calculateLiveItemFrequency(messageDelta, timeDelta);\n            if (newFrequency != undefined) {\n              const smoothedFrequency = smoothValues(sample.frequency, newFrequency);\n              sample.frequency = smoothedFrequency;\n              sample.count = stat.numMessages;\n              sample.time = currentTime;\n            }\n          }\n          result[topic] = sample.frequency;\n        }\n      }\n    }\n\n    return result;\n  }, [playerCurrentTime, duration, playerIsStaticSource, topicStats]);\n\n  return frequencies;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useCallback, useEffect, useLayoutEffect, useMemo, useRef } from \"react\";\nimport { useLatest } from \"react-use\";\n\nimport { Time } from \"@foxglove/rostime\";\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport { useTopicPublishFrequencies } from \"@foxglove/studio-base/hooks/useTopicPublishFrequences\";\nimport { PlayerCapabilities, TopicStats } from \"@foxglove/studio-base/players/types\";\n\nconst EM_DASH = \"\\u2014\";\nconst EMPTY_TOPIC_STATS = new Map<string, TopicStats>();\n\nconst selectTopicStats = (ctx: MessagePipelineContext) =>\n  ctx.playerState.activeData?.topicStats ?? EMPTY_TOPIC_STATS;\nconst selectPlayerId = (ctx: MessagePipelineContext) => ctx.playerState.playerId;\nconst selectPlayerCapabilities = (ctx: MessagePipelineContext) => ctx.playerState.capabilities;\n\ntype StatSample = {\n  time: Time;\n  count: number;\n  frequency: undefined | number;\n};\n\n/**\n * Encapsulates logic for directly updating topic stats DOM elements, bypassing\n * react for performance. To use this component mount it directly under your component\n * containing topics you want to update. Tag each topic stat field with data-topic\n * and data-topic-stat attributes.\n *\n * @property interval - the interval, in frames, between updates.\n */\nexport function DirectTopicStatsUpdater({ interval = 1 }: { interval?: number }): JSX.Element {\n  const topicStats = useMessagePipeline(selectTopicStats);\n  const playerCapabilities = useMessagePipeline(selectPlayerCapabilities);\n  const playerId = useMessagePipeline(selectPlayerId);\n\n  const latestStats = useLatest(topicStats);\n  const updateCount = useRef(0);\n  const rootRef = useRef<HTMLDivElement>(ReactNull);\n  const samplesByTopic = useRef<Record<string, StatSample>>({});\n\n  const frequenciesByTopic = useTopicPublishFrequencies();\n  const latestFrequenciesByTopic = useLatest(frequenciesByTopic);\n\n  const playerIsStaticSource = useMemo(\n    () => playerCapabilities.includes(PlayerCapabilities.playbackControl),\n    [playerCapabilities],\n  );\n\n  const updateStats = useCallback(() => {\n    if (!rootRef.current) {\n      return;\n    }\n\n    rootRef.current.parentElement?.querySelectorAll(\"[data-topic]\").forEach((field) => {\n      if (!(field instanceof HTMLElement) || !field.dataset.topic) {\n        return;\n      }\n\n      const topic = field.dataset.topic;\n      const stat = latestStats.current.get(topic);\n      if (field.dataset.topicStat === \"count\") {\n        if (stat) {\n          field.innerText = stat.numMessages.toLocaleString();\n        } else {\n          field.innerText = EM_DASH;\n        }\n      }\n\n      if (field.dataset.topicStat === \"frequency\") {\n        const frequency = latestFrequenciesByTopic.current[topic];\n        field.innerText = frequency != undefined ? `${frequency.toFixed(2)} Hz` : EM_DASH;\n      }\n    });\n  }, [latestFrequenciesByTopic, latestStats]);\n\n  useEffect(() => {\n    if (updateCount.current++ % interval === 0) {\n      updateStats();\n    }\n  }, [updateStats, interval, topicStats, playerIsStaticSource]);\n\n  // Clear previous samples on player change.\n  useEffect(() => {\n    void playerId;\n    samplesByTopic.current = {};\n  }, [playerId]);\n\n  useLayoutEffect(() => {\n    updateStats();\n  }, [updateStats]);\n\n  return <div ref={rootRef} style={{ display: \"none\" }} />;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { Link, Typography } from \"@mui/material\";\nimport { useCallback } from \"react\";\nimport { useDrop } from \"react-dnd\";\nimport { useTranslation } from \"react-i18next\";\nimport { MosaicDragType } from \"react-mosaic-component\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { PanelCatalog, PanelSelection } from \"@foxglove/studio-base/components/PanelCatalog\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { useCurrentLayoutActions } from \"@foxglove/studio-base/context/CurrentLayoutContext\";\nimport { MosaicDropResult } from \"@foxglove/studio-base/types/panels\";\nimport { getPanelIdForType } from \"@foxglove/studio-base/util/layout\";\n\ntype Props = {\n  tabId?: string;\n};\n\nconst useStyles = makeStyles()((theme) => ({\n  root: {\n    backgroundColor: theme.palette.background.paper,\n    width: \"100%\",\n    height: \"100%\",\n    overflowY: \"auto\",\n  },\n  dropTarget: {\n    width: \"100%\",\n    height: \"100%\",\n    minHeight: 0,\n  },\n  isOver: {\n    \"&:after\": {\n      content: \"''\",\n      borderColor: `1px solid ${theme.palette.action.selected}`,\n      backgroundColor: theme.palette.action.focus,\n      position: \"absolute\",\n      top: 0,\n      right: 0,\n      left: 0,\n      bottom: 0,\n      zIndex: theme.zIndex.appBar,\n    },\n  },\n}));\n\nexport const EmptyPanelLayout = ({ tabId }: Props): JSX.Element => {\n  const { classes, cx } = useStyles();\n  const { addPanel } = useCurrentLayoutActions();\n  const { t } = useTranslation(\"addPanel\");\n\n  const [{ isOver }, drop] = useDrop<unknown, MosaicDropResult, { isOver: boolean }>({\n    accept: MosaicDragType.WINDOW,\n    drop: () => {\n      return { tabId };\n    },\n    collect: (monitor) => ({\n      isOver: monitor.isOver(),\n    }),\n  });\n\n  const onPanelSelect = useCallback(\n    ({ type, config, relatedConfigs }: PanelSelection) => {\n      const id = getPanelIdForType(type);\n      addPanel({ tabId, id, config, relatedConfigs });\n    },\n    [addPanel, tabId],\n  );\n\n  return (\n    <div\n      ref={drop}\n      data-testid=\"empty-drop-target\"\n      className={cx(classes.dropTarget, { [classes.isOver]: isOver })}\n    >\n      <div className={classes.root}>\n        <Stack paddingBottom={2}>\n          <Typography variant=\"body2\" paddingX={2} paddingTop={2}>\n            {t(\"selectPanelToAddToLayout\")}{\" \"}\n            <Link color=\"primary\" target=\"_blank\" href=\"https://foxglove.dev/docs/studio/layouts\">\n              {t(\"learnMore\", { ns: \"general\" })}\n            </Link>\n          </Typography>\n          <PanelCatalog mode=\"grid\" onPanelSelect={onPanelSelect} />\n        </Stack>\n      </div>\n    </div>\n  );\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Typography } from \"@mui/material\";\nimport { ReactNode } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport Stack from \"@foxglove/studio-base/components/Stack\";\n\nconst useStyles = makeStyles()((theme) => ({\n  root: {\n    whiteSpace: \"pre-line\",\n\n    code: {\n      color: theme.palette.primary.main,\n      background: \"transparent\",\n      padding: 0,\n    },\n  },\n}));\n\nexport default function EmptyState({\n  children,\n  className,\n}: {\n  children: ReactNode;\n  className?: string;\n}): JSX.Element {\n  const { classes, cx } = useStyles();\n\n  return (\n    <Stack\n      className={cx(classes.root, className)}\n      flex=\"auto\"\n      alignItems=\"center\"\n      justifyContent=\"center\"\n      fullHeight\n      paddingX={1}\n    >\n      <Typography variant=\"body2\" color=\"text.secondary\" lineHeight={1.4} align=\"center\">\n        {children}\n      </Typography>\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Link, Button, Typography } from \"@mui/material\";\nimport { Component, ErrorInfo, PropsWithChildren, ReactNode } from \"react\";\n\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { reportError } from \"@foxglove/studio-base/reportError\";\nimport { AppError } from \"@foxglove/studio-base/util/errors\";\n\nimport ErrorDisplay from \"./ErrorDisplay\";\n\ntype Props = {\n  actions?: JSX.Element;\n  showErrorDetails?: boolean;\n  hideErrorSourceLocations?: boolean;\n};\n\ntype State = {\n  currentError: { error: Error; errorInfo: ErrorInfo } | undefined;\n};\n\nexport default class ErrorBoundary extends Component<PropsWithChildren<Props>, State> {\n  public override state: State = {\n    currentError: undefined,\n  };\n\n  public override componentDidCatch(error: Error, errorInfo: ErrorInfo): void {\n    reportError(new AppError(error, errorInfo));\n    this.setState({ currentError: { error, errorInfo } });\n  }\n\n  public override render(): ReactNode {\n    if (this.state.currentError) {\n      const actions = this.props.actions ?? (\n        <Stack\n          fullHeight\n          flex=\"auto\"\n          alignItems=\"flex-end\"\n          justifyContent=\"flex-end\"\n          direction=\"row\"\n        >\n          <Button\n            variant=\"outlined\"\n            color=\"secondary\"\n            onClick={() => this.setState({ currentError: undefined })}\n          >\n            Dismiss\n          </Button>\n        </Stack>\n      );\n      return (\n        <ErrorDisplay\n          showErrorDetails={this.props.showErrorDetails}\n          hideErrorSourceLocations={this.props.hideErrorSourceLocations}\n          error={this.state.currentError.error}\n          errorInfo={this.state.currentError.errorInfo}\n          content={\n            <Typography>\n              Something went wrong.{\" \"}\n              <Link color=\"inherit\" onClick={() => this.setState({ currentError: undefined })}>\n                Dismiss this error\n              </Link>{\" \"}\n              to continue using the app. If the issue persists, try restarting the app.\n            </Typography>\n          }\n          actions={actions}\n        />\n      );\n    }\n    return this.props.children;\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Typography, Link, Divider } from \"@mui/material\";\nimport { ErrorInfo, useMemo, useState } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport Stack from \"@foxglove/studio-base/components/Stack\";\n\nconst useStyles = makeStyles()((theme) => ({\n  grid: {\n    display: \"grid\",\n    gridTemplateRows: \"auto 1fr auto\",\n    height: \"100%\",\n    padding: theme.spacing(2),\n    overflowY: \"auto\",\n  },\n  errorDetailStack: {\n    fontSize: theme.typography.body2.fontSize,\n    lineHeight: \"1.3em\",\n    paddingLeft: theme.spacing(2),\n  },\n  errorDetailContainer: {\n    overflowY: \"auto\",\n    background: theme.palette.background.paper,\n    padding: theme.spacing(1),\n    minHeight: theme.spacing(10),\n  },\n  actions: {\n    flex: \"auto\",\n    paddingTop: theme.spacing(2),\n    textAlign: \"right\",\n  },\n}));\n/**\n * Remove source locations (which often include file hashes) so storybook screenshots can be\n * deterministic.\n */\nfunction sanitizeStack(stack: string) {\n  return stack.replace(/\\s+\\(.+\\)$/gm, \"\").replace(/\\s+https?:\\/\\/.+$/gm, \"\");\n}\n\nfunction ErrorStacktrace({\n  stack,\n  hideSourceLocations,\n}: {\n  stack: string;\n  hideSourceLocations: boolean;\n}) {\n  const { classes } = useStyles();\n  const lines = (hideSourceLocations ? sanitizeStack(stack) : stack)\n    .trim()\n    .replace(/^\\s*at /gm, \"\")\n    .split(\"\\n\")\n    .map((line) => line.trim());\n  return (\n    <pre className={classes.errorDetailStack}>\n      {lines.map((line, i) => {\n        const match = /^(.+)\\s(\\(.+$)/.exec(line);\n        if (!match) {\n          return line + \"\\n\";\n        }\n        return (\n          <span key={i}>\n            <span>{match[1]} </span>\n            <span>{match[2]}</span>\n            {\"\\n\"}\n          </span>\n        );\n      })}\n    </pre>\n  );\n}\n\ntype ErrorDisplayProps = {\n  title?: string;\n  error?: Error;\n  errorInfo?: ErrorInfo;\n  content?: JSX.Element;\n  actions?: JSX.Element;\n  showErrorDetails?: boolean;\n  hideErrorSourceLocations?: boolean;\n};\n\nfunction ErrorDisplay(props: ErrorDisplayProps): JSX.Element {\n  const { classes } = useStyles();\n  const { error, errorInfo, hideErrorSourceLocations = false } = props;\n\n  const [showErrorDetails, setShowErrorDetails] = useState(props.showErrorDetails ?? false);\n\n  const errorDetails = useMemo(() => {\n    if (!showErrorDetails) {\n      return ReactNull;\n    }\n\n    let stackWithoutMessage = error?.stack ?? \"\";\n    const errorString = error?.toString() ?? \"\";\n    if (stackWithoutMessage.startsWith(errorString)) {\n      stackWithoutMessage = stackWithoutMessage.substring(errorString.length);\n    }\n\n    return (\n      <div>\n        <Typography fontWeight=\"bold\">Error stack:</Typography>\n        <ErrorStacktrace\n          stack={stackWithoutMessage}\n          hideSourceLocations={hideErrorSourceLocations}\n        />\n        {errorInfo && (\n          <>\n            <Typography fontWeight=\"bold\">Component stack:</Typography>\n            <ErrorStacktrace\n              stack={errorInfo.componentStack}\n              hideSourceLocations={hideErrorSourceLocations}\n            />\n          </>\n        )}\n      </div>\n    );\n  }, [error, errorInfo, hideErrorSourceLocations, showErrorDetails]);\n\n  return (\n    <div className={classes.grid}>\n      <Stack gap={2} paddingBottom={2}>\n        <Stack>\n          <Typography variant=\"h4\" gutterBottom>\n            {props.title ?? \"The app encountered an unexpected error\"}\n          </Typography>\n          <Typography variant=\"body1\">{props.content}</Typography>\n        </Stack>\n        <Divider />\n        <Typography variant=\"subtitle2\" component=\"code\" fontWeight=\"bold\">\n          {error?.message}\n        </Typography>\n        <Link color=\"secondary\" onClick={() => setShowErrorDetails(!showErrorDetails)}>\n          {showErrorDetails ? \"Hide\" : \"Show\"} details\n        </Link>\n      </Stack>\n      {errorDetails && <div className={classes.errorDetailContainer}>{errorDetails}</div>}\n      {!errorDetails && <div />}\n      <div className={classes.actions}>{props.actions}</div>\n    </div>\n  );\n}\n\nexport default ErrorDisplay;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { IconButton, IconButtonProps } from \"@mui/material\";\nimport { forwardRef, useCallback, useEffect, useState } from \"react\";\n\ntype Props = {\n  icon: React.ReactNode;\n  activeIcon?: React.ReactNode;\n  color?: IconButtonProps[\"color\"];\n  activeColor?: IconButtonProps[\"color\"];\n} & Omit<IconButtonProps, \"children\" | \"color\">;\n\nconst HoverableIconButton = forwardRef<HTMLButtonElement, Props>((props, ref) => {\n  const { icon, activeIcon, color, activeColor, onMouseLeave, onMouseEnter, ...rest } = props;\n\n  const [hovered, setHovered] = useState(false);\n\n  const handleMouseEnter = useCallback(\n    (event) => {\n      if (onMouseEnter != undefined) {\n        onMouseEnter(event);\n      }\n      if (props.disabled === true) {\n        return;\n      }\n      setHovered(true);\n    },\n    [onMouseEnter, props.disabled],\n  );\n\n  const handleMouseLeave = useCallback(\n    (event) => {\n      if (onMouseLeave != undefined) {\n        onMouseLeave(event);\n      }\n      setHovered(false);\n    },\n    [onMouseLeave],\n  );\n\n  useEffect(() => {\n    if (props.disabled === true) {\n      setHovered(false);\n    }\n  }, [props.disabled]);\n\n  return (\n    <IconButton\n      ref={ref}\n      {...rest}\n      component=\"button\"\n      onMouseEnter={handleMouseEnter}\n      onMouseLeave={handleMouseLeave}\n      color={activeColor != undefined ? (hovered ? activeColor : color) : color}\n    >\n      {activeIcon != undefined ? (hovered ? activeIcon : icon) : icon}\n    </IconButton>\n  );\n});\n\nHoverableIconButton.displayName = \"HoverableIconButton\";\n\nexport default HoverableIconButton;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nexport type ValidationResult =\n  | string\n  | {\n      [fieldName: string]: string;\n    };\n\nexport const validationErrorToString = (validationResult: ValidationResult): string =>\n  typeof validationResult === \"string\"\n    ? validationResult\n    : Object.keys(validationResult)\n        .map((key) => `${key}: ${validationResult[key]}`)\n        .join(\", \");\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport ErrorIcon from \"@mui/icons-material/Error\";\nimport { Typography } from \"@mui/material\";\nimport CodeEditor from \"@uiw/react-textarea-code-editor\";\nimport { isEqual } from \"lodash\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { fonts } from \"@foxglove/studio-base/util/sharedStyleConstants\";\nimport { validationErrorToString, ValidationResult } from \"@foxglove/studio-base/util/validators\";\n\nconst { useState, useCallback, useRef, useLayoutEffect, useEffect } = React;\n\nconst useStyles = makeStyles()((theme) => ({\n  editor: {\n    backgroundColor: \"transparent !important\",\n    font: \"inherit !important\",\n    fontFamily: `${fonts.MONOSPACE} !important`,\n    overflow: \"auto\",\n  },\n  error: {\n    \"*\": {\n      color: `${theme.palette.error.main} !important`,\n    },\n  },\n}));\n\ntype Value = unknown;\ntype OnChange = (obj: unknown) => void;\ntype ParseAndStringifyFn = {\n  stringify: (obj: unknown) => string;\n  parse: (val: string) => unknown;\n};\nexport type BaseProps = {\n  dataTestId?: string;\n  dataValidator?: (data: unknown) => ValidationResult | undefined;\n  onChange?: OnChange;\n  onError?: (err: string) => void;\n  readOnly?: boolean;\n  maxHeight?: number | \"auto\" | \"none\";\n  value: Value;\n};\n\n/**\n * Handles value change, data validation, and data stringifying/parsing.\n * Any external value change will cause the input string to change and trigger new validations.\n * Only valid internal value change will call onChange. Any data processing and validation error will trigger onError.\n */\nfunction ValidatedInputBase({\n  dataTestId,\n  dataValidator = () => undefined,\n  onChange,\n  onError,\n  parse,\n  readOnly = false,\n  maxHeight,\n  stringify,\n  value,\n}: BaseProps & ParseAndStringifyFn): JSX.Element {\n  const { classes, cx } = useStyles();\n  const [error, setError] = useState<string>(\"\");\n  const [inputStr, setInputStr] = useState<string>(\"\");\n  const prevIncomingVal = useRef<unknown>(\"\");\n  const inputRef = useRef<HTMLTextAreaElement>(ReactNull);\n  const [isEditing, setIsEditing] = useState<boolean>(false);\n\n  // validate the input string, and setError or call onChange if needed\n  const memorizedInputValidation = useCallback(\n    (newInputVal: string, onChangeFcn?: OnChange) => {\n      let newVal;\n      let newError: string | undefined;\n      // parse the empty string directly as empty array or object for validation and onChange callback\n      if (newInputVal.trim() === \"\") {\n        newVal = Array.isArray(value) ? [] : {};\n      } else {\n        try {\n          newVal = parse(newInputVal);\n        } catch (e) {\n          newError = e.message;\n        }\n      }\n\n      if (newError != undefined) {\n        setError(newError);\n        return;\n      }\n      setError(\"\"); // clear the previous error\n      const validationResult = dataValidator(newVal);\n      if (validationResult != undefined) {\n        setError(validationErrorToString(validationResult));\n        return;\n      }\n      if (onChangeFcn) {\n        onChangeFcn(newVal);\n      }\n    },\n    [dataValidator, parse, value],\n  );\n\n  /**\n   * when not in editing mode whenever the incoming value changes\n   * we'll compare the new value with prevIncomingVal and reset local state values if they are different\n   */\n  useLayoutEffect(() => {\n    if (!isEditing && value !== prevIncomingVal.current) {\n      if (isEqual(value, prevIncomingVal.current)) {\n        return;\n      }\n      let newVal = \"\";\n      let newError: string | undefined;\n      try {\n        newVal = stringify(value);\n      } catch (e) {\n        newError = `Error stringifying the new value, using \"\" as default. ${e.message}`;\n      }\n      setInputStr(newVal);\n      prevIncomingVal.current = value;\n      if (newError != undefined) {\n        setError(newError);\n        return;\n      }\n      // try to validate if successfully stringified the new value\n      memorizedInputValidation(newVal);\n    }\n  }, [value, stringify, memorizedInputValidation, isEditing]);\n\n  const handleChange = useCallback(\n    (e: React.ChangeEvent<HTMLTextAreaElement>) => {\n      const val = e.currentTarget.value;\n      if (!isEditing) {\n        setIsEditing(true);\n      }\n      setInputStr(val);\n      memorizedInputValidation(val, onChange);\n    },\n    [isEditing, memorizedInputValidation, onChange],\n  );\n\n  useEffect(() => {\n    if (onError && error.length > 0) {\n      onError(error);\n    }\n  }, [error, onError]);\n\n  // scroll to the bottom when the text gets too long\n  useLayoutEffect(\n    () => {\n      if (!isEditing) {\n        const inputElem = inputRef.current;\n        if (inputElem) {\n          inputElem.scrollTop = inputElem.scrollHeight;\n        }\n      }\n    },\n    [isEditing, inputStr], // update whenever inputStr changes\n  );\n\n  return (\n    <>\n      <CodeEditor\n        className={cx(classes.editor, { [classes.error]: error.length > 0 })}\n        readOnly={readOnly}\n        data-testid={dataTestId ?? `validated-input-${JSON.stringify(inputStr)}`}\n        ref={inputRef}\n        value={inputStr}\n        onChange={handleChange}\n        language=\"json\"\n        onBlur={() => setIsEditing(false)}\n        padding={12}\n        style={{ maxHeight: maxHeight ?? 300 }}\n      />\n      {error.length > 0 && (\n        <Stack direction=\"row\" alignItems=\"center\" gap={0.25} padding={0.5}>\n          <ErrorIcon fontSize=\"inherit\" color=\"error\" />\n          <Typography variant=\"caption\" color=\"error.main\">\n            {error}\n          </Typography>\n        </Stack>\n      )}\n    </>\n  );\n}\n\nexport default function JsonInput(props: BaseProps): JSX.Element {\n  function stringify(val: unknown) {\n    if (val === '\"\"') {\n      return val;\n    }\n\n    return JSON.stringify(val, undefined, 2) ?? \"\";\n  }\n\n  return (\n    <Stack>\n      <ValidatedInputBase parse={JSON.parse} stringify={stringify} {...props} maxHeight=\"none\" />\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { ReactElement, useCallback, useEffect, useRef } from \"react\";\n\n// Invoke handler for matching key.\n// By default, preventDefault() is invoked on the event. Return false to allow the default.\ntype KeyHandlers = Record<string, (event: KeyboardEvent) => void | boolean | undefined>;\n\ntype Props = {\n  global?: boolean;\n  keyDownHandlers?: KeyHandlers;\n  keyPressHandlers?: KeyHandlers;\n  keyUpHandlers?: KeyHandlers;\n};\n\nfunction callHandlers(handlers: KeyHandlers | undefined, event: KeyboardEvent): void {\n  if (!handlers) {\n    return;\n  }\n\n  if (typeof handlers[event.key] === \"function\") {\n    let preventDefault = true;\n    try {\n      preventDefault = handlers[event.key]?.(event) ?? true;\n    } finally {\n      if (preventDefault) {\n        event.preventDefault();\n      }\n    }\n  }\n}\n\nexport default function KeyListener(props: Props): ReactElement {\n  const element = useRef<HTMLDivElement>(ReactNull);\n\n  const handleEvent = useCallback(\n    (event: Event) => {\n      if (!(event instanceof KeyboardEvent)) {\n        return;\n      }\n      const { target, type } = event;\n      if (\n        target instanceof HTMLInputElement ||\n        target instanceof HTMLTextAreaElement ||\n        (target instanceof HTMLElement && target.isContentEditable)\n      ) {\n        // The user is typing in an editable field; ignore the event.\n        return;\n      }\n\n      switch (type) {\n        case \"keydown\":\n          callHandlers(props.keyDownHandlers, event);\n          break;\n        case \"keypress\":\n          callHandlers(props.keyPressHandlers, event);\n          break;\n        case \"keyup\":\n          callHandlers(props.keyUpHandlers, event);\n          break;\n        default:\n          break;\n      }\n    },\n    [props.keyDownHandlers, props.keyPressHandlers, props.keyUpHandlers],\n  );\n\n  useEffect(() => {\n    const target = props.global === true ? document : element.current?.parentElement;\n\n    target?.addEventListener(\"keydown\", handleEvent);\n    target?.addEventListener(\"keypress\", handleEvent);\n    target?.addEventListener(\"keyup\", handleEvent);\n\n    return () => {\n      target?.removeEventListener(\"keydown\", handleEvent);\n      target?.removeEventListener(\"keypress\", handleEvent);\n      target?.removeEventListener(\"keyup\", handleEvent);\n    };\n  }, [handleEvent, props.global]);\n\n  return <div style={{ display: \"none\" }} ref={element} />;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Typography } from \"@mui/material\";\nimport { clamp } from \"lodash\";\nimport { FixedSizeList, ListChildComponentProps } from \"react-window\";\n\nconst Constants = Object.freeze({\n  LISTBOX_PADDING: 8,\n  ROW_HEIGHT: 26,\n});\n\nfunction renderRow(props: ListChildComponentProps) {\n  const { data, index, style } = props;\n  const dataSet = data[index];\n  const inlineStyle = {\n    ...style,\n    top: (style.top as number) + Constants.LISTBOX_PADDING,\n  };\n\n  return (\n    <Typography component=\"li\" noWrap style={inlineStyle}>\n      {dataSet}\n    </Typography>\n  );\n}\n\nconst OuterElementContext = React.createContext({});\n\nconst OuterElementType = React.forwardRef<HTMLDivElement>((props, ref) => {\n  const outerProps = React.useContext(OuterElementContext);\n  return <div ref={ref} {...props} {...outerProps} />;\n});\nOuterElementType.displayName = \"OuterElement\";\n\n/**\n * React-window adapter for a virtualized list, used in autocomplete.\n */\nexport const ReactWindowListboxAdapter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLElement>\n>(function ListboxComponent(props, ref) {\n  const { children, ...other } = props;\n  const itemData: React.ReactChild[] = [];\n  (children as React.ReactChild[]).forEach(\n    (item: React.ReactChild & { children?: React.ReactChild[] }) => {\n      itemData.push(item);\n      itemData.push(...(item.children ?? []));\n    },\n  );\n\n  const totalHeight =\n    2 * Constants.LISTBOX_PADDING + Constants.ROW_HEIGHT * clamp(itemData.length, 16);\n\n  return (\n    <div ref={ref}>\n      <OuterElementContext.Provider value={other}>\n        <FixedSizeList\n          height={totalHeight}\n          itemCount={itemData.length}\n          itemData={itemData}\n          itemSize={Constants.ROW_HEIGHT}\n          outerElementType={OuterElementType}\n          width=\"100%\"\n        >\n          {renderRow}\n        </FixedSizeList>\n      </OuterElementContext.Provider>\n    </div>\n  );\n});\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport CancelIcon from \"@mui/icons-material/Cancel\";\nimport {\n  MenuItem,\n  Autocomplete as MuiAutocomplete,\n  TextField,\n  alpha,\n  useTheme,\n} from \"@mui/material\";\nimport { Fzf, FzfResultItem } from \"fzf\";\nimport * as React from \"react\";\nimport {\n  CSSProperties,\n  SyntheticEvent,\n  useCallback,\n  useImperativeHandle,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport { useResizeDetector } from \"react-resize-detector\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { ReactWindowListboxAdapter } from \"@foxglove/studio-base/components/ReactWindowListboxAdapter\";\n\nconst MAX_FZF_MATCHES = 200;\n\ntype AutocompleteProps<T> = {\n  autoSize?: boolean;\n  disableAutoSelect?: boolean;\n  disabled?: boolean;\n  filterText?: string;\n  getItemText?: (item: T) => string;\n  getItemValue?: (item: T) => string;\n  hasError?: boolean;\n  inputStyle?: CSSProperties;\n  items: readonly T[];\n  menuStyle?: CSSProperties;\n  minWidth?: number;\n  onBlur?: () => void;\n  onChange?: (event: React.SyntheticEvent<Element>, text: string) => void;\n  onSelect: (value: string | T, autocomplete: IAutocomplete) => void;\n  placeholder?: string;\n  readOnly?: boolean;\n  selectedItem?: T;\n  selectOnFocus?: boolean;\n  sortWhenFiltering?: boolean;\n  value?: string;\n};\n\nexport interface IAutocomplete {\n  setSelectionRange(selectionStart: number, selectionEnd: number): void;\n  focus(): void;\n  blur(): void;\n}\n\nconst useStyles = makeStyles()((theme) => {\n  const prefersDarkMode = theme.palette.mode === \"dark\";\n  const inputBackgroundColor = prefersDarkMode\n    ? \"rgba(255, 255, 255, 0.09)\"\n    : \"rgba(0, 0, 0, 0.06)\";\n\n  return {\n    root: {\n      \".MuiInputBase-root.MuiInputBase-sizeSmall\": {\n        backgroundColor: \"transparent\",\n        paddingInline: 0,\n\n        \"&:focus-within\": {\n          backgroundColor: inputBackgroundColor,\n        },\n        \"&:hover, &:focus-within\": {\n          paddingRight: theme.spacing(2.5),\n        },\n      },\n    },\n    clearIndicator: {\n      marginRight: theme.spacing(-0.25),\n      opacity: theme.palette.action.disabledOpacity,\n\n      \":hover\": {\n        background: \"transparent\",\n        opacity: 1,\n      },\n    },\n    inputError: {\n      input: {\n        color: theme.palette.error.main,\n      },\n    },\n    item: {\n      padding: 6,\n      cursor: \"pointer\",\n      minHeight: \"100%\",\n      lineHeight: \"calc(100% - 10px)\",\n      overflowWrap: \"break-word\",\n      color: theme.palette.text.primary,\n      whiteSpace: \"pre\",\n    },\n    itemSelected: {\n      backgroundColor: alpha(\n        theme.palette.primary.main,\n        theme.palette.action.selectedOpacity + theme.palette.action.hoverOpacity,\n      ),\n    },\n    itemHighlighted: {\n      backgroundColor: theme.palette.action.hover,\n    },\n  };\n});\n\nfunction defaultGetText(name: string): (item: unknown) => string {\n  return function (item: unknown) {\n    if (typeof item === \"string\") {\n      return item;\n    } else if (\n      item != undefined &&\n      typeof item === \"object\" &&\n      typeof (item as { value?: string }).value === \"string\"\n    ) {\n      return (item as { value: string }).value;\n    }\n    throw new Error(`you need to provide an implementation of ${name}`);\n  };\n}\n\nconst EMPTY_SET = new Set<number>();\n\nfunction itemToFzfResult<T>(item: T): FzfResultItem<T> {\n  return {\n    item,\n    score: 0,\n    positions: EMPTY_SET,\n    start: 0,\n    end: 0,\n  };\n}\n\nconst HighlightChars = (props: { str: string; indices: Set<number> }) => {\n  const theme = useTheme();\n  const chars = props.str.split(\"\");\n\n  const nodes = chars.map((char, i) => {\n    if (props.indices.has(i)) {\n      return (\n        <b key={i} style={{ color: theme.palette.info.main }}>\n          {char}\n        </b>\n      );\n    } else {\n      return (\n        <span key={i} style={{ whiteSpace: \"pre\" }}>\n          {char}\n        </span>\n      );\n    }\n  });\n\n  return <>{nodes}</>;\n};\n\n/**\n * <Autocomplete> is a Studio-specific wrapper of MUI autocomplete with support\n * for things like multiple autocompletes that seamlessly transition into each\n * other, e.g. when building more complex strings like in the Plot panel.\n */\nexport default React.forwardRef(function Autocomplete<T = unknown>(\n  props: AutocompleteProps<T>,\n  ref: React.ForwardedRef<IAutocomplete>,\n): JSX.Element {\n  const inputRef = useRef<HTMLInputElement>(ReactNull);\n\n  const { classes, cx } = useStyles();\n\n  const [stateValue, setValue] = useState<string | undefined>(undefined);\n\n  const getItemText = useMemo(\n    () => props.getItemText ?? defaultGetText(\"getItemText\"),\n    [props.getItemText],\n  );\n\n  const getItemValue = useMemo(\n    () => props.getItemValue ?? defaultGetText(\"getItemValue\"),\n    [props.getItemValue],\n  );\n\n  // Props\n  const {\n    selectedItem,\n    // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n    value = stateValue ?? (selectedItem ? getItemText(selectedItem) : undefined),\n    disabled,\n    filterText = value ?? \"\",\n    items,\n    onBlur: onBlurCallback,\n    onChange: onChangeCallback,\n    onSelect: onSelectCallback,\n    placeholder,\n    readOnly,\n    selectOnFocus,\n    sortWhenFiltering = true,\n  }: AutocompleteProps<T> = props;\n\n  const fzfUnfiltered = useMemo(() => {\n    return items.map((item) => itemToFzfResult(item));\n  }, [items]);\n\n  const fzf = useMemo(() => {\n    // @ts-expect-error Fzf selector TS type seems to be wrong?\n    return new Fzf(items, {\n      fuzzy: \"v2\",\n      sort: sortWhenFiltering,\n      limit: MAX_FZF_MATCHES,\n      selector: getItemText,\n    });\n  }, [getItemText, items, sortWhenFiltering]);\n\n  const autocompleteItems: FzfResultItem<T>[] = useMemo(() => {\n    return filterText ? fzf.find(filterText) : fzfUnfiltered;\n  }, [filterText, fzf, fzfUnfiltered]);\n\n  const hasError = Boolean(props.hasError ?? (autocompleteItems.length === 0 && value?.length));\n\n  const selectedItemValue = selectedItem != undefined ? getItemValue(selectedItem) : undefined;\n  const setSelectionRange = useCallback((selectionStart: number, selectionEnd: number): void => {\n    inputRef.current?.focus();\n    inputRef.current?.setSelectionRange(selectionStart, selectionEnd);\n  }, []);\n\n  const focus = useCallback(() => {\n    inputRef.current?.focus();\n  }, []);\n\n  const blur = useCallback(() => {\n    inputRef.current?.blur();\n    onBlurCallback?.();\n  }, [onBlurCallback]);\n\n  // Give callers an opportunity to control autocomplete\n  useImperativeHandle(ref, () => ({ setSelectionRange, focus, blur }), [\n    setSelectionRange,\n    focus,\n    blur,\n  ]);\n\n  const onChange = useCallback(\n    (_event: ReactNull | React.SyntheticEvent<Element>, newValue: string): void => {\n      if (onChangeCallback) {\n        if (_event) {\n          onChangeCallback(_event, newValue);\n        }\n      } else {\n        setValue(newValue);\n      }\n    },\n    [onChangeCallback],\n  );\n\n  // To allow multiple completions in sequence, it's up to the parent component\n  // to manually blur the input to finish a completion.\n  const onSelect = useCallback(\n    (\n      _event: SyntheticEvent<Element>,\n      selectedValue: ReactNull | string | FzfResultItem<T>,\n    ): void => {\n      if (selectedValue != undefined && typeof selectedValue !== \"string\") {\n        setValue(undefined);\n        onSelectCallback(selectedValue.item, { setSelectionRange, focus, blur });\n      }\n    },\n    [onSelectCallback, blur, focus, setSelectionRange],\n  );\n\n  // Blur the input on resize to prevent misalignment of the input field and the\n  // autocomplete listbox. Debounce to prevent resize observer loop limit errors.\n  useResizeDetector<HTMLInputElement>({\n    handleHeight: false,\n    onResize: () => inputRef.current?.blur(),\n    refreshMode: \"debounce\",\n    refreshRate: 0,\n    skipOnMount: true,\n    targetRef: inputRef,\n  });\n\n  // Don't filter out options here because we assume that the parent\n  // component has already filtered them. This allows completing fragments.\n  const filterOptions = useCallback((options: FzfResultItem<T>[]) => options, []);\n\n  return (\n    <MuiAutocomplete\n      className={classes.root}\n      clearIcon={<CancelIcon fontSize=\"small\" />}\n      componentsProps={{\n        paper: { elevation: 8 },\n        clearIndicator: {\n          size: \"small\",\n          className: classes.clearIndicator,\n        },\n      }}\n      disableCloseOnSelect\n      disabled={disabled}\n      freeSolo\n      fullWidth\n      getOptionLabel={(item: string | FzfResultItem<T>) => {\n        if (typeof item === \"string\") {\n          return item;\n        }\n        return getItemValue(item.item);\n      }}\n      filterOptions={filterOptions}\n      ListboxComponent={ReactWindowListboxAdapter}\n      onChange={onSelect}\n      onInputChange={onChange}\n      openOnFocus\n      options={autocompleteItems}\n      readOnly={readOnly}\n      renderInput={(params) => (\n        <TextField\n          {...params}\n          variant=\"filled\"\n          inputRef={inputRef}\n          data-testid=\"autocomplete-textfield\"\n          placeholder={placeholder}\n          className={cx({ [classes.inputError]: hasError })}\n          size=\"small\"\n        />\n      )}\n      renderOption={(optProps, item: FzfResultItem<T>, { selected }) => {\n        const itemValue = getItemValue(item.item);\n        return (\n          <MenuItem\n            dense\n            {...optProps}\n            key={itemValue}\n            component=\"span\"\n            data-highlighted={selected}\n            data-testid=\"autocomplete-item\"\n            className={cx(classes.item, {\n              [classes.itemHighlighted]: selected,\n              [classes.itemSelected]:\n                selectedItemValue != undefined && itemValue === selectedItemValue,\n            })}\n          >\n            <HighlightChars str={getItemText(item.item)} indices={item.positions} />\n          </MenuItem>\n        );\n      }}\n      selectOnFocus={selectOnFocus}\n      size=\"small\"\n      value={value ?? ReactNull}\n    />\n  );\n}) as <T>(props: AutocompleteProps<T> & React.RefAttributes<IAutocomplete>) => JSX.Element; // https://stackoverflow.com/a/58473012/23649\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { Stack } from \"@mui/material\";\nimport { flatten, flatMap, partition } from \"lodash\";\nimport { CSSProperties, useCallback, useMemo } from \"react\";\n\nimport { MessageDefinitionField } from \"@foxglove/message-definition\";\nimport { Immutable } from \"@foxglove/studio\";\nimport * as PanelAPI from \"@foxglove/studio-base/PanelAPI\";\nimport Autocomplete, { IAutocomplete } from \"@foxglove/studio-base/components/Autocomplete\";\nimport useGlobalVariables, {\n  GlobalVariables,\n} from \"@foxglove/studio-base/hooks/useGlobalVariables\";\nimport { Topic } from \"@foxglove/studio-base/players/types\";\nimport { RosDatatypes } from \"@foxglove/studio-base/types/RosDatatypes\";\nimport { getTopicsByTopicName } from \"@foxglove/studio-base/util/selectors\";\n\nimport { RosPath, RosPrimitive } from \"./constants\";\nimport {\n  traverseStructure,\n  messagePathStructures,\n  messagePathsForDatatype,\n  validTerminatingStructureItem,\n  StructureTraversalResult,\n} from \"./messagePathsForDatatype\";\nimport parseRosPath, { quoteFieldNameIfNeeded, quoteTopicNameIfNeeded } from \"./parseRosPath\";\n\n// To show an input field with an autocomplete so the user can enter message paths, use:\n//\n//  <MessagePathInput path={this.state.path} onChange={path => this.setState({ path })} />\n//\n// To limit the autocomplete items to only certain types of values, you can use\n//\n//  <MessagePathInput types={[\"message\", \"array\", \"primitives\"]} />\n//\n// Or use actual ROS primitive types:\n//\n//  <MessagePathInput types={[\"uint16\", \"float64\"]} />\n//\n// If you are rendering many input fields, you might want to use `<MessagePathInput index={5}>`,\n// which gets passed down to `<MessagePathInput onChange>` as the second parameter, so you can\n// avoid creating anonymous functions on every render (which will prevent the component from\n// rendering unnecessarily).\n\n// Get a list of Message Path strings for all of the fields (recursively) in a list of topics\nfunction getFieldPaths(\n  topics: Immutable<Topic[]>,\n  datatypes: Immutable<RosDatatypes>,\n): Map<string, MessageDefinitionField> {\n  const output = new Map<string, MessageDefinitionField>();\n  for (const topic of topics) {\n    if (topic.schemaName == undefined) {\n      continue;\n    }\n    addFieldPathsForType(\n      quoteTopicNameIfNeeded(topic.name),\n      topic.schemaName,\n      datatypes,\n      [],\n      output,\n    );\n  }\n  return output;\n}\n\nfunction addFieldPathsForType(\n  curPath: string,\n  typeName: string,\n  datatypes: Immutable<RosDatatypes>,\n  seenTypes: string[],\n  output: Map<string, Immutable<MessageDefinitionField>>,\n): void {\n  const msgdef = datatypes.get(typeName);\n  if (msgdef) {\n    for (const field of msgdef.definitions) {\n      if (seenTypes.includes(field.type)) {\n        continue;\n      }\n      if (field.isConstant !== true) {\n        const fieldPath = `${curPath}.${quoteFieldNameIfNeeded(field.name)}`;\n        output.set(fieldPath, field);\n        if (field.isComplex === true) {\n          addFieldPathsForType(\n            fieldPath,\n            field.type,\n            datatypes,\n            [...seenTypes, field.type],\n            output,\n          );\n        }\n      }\n    }\n  }\n}\n\nexport function tryToSetDefaultGlobalVar(\n  variableName: string,\n  setGlobalVariables: (arg0: GlobalVariables) => void,\n): boolean {\n  const defaultGlobalVars = new Map<string, GlobalVariables>();\n  const defaultVar = defaultGlobalVars.get(variableName);\n  if (defaultVar) {\n    setGlobalVariables({ [variableName]: defaultVar });\n    return true;\n  }\n  return false;\n}\n\nexport function getFirstInvalidVariableFromRosPath(\n  rosPath: RosPath,\n  globalVariables: GlobalVariables,\n  setGlobalVariables: (arg0: GlobalVariables) => void,\n): { variableName: string; loc: number } | undefined {\n  const { messagePath } = rosPath;\n  const globalVars = Object.keys(globalVariables);\n  return flatMap(messagePath, (path) => {\n    const messagePathParts = [];\n    if (\n      path.type === \"filter\" &&\n      typeof path.value === \"object\" &&\n      !globalVars.includes(path.value.variableName)\n    ) {\n      const [variableName, loc] = [path.value.variableName, path.valueLoc];\n      messagePathParts.push({ variableName, loc });\n    } else if (path.type === \"slice\") {\n      if (typeof path.start === \"object\" && !globalVars.includes(path.start.variableName)) {\n        const [variableName, loc] = [path.start.variableName, path.start.startLoc];\n        messagePathParts.push({ variableName, loc });\n      }\n      if (typeof path.end === \"object\" && !globalVars.includes(path.end.variableName)) {\n        const [variableName, loc] = [path.end.variableName, path.end.startLoc];\n        messagePathParts.push({ variableName, loc });\n      }\n    }\n    return messagePathParts;\n  }).filter(({ variableName }) => !tryToSetDefaultGlobalVar(variableName, setGlobalVariables))[0];\n}\n\nfunction getExamplePrimitive(primitiveType: RosPrimitive) {\n  switch (primitiveType) {\n    case \"string\":\n      return '\"\"';\n    case \"bool\":\n      return \"true\";\n    case \"float32\":\n    case \"float64\":\n    case \"uint8\":\n    case \"uint16\":\n    case \"uint32\":\n    case \"uint64\":\n    case \"int8\":\n    case \"int16\":\n    case \"int32\":\n    case \"int64\":\n      return \"0\";\n  }\n}\n\ntype MessagePathInputBaseProps = {\n  supportsMathModifiers?: boolean;\n  path: string; // A path of the form `/topic.some_field[:]{id==42}.x`\n  index?: number; // Optional index field which gets passed to `onChange` (so you don't have to create anonymous functions)\n  onChange: (value: string, index?: number) => void;\n  validTypes?: readonly string[]; // Valid types, like \"message\", \"array\", or \"primitive\", or a ROS primitive like \"float64\"\n  noMultiSlices?: boolean; // Don't suggest slices with multiple values `[:]`, only single values like `[0]`.\n  autoSize?: boolean;\n  placeholder?: string;\n  inputStyle?: CSSProperties;\n  disabled?: boolean;\n  disableAutocomplete?: boolean; // Treat this as a normal input, with no autocomplete.\n  readOnly?: boolean;\n  prioritizedDatatype?: string;\n};\n\nexport default React.memo<MessagePathInputBaseProps>(function MessagePathInput(\n  props: MessagePathInputBaseProps,\n) {\n  const { globalVariables, setGlobalVariables } = useGlobalVariables();\n  const { datatypes, topics } = PanelAPI.useDataSourceInfo();\n\n  const {\n    supportsMathModifiers,\n    path,\n    prioritizedDatatype,\n    validTypes,\n    autoSize,\n    placeholder,\n    noMultiSlices,\n    inputStyle,\n    disableAutocomplete = false,\n  } = props;\n\n  const topicFields = useMemo(() => getFieldPaths(topics, datatypes), [datatypes, topics]);\n\n  const onChangeProp = props.onChange;\n  const onChange = useCallback(\n    (event: React.SyntheticEvent<Element>, rawValue: string) => {\n      // When typing a \"{\" character, also  insert a \"}\", so you get an\n      // autocomplete window immediately for selecting a filter name.\n      let value = rawValue;\n      if ((event.nativeEvent as InputEvent).data === \"{\") {\n        const target = event.target as HTMLInputElement;\n        const newCursorPosition = target.selectionEnd ?? 0;\n        value = `${value.slice(0, newCursorPosition)}}${value.slice(newCursorPosition)}`;\n        setImmediate(() => target.setSelectionRange(newCursorPosition, newCursorPosition));\n      }\n      onChangeProp(value, props.index);\n    },\n    [onChangeProp, props.index],\n  );\n\n  const onSelect = useCallback(\n    (\n      rawValue: string,\n      autocomplete: IAutocomplete,\n      autocompleteType: (\"topicName\" | \"messagePath\" | \"globalVariables\") | undefined,\n      autocompleteRange: { start: number; end: number },\n    ) => {\n      const completeStart = path.slice(0, autocompleteRange.start);\n      const completeEnd = path.slice(autocompleteRange.end);\n\n      // Check if accepting this completion would result in a path to a non-complex field.\n      const completedPath = completeStart + rawValue + completeEnd;\n      const completedField = topicFields.get(completedPath);\n      const isSimpleField = completedField != undefined && completedField.isComplex !== true;\n\n      // If we're dealing with a topic name, and we cannot validly end in a message type,\n      // add a \".\" so the user can keep typing to autocomplete the message path.\n      const messageIsValidType = validTypes == undefined || validTypes.includes(\"message\");\n      const keepGoingAfterTopicName =\n        autocompleteType === \"topicName\" && !messageIsValidType && !isSimpleField;\n      const value = keepGoingAfterTopicName ? rawValue + \".\" : rawValue;\n\n      onChangeProp(completeStart + value + completeEnd, props.index);\n\n      // We want to continue typing if we're dealing with a topic name,\n      // or if we just autocompleted something with a filter (because we might want to\n      // edit that filter), or if the autocomplete already has a filter (because we might\n      // have just autocompleted a name inside that filter).\n      if (keepGoingAfterTopicName || value.includes(\"{\") || path.includes(\"{\")) {\n        const newCursorPosition = autocompleteRange.start + value.length;\n        setImmediate(() => autocomplete.setSelectionRange(newCursorPosition, newCursorPosition));\n      } else {\n        autocomplete.blur();\n      }\n    },\n    [onChangeProp, path, props.index, topicFields, validTypes],\n  );\n\n  const rosPath = useMemo(() => parseRosPath(path), [path]);\n\n  const topic = useMemo(() => {\n    if (!rosPath) {\n      return undefined;\n    }\n\n    const { topicName } = rosPath;\n    return topics.find(({ name }) => name === topicName);\n  }, [rosPath, topics]);\n\n  const messagePathStructuresForDataype = useMemo(\n    () => messagePathStructures(datatypes),\n    [datatypes],\n  );\n\n  const structureTraversalResult = useMemo((): StructureTraversalResult | undefined => {\n    if (!topic || !rosPath?.messagePath) {\n      return undefined;\n    }\n    if (topic.schemaName == undefined) {\n      return {\n        valid: true,\n        msgPathPart: undefined,\n        structureItem: {\n          structureType: \"message\",\n          nextByName: {},\n          datatype: \"\",\n        },\n      };\n    }\n\n    return traverseStructure(\n      messagePathStructuresForDataype[topic.schemaName],\n      rosPath.messagePath,\n    );\n  }, [messagePathStructuresForDataype, rosPath?.messagePath, topic]);\n\n  const invalidGlobalVariablesVariable = useMemo(() => {\n    if (!rosPath) {\n      return undefined;\n    }\n    return getFirstInvalidVariableFromRosPath(rosPath, globalVariables, setGlobalVariables);\n  }, [globalVariables, rosPath, setGlobalVariables]);\n\n  const topicNamesAutocompleteItems = useMemo(\n    () => topics.map(({ name }) => quoteTopicNameIfNeeded(name)),\n    [topics],\n  );\n\n  const topicNamesAndFieldsAutocompleteItems = useMemo(\n    () => topicNamesAutocompleteItems.concat(Array.from(topicFields.keys())),\n    [topicFields, topicNamesAutocompleteItems],\n  );\n\n  const autocompleteType = useMemo(() => {\n    if (!rosPath) {\n      return \"topicName\";\n    } else if (!topic) {\n      return \"topicName\";\n    } else if (\n      structureTraversalResult == undefined ||\n      !structureTraversalResult.valid ||\n      !validTerminatingStructureItem(structureTraversalResult.structureItem, validTypes)\n    ) {\n      return \"messagePath\";\n    }\n\n    if (invalidGlobalVariablesVariable) {\n      return \"globalVariables\";\n    }\n\n    return undefined;\n  }, [invalidGlobalVariablesVariable, structureTraversalResult, validTypes, rosPath, topic]);\n\n  const { autocompleteItems, autocompleteFilterText, autocompleteRange } = useMemo(() => {\n    if (disableAutocomplete) {\n      return {\n        autocompleteItems: [],\n        autocompleteFilterText: \"\",\n        autocompleteRange: { start: 0, end: Infinity },\n      };\n    } else if (autocompleteType === \"topicName\") {\n      // If the path is empty, return topic names only to show the full list of topics. Otherwise,\n      // use the full set of topic names and field paths to autocomplete\n      return {\n        autocompleteItems: path\n          ? topicNamesAndFieldsAutocompleteItems\n          : topicNamesAutocompleteItems,\n        autocompleteFilterText: path,\n        autocompleteRange: { start: 0, end: Infinity },\n      };\n    } else if (autocompleteType === \"messagePath\" && topic && rosPath) {\n      if (\n        structureTraversalResult &&\n        !structureTraversalResult.valid &&\n        structureTraversalResult.msgPathPart?.type === \"filter\" &&\n        structureTraversalResult.structureItem?.structureType === \"message\"\n      ) {\n        const { msgPathPart } = structureTraversalResult;\n\n        const items: string[] = [];\n\n        // Provide filter suggestions for primitive values, since they're the only kinds of values\n        // that can be filtered on.\n        for (const name of Object.keys(structureTraversalResult.structureItem.nextByName)) {\n          const item = structureTraversalResult.structureItem.nextByName[name];\n          if (item?.structureType === \"primitive\") {\n            items.push(`${name}==${getExamplePrimitive(item.primitiveType)}`);\n          }\n        }\n\n        const filterText = msgPathPart.path.join(\".\");\n\n        return {\n          autocompleteItems: items,\n          autocompleteFilterText: filterText,\n          autocompleteRange: {\n            start: msgPathPart.nameLoc,\n            end: msgPathPart.nameLoc + filterText.length,\n          },\n        };\n      } else {\n        // Exclude any initial filters (\"/topic{foo=='bar'}\") from the range that will be replaced\n        // when the user chooses a new message path.\n        const initialFilterLength =\n          rosPath.messagePath[0]?.type === \"filter\" ? rosPath.messagePath[0].repr.length + 2 : 0;\n\n        return {\n          autocompleteItems:\n            topic.schemaName == undefined\n              ? []\n              : messagePathsForDatatype(topic.schemaName, datatypes, {\n                  validTypes,\n                  noMultiSlices,\n                  messagePath: rosPath.messagePath,\n                }).filter(\n                  // .header.seq is pretty useless but shows up everryyywhere.\n                  (msgPath) => msgPath !== \"\" && !msgPath.endsWith(\".header.seq\"),\n                ),\n\n          autocompleteRange: {\n            start: rosPath.topicNameRepr.length + initialFilterLength,\n            end: Infinity,\n          },\n          // Filter out filters (hah!) in a pretty crude way, so autocomplete still works\n          // when already having specified a filter and you want to see what other object\n          // names you can complete it with. Kind of an edge case, and this doesn't work\n          // ideally (because it will remove your existing filter if you actually select\n          // the autocomplete item), but it's easy to do for now, and nice to have.\n          autocompleteFilterText: path\n            .substring(rosPath.topicNameRepr.length)\n            .replace(/\\{[^}]*\\}/g, \"\"),\n        };\n      }\n    } else if (invalidGlobalVariablesVariable) {\n      return {\n        autocompleteItems: Object.keys(globalVariables).map((key) => `$${key}`),\n        autocompleteRange: {\n          start: invalidGlobalVariablesVariable.loc,\n          end:\n            invalidGlobalVariablesVariable.loc +\n            invalidGlobalVariablesVariable.variableName.length +\n            1,\n        },\n        autocompleteFilterText: invalidGlobalVariablesVariable.variableName,\n      };\n    }\n\n    return {\n      autocompleteItems: [],\n      autocompleteFilterText: \"\",\n      autocompleteRange: { start: 0, end: Infinity },\n    };\n  }, [\n    disableAutocomplete,\n    autocompleteType,\n    topic,\n    rosPath,\n    invalidGlobalVariablesVariable,\n    path,\n    topicNamesAutocompleteItems,\n    topicNamesAndFieldsAutocompleteItems,\n    structureTraversalResult,\n    datatypes,\n    validTypes,\n    noMultiSlices,\n    globalVariables,\n  ]);\n\n  const orderedAutocompleteItems = useMemo(() => {\n    if (prioritizedDatatype == undefined) {\n      return autocompleteItems;\n    }\n\n    return flatten(\n      partition(\n        autocompleteItems,\n        (item) => getTopicsByTopicName(topics)[item]?.schemaName === prioritizedDatatype,\n      ),\n    );\n  }, [autocompleteItems, prioritizedDatatype, topics]);\n\n  const usesUnsupportedMathModifier =\n    (supportsMathModifiers == undefined || !supportsMathModifiers) && path.includes(\".@\");\n\n  const hasError =\n    usesUnsupportedMathModifier ||\n    (autocompleteType != undefined && !disableAutocomplete && path.length > 0);\n\n  return (\n    <Stack\n      direction=\"row\"\n      justifyContent=\"space-between\"\n      alignItems=\"center\"\n      flexGrow={1}\n      flexShrink={0}\n      spacing={0.25}\n    >\n      <Autocomplete\n        items={orderedAutocompleteItems}\n        disabled={props.disabled}\n        readOnly={props.readOnly}\n        filterText={autocompleteFilterText}\n        value={path}\n        onChange={onChange}\n        onSelect={(value, autocomplete) =>\n          onSelect(value, autocomplete, autocompleteType, autocompleteRange)\n        }\n        hasError={hasError}\n        placeholder={\n          placeholder != undefined && placeholder !== \"\" ? placeholder : \"/some/topic.msgs[0].field\"\n        }\n        autoSize={autoSize}\n        inputStyle={inputStyle} // Disable autoselect since people often construct complex queries, and it's very annoying\n        // to have the entire input selected whenever you want to make a change to a part it.\n        disableAutoSelect\n      />\n    </Stack>\n  );\n});\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\n/**\n * List of typical filter names. Typical filter names are common names that are used for filters\n * in message path queries. For example, \"id\" or \"key\".\n */\nexport const TypicalFilterNames = [\"id\", \"_id\", \"ID\", \"Id\", \"key\"];\n\n// This regex does not change so we can create it once and reuse.\nconst typicalFilterNameRegex = /^id$|_id$|I[dD]$|^key$/;\n\n/**\n * Returns true if the given name is a typical filter name.\n */\nexport function isTypicalFilterName(name: string): boolean {\n  return typicalFilterNameRegex.test(name);\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport natsort from \"natsort\";\n\nconst sortFn = natsort({ insensitive: true });\n\ntype StringOrNumberFields<T> = T extends Record<string, unknown>\n  ? { [K in keyof T]: T[K] extends string | number ? K : never }[keyof T]\n  : never;\n\nfunction naturalSort(): typeof sortFn;\nfunction naturalSort<T, K extends StringOrNumberFields<T>>(key: K): (a: T, b: T) => number;\nfunction naturalSort<T, K extends StringOrNumberFields<T>>(key?: K): unknown {\n  return key == undefined\n    ? sortFn\n    : (a: T, b: T) =>\n        sortFn(a[key] as unknown as string | number, b[key] as unknown as string | number);\n}\n\nexport default naturalSort;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nconst RosPrimitives = {\n  bool: undefined,\n  int8: undefined,\n  uint8: undefined,\n  int16: undefined,\n  uint16: undefined,\n  int32: undefined,\n  uint32: undefined,\n  int64: undefined,\n  uint64: undefined,\n  float32: undefined,\n  float64: undefined,\n  string: undefined,\n};\n\nexport type RosPrimitive = keyof typeof RosPrimitives;\nexport const rosPrimitives = Object.keys(RosPrimitives) as RosPrimitive[];\n\nexport type MessagePathFilter = {\n  type: \"filter\";\n  path: string[];\n  value?: number | string | bigint | { variableName: string; startLoc: number };\n  nameLoc: number;\n  valueLoc: number;\n  repr: string; // the original string representation of the filter\n};\n\n// A parsed version of paths.\nexport type MessagePathPart =\n  | {\n      type: \"name\";\n      /** Referenced field name */\n      name: string;\n      /**\n       * Original spelling of the field name in the input message path (for accurate reproduction in\n       * autocomplete and string length)\n       */\n      repr: string;\n    }\n  | {\n      type: \"slice\";\n      start: number | { variableName: string; startLoc: number };\n      end: number | { variableName: string; startLoc: number };\n    }\n  | MessagePathFilter;\n\nexport type RosPath = {\n  /** Referenced topic name */\n  topicName: string;\n  /**\n   * Original spelling of the topic name in the input message path (for accurate reproduction in\n   * autocomplete and string length)\n   */\n  topicNameRepr: string;\n  messagePath: MessagePathPart[];\n  modifier?: string;\n};\n\n// \"Structure items\" are a more useful version of `datatypes`. They can be\n// easily traversed to either validate message paths or generate message paths.\nexport type MessagePathStructureItemMessage = {\n  structureType: \"message\";\n  nextByName: {\n    [key: string]: MessagePathStructureItem;\n  };\n  datatype: string;\n};\ntype MessagePathStructureItemArray = {\n  structureType: \"array\";\n  next: MessagePathStructureItem;\n  datatype: string;\n};\ntype MessagePathStructureItemPrimitive = {\n  structureType: \"primitive\";\n  primitiveType: RosPrimitive;\n  datatype: string;\n};\nexport type MessagePathStructureItem =\n  | MessagePathStructureItemMessage\n  | MessagePathStructureItemArray\n  | MessagePathStructureItemPrimitive;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { memoize } from \"lodash\";\nimport memoizeWeak from \"memoize-weak\";\n\nimport { Immutable } from \"@foxglove/studio\";\nimport { MessagePathFilter } from \"@foxglove/studio-base/components/MessagePathSyntax/constants\";\nimport { isTypicalFilterName } from \"@foxglove/studio-base/components/MessagePathSyntax/isTypicalFilterName\";\nimport { quoteFieldNameIfNeeded } from \"@foxglove/studio-base/components/MessagePathSyntax/parseRosPath\";\nimport { RosDatatypes } from \"@foxglove/studio-base/types/RosDatatypes\";\nimport { assertNever } from \"@foxglove/studio-base/util/assertNever\";\nimport naturalSort from \"@foxglove/studio-base/util/naturalSort\";\n\nimport {\n  MessagePathPart,\n  rosPrimitives,\n  RosPrimitive,\n  MessagePathStructureItem,\n  MessagePathStructureItemMessage,\n} from \"./constants\";\n\nconst STRUCTURE_ITEM_INTEGER_TYPES = [\n  \"int8\",\n  \"uint8\",\n  \"int16\",\n  \"uint16\",\n  \"int32\",\n  \"uint32\",\n  \"int64\",\n  \"uint64\",\n];\n\nfunction isRosPrimitive(type: string): type is RosPrimitive {\n  return rosPrimitives.includes(type as RosPrimitive);\n}\n\nfunction structureItemIsIntegerPrimitive(item: MessagePathStructureItem) {\n  return (\n    item.structureType === \"primitive\" && STRUCTURE_ITEM_INTEGER_TYPES.includes(item.primitiveType)\n  );\n}\n\n// Generate an easily navigable flat structure given some `datatypes`. We cache\n// this loosely as `datatypes` don't change after the player has connected.\n// The structure looks something like this:\n//\n// {\n//   \"/datatype/name\": {\n//     structureType: \"message\",\n//     nextByName: {\n//       \"some-sub-field\": {\n//         structureType: \"primitive\",\n//         primitiveType: \"uint8\",\n//       }\n//       \"some-boolean-array-sub-field\": {\n//         structureType: \"array\",\n//         next: {\n//           structureType: \"primitive\",\n//           primitiveType: \"bool\"\n//         }\n//       }\n//     }\n//   }\n// }\nlet lastDatatypes: Immutable<RosDatatypes> | undefined;\nlet lastStructures: Record<string, MessagePathStructureItemMessage> | undefined;\nexport function messagePathStructures(\n  datatypes: Immutable<RosDatatypes>,\n): Record<string, MessagePathStructureItemMessage> {\n  if (lastDatatypes === datatypes && lastStructures) {\n    return lastStructures;\n  }\n\n  lastDatatypes = undefined;\n  const structureFor = memoize(\n    (datatype: string, seenDatatypes: string[]): MessagePathStructureItemMessage => {\n      const nextByName: Record<string, MessagePathStructureItem> = {};\n      const rosDatatype = datatypes.get(datatype);\n      if (!rosDatatype) {\n        // \"time\" and \"duration\" are considered \"built-in\" types in ROS\n        // If we can't find a datatype in our datatypes list we fall-back to our hard-coded versions\n        if (datatype === \"time\" || datatype === \"duration\") {\n          return {\n            structureType: \"message\",\n            nextByName: {\n              sec: {\n                structureType: \"primitive\",\n                primitiveType: \"uint32\",\n                datatype: \"\",\n              },\n              nsec: {\n                structureType: \"primitive\",\n                primitiveType: \"uint32\",\n                datatype: \"\",\n              },\n            },\n            datatype,\n          };\n        }\n\n        throw new Error(`datatype not found: \"${datatype}\"`);\n      }\n      rosDatatype.definitions.forEach((msgField) => {\n        if (msgField.isConstant === true) {\n          return;\n        }\n\n        if (seenDatatypes.includes(msgField.type)) {\n          return;\n        }\n\n        const next: MessagePathStructureItem = isRosPrimitive(msgField.type)\n          ? {\n              structureType: \"primitive\",\n              primitiveType: msgField.type,\n              datatype,\n            }\n          : structureFor(msgField.type, [...seenDatatypes, msgField.type]);\n\n        if (msgField.isArray === true) {\n          nextByName[msgField.name] = { structureType: \"array\", next, datatype };\n        } else {\n          nextByName[msgField.name] = next;\n        }\n      });\n      return { structureType: \"message\", nextByName, datatype };\n    },\n  );\n\n  lastStructures = {};\n  for (const [datatype] of datatypes) {\n    lastStructures[datatype] = structureFor(datatype, []);\n  }\n  lastDatatypes = datatypes; // Set at the very end, in case there's an error earlier.\n  return lastStructures;\n}\n\nexport function validTerminatingStructureItem(\n  structureItem?: MessagePathStructureItem,\n  validTypes?: readonly string[],\n): boolean {\n  return (\n    !!structureItem &&\n    (!validTypes ||\n      validTypes.includes(structureItem.structureType) ||\n      validTypes.includes(structureItem.datatype) ||\n      (structureItem.structureType === \"primitive\" &&\n        validTypes.includes(structureItem.primitiveType)))\n  );\n}\n\n// Given a datatype, the array of datatypes, and a list of valid types,\n// list out all valid strings for the `messagePath` part of the path (sorted).\nexport function messagePathsForDatatype(\n  datatype: string,\n  datatypes: Immutable<RosDatatypes>,\n  {\n    validTypes,\n    noMultiSlices,\n    messagePath = [],\n  }: {\n    validTypes?: readonly string[];\n    noMultiSlices?: boolean;\n    messagePath?: MessagePathPart[];\n  } = {},\n): string[] {\n  let clonedMessagePath = [...messagePath];\n  const messagePaths: string[] = [];\n  function traverse(structureItem: MessagePathStructureItem, builtString: string) {\n    if (validTerminatingStructureItem(structureItem, validTypes)) {\n      messagePaths.push(builtString);\n    }\n    if (structureItem.structureType === \"message\") {\n      for (const [name, item] of Object.entries(structureItem.nextByName)) {\n        traverse(item, `${builtString}.${quoteFieldNameIfNeeded(name)}`);\n      }\n    } else if (structureItem.structureType === \"array\") {\n      if (structureItem.next.structureType === \"message\") {\n        // When we have an array of messages, you probably want to filter on\n        // some field, like `/topic.object{some_id=123}`. If we can't find a\n        // typical filter name, fall back to `/topic.object[0]`.\n        const typicalFilterItem = Object.entries(structureItem.next.nextByName).find(([name]) =>\n          isTypicalFilterName(name),\n        );\n        if (typicalFilterItem) {\n          const [typicalFilterName, typicalFilterValue] = typicalFilterItem;\n\n          // Find matching filter from clonedMessagePath\n          const matchingFilterPart = clonedMessagePath.find(\n            (pathPart): pathPart is MessagePathFilter =>\n              pathPart.type === \"filter\" && pathPart.path[0] === typicalFilterName,\n          );\n\n          // Format the displayed filter value\n          if (matchingFilterPart) {\n            // Remove the matching filter from clonedMessagePath, for future searches\n            clonedMessagePath = clonedMessagePath.filter(\n              (pathPart) => pathPart !== matchingFilterPart,\n            );\n            traverse(\n              structureItem.next,\n              `${builtString}[:]{${typicalFilterName}==${\n                typeof matchingFilterPart.value === \"object\"\n                  ? `$${matchingFilterPart.value.variableName}`\n                  : matchingFilterPart.value\n              }}`,\n            );\n          } else if (structureItemIsIntegerPrimitive(typicalFilterValue)) {\n            traverse(structureItem.next, `${builtString}[:]{${typicalFilterName}==0}`);\n          } else {\n            traverse(structureItem.next, `${builtString}[0]`);\n          }\n        } else {\n          traverse(structureItem.next, `${builtString}[0]`);\n        }\n      } else if (noMultiSlices !== true) {\n        // When dealing with an array of primitives, you likely just want a\n        // scatter plot (if we can do multi-slices).\n        traverse(structureItem.next, `${builtString}[:]`);\n      } else {\n        traverse(structureItem.next, `${builtString}[0]`);\n      }\n    }\n  }\n  const structureItem = messagePathStructures(datatypes)[datatype];\n  if (structureItem != undefined) {\n    traverse(structureItem, \"\");\n  }\n  return messagePaths.sort(naturalSort());\n}\n\nexport type StructureTraversalResult = {\n  valid: boolean;\n  msgPathPart?: MessagePathPart;\n  structureItem?: MessagePathStructureItem;\n};\n\n// Traverse down the structure given a `messagePath`. Return if the path\n// is valid, given the structure, `validTypes`, and `noMultiSlices`.\n//\n// We return the `msgPathPart` that was invalid to determine what sort\n// of autocomplete we should show.\n//\n// We use memoizeWeak because it works with multiple arguments (lodash's memoize\n// does not) and does not hold onto objects as strongly (it uses WeakMap).\nexport const traverseStructure = memoizeWeak(\n  (\n    initialStructureItem: MessagePathStructureItem | undefined,\n    messagePath: MessagePathPart[],\n  ): StructureTraversalResult => {\n    let structureItem = initialStructureItem;\n    if (!structureItem) {\n      return { valid: false, msgPathPart: undefined, structureItem: undefined };\n    }\n    for (const msgPathPart of messagePath) {\n      if (!structureItem) {\n        return { valid: false, msgPathPart, structureItem };\n      }\n      if (msgPathPart.type === \"name\") {\n        if (structureItem.structureType !== \"message\") {\n          return { valid: false, msgPathPart, structureItem };\n        }\n        const next: MessagePathStructureItem | undefined =\n          structureItem.nextByName[msgPathPart.name];\n        structureItem = next;\n      } else if (msgPathPart.type === \"slice\") {\n        if (structureItem.structureType !== \"array\") {\n          return { valid: false, msgPathPart, structureItem };\n        }\n        structureItem = structureItem.next;\n        // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n      } else if (msgPathPart.type === \"filter\") {\n        if (\n          structureItem.structureType !== \"message\" ||\n          msgPathPart.path.length === 0 ||\n          msgPathPart.value == undefined\n        ) {\n          return { valid: false, msgPathPart, structureItem };\n        }\n        let currentItem: MessagePathStructureItem | undefined = structureItem;\n        for (const name of msgPathPart.path) {\n          if (currentItem.structureType !== \"message\") {\n            return { valid: false, msgPathPart, structureItem };\n          }\n          currentItem = currentItem.nextByName[name];\n          if (currentItem == undefined) {\n            return { valid: false, msgPathPart, structureItem };\n          }\n        }\n      } else {\n        assertNever(\n          msgPathPart,\n          `Invalid msgPathPart.type: ${(msgPathPart as MessagePathPart).type}`,\n        );\n      }\n    }\n    return { valid: true, msgPathPart: undefined, structureItem };\n  },\n);\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { memoize, uniq } from \"lodash\";\nimport { Parser, Grammar } from \"nearley\";\n\nimport { filterMap } from \"@foxglove/den/collection\";\n\nimport { RosPath } from \"./constants\";\nimport grammar from \"./grammar.ne\";\n\nconst grammarObj = Grammar.fromCompiled(grammar);\n\n/** Wrap topic name in double quotes if it contains special characters */\nexport function quoteTopicNameIfNeeded(name: string): string {\n  // Pattern should match `slashID` in grammar.ne\n  if (name.match(/^[a-zA-Z0-9_/-]+$/)) {\n    return name;\n  }\n  return `\"${name.replace(/[\\\\\"]/g, (char) => `\\\\${char}`)}\"`;\n}\n\n/** Wrap field name in double quotes if it contains special characters */\nexport function quoteFieldNameIfNeeded(name: string): string {\n  // Pattern should match `id` in grammar.ne\n  if (name.match(/^[a-zA-Z0-9_-]+$/)) {\n    return name;\n  }\n  return `\"${name.replace(/[\\\\\"]/g, (char) => `\\\\${char}`)}\"`;\n}\n\nconst parseRosPath = memoize((path: string): RosPath | undefined => {\n  // Need to create a new Parser object for every new string to parse (should be cheap).\n  const parser = new Parser(grammarObj);\n  try {\n    return parser.feed(path).results[0];\n  } catch (_) {\n    return undefined;\n  }\n});\nexport default parseRosPath;\n\nexport function getTopicsFromPaths(paths: readonly string[]): string[] {\n  return uniq(\n    filterMap(paths, (path) => {\n      const rosPath = parseRosPath(path);\n      return rosPath ? rosPath.topicName : undefined;\n    }),\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport Logger from \"@foxglove/log\";\nimport { Time, isLessThan, subtract as subtractTimes, toSec } from \"@foxglove/rostime\";\nimport { PlayerState, MessageEvent, PlayerProblem } from \"@foxglove/studio-base/players/types\";\nimport { formatFrame } from \"@foxglove/studio-base/util/time\";\n\nconst DRIFT_THRESHOLD_SEC = 1; // Maximum amount of drift allowed.\nconst WAIT_FOR_SEEK_SEC = 1; // How long we wait for a change in `lastSeekTime` before warning.\n\nconst log = Logger.getLogger(__filename);\n\n// Logs a warning when there is a significant difference (more than `DRIFT_THRESHOLD_SEC`) between\n// a message's timestamp and `player.currentTime` OR when messages went back in time,\n// except when `player.lastSeekTime` changes, in which case panels should be clearing out their stored data.\n//\n// This is to ensure that other mechanisms that we have in place for either discarding old messages\n// or forcing an update of `player.lastSeekTime` are working properly.\nclass MessageOrderTracker {\n  #lastMessages: readonly MessageEvent[] = [];\n  #lastCurrentTime?: Time;\n  #lastMessageTime?: Time;\n  #lastMessageTopic?: string;\n  #lastLastSeekTime?: number;\n  #warningTimeout?: ReturnType<typeof setTimeout>;\n\n  /**\n   * Set this to `true` to debug out-of-order messages. It is disabled by default in production\n   * because logging messages to the console prevents them from getting garbage-collected as long as\n   * the console is not cleared.\n   */\n  #trackIncorrectMessages = false;\n\n  #incorrectMessages: MessageEvent[] = [];\n\n  public update(playerState: PlayerState): PlayerProblem[] {\n    if (!playerState.activeData) {\n      return [];\n    }\n\n    const problems: PlayerProblem[] = [];\n\n    const { messages, currentTime, lastSeekTime, messagesRecomputed } = playerState.activeData;\n    let didSeek = false;\n\n    if (this.#lastLastSeekTime !== lastSeekTime) {\n      this.#lastLastSeekTime = lastSeekTime;\n      if (this.#warningTimeout) {\n        clearTimeout(this.#warningTimeout);\n        this.#warningTimeout = undefined;\n        this.#incorrectMessages = [];\n      }\n      this.#warningTimeout = this.#lastMessageTime = this.#lastCurrentTime = undefined;\n      this.#lastMessages = [];\n      didSeek = true;\n    }\n    if (this.#lastMessages !== messages || this.#lastCurrentTime !== currentTime) {\n      this.#lastMessages = messages;\n      this.#lastCurrentTime = currentTime;\n      for (const message of messages) {\n        const messageTime = message.receiveTime;\n\n        // The first emit after a seek occurs from a backfill. This backfill might produce messages\n        // much older than the seek time.\n        if (!didSeek) {\n          const currentTimeDrift = Math.abs(toSec(subtractTimes(messageTime, currentTime)));\n          if (currentTimeDrift > DRIFT_THRESHOLD_SEC) {\n            if (this.#trackIncorrectMessages) {\n              this.#incorrectMessages.push(message);\n            }\n            if (!this.#warningTimeout) {\n              this.#warningTimeout = setTimeout(() => {\n                // timeout has fired, we need to clear so a new timeout registers if there are more messages\n                this.#warningTimeout = undefined;\n                // reset incorrect message queue before posting warning so we never keep\n                // incorrectMessages around. The browser console will keep messages in memory when\n                // logged, so disable logging of messages unless explicitly enabled.\n                const info = {\n                  currentTime,\n                  lastSeekTime,\n                  messageTime,\n                  incorrectMessages: this.#trackIncorrectMessages\n                    ? this.#incorrectMessages\n                    : \"not being tracked\",\n                };\n                this.#incorrectMessages = [];\n                log.warn(\n                  `Message receiveTime very different from player.currentTime; without updating lastSeekTime`,\n                  info,\n                );\n              }, WAIT_FOR_SEEK_SEC * 1000);\n            }\n          }\n        }\n\n        if (\n          // If we have recomputed the current frame there could be messages from before the lastMessageTime\n          messagesRecomputed !== true &&\n          this.#lastMessageTime &&\n          this.#lastMessageTopic != undefined &&\n          isLessThan(messageTime, this.#lastMessageTime)\n        ) {\n          const formattedTime = formatFrame(messageTime);\n          const lastMessageTime = formatFrame(this.#lastMessageTime);\n          const errorMessage =\n            `Processed a message on ${message.topic} at ${formattedTime} which is earlier than ` +\n            `last processed message on ${this.#lastMessageTopic} at ${lastMessageTime}.`;\n\n          problems.push({\n            severity: \"warn\",\n            message: \"Data went back in time\",\n            error: new Error(errorMessage),\n          });\n        }\n        this.#lastMessageTopic = message.topic;\n        this.#lastMessageTime = messageTime;\n      }\n    }\n\n    return problems;\n  }\n}\n\nexport default MessageOrderTracker;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { PromiseTimeoutError, promiseTimeout } from \"@foxglove/den/async\";\nimport sendNotification from \"@foxglove/studio-base/util/sendNotification\";\n\nexport type FramePromise = { name: string; promise: Promise<void> };\n\n// Wait longer before erroring if there's no user waiting (in automated run)\nexport const MAX_PROMISE_TIMEOUT_TIME_MS = 5000;\n\nexport async function pauseFrameForPromises(promises: FramePromise[]): Promise<void> {\n  try {\n    await promiseTimeout(\n      Promise.all(promises.map(async ({ promise }) => await promise)),\n      MAX_PROMISE_TIMEOUT_TIME_MS,\n    );\n  } catch (error) {\n    // An async render task failed to finish in time; some panels may display data from the wrong frame.\n    const isTimeoutError = error instanceof PromiseTimeoutError;\n    if (!isTimeoutError) {\n      sendNotification(\"Player \", error, \"app\", \"error\");\n      return;\n    }\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { flatten } from \"lodash\";\nimport { MutableRefObject } from \"react\";\nimport shallowequal from \"shallowequal\";\nimport { createStore, StoreApi } from \"zustand\";\n\nimport { Condvar } from \"@foxglove/den/async\";\nimport { MessageEvent } from \"@foxglove/studio\";\nimport {\n  AdvertiseOptions,\n  Player,\n  PlayerCapabilities,\n  PlayerPresence,\n  PlayerState,\n  SubscribePayload,\n} from \"@foxglove/studio-base/players/types\";\nimport { assertNever } from \"@foxglove/studio-base/util/assertNever\";\n\nimport { FramePromise } from \"./pauseFrameForPromise\";\nimport { MessagePipelineContext } from \"./types\";\n\nexport function defaultPlayerState(): PlayerState {\n  return {\n    presence: PlayerPresence.NOT_PRESENT,\n    progress: {},\n    capabilities: [],\n    profile: undefined,\n    playerId: \"\",\n    activeData: undefined,\n  };\n}\n\nexport type MessagePipelineInternalState = {\n  dispatch: (action: MessagePipelineStateAction) => void;\n\n  player?: Player;\n\n  /** used to keep track of whether we need to update public.startPlayback/playUntil/etc. */\n  lastCapabilities: string[];\n\n  subscriptionsById: Map<string, SubscribePayload[]>;\n  publishersById: { [key: string]: AdvertiseOptions[] };\n  allPublishers: AdvertiseOptions[];\n  subscriberIdsByTopic: Map<string, string[]>;\n  newTopicsBySubscriberId: Map<string, Set<string>>;\n  lastMessageEventByTopic: Map<string, MessageEvent>;\n  /** Function to call when react render has completed with the latest state */\n  renderDone?: () => void;\n\n  /** Part of the state that is exposed to consumers via useMessagePipeline */\n  public: MessagePipelineContext;\n};\n\ntype UpdateSubscriberAction = {\n  type: \"update-subscriber\";\n  id: string;\n  payloads: SubscribePayload[];\n};\ntype UpdatePlayerStateAction = {\n  type: \"update-player-state\";\n  playerState: PlayerState;\n  renderDone?: () => void;\n};\n\nexport type MessagePipelineStateAction =\n  | UpdateSubscriberAction\n  | UpdatePlayerStateAction\n  | { type: \"set-player\"; player: Player | undefined }\n  | { type: \"set-publishers\"; id: string; payloads: AdvertiseOptions[] };\n\nexport function createMessagePipelineStore({\n  promisesToWaitForRef,\n  initialPlayer,\n}: {\n  promisesToWaitForRef: MutableRefObject<FramePromise[]>;\n  initialPlayer: Player | undefined;\n}): StoreApi<MessagePipelineInternalState> {\n  return createStore((set, get) => ({\n    player: initialPlayer,\n    dispatch(action) {\n      set((state) => reducer(state, action));\n    },\n    publishersById: {},\n    allPublishers: [],\n    subscriptionsById: new Map(),\n    subscriberIdsByTopic: new Map(),\n    newTopicsBySubscriberId: new Map(),\n    lastMessageEventByTopic: new Map(),\n    lastCapabilities: [],\n\n    public: {\n      playerState: defaultPlayerState(),\n      messageEventsBySubscriberId: new Map(),\n      subscriptions: [],\n      sortedTopics: [],\n      datatypes: new Map(),\n      setSubscriptions(id, payloads) {\n        get().dispatch({ type: \"update-subscriber\", id, payloads });\n      },\n      setPublishers(id, payloads) {\n        get().dispatch({ type: \"set-publishers\", id, payloads });\n        get().player?.setPublishers(get().allPublishers);\n      },\n      setParameter(key, value) {\n        get().player?.setParameter(key, value);\n      },\n      publish(payload) {\n        get().player?.publish(payload);\n      },\n      async callService(service, request) {\n        const player = get().player;\n        if (player) {\n          return await player.callService(service, request);\n        }\n        throw new Error(\"callService called when player is not present\");\n      },\n      startPlayback: undefined,\n      playUntil: undefined,\n      pausePlayback: undefined,\n      setPlaybackSpeed: undefined,\n      seekPlayback: undefined,\n\n      pauseFrame(name: string) {\n        const condvar = new Condvar();\n        promisesToWaitForRef.current.push({ name, promise: condvar.wait() });\n        return () => {\n          condvar.notifyAll();\n        };\n      },\n    },\n  }));\n}\n// Update state with a subscriber. Any new topics for the subscriber are tracked in newTopicsBySubscriberId\n// to receive the last message on their newly subscribed topics.\nfunction updateSubscriberAction(\n  prevState: MessagePipelineInternalState,\n  action: UpdateSubscriberAction,\n): MessagePipelineInternalState {\n  const previousSubscriptionsById = prevState.subscriptionsById;\n  const newTopicsBySubscriberId = new Map(prevState.newTopicsBySubscriberId);\n\n  // Record any _new_ topics for this subscriber into newTopicsBySubscriberId\n  const newTopics = newTopicsBySubscriberId.get(action.id);\n  if (!newTopics) {\n    const actionTopics = action.payloads.map((sub) => sub.topic);\n    newTopicsBySubscriberId.set(action.id, new Set(actionTopics));\n  } else {\n    const previousSubscription = previousSubscriptionsById.get(action.id);\n    const prevTopics = new Set(previousSubscription?.map((sub) => sub.topic) ?? []);\n    for (const { topic: newTopic } of action.payloads) {\n      if (!prevTopics.has(newTopic)) {\n        newTopics.add(newTopic);\n      }\n    }\n  }\n\n  const newSubscriptionsById = new Map(previousSubscriptionsById);\n\n  if (action.payloads.length === 0) {\n    // When a subscription id has no topics we removed it from our map\n    newSubscriptionsById.delete(action.id);\n  } else {\n    newSubscriptionsById.set(action.id, action.payloads);\n  }\n\n  const subscriberIdsByTopic = new Map<string, string[]>();\n\n  const subscriptions: SubscribePayload[] = [];\n\n  // make a map of topics to subscriber ids\n  for (const [id, subs] of newSubscriptionsById) {\n    for (const subscription of subs) {\n      const topic = subscription.topic;\n\n      const ids = subscriberIdsByTopic.get(topic) ?? [];\n      ids.push(id);\n      subscriberIdsByTopic.set(topic, ids);\n      subscriptions.push(subscription);\n    }\n  }\n\n  return {\n    ...prevState,\n    subscriptionsById: newSubscriptionsById,\n    subscriberIdsByTopic,\n    newTopicsBySubscriberId,\n    public: {\n      ...prevState.public,\n      subscriptions,\n    },\n  };\n}\n// Update with a player state.\n// Put messages from the player state into messagesBySubscriberId. Any new topic subscribers, receive\n// the last message on a topic.\nfunction updatePlayerStateAction(\n  prevState: MessagePipelineInternalState,\n  action: UpdatePlayerStateAction,\n): MessagePipelineInternalState {\n  const messages = action.playerState.activeData?.messages;\n\n  const seenTopics = new Set<string>();\n\n  // We need a new set of message arrays for each subscriber since downstream users rely\n  // on object instance reference checks to determine if there are new messages\n  const messagesBySubscriberId = new Map<string, MessageEvent[]>();\n\n  const subsById = prevState.subscriptionsById;\n  const subscriberIdsByTopic = prevState.subscriberIdsByTopic;\n\n  const lastMessageEventByTopic = prevState.lastMessageEventByTopic;\n  const newTopicsBySubscriberId = new Map(prevState.newTopicsBySubscriberId);\n\n  // Put messages into per-subscriber queues\n  if (messages && messages !== prevState.public.playerState.activeData?.messages) {\n    for (const messageEvent of messages) {\n      // Save the last message on every topic to send the last message\n      // to newly subscribed panels.\n      lastMessageEventByTopic.set(messageEvent.topic, messageEvent);\n\n      seenTopics.add(messageEvent.topic);\n      const ids = subscriberIdsByTopic.get(messageEvent.topic);\n      if (!ids) {\n        continue;\n      }\n\n      for (const id of ids) {\n        let subscriberMessageEvents = messagesBySubscriberId.get(id);\n        if (!subscriberMessageEvents) {\n          subscriberMessageEvents = [];\n          messagesBySubscriberId.set(id, subscriberMessageEvents);\n        }\n        subscriberMessageEvents.push(messageEvent);\n      }\n    }\n  }\n\n  // Inject the last message on a topic to all new subscribers of the topic\n  for (const id of subsById.keys()) {\n    const newTopics = newTopicsBySubscriberId.get(id);\n    if (!newTopics) {\n      continue;\n    }\n    for (const topic of newTopics) {\n      // If we had a message for this topic in the regular set of messages, we don't need to inject\n      // another message.\n      if (seenTopics.has(topic)) {\n        continue;\n      }\n      const msgEvent = lastMessageEventByTopic.get(topic);\n      if (msgEvent) {\n        const subscriberMessageEvents = messagesBySubscriberId.get(id) ?? [];\n        // the injected message is older than any new messages\n        subscriberMessageEvents.unshift(msgEvent);\n        messagesBySubscriberId.set(id, subscriberMessageEvents);\n      }\n    }\n    // We've processed all new subscriber topics into message queues\n    newTopics.clear();\n  }\n\n  const newPublicState = {\n    ...prevState.public,\n    playerState: action.playerState,\n    messageEventsBySubscriberId: messagesBySubscriberId,\n  };\n\n  const topics = action.playerState.activeData?.topics;\n  if (topics !== prevState.public.playerState.activeData?.topics) {\n    newPublicState.sortedTopics = topics\n      ? [...topics].sort((a, b) => a.name.localeCompare(b.name))\n      : [];\n  }\n  if (\n    action.playerState.activeData?.datatypes !== prevState.public.playerState.activeData?.datatypes\n  ) {\n    newPublicState.datatypes = action.playerState.activeData?.datatypes ?? new Map();\n  }\n\n  const capabilities = action.playerState.capabilities;\n  const player = prevState.player;\n  if (player && !shallowequal(capabilities, prevState.lastCapabilities)) {\n    newPublicState.startPlayback = capabilities.includes(PlayerCapabilities.playbackControl)\n      ? player.startPlayback?.bind(player)\n      : undefined;\n    newPublicState.playUntil = capabilities.includes(PlayerCapabilities.playbackControl)\n      ? player.playUntil?.bind(player)\n      : undefined;\n    newPublicState.pausePlayback = capabilities.includes(PlayerCapabilities.playbackControl)\n      ? player.pausePlayback?.bind(player)\n      : undefined;\n    newPublicState.setPlaybackSpeed = capabilities.includes(PlayerCapabilities.setSpeed)\n      ? player.setPlaybackSpeed?.bind(player)\n      : undefined;\n    newPublicState.seekPlayback = capabilities.includes(PlayerCapabilities.playbackControl)\n      ? player.seekPlayback?.bind(player)\n      : undefined;\n  }\n\n  return {\n    ...prevState,\n    newTopicsBySubscriberId,\n    renderDone: action.renderDone,\n    public: newPublicState,\n    lastCapabilities: capabilities,\n  };\n}\n\nexport function reducer(\n  prevState: MessagePipelineInternalState,\n  action: MessagePipelineStateAction,\n): MessagePipelineInternalState {\n  switch (action.type) {\n    case \"update-player-state\":\n      return updatePlayerStateAction(prevState, action);\n    case \"update-subscriber\":\n      return updateSubscriberAction(prevState, action);\n\n    case \"set-publishers\": {\n      const newPublishersById = { ...prevState.publishersById, [action.id]: action.payloads };\n\n      return {\n        ...prevState,\n        publishersById: newPublishersById,\n        allPublishers: flatten(Object.values(newPublishersById)),\n      };\n    }\n\n    case \"set-player\":\n      if (action.player === prevState.player) {\n        return prevState;\n      }\n      return {\n        ...prevState,\n        player: action.player,\n        lastCapabilities: [],\n        lastMessageEventByTopic: new Map(),\n        public: {\n          ...prevState.public,\n          sortedTopics: [],\n          datatypes: new Map(),\n          messageEventsBySubscriberId: new Map(),\n          startPlayback: undefined,\n          pausePlayback: undefined,\n          playUntil: undefined,\n          setPlaybackSpeed: undefined,\n          seekPlayback: undefined,\n        },\n      };\n  }\n\n  assertNever(\n    action,\n    `Unhandled message pipeline action type ${(action as MessagePipelineStateAction).type}`,\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { debounce } from \"lodash\";\nimport {\n  createContext,\n  useCallback,\n  useEffect,\n  useLayoutEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport { StoreApi, useStore } from \"zustand\";\n\nimport { useGuaranteedContext } from \"@foxglove/hooks\";\nimport { Immutable } from \"@foxglove/studio\";\nimport { AppSetting } from \"@foxglove/studio-base/AppSetting\";\nimport { useAppConfigurationValue } from \"@foxglove/studio-base/hooks/useAppConfigurationValue\";\nimport { GlobalVariables } from \"@foxglove/studio-base/hooks/useGlobalVariables\";\nimport {\n  Player,\n  PlayerProblem,\n  PlayerState,\n  SubscribePayload,\n} from \"@foxglove/studio-base/players/types\";\n\nimport MessageOrderTracker from \"./MessageOrderTracker\";\nimport { pauseFrameForPromises, FramePromise } from \"./pauseFrameForPromise\";\nimport {\n  MessagePipelineInternalState,\n  createMessagePipelineStore,\n  MessagePipelineStateAction,\n  defaultPlayerState,\n} from \"./store\";\nimport { MessagePipelineContext } from \"./types\";\n\nexport type { MessagePipelineContext };\n\n// exported only for MockMessagePipelineProvider\nexport const ContextInternal = createContext<StoreApi<MessagePipelineInternalState> | undefined>(\n  undefined,\n);\n\n/**\n * useMessagePipelineGetter returns a function to access the current message pipeline context.\n * Commonly used in places where you want to access a value from the latest pipeline in a useCallback hook\n * but don't want the callback dependencies invalidated on ever change.\n *\n * @returns a function to return the current MessagePipelineContext\n */\nexport function useMessagePipelineGetter(): () => MessagePipelineContext {\n  const store = useGuaranteedContext(ContextInternal);\n  return useCallback(() => store.getState().public, [store]);\n}\n\nexport function useMessagePipeline<T>(selector: (arg0: MessagePipelineContext) => T): T {\n  const store = useGuaranteedContext(ContextInternal);\n  return useStore(\n    store,\n    useCallback((state) => selector(state.public), [selector]),\n  );\n}\n\ntype ProviderProps = {\n  children: React.ReactNode;\n\n  // Represents either the lack of a player, a player that is currently being constructed, or a\n  // valid player. MessagePipelineProvider is not responsible for building players, but it is\n  // responsible for providing player state information downstream in a context -- so this\n  // information is passed in and merged with other player state.\n  player?: Player;\n\n  globalVariables: GlobalVariables;\n};\n\nconst selectRenderDone = (state: MessagePipelineInternalState) => state.renderDone;\nconst selectSubscriptions = (state: MessagePipelineInternalState) => state.public.subscriptions;\n\nexport function MessagePipelineProvider({\n  children,\n  player,\n  globalVariables,\n}: ProviderProps): React.ReactElement {\n  const promisesToWaitForRef = useRef<FramePromise[]>([]);\n  const [store] = useState(() =>\n    createMessagePipelineStore({ promisesToWaitForRef, initialPlayer: player }),\n  );\n  useEffect(() => {\n    store.getState().dispatch({ type: \"set-player\", player });\n    player?.setPublishers(store.getState().allPublishers);\n  }, [player, store]);\n\n  const subscriptions = useStore(store, selectSubscriptions);\n\n  // Debounce the subscription updates for players. This batches multiple subscribe calls\n  // into one update for the player which avoids fetching data that will be immediately discarded.\n  //\n  // The delay of 0ms is intentional as we only want to give one timeout cycle to batch updates\n  const debouncedPlayerSetSubscriptions = useMemo(() => {\n    return debounce((subs: Immutable<SubscribePayload[]>) => {\n      player?.setSubscriptions(subs);\n    });\n  }, [player]);\n\n  // when unmounting or changing the debounce function cancel any pending debounce\n  useEffect(() => {\n    return () => {\n      debouncedPlayerSetSubscriptions.cancel();\n    };\n  }, [debouncedPlayerSetSubscriptions]);\n\n  useEffect(\n    () => debouncedPlayerSetSubscriptions(subscriptions),\n    [debouncedPlayerSetSubscriptions, subscriptions],\n  );\n\n  // Slow down the message pipeline framerate to the given FPS if it is set to less than 60\n  const [messageRate] = useAppConfigurationValue<number>(AppSetting.MESSAGE_RATE);\n\n  // Tell listener the layout has completed\n  const renderDone = useStore(store, selectRenderDone);\n  useLayoutEffect(() => {\n    renderDone?.();\n  }, [renderDone]);\n\n  const msPerFrameRef = useRef<number>(16);\n  msPerFrameRef.current = 1000 / (messageRate ?? 60);\n\n  const dispatch = store.getState().dispatch;\n  useEffect(() => {\n    if (!player) {\n      // When there is no player, set the player state to the default to go back to a state where we\n      // indicate the player is not present.\n      dispatch({\n        type: \"update-player-state\",\n        playerState: defaultPlayerState(),\n        renderDone: undefined,\n      });\n      return;\n    }\n\n    const { listener, cleanupListener } = createPlayerListener({\n      msPerFrameRef,\n      promisesToWaitForRef,\n      dispatch,\n    });\n    player.setListener(listener);\n    return () => {\n      cleanupListener();\n      player.close();\n      dispatch({\n        type: \"update-player-state\",\n        playerState: defaultPlayerState(),\n        renderDone: undefined,\n      });\n    };\n  }, [player, dispatch]);\n\n  useEffect(() => {\n    player?.setGlobalVariables(globalVariables);\n  }, [player, globalVariables]);\n\n  return <ContextInternal.Provider value={store}>{children}</ContextInternal.Provider>;\n}\n\n// Given a PlayerState and a PlayerProblem array, add the problems to any existing player problems\nfunction concatProblems(origState: PlayerState, problems: PlayerProblem[]): PlayerState {\n  if (problems.length === 0) {\n    return origState;\n  }\n\n  return {\n    ...origState,\n    problems: problems.concat(origState.problems ?? []),\n  };\n}\n\n/**\n * The creation of the player listener is extracted as a separate function to prevent memory leaks.\n * When multiple closures are created inside of an outer function, V8 allocates one \"context\" object\n * to be shared by all the inner closures, holding the shared variables they access. As long as any\n * of the inner closures are still alive, the context and **all** the shared variables stay alive.\n *\n * In the case of MessagePipelineProvider, when the `listener` closure was created directly inside\n * the useEffect above, it would end up retaining a shared context that also retained the player\n * `state` variable returned by `usePlayerState()`, even though the listener closure didn't actually\n * use it. In particular, each time a new player was created in the useEffect, this caused it to\n * retain the old player's state (via the listener closure), creating a \"linked list\" effect that\n * caused the last state produced by each player (and therefore also its preloaded message blocks)\n * to be retained indefinitely as new data sources were swapped in.\n *\n * To avoid this problem, we extract the closure creation into a module-level function where it\n * won't see variables from outer scopes that are potentially retained in the shared context due to\n * their use in other closures.\n *\n * This type of leak is discussed at:\n * - https://bugs.chromium.org/p/chromium/issues/detail?id=315190\n * - http://point.davidglasser.net/2013/06/27/surprising-javascript-memory-leak.html\n * - https://stackoverflow.com/questions/53985411/understanding-javascript-closure-variable-capture-in-v8\n */\nfunction createPlayerListener(args: {\n  msPerFrameRef: React.MutableRefObject<number>;\n  promisesToWaitForRef: React.MutableRefObject<FramePromise[]>;\n  dispatch: (action: MessagePipelineStateAction) => void;\n}): {\n  listener: (state: PlayerState) => Promise<void>;\n  cleanupListener: () => void;\n} {\n  const { msPerFrameRef, promisesToWaitForRef, dispatch: updateState } = args;\n  const messageOrderTracker = new MessageOrderTracker();\n  let closed = false;\n  let resolveFn: undefined | (() => void);\n  const listener = async (listenerPlayerState: PlayerState) => {\n    if (closed) {\n      return;\n    }\n\n    if (resolveFn) {\n      throw new Error(\"New playerState was emitted before last playerState was rendered.\");\n    }\n\n    // check for any out-of-order or out-of-sync messages\n    const problems = messageOrderTracker.update(listenerPlayerState);\n    const newPlayerState = concatProblems(listenerPlayerState, problems);\n\n    const promise = new Promise<void>((resolve) => {\n      resolveFn = () => {\n        resolveFn = undefined;\n        resolve();\n      };\n    });\n\n    // Track when we start the state update. This will pair when layout effect calls renderDone.\n    const start = Date.now();\n\n    // Render done is invoked by a layout effect once the component has rendered.\n    // After the component renders, we kick off an animation frame to give panels one\n    // animation frame to invoke pause.\n    let called = false;\n    function renderDone() {\n      if (called) {\n        return;\n      }\n      called = true;\n\n      // Compute how much time remains before this frame is done\n      const delta = Date.now() - start;\n      const frameTime = Math.max(0, msPerFrameRef.current - delta);\n\n      // Panels have the remaining frame time to invoke pause\n      setTimeout(async () => {\n        if (closed) {\n          return;\n        }\n\n        const promisesToWaitFor = promisesToWaitForRef.current;\n        if (promisesToWaitFor.length > 0) {\n          promisesToWaitForRef.current = [];\n          await pauseFrameForPromises(promisesToWaitFor);\n        }\n\n        if (!resolveFn) {\n          return;\n        }\n        resolveFn();\n      }, frameTime);\n    }\n\n    updateState({\n      type: \"update-player-state\",\n      playerState: newPlayerState,\n      renderDone,\n    });\n\n    return await promise;\n  };\n  return {\n    listener,\n    cleanupListener() {\n      closed = true;\n      resolveFn = undefined;\n    },\n  };\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext } from \"react\";\nimport { MosaicPath } from \"react-mosaic-component\";\n\n/**\n * Exposes the mosaic path at which a panel is located. Unlike calling\n * `mosaicWindowActions.getPath()` during render, subscribing to this context will trigger a\n * re-render when the path changes.\n */\nexport const MosaicPathContext = createContext<MosaicPath | undefined>(undefined);\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Button, Link } from \"@mui/material\";\nimport { Component, ErrorInfo, PropsWithChildren, ReactNode } from \"react\";\n\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { reportError } from \"@foxglove/studio-base/reportError\";\nimport { AppError } from \"@foxglove/studio-base/util/errors\";\n\nimport ErrorDisplay from \"./ErrorDisplay\";\n\ntype Props = {\n  showErrorDetails?: boolean;\n  hideErrorSourceLocations?: boolean;\n  onResetPanel: () => void;\n  onRemovePanel: () => void;\n};\n\ntype State = {\n  currentError: { error: Error; errorInfo: ErrorInfo } | undefined;\n};\n\nexport default class PanelErrorBoundary extends Component<PropsWithChildren<Props>, State> {\n  public override state: State = {\n    currentError: undefined,\n  };\n\n  public override componentDidCatch(error: Error, errorInfo: ErrorInfo): void {\n    reportError(new AppError(error, errorInfo));\n    this.setState({ currentError: { error, errorInfo } });\n  }\n\n  public override render(): ReactNode {\n    if (this.state.currentError) {\n      return (\n        <ErrorDisplay\n          title=\"This panel encountered an unexpected error\"\n          error={this.state.currentError.error}\n          errorInfo={this.state.currentError.errorInfo}\n          showErrorDetails={this.props.showErrorDetails}\n          hideErrorSourceLocations={this.props.hideErrorSourceLocations}\n          content={\n            <p>\n              Something went wrong in this panel.{\" \"}\n              <Link color=\"inherit\" onClick={() => this.setState({ currentError: undefined })}>\n                Dismiss this error\n              </Link>{\" \"}\n              to continue using this panel. If the issue persists, try resetting the panel.\n            </p>\n          }\n          actions={\n            <>\n              <Stack direction=\"row-reverse\" gap={1}>\n                <Button\n                  variant=\"outlined\"\n                  color=\"secondary\"\n                  onClick={() => this.setState({ currentError: undefined })}\n                >\n                  Dismiss\n                </Button>\n                <Button\n                  variant=\"outlined\"\n                  title=\"Reset panel settings to default values\"\n                  color=\"error\"\n                  onClick={() => {\n                    this.setState({ currentError: undefined });\n                    this.props.onResetPanel();\n                  }}\n                >\n                  Reset Panel\n                </Button>\n                <Button\n                  variant=\"text\"\n                  title=\"Remove this panel from the layout\"\n                  color=\"error\"\n                  onClick={this.props.onRemovePanel}\n                >\n                  Remove Panel\n                </Button>\n              </Stack>\n            </>\n          }\n        />\n      );\n    }\n    return this.props.children;\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { defer } from \"lodash\";\nimport { useContext } from \"react\";\nimport { useDrag, ConnectDragSource, ConnectDragPreview } from \"react-dnd\";\nimport { MosaicDragType, MosaicNode, MosaicWindowContext } from \"react-mosaic-component\";\n\nimport {\n  useCurrentLayoutActions,\n  usePanelMosaicId,\n} from \"@foxglove/studio-base/context/CurrentLayoutContext\";\nimport { MosaicDropResult, SavedProps } from \"@foxglove/studio-base/types/panels\";\n\ntype PanelDragObject = {\n  deferredHide: number;\n  originalLayout: MosaicNode<string> | undefined;\n  originalConfigById: SavedProps;\n};\n\n// Hook to integrate mosaic drag functionality into any other component\nexport default function usePanelDrag(props: {\n  tabId?: string;\n  panelId?: string;\n  onDragStart?: () => void;\n  onDragEnd?: () => void;\n}): [ConnectDragSource, ConnectDragPreview] {\n  const { tabId: sourceTabId, panelId, onDragStart, onDragEnd } = props;\n  const { mosaicWindowActions } = useContext(MosaicWindowContext);\n\n  const mosaicId = usePanelMosaicId();\n\n  const { getCurrentLayoutState: getCurrentLayout, startDrag, endDrag } = useCurrentLayoutActions();\n\n  const [, connectDragSource, connectDragPreview] = useDrag<\n    PanelDragObject,\n    MosaicDropResult,\n    never\n  >({\n    type: MosaicDragType.WINDOW,\n    item: () => {\n      if (onDragStart) {\n        onDragStart();\n      }\n\n      const { selectedLayout } = getCurrentLayout();\n      if (!selectedLayout?.data) {\n        // eslint-disable-next-line no-restricted-syntax\n        return null;\n      }\n\n      const { layout: originalLayout, configById: originalConfigById } = selectedLayout.data;\n\n      // The defer is necessary as the element must be present on start for HTML DnD to not cry\n      const path = mosaicWindowActions.getPath();\n      const deferredHide = defer(() => {\n        startDrag({ path, sourceTabId });\n      });\n      return { mosaicId, deferredHide, originalLayout, originalConfigById };\n    },\n    end: (item, monitor) => {\n      if (onDragEnd) {\n        onDragEnd();\n      }\n      if (item.originalLayout == undefined) {\n        return;\n      }\n\n      // If the hide call hasn't happened yet, cancel it\n      window.clearTimeout(item.deferredHide);\n      const ownPath = mosaicWindowActions.getPath();\n      const dropResult = monitor.getDropResult() ?? {};\n      const { position, path: destinationPath, tabId: targetTabId } = dropResult;\n      if (panelId == undefined) {\n        return;\n      }\n\n      endDrag({\n        originalLayout: item.originalLayout,\n        originalSavedProps: item.originalConfigById,\n        panelId,\n        sourceTabId,\n        targetTabId,\n        position,\n        destinationPath,\n        ownPath,\n      });\n    },\n  });\n\n  return [connectDragSource, connectDragPreview];\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport BorderAllIcon from \"@mui/icons-material/BorderAll\";\nimport DeleteForeverOutlinedIcon from \"@mui/icons-material/DeleteForeverOutlined\";\nimport LibraryAddOutlinedIcon from \"@mui/icons-material/LibraryAddOutlined\";\nimport TabIcon from \"@mui/icons-material/Tab\";\nimport { Button, useTheme } from \"@mui/material\";\nimport { last } from \"lodash\";\nimport React, {\n  ComponentType,\n  MouseEventHandler,\n  Profiler,\n  useCallback,\n  useContext,\n  useLayoutEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport {\n  getNodeAtPath,\n  getOtherBranch,\n  MosaicContext,\n  MosaicNode,\n  MosaicWindowActions,\n  MosaicWindowContext,\n  updateTree,\n} from \"react-mosaic-component\";\nimport { Transition } from \"react-transition-group\";\nimport { useMountedState } from \"react-use\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { useShallowMemo } from \"@foxglove/hooks\";\nimport { useConfigById } from \"@foxglove/studio-base/PanelAPI\";\nimport KeyListener from \"@foxglove/studio-base/components/KeyListener\";\nimport { MosaicPathContext } from \"@foxglove/studio-base/components/MosaicPathContext\";\nimport PanelContext from \"@foxglove/studio-base/components/PanelContext\";\nimport PanelErrorBoundary from \"@foxglove/studio-base/components/PanelErrorBoundary\";\nimport { PanelRoot, PANEL_ROOT_CLASS_NAME } from \"@foxglove/studio-base/components/PanelRoot\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport {\n  useCurrentLayoutActions,\n  useSelectedPanels,\n} from \"@foxglove/studio-base/context/CurrentLayoutContext\";\nimport { usePanelCatalog } from \"@foxglove/studio-base/context/PanelCatalogContext\";\nimport {\n  useWorkspaceStore,\n  WorkspaceStoreSelectors,\n} from \"@foxglove/studio-base/context/Workspace/WorkspaceContext\";\nimport usePanelDrag from \"@foxglove/studio-base/hooks/usePanelDrag\";\nimport { TabPanelConfig } from \"@foxglove/studio-base/types/layouts\";\nimport { OpenSiblingPanel, PanelConfig, SaveConfig } from \"@foxglove/studio-base/types/panels\";\nimport { TAB_PANEL_TYPE } from \"@foxglove/studio-base/util/globalConstants\";\nimport {\n  getPanelIdForType,\n  getPanelTypeFromId,\n  getPathFromNode,\n  updateTabPanelLayout,\n} from \"@foxglove/studio-base/util/layout\";\n\nconst useStyles = makeStyles()((theme) => ({\n  actionsOverlay: {\n    cursor: \"pointer\",\n    position: \"absolute\",\n    top: 0,\n    left: 0,\n    right: 0,\n    bottom: 0,\n    zIndex: 100000, // highest level within panel\n    backgroundColor: theme.palette.background.paper,\n    display: \"flex\",\n    alignItems: \"center\",\n    alignContent: \"center\",\n    justifyContent: \"center\",\n    flexDirection: \"column\",\n    flexWrap: \"wrap\",\n    visibility: \"hidden\",\n    pointerEvents: \"none\",\n\n    [`.${PANEL_ROOT_CLASS_NAME}:hover > &`]: {\n      visibility: \"visible\",\n      pointerEvents: \"auto\",\n    },\n    // for screenshot tests\n    \".hoverForScreenshot &\": {\n      visible: \"visible\",\n      pointerEvents: \"auto\",\n    },\n  },\n  perfInfo: {\n    position: \"absolute\",\n    whiteSpace: \"pre-line\",\n    bottom: 2,\n    left: 2,\n    fontSize: 9,\n    opacity: 0.7,\n    userSelect: \"none\",\n    mixBlendMode: \"difference\",\n  },\n  container: {\n    padding: theme.spacing(2),\n    maxWidth: 300,\n    margin: \"auto\",\n    gap: theme.spacing(1),\n  },\n  button: {\n    flexDirection: \"column\",\n    alignItems: \"center\",\n    textAlign: \"center\",\n    whiteSpace: \"nowrap\",\n    padding: theme.spacing(1, 2),\n    width: \"50%\",\n    flex: \"auto\",\n\n    \".MuiButton-startIcon\": {\n      margin: 0,\n    },\n  },\n}));\n\ntype Props<Config> = {\n  childId?: string;\n  overrideConfig?: Config;\n  tabId?: string;\n};\n\nexport interface PanelStatics<Config> {\n  panelType: string;\n  defaultConfig: Config;\n}\n\n// Like React.ComponentType<P>, but without restrictions on the constructor return type.\ntype ComponentConstructorType<P> = { displayName?: string } & (\n  | { new (props: P): React.Component<unknown, unknown> }\n  | { (props: P): React.ReactElement<unknown> | ReactNull }\n);\n\n/** Used in storybook when panels are renered outside of a <PanelLayout/> */\nconst FALLBACK_PANEL_ID = \"$unknown_id\";\n\n// HOC that wraps panel in an error boundary and flex box.\n// Gives panel a `config` and `saveConfig`.\n//   export default Panel(MyPanelComponent)\n//\n// `config` comes from the current layout, but in stories / tests you can pass in your own:\n//   `<MyPanel config={…} />`\nexport default function Panel<\n  Config extends PanelConfig,\n  PanelProps extends { config: Config; saveConfig: SaveConfig<Config> },\n>(\n  PanelComponent: ComponentConstructorType<PanelProps> & PanelStatics<Config>,\n): ComponentType<Props<Config> & Omit<PanelProps, \"config\" | \"saveConfig\">> & PanelStatics<Config> {\n  function ConnectedPanel(props: Props<Config>) {\n    const { childId = FALLBACK_PANEL_ID, overrideConfig, tabId, ...otherProps } = props;\n    const theme = useTheme();\n    const { classes, cx } = useStyles();\n    const isMounted = useMountedState();\n\n    const { mosaicActions } = useContext(MosaicContext);\n    const { mosaicWindowActions }: { mosaicWindowActions: MosaicWindowActions } =\n      useContext(MosaicWindowContext);\n\n    const {\n      selectedPanelIds,\n      setSelectedPanelIds,\n      selectAllPanels,\n      togglePanelSelected,\n      getSelectedPanelIds,\n    } = useSelectedPanels();\n\n    const isSelected = useMemo(\n      () => selectedPanelIds.includes(childId),\n      [childId, selectedPanelIds],\n    );\n    const numSelectedPanelsIfSelected = useMemo(\n      () => (isSelected ? selectedPanelIds.length : 0),\n      [isSelected, selectedPanelIds],\n    );\n\n    const {\n      savePanelConfigs,\n      updatePanelConfigs,\n      createTabPanel,\n      closePanel,\n      swapPanel,\n      getCurrentLayoutState,\n    } = useCurrentLayoutActions();\n\n    const [quickActionsKeyPressed, setQuickActionsKeyPressed] = useState(false);\n    const [fullscreen, setFullscreen] = useState(false);\n    const [fullscreenSourceRect, setFullscreenSourceRect] = useState<DOMRect | undefined>(\n      undefined,\n    );\n    const [hasFullscreenDescendant, _setHasFullscreenDescendant] = useState(false);\n    const panelRootRef = useRef<HTMLDivElement>(ReactNull);\n    const panelCatalog = usePanelCatalog();\n\n    const mosaicPath = useContext(MosaicPathContext);\n    const isTopLevelPanel =\n      mosaicPath != undefined && mosaicPath.length === 0 && tabId == undefined;\n\n    // There may be a parent panel (when a panel is in a tab).\n    const parentPanelContext = useContext(PanelContext);\n\n    const type = PanelComponent.panelType;\n    const title = useMemo(\n      () => panelCatalog.getPanelByType(type)?.title ?? \"\",\n      [panelCatalog, type],\n    );\n\n    const defaultConfig = PanelComponent.defaultConfig;\n    const [savedConfig, saveConfig] = useConfigById<Config>(childId);\n\n    const resetPanel = useCallback(() => {\n      saveConfig(defaultConfig);\n    }, [defaultConfig, saveConfig]);\n\n    // PanelSettings needs useConfigById to return a complete config. If there is no saved config\n    // (or it is an empty object), or if keys have been added to the default config since it was\n    // previously saved, we save the default config provided by the panel. This typically happens\n    // when a new panel is added and the layout does not yet have a config. Even if this effect gets\n    // run more than once, we only need to save the default config once.\n    //\n    // An empty object can occur when swapping a panel\n    const savedDefaultConfig = useRef(false);\n    useLayoutEffect(() => {\n      if (savedDefaultConfig.current) {\n        return;\n      }\n\n      if (!savedConfig || Object.keys(savedConfig).length === 0) {\n        savedDefaultConfig.current = true;\n        saveConfig(defaultConfig);\n      } else if (\n        Object.entries(defaultConfig).some(\n          ([key, value]) => value != undefined && !(key in savedConfig),\n        )\n      ) {\n        savedDefaultConfig.current = true;\n        saveConfig({ ...defaultConfig, ...savedConfig });\n      }\n    }, [defaultConfig, saveConfig, savedConfig]);\n\n    const panelComponentConfig = useMemo(\n      () => ({ ...defaultConfig, ...savedConfig, ...overrideConfig }),\n      [savedConfig, defaultConfig, overrideConfig],\n    );\n\n    // Open a panel next to the current panel, of the specified `panelType`.\n    // If such a panel already exists, we update it with the new props.\n    const openSiblingPanel = useCallback<OpenSiblingPanel>(\n      async ({ panelType, siblingConfigCreator, updateIfExists }) => {\n        const panelsState = getCurrentLayoutState().selectedLayout?.data;\n        if (!panelsState) {\n          return;\n        }\n\n        let siblingDefaultConfig: PanelConfig = {};\n\n        // If we can lookup the sibling panel type, try to load the default config from the panel module\n        const siblingPanelInfo = panelCatalog.getPanelByType(panelType);\n        if (siblingPanelInfo) {\n          const siblingModule = await siblingPanelInfo.module();\n          if (!isMounted()) {\n            return;\n          }\n\n          siblingDefaultConfig = siblingModule.default.defaultConfig;\n        }\n\n        const ownPath = mosaicWindowActions.getPath();\n\n        // Try to find a sibling panel and update it with the `siblingConfig`\n        if (updateIfExists) {\n          const lastNode = last(ownPath);\n          const siblingPathEnd = lastNode != undefined ? getOtherBranch(lastNode) : \"second\";\n          const siblingPath = ownPath.slice(0, -1).concat(siblingPathEnd);\n          const siblingId = getNodeAtPath(mosaicActions.getRoot(), siblingPath);\n          if (typeof siblingId === \"string\" && getPanelTypeFromId(siblingId) === panelType) {\n            const siblingConfig: PanelConfig = {\n              ...siblingDefaultConfig,\n              ...panelsState.configById[siblingId],\n            };\n            savePanelConfigs({\n              configs: [\n                {\n                  id: siblingId,\n                  config: siblingConfigCreator(siblingConfig),\n                  defaultConfig: siblingDefaultConfig,\n                },\n              ],\n            });\n            return;\n          }\n        }\n\n        // Otherwise, open new panel\n        const newPanelPath = ownPath.concat(\"second\");\n        const newPanelConfig = siblingConfigCreator(siblingDefaultConfig);\n        void mosaicWindowActions\n          .split({ type: panelType, panelConfig: newPanelConfig })\n          .then(() => {\n            const newPanelId = getNodeAtPath(mosaicActions.getRoot(), newPanelPath) as string;\n            savePanelConfigs({\n              configs: [\n                {\n                  id: newPanelId,\n                  config: newPanelConfig,\n                  defaultConfig: siblingDefaultConfig,\n                },\n              ],\n            });\n          });\n      },\n      [\n        getCurrentLayoutState,\n        isMounted,\n        mosaicActions,\n        mosaicWindowActions,\n        panelCatalog,\n        savePanelConfigs,\n      ],\n    );\n\n    const replacePanel = useCallback(\n      (newPanelType: string, config: Record<string, unknown>) => {\n        swapPanel({\n          tabId,\n          originalId: childId,\n          type: newPanelType,\n          root: mosaicActions.getRoot() as MosaicNode<string>,\n          path: mosaicWindowActions.getPath(),\n          config,\n        });\n      },\n      [childId, mosaicActions, mosaicWindowActions, swapPanel, tabId],\n    );\n\n    const panelSettingsOpen = useWorkspaceStore(WorkspaceStoreSelectors.selectPanelSettingsOpen);\n\n    const onPanelRootClick: MouseEventHandler<HTMLDivElement> = useCallback(\n      (e) => {\n        if (panelSettingsOpen) {\n          // Allow clicking with no modifiers to select a panel (and deselect others) when panel settings are open\n          e.stopPropagation(); // select the deepest clicked panel, not parent tab panels\n          setSelectedPanelIds([childId]);\n        } else if (e.metaKey || e.shiftKey || isSelected) {\n          e.stopPropagation(); // select the deepest clicked panel, not parent tab panels\n          togglePanelSelected(childId, tabId);\n        }\n      },\n      [childId, tabId, togglePanelSelected, isSelected, setSelectedPanelIds, panelSettingsOpen],\n    );\n\n    const groupPanels = useCallback(() => {\n      const layout = getCurrentLayoutState().selectedLayout?.data?.layout;\n      if (layout == undefined) {\n        return;\n      }\n      createTabPanel({\n        idToReplace: childId,\n        layout,\n        idsToRemove: getSelectedPanelIds(),\n        singleTab: true,\n      });\n    }, [getCurrentLayoutState, getSelectedPanelIds, createTabPanel, childId]);\n\n    const createTabs = useCallback(() => {\n      const layout = getCurrentLayoutState().selectedLayout?.data?.layout;\n      if (layout == undefined) {\n        return;\n      }\n      createTabPanel({\n        idToReplace: childId,\n        layout,\n        idsToRemove: getSelectedPanelIds(),\n        singleTab: false,\n      });\n    }, [getCurrentLayoutState, getSelectedPanelIds, createTabPanel, childId]);\n\n    const removePanel = useCallback(() => {\n      closePanel({\n        path: mosaicWindowActions.getPath(),\n        root: mosaicActions.getRoot() as MosaicNode<string>,\n        tabId,\n      });\n    }, [closePanel, mosaicActions, mosaicWindowActions, tabId]);\n\n    const splitPanel = useCallback(() => {\n      const savedProps = getCurrentLayoutState().selectedLayout?.data?.configById;\n      if (!savedProps) {\n        return;\n      }\n      const tabSavedProps = tabId != undefined ? (savedProps[tabId] as TabPanelConfig) : undefined;\n      if (tabId != undefined && tabSavedProps != undefined) {\n        const newId = getPanelIdForType(PanelComponent.panelType);\n        const activeTabLayout = tabSavedProps.tabs[tabSavedProps.activeTabIdx]?.layout;\n        if (activeTabLayout == undefined) {\n          return;\n        }\n        const pathToPanelInTab = getPathFromNode(childId, activeTabLayout);\n        const newTabLayout = updateTree(activeTabLayout, [\n          {\n            path: pathToPanelInTab,\n            spec: { $set: { first: childId, second: newId, direction: \"row\" } },\n          },\n        ]);\n        const newTabConfig = updateTabPanelLayout(newTabLayout, tabSavedProps);\n        savePanelConfigs({\n          configs: [\n            { id: tabId, config: newTabConfig },\n            { id: newId, config: panelComponentConfig },\n          ],\n        });\n      } else {\n        void mosaicWindowActions.split({ type: PanelComponent.panelType });\n      }\n    }, [\n      childId,\n      getCurrentLayoutState,\n      mosaicWindowActions,\n      panelComponentConfig,\n      savePanelConfigs,\n      tabId,\n    ]);\n\n    const { enterFullscreen, exitFullscreen } = useMemo(\n      () => ({\n        enterFullscreen: () => {\n          setFullscreenSourceRect(panelRootRef.current?.getBoundingClientRect());\n          setFullscreen(true);\n\n          // When entering fullscreen for a panel within a tab, we need to adjust the ancestor\n          // tab(s)'s z-index to have our panel properly overlay other panels outside the tab.\n          parentPanelContext?.setHasFullscreenDescendant(true);\n        },\n        exitFullscreen: () => {\n          // Don't clear fullscreenSourceRect or hasFullscreenDescendant, they are needed during the exit transition\n          setFullscreen(false);\n        },\n      }),\n      [parentPanelContext],\n    );\n\n    const setHasFullscreenDescendant = useCallback(\n      // eslint-disable-next-line @foxglove/no-boolean-parameters\n      (value: boolean) => {\n        _setHasFullscreenDescendant(value);\n        parentPanelContext?.setHasFullscreenDescendant(value);\n      },\n      [parentPanelContext],\n    );\n\n    // We use two separate sets of key handlers because the panel context and exitFullScreen\n    // change often and invalidate our key handlers during user interactions.\n    const { keyUpHandlers, keyDownHandlers } = useMemo(\n      () => ({\n        keyUpHandlers: {\n          \"`\": () => setQuickActionsKeyPressed(false),\n          \"~\": () => setQuickActionsKeyPressed(false),\n        },\n        keyDownHandlers: {\n          a: (e: KeyboardEvent) => {\n            e.preventDefault();\n            if (e.metaKey) {\n              selectAllPanels();\n            }\n          },\n          \"`\": () => setQuickActionsKeyPressed(true),\n          \"~\": () => setQuickActionsKeyPressed(true),\n        },\n      }),\n      [selectAllPanels],\n    );\n\n    const fullScreenKeyHandlers = useMemo(\n      () => ({\n        Escape: () => exitFullscreen(),\n      }),\n      [exitFullscreen],\n    );\n\n    const otherPanelProps = useShallowMemo(otherProps);\n    const childProps = useMemo(\n      // We have to lie to TypeScript with \"as PanelProps\" because the \"PanelProps extends {...}\"\n      // constraint technically allows the panel to require the types of config/saveConfig be more\n      // specific types that aren't satisfied by the functions we pass in\n      () => ({ config: panelComponentConfig, saveConfig, ...otherPanelProps } as PanelProps),\n      [otherPanelProps, panelComponentConfig, saveConfig],\n    );\n    const child = useMemo(() => <PanelComponent {...childProps} />, [childProps]);\n\n    const renderCount = useRef(0);\n\n    const perfInfo = useRef<HTMLDivElement>(ReactNull);\n    const quickActionsOverlayRef = useRef<HTMLDivElement>(ReactNull);\n    const onDragStart = useCallback(() => {\n      // Temporarily hide the overlay so that the panel can be shown as the drag preview image --\n      // even though the overlay is a sibling rather than a child, Chrome still includes it in the\n      // preview if it is visible. Changing the appearance in the next React render cycle is not\n      // enough; it actually needs to happen during the dragstart event.\n      // https://bugs.chromium.org/p/chromium/issues/detail?id=1203107\n      const overlay = quickActionsOverlayRef.current;\n      if (overlay) {\n        overlay.style.opacity = \"0\";\n        setTimeout(() => (overlay.style.opacity = \"1\"), 0);\n      }\n    }, []);\n    const dragSpec = { tabId, panelId: childId, onDragStart };\n    const [connectOverlayDragSource, connectOverlayDragPreview] = usePanelDrag(dragSpec);\n    const [connectToolbarDragHandle, connectToolbarDragPreview] = usePanelDrag(dragSpec);\n\n    return (\n      <Profiler\n        id={childId}\n        onRender={(\n          _id,\n          _phase,\n          actualDuration,\n          _baseDuration,\n          _startTime,\n          _commitTime,\n          _interactions,\n        ) => {\n          if (perfInfo.current) {\n            perfInfo.current.innerText = `${++renderCount.current}\\n${actualDuration.toFixed(1)}ms`;\n          }\n        }}\n      >\n        <PanelContext.Provider\n          value={{\n            type,\n            id: childId,\n            title,\n            config: panelComponentConfig,\n            saveConfig: saveConfig as SaveConfig<PanelConfig>,\n            updatePanelConfigs,\n            openSiblingPanel,\n            replacePanel,\n            enterFullscreen,\n            exitFullscreen,\n            setHasFullscreenDescendant,\n            isFullscreen: fullscreen,\n            tabId,\n            // disallow dragging the root panel in a layout\n            connectToolbarDragHandle: isTopLevelPanel ? undefined : connectToolbarDragHandle,\n          }}\n        >\n          <KeyListener global keyUpHandlers={keyUpHandlers} keyDownHandlers={keyDownHandlers} />\n          {fullscreen && <KeyListener global keyDownHandlers={fullScreenKeyHandlers} />}\n          <Transition\n            in={fullscreen}\n            onExited={() => setHasFullscreenDescendant(false)}\n            nodeRef={panelRootRef}\n            timeout={{\n              // match to transition duration inside PanelRoot\n              exit: theme.transitions.duration.shorter,\n            }}\n          >\n            {(fullscreenState) => (\n              <PanelRoot\n                onClick={onPanelRootClick}\n                hasFullscreenDescendant={hasFullscreenDescendant}\n                fullscreenState={fullscreenState}\n                sourceRect={fullscreenSourceRect}\n                selected={isSelected}\n                data-testid={cx(\"panel-mouseenter-container\", childId)}\n                ref={(el) => {\n                  panelRootRef.current = el;\n                  // disallow dragging the root panel in a layout\n                  if (!isTopLevelPanel) {\n                    connectOverlayDragPreview(el);\n                    connectToolbarDragPreview(el);\n                  }\n                }}\n              >\n                {isSelected && !fullscreen && numSelectedPanelsIfSelected > 1 && (\n                  <div className={classes.actionsOverlay}>\n                    <Stack className={classes.container}>\n                      <Button\n                        fullWidth\n                        size=\"large\"\n                        variant=\"contained\"\n                        startIcon={<TabIcon fontSize=\"large\" />}\n                        onClick={groupPanels}\n                      >\n                        Group in tab\n                      </Button>\n                      <Button\n                        fullWidth\n                        size=\"large\"\n                        variant=\"contained\"\n                        startIcon={<LibraryAddOutlinedIcon fontSize=\"large\" />}\n                        onClick={createTabs}\n                      >\n                        Create {numSelectedPanelsIfSelected} tabs\n                      </Button>\n                    </Stack>\n                  </div>\n                )}\n                {type !== TAB_PANEL_TYPE && quickActionsKeyPressed && !fullscreen && (\n                  <div\n                    className={classes.actionsOverlay}\n                    ref={(el) => {\n                      quickActionsOverlayRef.current = el;\n                      // disallow dragging the root panel in a layout\n                      if (!isTopLevelPanel) {\n                        connectOverlayDragSource(el);\n                      }\n                    }}\n                  >\n                    <Stack className={classes.container} direction=\"row\">\n                      <Button\n                        className={classes.button}\n                        size=\"large\"\n                        variant=\"contained\"\n                        startIcon={<DeleteForeverOutlinedIcon fontSize=\"large\" />}\n                        onClick={(event) => {\n                          event.stopPropagation();\n                          removePanel();\n                        }}\n                      >\n                        Remove\n                      </Button>\n                      <Button\n                        className={classes.button}\n                        size=\"large\"\n                        variant=\"contained\"\n                        startIcon={<BorderAllIcon fontSize=\"large\" />}\n                        onClick={splitPanel}\n                      >\n                        Split\n                      </Button>\n                    </Stack>\n                  </div>\n                )}\n                <PanelErrorBoundary onRemovePanel={removePanel} onResetPanel={resetPanel}>\n                  <React.StrictMode>{child}</React.StrictMode>\n                </PanelErrorBoundary>\n                {process.env.NODE_ENV !== \"production\" && (\n                  <div className={classes.perfInfo} ref={perfInfo} />\n                )}\n              </PanelRoot>\n            )}\n          </Transition>\n        </PanelContext.Provider>\n      </Profiler>\n    );\n  }\n\n  return Object.assign(React.memo(ConnectedPanel), {\n    defaultConfig: PanelComponent.defaultConfig,\n    panelType: PanelComponent.panelType,\n    displayName: `Panel(${PanelComponent.displayName ?? PanelComponent.name})`,\n  });\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport fuzzySort from \"fuzzysort\";\nimport { makeStyles } from \"tss-react/mui\";\n\nconst useStyles = makeStyles()((theme) => ({\n  root: {\n    \".TextHighlight-highlight\": {\n      color: theme.palette.primary.main,\n      fontWeight: \"bold\",\n    },\n  },\n}));\n\ntype Props = {\n  targetStr: string;\n  searchText?: string;\n};\n\nexport default function TextHighlight({ targetStr = \"\", searchText = \"\" }: Props): JSX.Element {\n  const { classes } = useStyles();\n\n  if (searchText.length === 0) {\n    return <>{targetStr}</>;\n  }\n\n  const match = fuzzySort.single(searchText, targetStr);\n  const result = match\n    ? fuzzySort.highlight(match, \"<span class='TextHighlight-highlight'>\", \"</span>\")\n    : undefined;\n\n  return (\n    <span className={classes.root}>\n      {result != undefined && result.length > 0 ? (\n        <span dangerouslySetInnerHTML={{ __html: result }} />\n      ) : (\n        targetStr\n      )}\n    </span>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Card, CardActionArea, CardContent, CardMedia, Typography } from \"@mui/material\";\nimport { useCallback } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport TextHighlight from \"@foxglove/studio-base/components/TextHighlight\";\nimport { PanelInfo } from \"@foxglove/studio-base/context/PanelCatalogContext\";\n\nconst useStyles = makeStyles()((theme) => {\n  return {\n    fullHeight: {\n      height: \"100%\",\n    },\n    imagePlaceholder: {\n      paddingBottom: `${(200 / 280) * 100}%`,\n      backgroundColor: theme.palette.background.default,\n    },\n    cardContent: {\n      flex: \"auto\",\n    },\n  };\n});\n\ntype Props = {\n  panel: PanelInfo;\n  searchQuery: string;\n  onClick: () => void;\n};\n\nexport function PanelGridCard(props: Props): JSX.Element {\n  const { searchQuery, panel, onClick } = props;\n  const { classes } = useStyles();\n\n  const targetString = panel.extensionNamespace\n    ? `${panel.title} [${panel.extensionNamespace}]`\n    : panel.title;\n\n  const onClickWithStopPropagation = useCallback(\n    (event: React.MouseEvent) => {\n      event.stopPropagation();\n      onClick();\n    },\n    [onClick],\n  );\n\n  return (\n    <Card className={classes.fullHeight}>\n      <CardActionArea onClick={onClickWithStopPropagation} className={classes.fullHeight}>\n        <Stack fullHeight>\n          {panel.thumbnail != undefined ? (\n            <CardMedia component=\"img\" image={panel.thumbnail} alt={panel.title} />\n          ) : (\n            <div className={classes.imagePlaceholder} />\n          )}\n          <CardContent className={classes.cardContent}>\n            <Typography variant=\"subtitle2\" gutterBottom>\n              <span data-testid={`panel-menu-item ${panel.title}`}>\n                <TextHighlight targetStr={targetString} searchText={searchQuery} />\n              </span>\n            </Typography>\n            <Typography variant=\"body2\" color=\"text.secondary\">\n              <TextHighlight targetStr={panel.description ?? \"\"} searchText={searchQuery} />\n            </Typography>\n          </CardContent>\n        </Stack>\n      </CardActionArea>\n    </Card>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\n// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// fil\n\nimport { Container } from \"@mui/material\";\nimport { useCallback } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { PanelInfo } from \"@foxglove/studio-base/context/PanelCatalogContext\";\n\nimport { PanelGridCard } from \"./PanelGridCard\";\nimport { PanelSelection } from \"./types\";\n\nconst useStyles = makeStyles()((theme) => ({\n  grid: {\n    display: \"grid !important\",\n    gridTemplateColumns: \"repeat(auto-fill, minmax(240px, 1fr))\",\n    gap: theme.spacing(2),\n  },\n}));\n\ntype Props = {\n  filteredPanels: PanelInfo[];\n  onPanelSelect: (arg0: PanelSelection) => void;\n  searchQuery?: string;\n};\n\nexport function PanelGrid(props: Props): JSX.Element {\n  const { filteredPanels, onPanelSelect, searchQuery = \"\" } = props;\n  const { classes } = useStyles();\n\n  const displayPanelListItem = useCallback(\n    (panelInfo: PanelInfo) => {\n      const { title, type, config, relatedConfigs } = panelInfo;\n      return (\n        <PanelGridCard\n          key={`${type}-${title}`}\n          panel={panelInfo}\n          searchQuery={searchQuery}\n          onClick={() => {\n            onPanelSelect({ type, config, relatedConfigs });\n          }}\n        />\n      );\n    },\n    [onPanelSelect, searchQuery],\n  );\n\n  return (\n    <Container className={classes.grid} maxWidth={false}>\n      {filteredPanels.map(displayPanelListItem)}\n    </Container>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { ReOrderDotsVertical16Filled } from \"@fluentui/react-icons\";\nimport { Fade, ListItem, ListItemButton, ListItemText, Tooltip, Typography } from \"@mui/material\";\nimport { useCallback, useEffect, useRef } from \"react\";\nimport { useDrag } from \"react-dnd\";\nimport { MosaicDragType, MosaicPath } from \"react-mosaic-component\";\nimport { MosaicDropTargetPosition } from \"react-mosaic-component/lib/internalTypes\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport TextHighlight from \"@foxglove/studio-base/components/TextHighlight\";\nimport { PanelInfo } from \"@foxglove/studio-base/context/PanelCatalogContext\";\nimport { MosaicDropResult, PanelConfig, SavedProps } from \"@foxglove/studio-base/types/panels\";\n\nconst useStyles = makeStyles<void, \"dragIcon\">()((theme, _params, classes) => {\n  return {\n    listItemButton: {\n      height: theme.spacing(4), // hard coded here because the parent element of this changes based on context\n      cursor: \"grab\",\n\n      [`&:not(:hover) .${classes.dragIcon}`]: {\n        visibility: \"hidden\",\n      },\n    },\n    dragIcon: {\n      cursor: \"grab\",\n      marginRight: theme.spacing(-1),\n      color: theme.palette.text.disabled,\n    },\n  };\n});\n\nexport type DropDescription = {\n  type: string;\n  config?: PanelConfig;\n  relatedConfigs?: SavedProps;\n  position?: MosaicDropTargetPosition;\n  path?: MosaicPath;\n  tabId?: string;\n};\n\ntype Props = {\n  panel: PanelInfo;\n  searchQuery: string;\n  checked?: boolean;\n  highlighted?: boolean;\n  onClick: () => void;\n  mosaicId: string;\n  onDragStart?: () => void;\n  onDrop: (arg0: DropDescription) => void;\n};\n\nexport function PanelListItem(props: Props): JSX.Element {\n  const {\n    searchQuery,\n    panel,\n    onClick,\n    onDragStart,\n    onDrop,\n    checked = false,\n    highlighted = false,\n    mosaicId,\n  } = props;\n  const { classes } = useStyles();\n  const scrollRef = useRef<HTMLElement>(ReactNull);\n  const [, connectDragSource] = useDrag<unknown, MosaicDropResult, never>({\n    type: MosaicDragType.WINDOW,\n    // mosaicId is needed for react-mosaic to accept the drop\n    item: () => {\n      onDragStart?.();\n      return { mosaicId };\n    },\n    options: { dropEffect: \"copy\" },\n    end: (_item, monitor) => {\n      const dropResult = monitor.getDropResult() ?? {};\n      const { position, path, tabId } = dropResult;\n      // dropping outside mosaic does nothing. If we have a tabId, but no\n      // position or path, we're dragging into an empty tab.\n      if ((position == undefined || path == undefined) && tabId == undefined) {\n        // when dragging a panel into an empty layout treat it link clicking the panel\n        // mosaic doesn't give us a position or path to invoke onDrop\n        onClick();\n        return;\n      }\n      const { type, config, relatedConfigs } = panel;\n      onDrop({ type, config, relatedConfigs, position, path, tabId });\n    },\n  });\n\n  useEffect(() => {\n    if (highlighted && scrollRef.current) {\n      const highlightedItem = scrollRef.current.getBoundingClientRect();\n      const scrollContainer = scrollRef.current.parentElement?.parentElement?.parentElement;\n      if (scrollContainer) {\n        const scrollContainerToTop = scrollContainer.getBoundingClientRect().top;\n\n        const isInView =\n          highlightedItem.top >= 0 &&\n          highlightedItem.top >= scrollContainerToTop &&\n          highlightedItem.top + 50 <= window.innerHeight;\n\n        if (!isInView) {\n          scrollRef.current.scrollIntoView();\n        }\n      }\n    }\n  }, [highlighted]);\n\n  const mergedRef = useCallback(\n    (el: HTMLElement | ReactNull) => {\n      connectDragSource(el);\n      scrollRef.current = el;\n    },\n    [connectDragSource, scrollRef],\n  );\n\n  const targetString = panel.extensionNamespace\n    ? `${panel.title} [${panel.extensionNamespace}]`\n    : panel.title;\n\n  const onClickWithStopPropagation = useCallback(\n    (event: React.MouseEvent) => {\n      event.stopPropagation();\n      onClick();\n    },\n    [onClick],\n  );\n\n  return (\n    <Tooltip\n      placement=\"right\"\n      enterDelay={500}\n      leaveDelay={0}\n      TransitionComponent={Fade}\n      title={\n        <Stack paddingTop={0.25} style={{ width: 200 }}>\n          {panel.thumbnail != undefined && <img src={panel.thumbnail} alt={panel.title} />}\n          <Stack padding={1} gap={0.5}>\n            <Typography variant=\"body2\" fontWeight=\"bold\">\n              {panel.title}\n            </Typography>\n            <Typography variant=\"body2\" style={{ opacity: 0.6 }}>\n              {panel.description}\n            </Typography>\n          </Stack>\n        </Stack>\n      }\n    >\n      <ListItem dense disablePadding>\n        <ListItemButton\n          selected={highlighted}\n          className={classes.listItemButton}\n          disabled={checked}\n          ref={mergedRef}\n          onClick={onClickWithStopPropagation}\n        >\n          <ListItemText>\n            <span data-testid={`panel-menu-item ${panel.title}`}>\n              <TextHighlight targetStr={targetString} searchText={searchQuery} />\n            </span>\n          </ListItemText>\n\n          <ReOrderDotsVertical16Filled className={classes.dragIcon} />\n        </ListItemButton>\n      </ListItem>\n    </Tooltip>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { List } from \"@mui/material\";\nimport { useCallback, useMemo } from \"react\";\n\nimport {\n  useCurrentLayoutActions,\n  usePanelMosaicId,\n} from \"@foxglove/studio-base/context/CurrentLayoutContext\";\nimport { PanelInfo } from \"@foxglove/studio-base/context/PanelCatalogContext\";\n\nimport { PanelListItem, DropDescription } from \"./PanelListItem\";\nimport { PanelSelection } from \"./types\";\n\ntype Props = {\n  filteredPanels: PanelInfo[];\n  onPanelSelect: (arg0: PanelSelection) => void;\n  onDragStart?: () => void;\n  selectedPanelType?: string;\n  highlightedPanelIdx?: number;\n  searchQuery?: string;\n};\n\nfunction blurActiveElement() {\n  // Clear focus from the panel menu button so that spacebar doesn't trigger\n  // more panel additions.\n  if (document.activeElement instanceof HTMLElement) {\n    document.activeElement.blur();\n  }\n}\n\nexport function PanelList(props: Props): JSX.Element {\n  const {\n    filteredPanels,\n    highlightedPanelIdx,\n    onDragStart,\n    onPanelSelect,\n    selectedPanelType,\n    searchQuery = \"\",\n  } = props;\n\n  const { dropPanel } = useCurrentLayoutActions();\n  const mosaicId = usePanelMosaicId();\n\n  // Update panel layout when a panel menu item is dropped;\n  // actual operations to change layout supplied by react-mosaic-component\n  const onPanelMenuItemDrop = useCallback(\n    ({ config, relatedConfigs, type, position, path, tabId }: DropDescription) => {\n      dropPanel({\n        newPanelType: type,\n        destinationPath: path,\n        position,\n        tabId,\n        config,\n        relatedConfigs,\n      });\n      blurActiveElement();\n    },\n    [dropPanel],\n  );\n\n  const highlightedPanel = useMemo(() => {\n    return highlightedPanelIdx != undefined ? filteredPanels[highlightedPanelIdx] : undefined;\n  }, [filteredPanels, highlightedPanelIdx]);\n\n  const displayPanelListItem = useCallback(\n    (panelInfo: PanelInfo) => {\n      const { title, type, config, relatedConfigs } = panelInfo;\n      return (\n        <PanelListItem\n          key={`${type}-${title}`}\n          mosaicId={mosaicId}\n          panel={panelInfo}\n          onDragStart={onDragStart}\n          onDrop={onPanelMenuItemDrop}\n          onClick={() => {\n            onPanelSelect({ type, config, relatedConfigs });\n            blurActiveElement();\n          }}\n          checked={type === selectedPanelType}\n          highlighted={highlightedPanel?.title === title}\n          searchQuery={searchQuery}\n        />\n      );\n    },\n    [\n      highlightedPanel?.title,\n      mosaicId,\n      onDragStart,\n      onPanelMenuItemDrop,\n      onPanelSelect,\n      searchQuery,\n      selectedPanelType,\n    ],\n  );\n\n  return (\n    <List dense disablePadding>\n      {filteredPanels.map(displayPanelListItem)}\n    </List>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport CloseIcon from \"@mui/icons-material/Close\";\nimport SearchIcon from \"@mui/icons-material/Search\";\nimport { IconButton, TextField } from \"@mui/material\";\nimport fuzzySort from \"fuzzysort\";\nimport { countBy, isEmpty } from \"lodash\";\nimport { forwardRef, useCallback, useEffect, useMemo, useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport EmptyState from \"@foxglove/studio-base/components/EmptyState\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { PanelInfo, usePanelCatalog } from \"@foxglove/studio-base/context/PanelCatalogContext\";\nimport { mightActuallyBePartial } from \"@foxglove/studio-base/util/mightActuallyBePartial\";\n\nimport { PanelGrid } from \"./PanelGrid\";\nimport { PanelList } from \"./PanelList\";\nimport { PanelSelection } from \"./types\";\n\nconst useStyles = makeStyles()((theme) => {\n  const { spacing, palette } = theme;\n  return {\n    toolbar: {\n      position: \"sticky\",\n      top: -0.5, // yep that's a half pixel to avoid a gap between the appbar and panel top\n      zIndex: 100,\n      display: \"flex\",\n      justifyContent: \"stretch\",\n      padding: theme.spacing(1.5),\n      backgroundImage: `linear-gradient(to top, transparent, ${palette.background.paper} ${spacing(\n        1.5,\n      )}) !important`,\n    },\n    toolbarMenu: {\n      backgroundImage: `linear-gradient(to top, transparent, ${palette.background.menu} ${spacing(\n        1.5,\n      )}) !important`,\n    },\n    toolbarGrid: {\n      padding: theme.spacing(2),\n    },\n  };\n});\n\n// sanity checks to help panel authors debug issues\nfunction verifyPanels(panels: readonly PanelInfo[]): void {\n  const panelTypes: Map<string, PanelInfo> = new Map();\n  for (const panel of panels) {\n    const { title, type, config } = mightActuallyBePartial(panel);\n    const dispName = title ?? type ?? \"<unnamed>\";\n    if (type == undefined || type.length === 0) {\n      throw new Error(`Panel component ${title} must declare a unique \\`static panelType\\``);\n    }\n    const existingPanel = mightActuallyBePartial(panelTypes.get(type));\n    if (existingPanel) {\n      const bothHaveEmptyConfigs = isEmpty(existingPanel.config) && isEmpty(config);\n      if (bothHaveEmptyConfigs) {\n        const otherDisplayName = existingPanel.title ?? existingPanel.type ?? \"<unnamed>\";\n        throw new Error(\n          `Two components have the same panelType ('${type}') and no preset configs: ${otherDisplayName} and ${dispName}`,\n        );\n      }\n    }\n    panelTypes.set(type, panel);\n  }\n}\n\ntype Props = {\n  onPanelSelect: (arg0: PanelSelection) => void;\n  onDragStart?: () => void;\n  selectedPanelType?: string;\n  mode?: \"grid\" | \"list\";\n  isMenu?: boolean;\n};\n\nexport const PanelCatalog = forwardRef<HTMLDivElement, Props>(function PanelCatalog(\n  props: Props,\n  ref,\n) {\n  const { isMenu = false, onDragStart, onPanelSelect, selectedPanelType, mode = \"list\" } = props;\n  const { classes, cx } = useStyles();\n  const { t } = useTranslation(\"addPanel\");\n\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [highlightedPanelIdx, setHighlightedPanelIdx] = useState<number | undefined>();\n\n  const handleSearchChange = useCallback((event: React.ChangeEvent<HTMLInputElement>) => {\n    const query = event.target.value;\n    setSearchQuery(query);\n\n    // When there is a search query, automatically highlight the first (0th) item.\n    // When the user erases the query, remove the highlight.\n    setHighlightedPanelIdx(query ? 0 : undefined);\n  }, []);\n\n  const panelCatalog = usePanelCatalog();\n\n  const namespacedPanels = useMemo(() => {\n    // Remove namespace if panel title is unique.\n    const panels = panelCatalog.getPanels();\n    const countByTitle = countBy(panels, (panel) => panel.title);\n    return panels.map((panel) => {\n      if ((countByTitle[panel.title] ?? 0) > 1) {\n        return panel;\n      } else {\n        return { ...panel, namespace: undefined };\n      }\n    });\n  }, [panelCatalog]);\n\n  const { allRegularPanels, allPreconfiguredPanels } = useMemo(() => {\n    const panels = namespacedPanels;\n    const regular = panels.filter((panel) => !panel.config);\n    const preconfigured = panels.filter((panel) => panel.config);\n    const sortByTitle = (a: PanelInfo, b: PanelInfo) =>\n      a.title.localeCompare(b.title, undefined, { ignorePunctuation: true, sensitivity: \"base\" });\n\n    return {\n      allRegularPanels: [...regular].sort(sortByTitle),\n      allPreconfiguredPanels: [...preconfigured].sort(sortByTitle),\n    };\n  }, [namespacedPanels]);\n\n  useEffect(() => {\n    verifyPanels([...allRegularPanels, ...allPreconfiguredPanels]);\n  }, [allRegularPanels, allPreconfiguredPanels]);\n\n  const getFilteredPanels = useCallback(\n    (panels: PanelInfo[]) => {\n      return searchQuery.length > 0\n        ? fuzzySort\n            .go(searchQuery, panels, {\n              keys: [\"title\", \"description\"],\n              // Weigh title matches more heavily than description matches.\n              scoreFn: (a) => Math.max(a[0] ? a[0].score : -1000, a[1] ? a[1].score - 100 : -1000),\n              threshold: -900,\n            })\n            .map((searchResult) => searchResult.obj)\n        : panels;\n    },\n    [searchQuery],\n  );\n\n  const { filteredRegularPanels, filteredPreconfiguredPanels } = useMemo(\n    () => ({\n      filteredRegularPanels: getFilteredPanels(allRegularPanels),\n      filteredPreconfiguredPanels: getFilteredPanels(allPreconfiguredPanels),\n    }),\n    [getFilteredPanels, allRegularPanels, allPreconfiguredPanels],\n  );\n\n  const allFilteredPanels = useMemo(\n    () => [...filteredPreconfiguredPanels, ...filteredRegularPanels],\n    [filteredPreconfiguredPanels, filteredRegularPanels],\n  );\n\n  const highlightedPanel = useMemo(() => {\n    return highlightedPanelIdx != undefined ? allFilteredPanels[highlightedPanelIdx] : undefined;\n  }, [allFilteredPanels, highlightedPanelIdx]);\n\n  const noResults = allFilteredPanels.length === 0;\n\n  const onKeyDown = useCallback(\n    (e: React.KeyboardEvent) => {\n      // Prevent key down events from triggering the parent menu, if any.\n      if (e.key !== \"Escape\") {\n        e.stopPropagation();\n      }\n\n      if (mode === \"grid\") {\n        return;\n      }\n\n      if (e.key === \"ArrowDown\") {\n        setHighlightedPanelIdx((existing) => {\n          if (existing == undefined) {\n            return 0;\n          }\n          return (existing + 1) % allFilteredPanels.length;\n        });\n      } else if (e.key === \"ArrowUp\") {\n        setHighlightedPanelIdx((existing) => {\n          // nothing to highlight if there are no entries\n          if (allFilteredPanels.length <= 0) {\n            return undefined;\n          }\n\n          if (existing == undefined) {\n            return allFilteredPanels.length - 1;\n          }\n          return (existing - 1 + allFilteredPanels.length) % allFilteredPanels.length;\n        });\n      } else if (e.key === \"Enter\" && highlightedPanel) {\n        onPanelSelect({\n          type: highlightedPanel.type,\n          config: highlightedPanel.config,\n          relatedConfigs: highlightedPanel.relatedConfigs,\n        });\n      }\n    },\n    [allFilteredPanels.length, highlightedPanel, mode, onPanelSelect],\n  );\n\n  return (\n    <Stack fullHeight ref={ref}>\n      <div\n        className={cx(classes.toolbar, {\n          [classes.toolbarMenu]: isMenu,\n          [classes.toolbarGrid]: mode === \"grid\",\n        })}\n      >\n        <TextField\n          fullWidth\n          placeholder={t(\"searchPanels\")}\n          value={searchQuery}\n          onChange={handleSearchChange}\n          onKeyDown={onKeyDown}\n          autoFocus\n          data-testid=\"panel-list-textfield\"\n          InputProps={{\n            startAdornment: <SearchIcon fontSize=\"small\" color=\"primary\" />,\n            endAdornment: searchQuery && (\n              <IconButton size=\"small\" edge=\"end\" onClick={() => setSearchQuery(\"\")}>\n                <CloseIcon fontSize=\"small\" />\n              </IconButton>\n            ),\n          }}\n        />\n      </div>\n      {mode === \"grid\" ? (\n        <PanelGrid\n          searchQuery={searchQuery}\n          filteredPanels={allFilteredPanels}\n          onPanelSelect={onPanelSelect}\n        />\n      ) : (\n        <PanelList\n          searchQuery={searchQuery}\n          filteredPanels={allFilteredPanels}\n          selectedPanelType={selectedPanelType}\n          highlightedPanelIdx={highlightedPanelIdx}\n          onDragStart={onDragStart}\n          onPanelSelect={onPanelSelect}\n        />\n      )}\n      {noResults && (\n        <Stack padding={2}>\n          <EmptyState>{t(\"noPanelsMatchSearchCriteria\")}</EmptyState>\n        </Stack>\n      )}\n    </Stack>\n  );\n});\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { SaveConfig, PanelConfig, OpenSiblingPanel } from \"@foxglove/studio-base/types/panels\";\n\nexport type PanelContextType<T> = {\n  type: string;\n  id: string;\n  title: string;\n  tabId?: string;\n\n  config: PanelConfig;\n  saveConfig: SaveConfig<T>;\n\n  updatePanelConfigs: (panelType: string, updateConfig: (config: T) => T) => void;\n  openSiblingPanel: OpenSiblingPanel;\n  replacePanel: (panelType: string, config: Record<string, unknown>) => void;\n\n  enterFullscreen: () => void;\n  exitFullscreen: () => void;\n  isFullscreen: boolean;\n\n  /** Used to adjust z-index settings on parent panels when children are fullscreen */\n  // eslint-disable-next-line @foxglove/no-boolean-parameters\n  setHasFullscreenDescendant: (hasFullscreenDescendant: boolean) => void;\n\n  connectToolbarDragHandle?: (el: Element | ReactNull) => void;\n};\n\n// Context used for components to know which panel they are inside\nconst PanelContext = React.createContext<PanelContextType<PanelConfig> | undefined>(undefined);\nPanelContext.displayName = \"PanelContext\";\n\nexport function usePanelContext(): PanelContextType<PanelConfig> {\n  const context = React.useContext(PanelContext);\n  if (!context) {\n    throw new Error(\"Tried to use PanelContext outside a <PanelContext.Provider />\");\n  }\n  return context;\n}\n\nexport default PanelContext;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Card, CardContent, Paper, Typography } from \"@mui/material\";\nimport { useTranslation } from \"react-i18next\";\nimport { makeStyles } from \"tss-react/mui\";\n\nconst useStyles = makeStyles()({\n  root: {\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    height: \"100%\",\n  },\n});\n\n/**\n * Message indiciating the panel is too old to be used with the current version of a configuration.\n */\nexport function PanelConfigVersionError(): JSX.Element {\n  const { t } = useTranslation(\"panelConfigVersionGuard\");\n\n  const { classes } = useStyles();\n\n  return (\n    <Paper className={classes.root}>\n      <Card>\n        <CardContent>\n          <Typography variant=\"subtitle1\">{t(\"warning\")}</Typography>\n          <Typography variant=\"subtitle1\">{t(\"instructions\")}</Typography>\n        </CardContent>\n      </Card>\n    </Paper>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { difference } from \"lodash\";\n\nimport {\n  Immutable,\n  MessageEvent,\n  RegisterMessageConverterArgs,\n  Subscription,\n} from \"@foxglove/studio\";\nimport { Topic as PlayerTopic } from \"@foxglove/studio-base/players/types\";\n\n// Branded string to ensure that users go through the `converterKey` function to compute a lookup key\ntype Brand<K, T> = K & { __brand: T };\ntype ConverterKey = Brand<string, \"ConverterKey\">;\n\ntype MessageConverter = RegisterMessageConverterArgs<unknown>;\n\ntype TopicSchemaConverterMap = Map<ConverterKey, MessageConverter[]>;\n\n// Create a string lookup key from a message event\n//\n// The string key uses a newline delimeter to avoid producting the same key for topic/schema name\n// values that might concatenate to the same string. i.e. \"topic\" \"schema\" and \"topics\" \"chema\".\nfunction converterKey(topic: string, schema: string): ConverterKey {\n  return (topic + \"\\n\" + schema) as ConverterKey;\n}\n\n/**\n * Convert message into convertedMessages using the keyed converters. Modifies\n * convertedMessages in place for efficiency.\n */\nexport function convertMessage(\n  messageEvent: Immutable<MessageEvent<unknown>>,\n  converters: Immutable<TopicSchemaConverterMap>,\n  convertedMessages: MessageEvent<unknown>[],\n): void {\n  const key = converterKey(messageEvent.topic, messageEvent.schemaName);\n  const matchedConverters = converters.get(key);\n  for (const converter of matchedConverters ?? []) {\n    const convertedMessage = converter.converter(messageEvent.message, messageEvent);\n    convertedMessages.push({\n      topic: messageEvent.topic,\n      schemaName: converter.toSchemaName,\n      receiveTime: messageEvent.receiveTime,\n      message: convertedMessage,\n      originalMessageEvent: messageEvent,\n      sizeInBytes: messageEvent.sizeInBytes,\n    });\n  }\n}\n\n/**\n * Returns a new map consisting of all items in `a` not present in `b`.\n */\nexport function mapDifference<K, V>(a: Map<K, V[]>, b: undefined | Map<K, V[]>): Map<K, V[]> {\n  const result = new Map<K, V[]>();\n  for (const [key, value] of a.entries()) {\n    const newValues = difference(value, b?.get(key) ?? []);\n    if (newValues.length > 0) {\n      result.set(key, newValues);\n    }\n  }\n  return result;\n}\n\nexport type TopicSchemaConversions = {\n  // Topics which we are subscribed without a conversion, these are topics we\n  // want to receive the original message.\n  unconvertedSubscriptionTopics: Set<string>;\n\n  // When a subscription with a convertTo exists, we use this map to lookup a\n  // converter which can produce the desired output message schema. The keys for\n  // the map are `topic + input schema`.\n  //\n  // This allows the runtime message event handler logic which builds\n  // currentFrame and allFrames to lookup whether the incoming message event has\n  // converters to run by looking up the topic + schema of the message event in\n  // this map.\n  topicSchemaConverters: TopicSchemaConverterMap;\n};\n\n/**\n * Builds a set of topics we can render without conversion and a map of\n * converterKey -> converter arguments we use to produce converted messages.\n *\n * This will be memoized for performance so the inputs should be stable.\n */\nexport function collateTopicSchemaConversions(\n  subscriptions: readonly Subscription[],\n  sortedTopics: readonly PlayerTopic[],\n  messageConverters: undefined | readonly MessageConverter[],\n): TopicSchemaConversions {\n  const topicSchemaConverters: TopicSchemaConverterMap = new Map();\n  const unconvertedSubscriptionTopics: Set<string> = new Set();\n\n  // Bin the subscriptions into two sets: those which want a conversion and those that do not.\n  //\n  // For the subscriptions that want a conversion, if the topic schemaName matches the requested\n  // convertTo, then we don't need to do a conversion.\n  for (const subscription of subscriptions) {\n    if (!subscription.convertTo) {\n      unconvertedSubscriptionTopics.add(subscription.topic);\n      continue;\n    }\n\n    // If the convertTo is the same as the original schema for the topic then we don't need to\n    // perform a conversion.\n    const noConversion = sortedTopics.find(\n      (topic) => topic.name === subscription.topic && topic.schemaName === subscription.convertTo,\n    );\n    if (noConversion) {\n      unconvertedSubscriptionTopics.add(noConversion.name);\n      continue;\n    }\n\n    // Since we don't have an existing topic with out destination schema we need to find\n    // a converter that will convert from the topic to the desired schema\n    const subscriberTopic = sortedTopics.find((topic) => topic.name === subscription.topic);\n    if (!subscriberTopic) {\n      continue;\n    }\n\n    const key = converterKey(subscription.topic, subscriberTopic.schemaName ?? \"<no-schema>\");\n    let existingConverters = topicSchemaConverters.get(key);\n\n    // We've already stored a converter for this topic to convertTo\n    const haveConverter = existingConverters?.find(\n      (conv) => conv.toSchemaName === subscription.convertTo,\n    );\n    if (haveConverter) {\n      continue;\n    }\n\n    // Find a converter that can go from the original topic schema to the target schema\n    // Note: We only support one converter per unique from/to pair so this _find_ only needs to\n    //       find one converter rather than multiple converters.\n    const converter = messageConverters?.find(\n      (conv) =>\n        conv.fromSchemaName === subscriberTopic.schemaName &&\n        conv.toSchemaName === subscription.convertTo,\n    );\n\n    if (converter) {\n      existingConverters ??= [];\n      existingConverters.push(converter);\n      topicSchemaConverters.set(key, existingConverters);\n    }\n  }\n\n  return { unconvertedSubscriptionTopics, topicSchemaConverters };\n}\n\n/**\n * Function to iterate and call function over multiple sorted arrays in sorted order across all items in all arrays.\n * Time complexity is O(t*n) where t is the number of arrays and n is the total number of items in all arrays.\n * Space complexity is O(t) where t is the number of arrays.\n * @param arrays - sorted arrays to iterate over\n * @param compareFn - function called to compare items in arrays. Returns a positive value if left is larger than right,\n *  a negative value if right is larger than left, or zero if both are equal\n * @param forEach - callback to be executed on all items in the arrays to iterate over in sorted order across all arrays\n */\nexport function forEachSortedArrays<Item>(\n  arrays: Immutable<Item[][]>,\n  compareFn: (a: Immutable<Item>, b: Immutable<Item>) => number,\n  forEach: (item: Immutable<Item>) => void,\n): void {\n  const cursors: number[] = Array(arrays.length).fill(0);\n  if (arrays.length === 0) {\n    return;\n  }\n  for (;;) {\n    let minCursorIndex = undefined;\n    for (let i = 0; i < cursors.length; i++) {\n      const cursor = cursors[i]!;\n      const array = arrays[i]!;\n      if (cursor >= array.length) {\n        continue;\n      }\n      const item = array[cursor]!;\n      if (minCursorIndex == undefined) {\n        minCursorIndex = i;\n      } else {\n        const minItem = arrays[minCursorIndex]![cursors[minCursorIndex]!]!;\n        if (compareFn(item, minItem) < 0) {\n          minCursorIndex = i;\n        }\n      }\n    }\n    if (minCursorIndex == undefined) {\n      break;\n    }\n    const minItem = arrays[minCursorIndex]![cursors[minCursorIndex]!];\n    if (minItem != undefined) {\n      forEach(minItem);\n      cursors[minCursorIndex]++;\n    } else {\n      break;\n    }\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport memoizeWeak from \"memoize-weak\";\nimport { Writable } from \"ts-essentials\";\n\nimport { filterMap } from \"@foxglove/den/collection\";\nimport { compare, toSec } from \"@foxglove/rostime\";\nimport {\n  AppSettingValue,\n  Immutable,\n  MessageEvent,\n  ParameterValue,\n  RegisterMessageConverterArgs,\n  RenderState,\n  Subscription,\n  Topic,\n} from \"@foxglove/studio\";\nimport {\n  EMPTY_GLOBAL_VARIABLES,\n  GlobalVariables,\n} from \"@foxglove/studio-base/hooks/useGlobalVariables\";\nimport {\n  MessageBlock,\n  PlayerState,\n  Topic as PlayerTopic,\n} from \"@foxglove/studio-base/players/types\";\nimport { HoverValue } from \"@foxglove/studio-base/types/hoverValue\";\n\nimport {\n  collateTopicSchemaConversions,\n  convertMessage,\n  forEachSortedArrays,\n  mapDifference,\n  TopicSchemaConversions,\n} from \"./messageProcessing\";\n\nconst EmptyParameters = new Map<string, ParameterValue>();\n\nexport type BuilderRenderStateInput = Immutable<{\n  appSettings: Map<string, AppSettingValue> | undefined;\n  colorScheme: RenderState[\"colorScheme\"] | undefined;\n  currentFrame: MessageEvent[] | undefined;\n  globalVariables: GlobalVariables;\n  hoverValue: HoverValue | undefined;\n  messageConverters?: readonly RegisterMessageConverterArgs<unknown>[];\n  playerState: PlayerState | undefined;\n  sharedPanelState: Record<string, unknown> | undefined;\n  sortedTopics: readonly PlayerTopic[];\n  subscriptions: Subscription[];\n  watchedFields: Set<string>;\n}>;\n\ntype BuildRenderStateFn = (input: BuilderRenderStateInput) => Immutable<RenderState> | undefined;\n\n/**\n * initRenderStateBuilder creates a function that transforms render state input into a new\n * RenderState\n *\n * This function tracks previous input to determine what parts of the existing render state to\n * update or whether there are any updates\n *\n * @returns a function that accepts render state input and returns a new RenderState to render or\n * undefined if there's no update for rendering\n */\nfunction initRenderStateBuilder(): BuildRenderStateFn {\n  let prevVariables: Immutable<GlobalVariables> = EMPTY_GLOBAL_VARIABLES;\n  let prevBlocks: undefined | Immutable<(undefined | MessageBlock)[]>;\n  let prevSeekTime: number | undefined;\n  let prevSortedTopics: BuilderRenderStateInput[\"sortedTopics\"] | undefined;\n  let prevMessageConverters: BuilderRenderStateInput[\"messageConverters\"] | undefined;\n  let prevSharedPanelState: BuilderRenderStateInput[\"sharedPanelState\"];\n  let prevCurrentFrame: Immutable<RenderState[\"currentFrame\"]>;\n  let prevCollatedConversions: undefined | TopicSchemaConversions;\n  const lastMessageByTopic: Map<string, MessageEvent> = new Map();\n\n  // Pull these memoized versions into the closure so they are scoped to the lifetime of\n  // the panel.\n  const memoMapDifference = memoizeWeak(mapDifference);\n  const memoCollateTopicSchemaConversions = memoizeWeak(collateTopicSchemaConversions);\n\n  const prevRenderState: Writable<Immutable<RenderState>> = {};\n\n  return function buildRenderState(input: BuilderRenderStateInput) {\n    const {\n      appSettings,\n      colorScheme,\n      currentFrame,\n      globalVariables,\n      hoverValue,\n      messageConverters,\n      playerState,\n      sharedPanelState,\n      sortedTopics,\n      subscriptions,\n      watchedFields,\n    } = input;\n\n    // Should render indicates whether any fields of render state are updated\n    let shouldRender = false;\n\n    // Hoisted active data to shorten some of the code below that repeatedly uses active data\n    const activeData = playerState?.activeData;\n\n    // The render state starts with the previous render state and changes are applied as detected\n    const renderState = prevRenderState;\n\n    const collatedConversions = memoCollateTopicSchemaConversions(\n      subscriptions,\n      sortedTopics,\n      messageConverters,\n    );\n    const { unconvertedSubscriptionTopics, topicSchemaConverters } = collatedConversions;\n    const conversionsChanged = prevCollatedConversions !== collatedConversions;\n    const newConverters = memoMapDifference(\n      topicSchemaConverters,\n      prevCollatedConversions?.topicSchemaConverters,\n    );\n\n    if (prevSeekTime !== activeData?.lastSeekTime) {\n      lastMessageByTopic.clear();\n    }\n\n    if (watchedFields.has(\"didSeek\")) {\n      const didSeek = prevSeekTime !== activeData?.lastSeekTime;\n      if (didSeek !== renderState.didSeek) {\n        renderState.didSeek = didSeek;\n        shouldRender = true;\n      }\n      prevSeekTime = activeData?.lastSeekTime;\n    }\n\n    if (watchedFields.has(\"parameters\")) {\n      const parameters = activeData?.parameters ?? EmptyParameters;\n      if (parameters !== renderState.parameters) {\n        shouldRender = true;\n        renderState.parameters = parameters;\n      }\n    }\n\n    if (watchedFields.has(\"sharedPanelState\")) {\n      if (sharedPanelState !== prevSharedPanelState) {\n        shouldRender = true;\n        prevSharedPanelState = sharedPanelState;\n        renderState.sharedPanelState = sharedPanelState;\n      }\n    }\n\n    if (watchedFields.has(\"variables\")) {\n      if (globalVariables !== prevVariables) {\n        shouldRender = true;\n        prevVariables = globalVariables;\n        renderState.variables = new Map(Object.entries(globalVariables));\n      }\n    }\n\n    if (watchedFields.has(\"topics\")) {\n      if (sortedTopics !== prevSortedTopics || prevMessageConverters !== messageConverters) {\n        shouldRender = true;\n\n        const topics = sortedTopics.map<Topic>((topic) => {\n          const newTopic: Topic = {\n            name: topic.name,\n            datatype: topic.schemaName ?? \"\",\n            schemaName: topic.schemaName ?? \"\",\n          };\n\n          if (messageConverters) {\n            const convertibleTo: string[] = [];\n\n            // find any converters that can convert _from_ the schema name of the topic\n            // the _to_ names of the converter become additional schema names for the topic entry\n            for (const converter of messageConverters) {\n              if (converter.fromSchemaName === topic.schemaName) {\n                if (!convertibleTo.includes(converter.toSchemaName)) {\n                  convertibleTo.push(converter.toSchemaName);\n                }\n              }\n            }\n\n            if (convertibleTo.length > 0) {\n              newTopic.convertibleTo = convertibleTo;\n            }\n          }\n\n          return newTopic;\n        });\n\n        renderState.topics = topics;\n        prevSortedTopics = sortedTopics;\n      }\n    }\n\n    if (watchedFields.has(\"currentFrame\")) {\n      if (currentFrame && currentFrame !== prevCurrentFrame) {\n        // If we have a new frame, emit that frame and process all messages on that frame.\n        // Unconverted messages are only processed on a new frame.\n        const postProcessedFrame: MessageEvent<unknown>[] = [];\n        for (const messageEvent of currentFrame) {\n          if (unconvertedSubscriptionTopics.has(messageEvent.topic)) {\n            postProcessedFrame.push(messageEvent);\n          }\n          convertMessage(messageEvent, topicSchemaConverters, postProcessedFrame);\n          lastMessageByTopic.set(messageEvent.topic, messageEvent);\n        }\n        renderState.currentFrame = postProcessedFrame;\n        shouldRender = true;\n      } else if (conversionsChanged) {\n        // If we don't have a new frame but our conversions have changed, run\n        // only the new conversions on our most recent message on each topic.\n        const postProcessedFrame: MessageEvent<unknown>[] = [];\n        for (const messageEvent of lastMessageByTopic.values()) {\n          convertMessage(messageEvent, newConverters, postProcessedFrame);\n        }\n        renderState.currentFrame = postProcessedFrame;\n        shouldRender = true;\n      } else if (currentFrame !== prevCurrentFrame) {\n        // Otherwise if we're replacing a non-empty frame with an empty frame and\n        // conversions haven't changed, include the empty frame in the new render state.\n        renderState.currentFrame = currentFrame;\n        shouldRender = true;\n      }\n\n      prevCurrentFrame = currentFrame;\n    }\n\n    if (watchedFields.has(\"allFrames\")) {\n      // Rebuild allFrames if we have new blocks or if our conversions have changed.\n      const newBlocks = playerState?.progress.messageCache?.blocks;\n      if ((newBlocks && prevBlocks !== newBlocks) || conversionsChanged) {\n        shouldRender = true;\n        const blocksToProcess = newBlocks ?? prevBlocks ?? [];\n        const frames: MessageEvent<unknown>[] = (renderState.allFrames = []);\n        // only populate allFrames with topics that the panel wants to preload\n        const topicsToPreloadForPanel = Array.from(\n          new Set<string>(\n            filterMap(subscriptions, (sub) => (sub.preload === true ? sub.topic : undefined)),\n          ),\n        );\n\n        for (const block of blocksToProcess) {\n          if (!block) {\n            continue;\n          }\n\n          // Given that messagesByTopic should be in order by receiveTime, we need to\n          // combine all of the messages into a single array and sorted by receive time.\n          forEachSortedArrays(\n            topicsToPreloadForPanel.map((topic) => block.messagesByTopic[topic] ?? []),\n            (a, b) => compare(a.receiveTime, b.receiveTime),\n            (messageEvent) => {\n              // Message blocks may contain topics that we are not subscribed to so we\n              // need to filter those out. We use unconvertedSubscriptionTopics to\n              // determine if we should include the message event. Clients expect\n              // allFrames to be a complete set of messages for all subscribed topics so\n              // we include all unconverted and converted messages, unlike in\n              // currentFrame.\n              if (unconvertedSubscriptionTopics.has(messageEvent.topic)) {\n                frames.push(messageEvent);\n              }\n              convertMessage(messageEvent, topicSchemaConverters, frames);\n            },\n          );\n        }\n      }\n      prevBlocks = newBlocks;\n    }\n\n    if (watchedFields.has(\"currentTime\")) {\n      if (renderState.currentTime !== activeData?.currentTime) {\n        renderState.currentTime = activeData?.currentTime;\n        shouldRender = true;\n      }\n    }\n\n    if (watchedFields.has(\"startTime\")) {\n      if (renderState.startTime !== activeData?.startTime) {\n        renderState.startTime = activeData?.startTime;\n        shouldRender = true;\n      }\n    }\n\n    if (watchedFields.has(\"endTime\")) {\n      if (renderState.endTime !== activeData?.endTime) {\n        renderState.endTime = activeData?.endTime;\n        shouldRender = true;\n      }\n    }\n\n    if (watchedFields.has(\"previewTime\")) {\n      const startTime = activeData?.startTime;\n\n      if (startTime != undefined && hoverValue != undefined) {\n        const stamp = toSec(startTime) + hoverValue.value;\n        if (stamp !== renderState.previewTime) {\n          shouldRender = true;\n        }\n        renderState.previewTime = stamp;\n      } else {\n        if (renderState.previewTime != undefined) {\n          shouldRender = true;\n        }\n        renderState.previewTime = undefined;\n      }\n    }\n\n    if (watchedFields.has(\"colorScheme\")) {\n      if (colorScheme !== renderState.colorScheme) {\n        shouldRender = true;\n        renderState.colorScheme = colorScheme;\n      }\n    }\n\n    if (watchedFields.has(\"appSettings\")) {\n      if (renderState.appSettings !== appSettings) {\n        shouldRender = true;\n        renderState.appSettings = appSettings;\n      }\n    }\n\n    // Update the prev fields with the latest values at the end of all the watch steps\n    // Several of the watch steps depend on the comparison against prev and new values\n    prevMessageConverters = messageConverters;\n    prevCollatedConversions = collatedConversions;\n\n    if (!shouldRender) {\n      return undefined;\n    }\n\n    return renderState;\n  };\n}\n\nexport { initRenderStateBuilder };\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useTheme } from \"@mui/material\";\nimport { CSSProperties, useEffect, useLayoutEffect, useMemo, useRef, useState } from \"react\";\nimport { useLatest } from \"react-use\";\nimport { v4 as uuid } from \"uuid\";\n\nimport { useValueChangedDebugLog, useSynchronousMountedState } from \"@foxglove/hooks\";\nimport Logger from \"@foxglove/log\";\nimport { fromSec, toSec } from \"@foxglove/rostime\";\nimport {\n  AppSettingValue,\n  ExtensionPanelRegistration,\n  PanelExtensionContext,\n  ParameterValue,\n  RenderState,\n  SettingsTree,\n  Subscription,\n  Time,\n  VariableValue,\n} from \"@foxglove/studio\";\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n  useMessagePipelineGetter,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport { usePanelContext } from \"@foxglove/studio-base/components/PanelContext\";\nimport PanelToolbar from \"@foxglove/studio-base/components/PanelToolbar\";\nimport { useAppConfiguration } from \"@foxglove/studio-base/context/AppConfigurationContext\";\nimport {\n  ExtensionCatalog,\n  useExtensionCatalog,\n} from \"@foxglove/studio-base/context/ExtensionCatalogContext\";\nimport {\n  useClearHoverValue,\n  useHoverValue,\n  useSetHoverValue,\n} from \"@foxglove/studio-base/context/TimelineInteractionStateContext\";\nimport useGlobalVariables from \"@foxglove/studio-base/hooks/useGlobalVariables\";\nimport {\n  AdvertiseOptions,\n  PlayerCapabilities,\n  SubscribePayload,\n} from \"@foxglove/studio-base/players/types\";\nimport {\n  usePanelSettingsTreeUpdate,\n  useSharedPanelState,\n  useDefaultPanelTitle,\n} from \"@foxglove/studio-base/providers/PanelStateContextProvider\";\nimport { PanelConfig, SaveConfig } from \"@foxglove/studio-base/types/panels\";\nimport { assertNever } from \"@foxglove/studio-base/util/assertNever\";\n\nimport { PanelConfigVersionError } from \"./PanelConfigVersionError\";\nimport { initRenderStateBuilder } from \"./renderState\";\n\nconst log = Logger.getLogger(__filename);\n\ntype VersionedPanelConfig = Record<string, unknown> & { [VERSION_CONFIG_KEY]: number };\n\nexport const VERSION_CONFIG_KEY = \"foxgloveConfigVersion\";\n\nfunction isVersionedPanelConfig(config: unknown): config is VersionedPanelConfig {\n  return (\n    config != undefined &&\n    typeof config === \"object\" &&\n    VERSION_CONFIG_KEY in config &&\n    typeof config[VERSION_CONFIG_KEY] === \"number\"\n  );\n}\n\ntype PanelExtensionAdapterProps = {\n  /** function that initializes the panel extension */\n  initPanel: ExtensionPanelRegistration[\"initPanel\"];\n  /**\n   * If defined, the highest supported version of config the panel supports.\n   * Used to prevent older implementations of a panel from trying to access\n   * newer, incompatible versions of the panel's config. Panels should include a\n   * numbered foxgloveConfigVersion property in their config to control this.\n   */\n  highestSupportedConfigVersion?: number;\n  config: unknown;\n  saveConfig: SaveConfig<unknown>;\n};\n\nfunction selectContext(ctx: MessagePipelineContext) {\n  return ctx;\n}\n\nfunction selectInstalledMessageConverters(state: ExtensionCatalog) {\n  return state.installedMessageConverters;\n}\n\ntype RenderFn = NonNullable<PanelExtensionContext[\"onRender\"]>;\n/**\n * PanelExtensionAdapter renders a panel extension via initPanel\n *\n * The adapter creates a PanelExtensionContext and invokes initPanel using the context.\n */\nfunction PanelExtensionAdapter(\n  props: React.PropsWithChildren<PanelExtensionAdapterProps>,\n): JSX.Element {\n  const { initPanel, config, saveConfig, highestSupportedConfigVersion } = props;\n\n  // Unlike the react data flow, the config is only provided to the panel once on setup.\n  // The panel is meant to manage the config and call saveConfig on its own.\n  //\n  // We store the config in a ref to avoid re-initializing the panel when the react config\n  // changes.\n  const initialState = useLatest(config);\n\n  const messagePipelineContext = useMessagePipeline(selectContext);\n\n  const { playerState, pauseFrame, setSubscriptions, seekPlayback, sortedTopics } =\n    messagePipelineContext;\n\n  const { capabilities, profile: dataSourceProfile } = playerState;\n\n  const { openSiblingPanel } = usePanelContext();\n\n  const [panelId] = useState(() => uuid());\n  const isMounted = useSynchronousMountedState();\n  const [error, setError] = useState<Error | undefined>();\n  const [watchedFields, setWatchedFields] = useState(new Set<keyof RenderState>());\n  const messageConverters = useExtensionCatalog(selectInstalledMessageConverters);\n\n  const [localSubscriptions, setLocalSubscriptions] = useState<Subscription[]>([]);\n\n  const [appSettings, setAppSettings] = useState(new Map<string, AppSettingValue>());\n  const [subscribedAppSettings, setSubscribedAppSettings] = useState<string[]>([]);\n\n  const [renderFn, setRenderFn] = useState<RenderFn | undefined>();\n  const isPanelInitializedRef = useRef(false);\n\n  const [slowRender, setSlowRender] = useState(false);\n  const [, setDefaultPanelTitle] = useDefaultPanelTitle();\n\n  const { globalVariables, setGlobalVariables } = useGlobalVariables();\n\n  const hoverValue = useHoverValue({\n    componentId: `PanelExtensionAdapter:${panelId}`,\n    isTimestampScale: true,\n  });\n  const setHoverValue = useSetHoverValue();\n  const clearHoverValue = useClearHoverValue();\n\n  // track the advertisements requested by the panel context\n  // topic -> advertisement\n  const advertisementsRef = useRef(new Map<string, AdvertiseOptions>());\n\n  const {\n    palette: { mode: colorScheme },\n  } = useTheme();\n\n  const appConfiguration = useAppConfiguration();\n\n  // The panel extension context exposes methods on the message pipeline. We don't want\n  // the extension context to be re-created when the message pipeline changes since it only\n  // needs to act on the latest version of the message pipeline.\n  //\n  // This getter allows the extension context to remain stable through pipeline changes\n  const getMessagePipelineContext = useMessagePipelineGetter();\n\n  // initRenderStateBuilder render produces a function which computes the latest render state from a set of inputs\n  // Spiritually its like a reducer\n  const [buildRenderState, setBuildRenderState] = useState(() => initRenderStateBuilder());\n\n  const [sharedPanelState, setSharedPanelState] = useSharedPanelState();\n\n  // Register handlers to update the app settings we subscribe to\n  useEffect(() => {\n    const handlers = new Map<string, (newValue: AppSettingValue) => void>();\n\n    for (const key of subscribedAppSettings) {\n      const handler = (newValue: AppSettingValue) => {\n        setAppSettings((old) => {\n          old.set(key, newValue);\n          return new Map(old);\n        });\n      };\n      handlers.set(key, handler);\n      appConfiguration.addChangeListener(key, handler);\n    }\n\n    const newAppSettings = new Map<string, AppSettingValue>();\n    for (const key of subscribedAppSettings) {\n      newAppSettings.set(key, appConfiguration.get(key));\n    }\n\n    setAppSettings(newAppSettings);\n\n    return () => {\n      for (const [key, handler] of handlers.entries()) {\n        appConfiguration.removeChangeListener(key, handler);\n      }\n    };\n  }, [appConfiguration, subscribedAppSettings]);\n\n  const messageEvents = useMemo(\n    () => messagePipelineContext.messageEventsBySubscriberId.get(panelId),\n    [messagePipelineContext.messageEventsBySubscriberId, panelId],\n  );\n\n  // The rendering ref is set when we've begin rendering the frame (calling the panel's render\n  // function)\n  //\n  // If another update arrives before the panel finishes rendering, we will update the\n  // slowRenderState to indicate that the panel could not keep up with rendering relative to\n  // updates.\n  const renderingRef = useRef<boolean>(false);\n  useLayoutEffect(() => {\n    /**\n     * We need to check that the panel has been initialized because the renderFn function is being\n     * called between the initPanel's useLayoutEffect cleanup and initPanel being called\n     * again even if setRenderFn(undefined) is called in the cleanup function. This causes\n     * the old renderFn to be called in this effect and pauseFrame to happen, but it is never\n     * resumed, thus causing a 5 second delay in all panels in the layout to be loaded.\n     */\n    if (!renderFn || !isPanelInitializedRef.current) {\n      return;\n    }\n\n    const renderState = buildRenderState({\n      appSettings,\n      colorScheme,\n      currentFrame: messageEvents,\n      globalVariables,\n      hoverValue,\n      messageConverters,\n      playerState,\n      sharedPanelState,\n      sortedTopics,\n      subscriptions: localSubscriptions,\n      watchedFields,\n    });\n\n    if (!renderState) {\n      return;\n    }\n\n    if (renderingRef.current) {\n      setSlowRender(true);\n      return;\n    }\n\n    setSlowRender(false);\n    const resumeFrame = pauseFrame(panelId);\n\n    // tell the panel to render and lockout future renders until rendering is complete\n    renderingRef.current = true;\n    try {\n      setError(undefined);\n      let doneCalled = false;\n      renderFn(renderState, () => {\n        // ignore any additional done calls from the panel\n        if (doneCalled) {\n          log.warn(`${panelId} called render done function twice`);\n          return;\n        }\n        doneCalled = true;\n        resumeFrame();\n        renderingRef.current = false;\n      });\n    } catch (err) {\n      setError(err);\n    }\n  }, [\n    appSettings,\n    buildRenderState,\n    colorScheme,\n    globalVariables,\n    hoverValue,\n    localSubscriptions,\n    messageConverters,\n    messageEvents,\n    panelId,\n    pauseFrame,\n    playerState,\n    renderFn,\n    sharedPanelState,\n    sortedTopics,\n    watchedFields,\n  ]);\n\n  const updatePanelSettingsTree = usePanelSettingsTreeUpdate();\n\n  type PartialPanelExtensionContext = Omit<PanelExtensionContext, \"panelElement\">;\n  const partialExtensionContext = useMemo<PartialPanelExtensionContext>(() => {\n    const layout: PanelExtensionContext[\"layout\"] = {\n      addPanel({ position, type, updateIfExists, getState }) {\n        if (!isMounted()) {\n          return;\n        }\n        switch (position) {\n          case \"sibling\":\n            openSiblingPanel({\n              panelType: type,\n              updateIfExists,\n              siblingConfigCreator: (existingConfig) => getState(existingConfig) as PanelConfig,\n            });\n            return;\n          default:\n            assertNever(position, `Unsupported position for addPanel: ${position}`);\n        }\n      },\n    };\n\n    return {\n      initialState: initialState.current,\n\n      saveState: (state) => {\n        if (!isMounted()) {\n          return;\n        }\n        saveConfig(state);\n      },\n\n      layout,\n\n      seekPlayback: seekPlayback\n        ? (stamp: number | Time) => {\n            if (!isMounted()) {\n              return;\n            }\n            const seekTarget = typeof stamp === \"object\" ? stamp : fromSec(stamp);\n            seekPlayback(seekTarget);\n          }\n        : undefined,\n\n      dataSourceProfile,\n\n      setParameter: (name: string, value: ParameterValue) => {\n        if (!isMounted()) {\n          return;\n        }\n        getMessagePipelineContext().setParameter(name, value);\n      },\n\n      setVariable: (name: string, value: VariableValue) => {\n        if (!isMounted()) {\n          return;\n        }\n        setGlobalVariables({ [name]: value });\n      },\n\n      setPreviewTime: (stamp: number | undefined) => {\n        if (!isMounted()) {\n          return;\n        }\n        if (stamp == undefined) {\n          clearHoverValue(\"PanelExtensionAdatper\");\n        } else {\n          const ctx = getMessagePipelineContext();\n          const startTime = ctx.playerState.activeData?.startTime;\n          // if we don't have a start time we cannot correctly set the playback seconds hover value\n          // this hover value needs seconds from start\n          if (!startTime) {\n            return;\n          }\n          const secondsFromStart = stamp - toSec(startTime);\n          setHoverValue({\n            type: \"PLAYBACK_SECONDS\",\n            componentId: \"PanelExtensionAdatper\",\n            value: secondsFromStart,\n          });\n        }\n      },\n\n      setSharedPanelState,\n\n      watch: (field: keyof RenderState) => {\n        if (!isMounted()) {\n          return;\n        }\n        setWatchedFields((old) => {\n          if (old.has(field)) {\n            // In React 18 we noticed that this setter function would be called in an infinite loop\n            // even though watch() was not called repeatedly. Adding this early return of the old\n            // value fixed the issue.\n            return old;\n          }\n          const newWatchedFields = new Set(old);\n          newWatchedFields.add(field);\n          return newWatchedFields;\n        });\n      },\n\n      subscribe: (topics: ReadonlyArray<string | Subscription>) => {\n        if (!isMounted()) {\n          return;\n        }\n        const subscribePayloads = topics.map<SubscribePayload>((item) => {\n          if (typeof item === \"string\") {\n            // For backwards compatability with the topic-string-array api `subscribe([\"/topic\"])`\n            // results in a topic subscription with full preloading\n            return { topic: item, preloadType: \"full\" };\n          }\n\n          return {\n            topic: item.topic,\n            convertTo: item.convertTo,\n            preloadType: item.preload === true ? \"full\" : \"partial\",\n          };\n        });\n\n        // ExtensionPanel-Facing subscription type\n        const localSubs = topics.map<Subscription>((item) => {\n          if (typeof item === \"string\") {\n            return { topic: item, preload: true };\n          }\n\n          return item;\n        });\n\n        setLocalSubscriptions(localSubs);\n        setSubscriptions(panelId, subscribePayloads);\n      },\n\n      advertise: capabilities.includes(PlayerCapabilities.advertise)\n        ? (topic: string, datatype: string, options) => {\n            if (!isMounted()) {\n              return;\n            }\n            const payload: AdvertiseOptions = {\n              topic,\n              schemaName: datatype,\n              options,\n            };\n            advertisementsRef.current.set(topic, payload);\n\n            getMessagePipelineContext().setPublishers(\n              panelId,\n              Array.from(advertisementsRef.current.values()),\n            );\n          }\n        : undefined,\n\n      unadvertise: capabilities.includes(PlayerCapabilities.advertise)\n        ? (topic: string) => {\n            if (!isMounted()) {\n              return;\n            }\n            advertisementsRef.current.delete(topic);\n            getMessagePipelineContext().setPublishers(\n              panelId,\n              Array.from(advertisementsRef.current.values()),\n            );\n          }\n        : undefined,\n\n      publish: capabilities.includes(PlayerCapabilities.advertise)\n        ? (topic, message) => {\n            if (!isMounted()) {\n              return;\n            }\n            getMessagePipelineContext().publish({\n              topic,\n              msg: message as Record<string, unknown>,\n            });\n          }\n        : undefined,\n\n      callService: capabilities.includes(PlayerCapabilities.callServices)\n        ? async (service, request): Promise<unknown> => {\n            if (!isMounted()) {\n              throw new Error(\"Service call after panel was unmounted\");\n            }\n            return await getMessagePipelineContext().callService(service, request);\n          }\n        : undefined,\n\n      unsubscribeAll: () => {\n        if (!isMounted()) {\n          return;\n        }\n        setLocalSubscriptions([]);\n        setSubscriptions(panelId, []);\n      },\n\n      subscribeAppSettings: (settings: string[]) => {\n        if (!isMounted()) {\n          return;\n        }\n        setSubscribedAppSettings(settings);\n      },\n\n      updatePanelSettingsEditor: (settings: SettingsTree) => {\n        if (!isMounted()) {\n          return;\n        }\n        updatePanelSettingsTree(settings);\n      },\n\n      setDefaultPanelTitle: (title: string) => {\n        if (!isMounted()) {\n          return;\n        }\n        setDefaultPanelTitle(title);\n      },\n    };\n  }, [\n    capabilities,\n    clearHoverValue,\n    dataSourceProfile,\n    getMessagePipelineContext,\n    initialState,\n    isMounted,\n    openSiblingPanel,\n    panelId,\n    saveConfig,\n    seekPlayback,\n    setDefaultPanelTitle,\n    setGlobalVariables,\n    setHoverValue,\n    setSharedPanelState,\n    setSubscriptions,\n    updatePanelSettingsTree,\n  ]);\n\n  const panelContainerRef = useRef<HTMLDivElement>(ReactNull);\n\n  useValueChangedDebugLog(initPanel, \"initPanel\");\n  useValueChangedDebugLog(panelId, \"panelId\");\n  useValueChangedDebugLog(partialExtensionContext, \"partialExtensionContext\");\n\n  const configTooNew = useMemo(() => {\n    const latestConfig = initialState.current;\n    return (\n      isVersionedPanelConfig(latestConfig) &&\n      highestSupportedConfigVersion != undefined &&\n      latestConfig[VERSION_CONFIG_KEY] > highestSupportedConfigVersion\n    );\n  }, [initialState, highestSupportedConfigVersion]);\n\n  // Manage extension lifecycle by calling initPanel() when the panel context changes.\n  //\n  // If we useEffect here instead of useLayoutEffect, the prevRenderState can get polluted with data\n  // from a previous panel instance.\n  useLayoutEffect(() => {\n    if (!panelContainerRef.current) {\n      throw new Error(\"Expected panel container to be mounted\");\n    }\n\n    // If the config is too new for this panel to support we bail and don't do any panel initialization\n    // We will instead show a warning message to the user\n    if (configTooNew) {\n      return;\n    }\n\n    // Reset local state when the panel element is mounted or changes\n    setRenderFn(undefined);\n    renderingRef.current = false;\n    setSlowRender(false);\n\n    setBuildRenderState(() => initRenderStateBuilder());\n\n    const panelElement = document.createElement(\"div\");\n    panelElement.style.width = \"100%\";\n    panelElement.style.height = \"100%\";\n    panelElement.style.overflow = \"hidden\";\n    panelContainerRef.current.appendChild(panelElement);\n\n    log.info(`Init panel ${panelId}`);\n    const onUnmount = initPanel({\n      panelElement,\n      ...partialExtensionContext,\n\n      // eslint-disable-next-line no-restricted-syntax\n      set onRender(renderFunction: RenderFn | undefined) {\n        setRenderFn(() => renderFunction);\n      },\n    });\n    isPanelInitializedRef.current = true;\n\n    return () => {\n      if (onUnmount) {\n        onUnmount();\n      }\n      isPanelInitializedRef.current = false;\n      panelElement.remove();\n      getMessagePipelineContext().setSubscriptions(panelId, []);\n      getMessagePipelineContext().setPublishers(panelId, []);\n    };\n  }, [initPanel, panelId, partialExtensionContext, getMessagePipelineContext, configTooNew]);\n\n  const style: CSSProperties = {};\n  if (slowRender) {\n    style.borderColor = \"orange\";\n    style.borderWidth = \"1px\";\n    style.borderStyle = \"solid\";\n  }\n\n  if (error) {\n    throw error;\n  }\n\n  return (\n    <div\n      style={{\n        alignItems: \"stretch\",\n        display: \"flex\",\n        flexDirection: \"column\",\n        height: \"100%\",\n        overflow: \"hidden\",\n        width: \"100%\",\n        zIndex: 0,\n        ...style,\n      }}\n    >\n      <PanelToolbar />\n      {configTooNew && <PanelConfigVersionError />}\n      {props.children}\n      <div style={{ flex: 1, overflow: \"hidden\" }} ref={panelContainerRef} />\n    </div>\n  );\n}\n\nexport default PanelExtensionAdapter;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Fragment, ReactNode, useCallback } from \"react\";\n\nimport {\n  PanelStateStore,\n  usePanelStateStore,\n} from \"@foxglove/studio-base/context/PanelStateContext\";\n\n/**\n * Wrapper component used to force-remount the panel when key properties like the tabId\n * or settings sequence number change.\n */\nexport function PanelRemounter({\n  children,\n  id,\n  tabId,\n}: {\n  children: ReactNode;\n  id: string;\n  tabId: undefined | string;\n}): JSX.Element {\n  const selector = useCallback((store: PanelStateStore) => store.sequenceNumbers[id] ?? 0, [id]);\n  const sequenceNumber = usePanelStateStore(selector);\n\n  return <Fragment key={`${id}${tabId ?? \"\"}${sequenceNumber}`}>{children}</Fragment>;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport EmptyState from \"@foxglove/studio-base/components/EmptyState\";\nimport withPanel from \"@foxglove/studio-base/components/Panel\";\nimport PanelToolbar from \"@foxglove/studio-base/components/PanelToolbar\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { SaveConfig } from \"@foxglove/studio-base/types/panels\";\n\n// Since the unknown panel never saves its config, the config fields here are used with `overrideConfig`\n// to the connected Panel component (returned from withPanel).\n//\n// The _type_ config option should be the type of the missing panel.\ntype Props = {\n  config: { type: string; id: string };\n  saveConfig: SaveConfig<unknown>;\n};\n\nfunction UnconnectedUnknownPanel(props: Props) {\n  const { config, saveConfig: _ } = props;\n\n  return (\n    <Stack flex=\"auto\" alignItems=\"center\" justifyContent=\"center\" data-testid={config.id}>\n      <PanelToolbar isUnknownPanel />\n      <EmptyState>Unknown panel type: {config.type}.</EmptyState>\n    </Stack>\n  );\n}\nUnconnectedUnknownPanel.panelType = \"unknown\";\nUnconnectedUnknownPanel.defaultConfig = {};\n\n/**\n * An UnknownPanel stands in for missing panels. When a panel referenced in a layout is not\n * available (maybe the extension was un-installed), this panel is shown instead.\n */\nexport const UnknownPanel = withPanel(UnconnectedUnknownPanel);\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { CircularProgress } from \"@mui/material\";\nimport React, { PropsWithChildren, Suspense, useCallback, useMemo } from \"react\";\nimport { useDrop } from \"react-dnd\";\nimport {\n  MosaicDragType,\n  MosaicNode,\n  MosaicPath,\n  MosaicWindow,\n  MosaicWithoutDragDropContext,\n} from \"react-mosaic-component\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { EmptyPanelLayout } from \"@foxglove/studio-base/components/EmptyPanelLayout\";\nimport EmptyState from \"@foxglove/studio-base/components/EmptyState\";\nimport { useAppContext } from \"@foxglove/studio-base/context/AppContext\";\nimport {\n  LayoutState,\n  useCurrentLayoutActions,\n  useCurrentLayoutSelector,\n  usePanelMosaicId,\n} from \"@foxglove/studio-base/context/CurrentLayoutContext\";\nimport { useExtensionCatalog } from \"@foxglove/studio-base/context/ExtensionCatalogContext\";\nimport { usePanelCatalog } from \"@foxglove/studio-base/context/PanelCatalogContext\";\nimport { MosaicDropResult, PanelConfig } from \"@foxglove/studio-base/types/panels\";\nimport { getPanelIdForType, getPanelTypeFromId } from \"@foxglove/studio-base/util/layout\";\n\nimport ErrorBoundary from \"./ErrorBoundary\";\nimport { MosaicPathContext } from \"./MosaicPathContext\";\nimport { PanelRemounter } from \"./PanelRemounter\";\nimport { UnknownPanel } from \"./UnknownPanel\";\n\nimport \"react-mosaic-component/react-mosaic-component.css\";\n\ntype Props = {\n  layout?: MosaicNode<string>;\n  onChange: (panels: MosaicNode<string> | undefined) => void;\n  tabId?: string;\n};\n\n// CSS hack to disable the first level of drop targets inside a Tab's own mosaic window (that would\n// place the dropped item as a sibling of the Tab), as well as the \"root drop targets\" inside the\n// nested mosaic (that would place the dropped item as a direct child of the Tab). Makes it easier\n// to drop panels into a tab layout.\nconst useStyles = makeStyles()({\n  hideTopLevelDropTargets: {\n    margin: 0,\n\n    \".mosaic-root + .drop-target-container\": {\n      display: \"none !important\",\n    },\n    \"& > .mosaic-window > .drop-target-container\": {\n      display: \"none !important\",\n    },\n  },\n});\n\n// This wrapper makes the tabId available in the drop result when something is dropped into a nested\n// drop target. This allows a panel to know which mosaic it was dropped in regardless of nesting\n// level.\nfunction TabMosaicWrapper({ tabId, children }: PropsWithChildren<{ tabId?: string }>) {\n  const { classes, cx } = useStyles();\n  const [, drop] = useDrop<unknown, MosaicDropResult, never>({\n    accept: MosaicDragType.WINDOW,\n    drop: (_item, monitor) => {\n      const nestedDropResult = monitor.getDropResult<MosaicDropResult>();\n      if (nestedDropResult) {\n        // The drop result may already have a tabId if it was dropped in a more deeply-nested Tab\n        // mosaic. Provide our tabId only if there wasn't one already.\n        return { tabId, ...nestedDropResult };\n      }\n      return undefined;\n    },\n  });\n  return (\n    <div className={cx(classes.hideTopLevelDropTargets, \"mosaic-tile\")} ref={drop}>\n      {children}\n    </div>\n  );\n}\n\nexport function UnconnectedPanelLayout(props: Props): React.ReactElement {\n  const { savePanelConfigs } = useCurrentLayoutActions();\n  const mosaicId = usePanelMosaicId();\n  const { layout, onChange, tabId } = props;\n  const createTile = useCallback(\n    (config?: { type?: string; panelConfig?: PanelConfig }) => {\n      const defaultPanelType = \"RosOut\";\n      const type = config?.type ? config.type : defaultPanelType;\n      const id = getPanelIdForType(type);\n      if (config?.panelConfig) {\n        savePanelConfigs({ configs: [{ id, config: config.panelConfig }] });\n      }\n      return id;\n    },\n    [savePanelConfigs],\n  );\n\n  const panelCatalog = usePanelCatalog();\n\n  const panelComponents = useMemo(\n    () =>\n      new Map(\n        panelCatalog.getPanels().map((panelInfo) => [panelInfo.type, React.lazy(panelInfo.module)]),\n      ),\n    [panelCatalog],\n  );\n\n  const renderTile = useCallback(\n    (id: string | Record<string, never> | undefined, path: MosaicPath) => {\n      // `id` is usually a string. But when `layout` is empty, `id` will be an empty object, in which case we don't need to render Tile\n      if (id == undefined || typeof id !== \"string\") {\n        return <></>;\n      }\n      const type = getPanelTypeFromId(id);\n\n      let panel: JSX.Element;\n      const PanelComponent = panelComponents.get(type);\n      if (PanelComponent) {\n        panel = <PanelComponent childId={id} tabId={tabId} />;\n      } else {\n        // If we haven't found a panel of the given type, render the panel selector\n        panel = <UnknownPanel childId={id} tabId={tabId} overrideConfig={{ type, id }} />;\n      }\n\n      const mosaicWindow = (\n        <MosaicWindow\n          title=\"\"\n          key={id}\n          path={path}\n          createNode={createTile}\n          renderPreview={() => undefined as unknown as JSX.Element}\n        >\n          <Suspense\n            fallback={\n              <EmptyState>\n                <CircularProgress size={28} />\n              </EmptyState>\n            }\n          >\n            <MosaicPathContext.Provider value={path}>\n              <PanelRemounter id={id} tabId={tabId}>\n                {panel}\n              </PanelRemounter>\n            </MosaicPathContext.Provider>\n          </Suspense>\n        </MosaicWindow>\n      );\n      if (type === \"Tab\") {\n        return <TabMosaicWrapper tabId={id}>{mosaicWindow}</TabMosaicWrapper>;\n      }\n      return mosaicWindow;\n    },\n    [panelComponents, createTile, tabId],\n  );\n\n  const bodyToRender = useMemo(\n    () =>\n      layout != undefined ? (\n        <MosaicWithoutDragDropContext\n          renderTile={renderTile}\n          className=\"mosaic-foxglove-theme\" // prevent the default mosaic theme from being applied\n          resize={{ minimumPaneSizePercentage: 2 }}\n          value={layout}\n          onChange={(newLayout) => onChange(newLayout ?? undefined)}\n          mosaicId={mosaicId}\n        />\n      ) : (\n        <EmptyPanelLayout tabId={tabId} />\n      ),\n    [layout, mosaicId, onChange, renderTile, tabId],\n  );\n\n  return <ErrorBoundary>{bodyToRender}</ErrorBoundary>;\n}\n\nfunction LoadingState(): JSX.Element {\n  return (\n    <EmptyState>\n      <CircularProgress size={28} />\n    </EmptyState>\n  );\n}\n\nconst selectedLayoutLoadingSelector = (state: LayoutState) => state.selectedLayout?.loading;\nconst selectedLayoutExistsSelector = (state: LayoutState) =>\n  state.selectedLayout?.data != undefined;\nconst selectedLayoutMosaicSelector = (state: LayoutState) => state.selectedLayout?.data?.layout;\n\nexport default function PanelLayout(): JSX.Element {\n  const { layoutEmptyState } = useAppContext();\n  const { changePanelLayout } = useCurrentLayoutActions();\n  const layoutExists = useCurrentLayoutSelector(selectedLayoutExistsSelector);\n  const layoutLoading = useCurrentLayoutSelector(selectedLayoutLoadingSelector);\n  const mosaicLayout = useCurrentLayoutSelector(selectedLayoutMosaicSelector);\n  const registeredExtensions = useExtensionCatalog((state) => state.installedExtensions);\n\n  const onChange = useCallback(\n    (newLayout: MosaicNode<string> | undefined) => {\n      if (newLayout != undefined) {\n        changePanelLayout({ layout: newLayout });\n      }\n    },\n    [changePanelLayout],\n  );\n\n  if (registeredExtensions == undefined) {\n    return <LoadingState />;\n  }\n\n  if (layoutExists) {\n    return <UnconnectedPanelLayout layout={mosaicLayout} onChange={onChange} />;\n  }\n\n  if (layoutLoading === true) {\n    return <LoadingState />;\n  }\n\n  if (layoutEmptyState) {\n    return layoutEmptyState;\n  }\n\n  return <></>;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { alpha } from \"@mui/material\";\nimport { forwardRef, HTMLAttributes, PropsWithChildren } from \"react\";\nimport { TransitionStatus } from \"react-transition-group\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { APP_BAR_HEIGHT } from \"@foxglove/studio-base/components/AppBar/constants\";\n\nexport const PANEL_ROOT_CLASS_NAME = \"FoxglovePanelRoot-root\";\n\ntype PanelRootProps = {\n  fullscreenState: TransitionStatus;\n  selected: boolean;\n  sourceRect: DOMRectReadOnly | undefined;\n  hasFullscreenDescendant: boolean;\n} & HTMLAttributes<HTMLDivElement>;\n\nexport const usePanelRootStyles = makeStyles<\n  Omit<PanelRootProps, \"fullscreenState\" | \"selected\">\n>()((theme, props) => {\n  const { palette, transitions } = theme;\n  const { sourceRect, hasFullscreenDescendant } = props;\n  const duration = transitions.duration.shorter;\n\n  return {\n    root: {\n      display: \"flex\",\n      flexDirection: \"column\",\n      flex: \"1 1 auto\",\n      overflow: \"hidden\",\n      backgroundColor: palette.background.default,\n      border: `0px solid ${alpha(palette.primary.main, 0.67)}`,\n      transition: transitions.create(\"border-width\", {\n        duration, // match to timeout duration inside Panel component\n      }),\n\n      \"::after\": {\n        content: \"''\",\n        top: 0,\n        left: 0,\n        right: 0,\n        bottom: 0,\n        inset: 1,\n        opacity: 0,\n        border: `1px solid ${palette.primary.main}`,\n        position: \"absolute\",\n        pointerEvents: \"none\",\n        transition: \"opacity 0.05s ease-out\",\n        zIndex: 10000 + 1,\n      },\n    },\n    rootSelected: {\n      \"::after\": {\n        opacity: 1,\n        transition: \"opacity 0.125s ease-out\",\n      },\n    },\n    entering: {\n      position: \"fixed\",\n      top: sourceRect?.top ?? 0,\n      left: sourceRect?.left ?? 0,\n      right: sourceRect ? window.innerWidth - sourceRect.right : 0,\n      bottom: sourceRect ? window.innerHeight - sourceRect.bottom : 0,\n      zIndex: 10000,\n    },\n    entered: {\n      borderWidth: 4,\n      position: \"fixed\",\n      top: APP_BAR_HEIGHT, // offset by app bar height\n      left: 0,\n      right: 0,\n      bottom: 77, // match PlaybackBar height\n      zIndex: 10000,\n      transition: transitions.create([\"border-width\", \"top\", \"right\", \"bottom\", \"left\"], {\n        duration, // match to timeout duration inside Panel component\n      }),\n    },\n    exiting: {\n      position: \"fixed\",\n      top: sourceRect?.top ?? 0,\n      left: sourceRect?.left ?? 0,\n      right: sourceRect ? window.innerWidth - sourceRect.right : 0,\n      bottom: sourceRect ? window.innerHeight - sourceRect.bottom : 0,\n      zIndex: 10000,\n      transition: transitions.create([\"border-width\", \"top\", \"right\", \"bottom\", \"left\"], {\n        duration, // match to timeout duration inside Panel component\n      }),\n    },\n    exited: {\n      position: \"relative\",\n      top: 0,\n      left: 0,\n      right: 0,\n      bottom: 0,\n      // \"z-index: 1\" makes panel drag & drop work more reliably (see\n      // https://github.com/foxglove/studio/pull/3355), but it also makes fullscreen panels get\n      // overlapped by other parts of the panel layout. So we turn it back to auto when a\n      // descendant is fullscreen.\n      zIndex: hasFullscreenDescendant ? \"auto\" : 1,\n    },\n  };\n});\n\nexport const PanelRoot = forwardRef<HTMLDivElement, PropsWithChildren<PanelRootProps>>(\n  function PanelRoot(props, ref): JSX.Element {\n    const { fullscreenState, selected, sourceRect, hasFullscreenDescendant, className, ...rest } =\n      props;\n    const { classes, cx } = usePanelRootStyles({\n      sourceRect,\n      hasFullscreenDescendant,\n    });\n\n    const classNames = cx(PANEL_ROOT_CLASS_NAME, className, classes.root, {\n      [classes.entering]: fullscreenState === \"entering\",\n      [classes.entered]: fullscreenState === \"entered\",\n      [classes.exiting]: fullscreenState === \"exiting\",\n      [classes.exited]: fullscreenState === \"exited\",\n      [classes.rootSelected]: selected,\n    });\n\n    return (\n      <div ref={ref} className={classNames} {...rest}>\n        {props.children}\n      </div>\n    );\n  },\n);\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { IconButton, IconButtonProps } from \"@mui/material\";\nimport { ForwardedRef, forwardRef } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nconst useStyles = makeStyles()((theme) => ({\n  root: {\n    padding: theme.spacing(0.375),\n    fontSize: \"0.875rem\",\n\n    \".MuiSvgIcon-root, svg:not(.MuiSvgIcon-root)\": {\n      height: \"1em\",\n      width: \"1em\",\n      fontSize: \"inherit\",\n    },\n  },\n}));\n\nexport default forwardRef(function ToolbarIconButton(\n  props: IconButtonProps,\n  ref: ForwardedRef<HTMLButtonElement>,\n): React.ReactElement {\n  const { className, ...rest } = props;\n  const { classes, cx } = useStyles();\n\n  return <IconButton ref={ref} className={cx(classes.root, className)} {...rest} />;\n});\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { ClickAwayListener, Grow, Paper, Popper } from \"@mui/material\";\nimport { useCallback, useContext } from \"react\";\nimport { MosaicContext, MosaicNode, MosaicWindowContext } from \"react-mosaic-component\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { PanelCatalog, PanelSelection } from \"@foxglove/studio-base/components/PanelCatalog\";\nimport PanelContext from \"@foxglove/studio-base/components/PanelContext\";\nimport { useCurrentLayoutActions } from \"@foxglove/studio-base/context/CurrentLayoutContext\";\n\nconst useStyles = makeStyles()((theme) => ({\n  paper: {\n    backgroundColor: theme.palette.background.menu,\n    maxHeight: `calc(100vh - ${theme.spacing(12)})`,\n    overflow: \"auto\",\n\n    // Add iOS momentum scrolling for iOS < 13.0\n    WebkitOverflowScrolling: \"touch\",\n  },\n}));\n\nexport default function ChangePanelMenu({\n  tabId,\n  anchorEl,\n  onClose,\n}: {\n  tabId?: string;\n  anchorEl?: HTMLElement;\n  onClose: () => void;\n}): JSX.Element {\n  const { classes } = useStyles();\n  const panelContext = useContext(PanelContext);\n  const { mosaicActions } = useContext(MosaicContext);\n  const { mosaicWindowActions } = useContext(MosaicWindowContext);\n  const { swapPanel } = useCurrentLayoutActions();\n  const open = Boolean(anchorEl);\n\n  const handleSwap = useCallback(\n    (id?: string) =>\n      ({ type, config, relatedConfigs }: PanelSelection) => {\n        // Reselecting current panel type is a no-op.\n        if (type === panelContext?.type) {\n          onClose();\n          return;\n        }\n\n        swapPanel({\n          tabId,\n          originalId: id ?? \"\",\n          type,\n          root: mosaicActions.getRoot() as MosaicNode<string>,\n          path: mosaicWindowActions.getPath(),\n          config: config ?? {},\n          relatedConfigs,\n        });\n      },\n    [onClose, mosaicActions, mosaicWindowActions, panelContext?.type, swapPanel, tabId],\n  );\n\n  // https://github.com/mui/material-ui/issues/35287#issuecomment-1332327752\n  const fixMui35287 = {} as { onResize: undefined; onResizeCapture: undefined };\n\n  return (\n    <Popper\n      {...fixMui35287}\n      id=\"change-panel-menu\"\n      open={open}\n      role={undefined}\n      anchorEl={anchorEl}\n      transition\n      placement=\"right-start\"\n      style={{ zIndex: 10000 }}\n      popperOptions={{\n        modifiers: [\n          {\n            name: \"flip\",\n            options: { fallbackPlacements: [\"right-start\", \"left-start\"] },\n          },\n        ],\n      }}\n    >\n      {({ TransitionProps, placement }) => (\n        <Grow\n          {...TransitionProps}\n          style={{\n            transformOrigin: placement === \"right-start\" ? \"top left\" : \"top right\",\n          }}\n        >\n          <Paper elevation={8} className={classes.paper}>\n            <ClickAwayListener onClickAway={onClose}>\n              <PanelCatalog\n                mode=\"list\"\n                isMenu\n                selectedPanelType={panelContext?.type}\n                onPanelSelect={handleSwap(panelContext?.id)}\n              />\n            </ClickAwayListener>\n          </Paper>\n        </Grow>\n      )}\n    </Popper>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { getNodeAtPath, MosaicRootActions, MosaicWindowActions } from \"react-mosaic-component\";\nimport { MosaicKey } from \"react-mosaic-component/lib/types\";\n\nimport { getPanelTypeFromId } from \"@foxglove/studio-base/util/layout\";\n\nexport function getPanelTypeFromMosaic(\n  mosaicWindowActions?: MosaicWindowActions,\n  mosaicActions?: MosaicRootActions<MosaicKey>,\n): string | undefined {\n  if (!mosaicWindowActions || !mosaicActions) {\n    return undefined;\n  }\n  const node = getNodeAtPath(mosaicActions.getRoot(), mosaicWindowActions.getPath());\n  if (typeof node !== \"string\") {\n    throw new Error(`Used getPanelTypeFromMosaic on non-leaf node: ${JSON.stringify(node)}`);\n  }\n  const type = getPanelTypeFromId(node);\n\n  return type;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport {\n  Delete20Regular,\n  FullScreenMaximize20Regular,\n  ShapeSubtract20Regular,\n  SplitHorizontal20Regular,\n  SplitVertical20Regular,\n} from \"@fluentui/react-icons\";\nimport ChevronRightIcon from \"@mui/icons-material/ChevronRight\";\nimport MoreVertIcon from \"@mui/icons-material/MoreVert\";\nimport { Divider, Menu, MenuItem } from \"@mui/material\";\nimport { MouseEvent, useCallback, useContext, useMemo, useRef, useState } from \"react\";\nimport { MosaicContext, MosaicNode, MosaicWindowContext } from \"react-mosaic-component\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport PanelContext from \"@foxglove/studio-base/components/PanelContext\";\nimport ChangePanelMenu from \"@foxglove/studio-base/components/PanelToolbar/ChangePanelMenu\";\nimport ToolbarIconButton from \"@foxglove/studio-base/components/PanelToolbar/ToolbarIconButton\";\nimport { getPanelTypeFromMosaic } from \"@foxglove/studio-base/components/PanelToolbar/utils\";\nimport { useCurrentLayoutActions } from \"@foxglove/studio-base/context/CurrentLayoutContext\";\n\ntype Props = {\n  isUnknownPanel: boolean;\n};\n\nconst useStyles = makeStyles()((theme) => ({\n  error: { color: theme.palette.error.main },\n  icon: {\n    marginRight: theme.spacing(-1),\n  },\n  menuItem: {\n    display: \"flex\",\n    gap: theme.spacing(1),\n    alignItems: \"center\",\n\n    \".root-span\": {\n      display: \"flex\",\n      marginLeft: theme.spacing(-0.25),\n    },\n    \"&.Mui-selected\": {\n      backgroundColor: theme.palette.action.hover,\n\n      \"&:hover\": {\n        backgroundColor: theme.palette.action.hover,\n      },\n    },\n  },\n}));\n\nexport function PanelActionsDropdown({ isUnknownPanel }: Props): JSX.Element {\n  const { classes, cx } = useStyles();\n  const [menuAnchorEl, setMenuAnchorEl] = useState<undefined | HTMLElement>(undefined);\n  const [subMenuAnchorEl, setSubmenuAnchorEl] = useState<undefined | HTMLElement>(undefined);\n\n  const menuOpen = Boolean(menuAnchorEl);\n  const submenuOpen = Boolean(subMenuAnchorEl);\n\n  const panelContext = useContext(PanelContext);\n  const tabId = panelContext?.tabId;\n  const { mosaicActions } = useContext(MosaicContext);\n  const { mosaicWindowActions } = useContext(MosaicWindowContext);\n  const {\n    getCurrentLayoutState: getCurrentLayout,\n    closePanel,\n    splitPanel,\n  } = useCurrentLayoutActions();\n  const getPanelType = useCallback(\n    () => getPanelTypeFromMosaic(mosaicWindowActions, mosaicActions),\n    [mosaicActions, mosaicWindowActions],\n  );\n\n  const handleMenuClick = (event: React.MouseEvent<HTMLButtonElement>) => {\n    setSubmenuAnchorEl(undefined);\n    setMenuAnchorEl(event.currentTarget);\n  };\n\n  const handleMenuClose = () => {\n    setSubmenuAnchorEl(undefined);\n    setMenuAnchorEl(undefined);\n  };\n\n  const handleSubmenuClick = (event: MouseEvent<HTMLElement>) => {\n    if (subMenuAnchorEl !== event.currentTarget) {\n      setSubmenuAnchorEl(event.currentTarget);\n    }\n    setMenuAnchorEl(undefined);\n  };\n\n  const handleSubmenuClose = useCallback(() => {\n    setSubmenuAnchorEl(undefined);\n  }, []);\n\n  const handleSubmenuMouseEnter = (event: MouseEvent<HTMLElement>) => {\n    setSubmenuAnchorEl(event.currentTarget);\n  };\n\n  const close = useCallback(() => {\n    closePanel({\n      tabId,\n      root: mosaicActions.getRoot() as MosaicNode<string>,\n      path: mosaicWindowActions.getPath(),\n    });\n    handleMenuClose();\n  }, [closePanel, mosaicActions, mosaicWindowActions, tabId]);\n\n  const split = useCallback(\n    (id: string | undefined, direction: \"row\" | \"column\") => {\n      const type = getPanelType();\n      if (id == undefined || type == undefined) {\n        throw new Error(\"Trying to split unknown panel!\");\n      }\n\n      const config = getCurrentLayout().selectedLayout?.data?.configById[id] ?? {};\n      splitPanel({\n        id,\n        tabId,\n        direction,\n        root: mosaicActions.getRoot() as MosaicNode<string>,\n        path: mosaicWindowActions.getPath(),\n        config,\n      });\n      handleMenuClose();\n    },\n    [getCurrentLayout, getPanelType, mosaicActions, mosaicWindowActions, splitPanel, tabId],\n  );\n\n  const enterFullscreen = useCallback(() => {\n    panelContext?.enterFullscreen();\n    handleMenuClose();\n  }, [panelContext]);\n\n  const menuItems = useMemo(() => {\n    const items = [];\n\n    if (!isUnknownPanel) {\n      items.push(\n        {\n          key: \"vsplit\",\n          text: \"Split right\",\n          icon: <SplitVertical20Regular />,\n          onClick: () => split(panelContext?.id, \"row\"),\n        },\n        {\n          key: \"hsplit\",\n          text: \"Split down\",\n          icon: <SplitHorizontal20Regular />,\n          onClick: () => split(panelContext?.id, \"column\"),\n        },\n      );\n    }\n\n    if (panelContext?.isFullscreen !== true) {\n      items.push({\n        key: \"enter-fullscreen\",\n        text: \"Fullscreen\",\n        icon: <FullScreenMaximize20Regular />,\n        onClick: enterFullscreen,\n        \"data-testid\": \"panel-menu-fullscreen\",\n      });\n    }\n\n    items.push({ key: \"divider\", type: \"divider\" });\n\n    items.push({\n      key: \"remove\",\n      text: \"Remove panel\",\n      icon: <Delete20Regular />,\n      onClick: close,\n      \"data-testid\": \"panel-menu-remove\",\n      className: classes.error,\n    });\n\n    return items;\n  }, [\n    classes.error,\n    close,\n    enterFullscreen,\n    isUnknownPanel,\n    panelContext?.id,\n    panelContext?.isFullscreen,\n    split,\n  ]);\n\n  const buttonRef = useRef<HTMLDivElement>(ReactNull);\n  const type = getPanelType();\n\n  if (type == undefined) {\n    return <></>;\n  }\n\n  return (\n    <div ref={buttonRef}>\n      <ToolbarIconButton\n        id=\"panel-menu-button\"\n        aria-controls={menuOpen ? \"panel-menu\" : undefined}\n        aria-haspopup=\"true\"\n        aria-expanded={menuOpen ? \"true\" : undefined}\n        onClick={handleMenuClick}\n        data-testid=\"panel-menu\"\n        title=\"More\"\n      >\n        <MoreVertIcon />\n      </ToolbarIconButton>\n      <Menu\n        id=\"panel-menu\"\n        anchorEl={menuAnchorEl}\n        open={menuOpen}\n        onClose={handleMenuClose}\n        anchorOrigin={{ vertical: \"bottom\", horizontal: \"left\" }}\n        MenuListProps={{\n          \"aria-labelledby\": \"panel-menu-button\",\n          dense: true,\n        }}\n      >\n        <MenuItem\n          className={classes.menuItem}\n          selected={submenuOpen}\n          id=\"change-panel-button\"\n          aria-controls={submenuOpen ? \"change-panel-menu\" : undefined}\n          aria-haspopup=\"true\"\n          aria-expanded={submenuOpen ? \"true\" : undefined}\n          onClick={handleSubmenuClick}\n          onMouseEnter={handleSubmenuMouseEnter}\n        >\n          <ShapeSubtract20Regular />\n          Change panel\n          <ChevronRightIcon className={classes.icon} fontSize=\"small\" />\n        </MenuItem>\n        <ChangePanelMenu anchorEl={subMenuAnchorEl} onClose={handleSubmenuClose} tabId={tabId} />\n        <Divider variant=\"middle\" />\n        {menuItems.map((item, idx) =>\n          item.type === \"divider\" ? (\n            <Divider key={`divider-${idx}`} variant=\"middle\" />\n          ) : (\n            <MenuItem\n              key={item.key}\n              onClick={(event) => {\n                event.stopPropagation();\n                item.onClick?.();\n              }}\n              onMouseEnter={() => setSubmenuAnchorEl(undefined)}\n              className={cx(classes.menuItem, item.className)}\n              data-testid={item[\"data-testid\"]}\n            >\n              {item.icon}\n              {item.text}\n            </MenuItem>\n          ),\n        )}\n      </Menu>\n    </div>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport SettingsIcon from \"@mui/icons-material/Settings\";\nimport { forwardRef, useCallback, useContext, useMemo } from \"react\";\n\nimport PanelContext from \"@foxglove/studio-base/components/PanelContext\";\nimport ToolbarIconButton from \"@foxglove/studio-base/components/PanelToolbar/ToolbarIconButton\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { useSelectedPanels } from \"@foxglove/studio-base/context/CurrentLayoutContext\";\nimport PanelCatalogContext from \"@foxglove/studio-base/context/PanelCatalogContext\";\nimport {\n  PanelStateStore,\n  usePanelStateStore,\n} from \"@foxglove/studio-base/context/PanelStateContext\";\nimport { useWorkspaceActions } from \"@foxglove/studio-base/context/Workspace/useWorkspaceActions\";\n\nimport { PanelActionsDropdown } from \"./PanelActionsDropdown\";\n\ntype PanelToolbarControlsProps = {\n  additionalIcons?: React.ReactNode;\n  isUnknownPanel: boolean;\n};\n\nconst PanelToolbarControlsComponent = forwardRef<HTMLDivElement, PanelToolbarControlsProps>(\n  (props, ref) => {\n    const { additionalIcons, isUnknownPanel } = props;\n    const { id: panelId, type: panelType } = useContext(PanelContext) ?? {};\n    const panelCatalog = useContext(PanelCatalogContext);\n    const { setSelectedPanelIds } = useSelectedPanels();\n    const { openPanelSettings } = useWorkspaceActions();\n\n    const hasSettingsSelector = useCallback(\n      (store: PanelStateStore) => (panelId ? store.settingsTrees[panelId] != undefined : false),\n      [panelId],\n    );\n\n    const panelInfo = useMemo(\n      () => (panelType != undefined ? panelCatalog?.getPanelByType(panelType) : undefined),\n      [panelCatalog, panelType],\n    );\n\n    const hasSettings = usePanelStateStore(hasSettingsSelector);\n\n    const openSettings = useCallback(async () => {\n      if (panelId) {\n        setSelectedPanelIds([panelId]);\n        openPanelSettings();\n      }\n    }, [panelId, setSelectedPanelIds, openPanelSettings]);\n\n    // Show the settings button so that panel title is editable, unless we have a custom\n    // toolbar in which case the title wouldn't be visible.\n    const showSettingsButton = panelInfo?.hasCustomToolbar !== true || hasSettings;\n\n    return (\n      <Stack direction=\"row\" alignItems=\"center\" paddingLeft={1} ref={ref}>\n        {additionalIcons}\n        {showSettingsButton && (\n          <ToolbarIconButton title=\"Settings\" onClick={openSettings}>\n            <SettingsIcon />\n          </ToolbarIconButton>\n        )}\n        <PanelActionsDropdown isUnknownPanel={isUnknownPanel} />\n      </Stack>\n    );\n  },\n);\n\nPanelToolbarControlsComponent.displayName = \"PanelToolbarControls\";\n\n// Keep controls, which don't change often, in a pure component in order to avoid re-rendering the\n// whole PanelToolbar when only children change.\nexport const PanelToolbarControls = React.memo(PanelToolbarControlsComponent);\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport FullscreenExitIcon from \"@mui/icons-material/FullscreenExit\";\nimport { Typography } from \"@mui/material\";\nimport { useContext, useMemo, CSSProperties } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport PanelContext from \"@foxglove/studio-base/components/PanelContext\";\nimport ToolbarIconButton from \"@foxglove/studio-base/components/PanelToolbar/ToolbarIconButton\";\nimport { useDefaultPanelTitle } from \"@foxglove/studio-base/providers/PanelStateContextProvider\";\nimport { PANEL_TITLE_CONFIG_KEY } from \"@foxglove/studio-base/util/layout\";\n\nimport { PanelToolbarControls } from \"./PanelToolbarControls\";\n\nexport const PANEL_TOOLBAR_MIN_HEIGHT = 30;\n\ntype Props = {\n  additionalIcons?: React.ReactNode;\n  backgroundColor?: CSSProperties[\"backgroundColor\"];\n  children?: React.ReactNode;\n  className?: string;\n  isUnknownPanel?: boolean;\n};\n\nconst useStyles = makeStyles()((theme) => ({\n  root: {\n    transition: \"transform 80ms ease-in-out, opacity 80ms ease-in-out\",\n    cursor: \"auto\",\n    flex: \"0 0 auto\",\n    alignItems: \"center\",\n    justifyContent: \"flex-end\",\n    padding: theme.spacing(0.25, 0.75),\n    display: \"flex\",\n    minHeight: PANEL_TOOLBAR_MIN_HEIGHT,\n    backgroundColor: theme.palette.background.paper,\n    width: \"100%\",\n    left: 0,\n    zIndex: theme.zIndex.appBar,\n  },\n}));\n\n// Panel toolbar should be added to any panel that's part of the\n// react-mosaic layout.  It adds a drag handle, remove/replace controls\n// and has a place to add custom controls via it's children property\nexport default React.memo<Props>(function PanelToolbar({\n  additionalIcons,\n  backgroundColor,\n  children,\n  className,\n  isUnknownPanel = false,\n}: Props) {\n  const { classes, cx } = useStyles();\n  const {\n    isFullscreen,\n    exitFullscreen,\n    config: { [PANEL_TITLE_CONFIG_KEY]: customTitle = undefined } = {},\n  } = useContext(PanelContext) ?? {};\n\n  const panelContext = useContext(PanelContext);\n\n  // Help-shown state must be hoisted outside the controls container so the modal can remain visible\n  // when the panel is no longer hovered.\n  const additionalIconsWithHelp = useMemo(() => {\n    return (\n      <>\n        {additionalIcons}\n        {isFullscreen === true && (\n          <ToolbarIconButton\n            value=\"exit-fullscreen\"\n            title=\"Exit fullscreen\"\n            onClick={exitFullscreen}\n          >\n            <FullscreenExitIcon />\n          </ToolbarIconButton>\n        )}\n      </>\n    );\n  }, [additionalIcons, isFullscreen, exitFullscreen]);\n\n  // If we have children then we limit the drag area to the controls. Otherwise the entire\n  // toolbar is draggable.\n  const rootDragRef =\n    isUnknownPanel || children != undefined ? undefined : panelContext?.connectToolbarDragHandle;\n\n  const controlsDragRef =\n    isUnknownPanel || children == undefined ? undefined : panelContext?.connectToolbarDragHandle;\n\n  const [defaultPanelTitle] = useDefaultPanelTitle();\n  const customPanelTitle =\n    customTitle != undefined && typeof customTitle === \"string\" && customTitle.length > 0\n      ? customTitle\n      : defaultPanelTitle;\n\n  const title = customPanelTitle ?? panelContext?.title;\n  return (\n    <header\n      className={cx(classes.root, className)}\n      data-testid=\"mosaic-drag-handle\"\n      ref={rootDragRef}\n      style={{ backgroundColor, cursor: rootDragRef != undefined ? \"grab\" : \"auto\" }}\n    >\n      {children ??\n        (title && (\n          <Typography noWrap variant=\"body2\" color=\"text.secondary\" flex=\"auto\">\n            {title}\n          </Typography>\n        ))}\n      <PanelToolbarControls\n        additionalIcons={additionalIconsWithHelp}\n        isUnknownPanel={!!isUnknownPanel}\n        ref={controlsDragRef}\n      />\n    </header>\n  );\n});\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { RpcScales } from \"@foxglove/studio-base/components/Chart/types\";\nimport { useHoverValue } from \"@foxglove/studio-base/context/TimelineInteractionStateContext\";\n\nimport { VerticalBarWrapper } from \"./VerticalBarWrapper\";\n\ntype Props = {\n  scales?: RpcScales;\n  componentId: string;\n  isTimestampScale: boolean;\n};\n\nexport default React.memo<React.PropsWithChildren<Props>>(function HoverBar({\n  children,\n  componentId,\n  isTimestampScale,\n  scales,\n}) {\n  const hoverValue = useHoverValue({ componentId, isTimestampScale });\n\n  return (\n    <VerticalBarWrapper scales={scales} xValue={hoverValue?.value}>\n      {children}\n    </VerticalBarWrapper>\n  );\n});\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { CSSProperties, useMemo } from \"react\";\nimport { withStyles } from \"tss-react/mui\";\n\nimport { RpcScales } from \"@foxglove/studio-base/components/Chart/types\";\n\nexport const Wrapper = withStyles(\"div\", () => ({\n  root: {\n    top: 0,\n    bottom: 0,\n    position: \"absolute\",\n    pointerEvents: \"none\",\n    willChange: \"transform\",\n    visibility: \"hidden\",\n  },\n}));\n\ntype VerticalBarWrapperProps = {\n  scales?: RpcScales;\n  xValue?: number;\n};\n\nexport function VerticalBarWrapper({\n  children,\n  scales,\n  xValue,\n}: React.PropsWithChildren<VerticalBarWrapperProps>): JSX.Element {\n  const positionX = useMemo(() => {\n    const xScale = scales?.x;\n    if (!xScale || xValue == undefined) {\n      return;\n    }\n\n    const pixels = xScale.pixelMax - xScale.pixelMin;\n    const range = xScale.max - xScale.min;\n\n    if (pixels === 0 || range === 0) {\n      return;\n    }\n\n    const pos = (xValue - xScale.min) / (range / pixels) + xScale.pixelMin;\n    // don't show hoverbar if it falls outsize our boundary\n    if (pos < xScale.pixelMin || pos > xScale.pixelMax) {\n      return;\n    }\n    return pos;\n  }, [scales?.x, xValue]);\n\n  const style = useMemo((): CSSProperties => {\n    if (positionX == undefined || isNaN(positionX)) {\n      return { visibility: \"hidden\", transform: undefined };\n    }\n    return { visibility: \"visible\", transform: `translateX(${positionX}px)` };\n  }, [positionX]);\n\n  return <Wrapper style={style}>{children}</Wrapper>;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport IAnalytics from \"@foxglove/studio-base/services/IAnalytics\";\n\nexport default class NullAnalytics implements IAnalytics {\n  public logEvent(): void | Promise<void> {}\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext, useContext } from \"react\";\n\nimport IAnalytics from \"@foxglove/studio-base/services/IAnalytics\";\nimport NullAnalytics from \"@foxglove/studio-base/services/NullAnalytics\";\n\nconst AnalyticsContext = createContext<IAnalytics>(new NullAnalytics());\nAnalyticsContext.displayName = \"AnalyticsContext\";\n\nexport function useAnalytics(): IAnalytics {\n  return useContext(AnalyticsContext);\n}\n\n// ts-prune-ignore-next\nexport default AnalyticsContext;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext, useContext } from \"react\";\n\n// individual app configuration values are basic primitive types\nexport type AppConfigurationValue = string | number | boolean | undefined;\n\nexport type ChangeHandler = (newValue: AppConfigurationValue) => void;\n\n// Exposes an interface for reading and writing user-configurable options and other persistent application state.\nexport interface IAppConfiguration {\n  // get the current value for the key\n  get(key: string): AppConfigurationValue;\n  // set key to value - This returns a promise to track the progress for setting the value\n  set(key: string, value: AppConfigurationValue): Promise<void>;\n  // register a change handler for a particular key\n  addChangeListener(key: string, cb: ChangeHandler): void;\n  // remove a change handler on a given key\n  removeChangeListener(key: string, cb: ChangeHandler): void;\n}\n\nconst AppConfigurationContext = createContext<IAppConfiguration | undefined>(undefined);\nAppConfigurationContext.displayName = \"AppConfigurationContext\";\n\nexport function useAppConfiguration(): IAppConfiguration {\n  const storage = useContext(AppConfigurationContext);\n  if (!storage) {\n    throw new Error(\"An AppConfigurationContext provider is required to useAppConfiguration\");\n  }\n  return storage;\n}\n\nexport default AppConfigurationContext;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext, useContext } from \"react\";\n\ninterface IAppContext {\n  appBarLayoutButton?: JSX.Element;\n  createEvent?: (args: {\n    deviceId: string;\n    timestamp: string;\n    durationNanos: string;\n    metadata: Record<string, string>;\n  }) => Promise<void>;\n  syncAdapters?: readonly JSX.Element[];\n  workspaceExtensions?: readonly JSX.Element[];\n  layoutEmptyState?: JSX.Element;\n}\n\nconst AppContext = createContext<IAppContext>({});\nAppContext.displayName = \"AppContext\";\n\nexport function useAppContext(): IAppContext {\n  return useContext(AppContext);\n}\n\nexport { AppContext };\nexport type { IAppContext };\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { without, xor } from \"lodash\";\n\nimport { TabPanelConfig } from \"@foxglove/studio-base/types/layouts\";\nimport { SavedProps } from \"@foxglove/studio-base/types/panels\";\nimport {\n  getAllPanelIds,\n  getParentTabPanelByPanelId,\n  isTabPanel,\n} from \"@foxglove/studio-base/util/layout\";\n\nexport default function toggleSelectedPanel(\n  panelId: string,\n  containingTabId: string | undefined,\n  configById: SavedProps,\n  selectedPanelIds: readonly string[],\n): string[] {\n  const panelIdsToDeselect = [];\n\n  // If we selected a Tab panel, deselect its children\n  const savedConfig = configById[panelId];\n  if (isTabPanel(panelId) && savedConfig) {\n    const { activeTabIdx, tabs } = savedConfig as TabPanelConfig;\n    const activeTabLayout = tabs[activeTabIdx]?.layout;\n    if (activeTabLayout != undefined) {\n      const childrenPanelIds = getAllPanelIds(activeTabLayout, configById);\n      panelIdsToDeselect.push(...childrenPanelIds);\n    }\n  }\n\n  // If we selected a child, deselect all parent Tab panels\n  const parentTabPanelByPanelId = getParentTabPanelByPanelId(configById);\n  let nextParentId = containingTabId;\n  const parentTabPanelIds = [];\n  while (nextParentId != undefined) {\n    parentTabPanelIds.push(nextParentId);\n    nextParentId = parentTabPanelByPanelId[nextParentId];\n  }\n  panelIdsToDeselect.push(...parentTabPanelIds);\n\n  const nextSelectedPanelIds = xor(selectedPanelIds, [panelId]);\n  const nextValidSelectedPanelIds = without(nextSelectedPanelIds, ...panelIdsToDeselect);\n  return nextValidSelectedPanelIds;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext, useCallback, useLayoutEffect, useReducer, useRef, useState } from \"react\";\nimport { getLeaves } from \"react-mosaic-component\";\n\nimport {\n  useShallowMemo,\n  selectWithUnstableIdentityWarning,\n  useGuaranteedContext,\n} from \"@foxglove/hooks\";\nimport Logger from \"@foxglove/log\";\nimport { VariableValue } from \"@foxglove/studio\";\nimport useShouldNotChangeOften from \"@foxglove/studio-base/hooks/useShouldNotChangeOften\";\nimport toggleSelectedPanel from \"@foxglove/studio-base/providers/CurrentLayoutProvider/toggleSelectedPanel\";\nimport { PanelConfig, PlaybackConfig, UserNodes } from \"@foxglove/studio-base/types/panels\";\n\nimport {\n  LayoutData,\n  AddPanelPayload,\n  ChangePanelLayoutPayload,\n  ClosePanelPayload,\n  CreateTabPanelPayload,\n  DropPanelPayload,\n  EndDragPayload,\n  MoveTabPayload,\n  SaveConfigsPayload,\n  SplitPanelPayload,\n  StartDragPayload,\n  SwapPanelPayload,\n} from \"./actions\";\n\nexport type LayoutID = string & { __brand: \"LayoutID\" };\n\nexport type LayoutState = Readonly<{\n  selectedLayout:\n    | {\n        id: LayoutID;\n        loading?: boolean;\n        data: LayoutData | undefined;\n        name?: string;\n        edited?: boolean;\n      }\n    | undefined;\n}>;\n\n/**\n * Encapsulates the mosaic layout, user nodes, and playback settings (everything considered to be\n * part of a saved \"layout\") used by the current workspace.\n */\nexport interface ICurrentLayout {\n  addLayoutStateListener: (listener: (_: LayoutState) => void) => void;\n  removeLayoutStateListener: (listener: (_: LayoutState) => void) => void;\n  addSelectedPanelIdsListener: (listener: (_: readonly string[]) => void) => void;\n  removeSelectedPanelIdsListener: (listener: (_: readonly string[]) => void) => void;\n\n  /**\n   * We use the same mosaicId for all mosaics (at the top level and within tabs) to support\n   * dragging and dropping between them.\n   */\n  mosaicId: string;\n\n  getSelectedPanelIds: () => readonly string[];\n  setSelectedPanelIds: (\n    _: readonly string[] | ((prevState: readonly string[]) => readonly string[]),\n  ) => void;\n\n  actions: {\n    /**\n     * Returns the current state - useful for click handlers and callbacks that read the state\n     * asynchronously and don't want to update every time the state changes.\n     */\n    getCurrentLayoutState: () => LayoutState;\n\n    setSelectedLayoutId: (id: LayoutID | undefined) => void;\n\n    savePanelConfigs: (payload: SaveConfigsPayload) => void;\n    updatePanelConfigs: (panelType: string, updater: (config: PanelConfig) => PanelConfig) => void;\n    createTabPanel: (payload: CreateTabPanelPayload) => void;\n    changePanelLayout: (payload: ChangePanelLayoutPayload) => void;\n    overwriteGlobalVariables: (payload: Record<string, VariableValue>) => void;\n    setGlobalVariables: (payload: Record<string, VariableValue>) => void;\n    setUserNodes: (payload: Partial<UserNodes>) => void;\n    setPlaybackConfig: (payload: Partial<PlaybackConfig>) => void;\n    closePanel: (payload: ClosePanelPayload) => void;\n    splitPanel: (payload: SplitPanelPayload) => void;\n    swapPanel: (payload: SwapPanelPayload) => void;\n    moveTab: (payload: MoveTabPayload) => void;\n    addPanel: (payload: AddPanelPayload) => void;\n    dropPanel: (payload: DropPanelPayload) => void;\n    startDrag: (payload: StartDragPayload) => void;\n    endDrag: (payload: EndDragPayload) => void;\n  };\n}\n\nexport type CurrentLayoutActions = ICurrentLayout[\"actions\"];\n\nexport type SelectedPanelActions = {\n  getSelectedPanelIds: () => readonly string[];\n  selectedPanelIds: readonly string[];\n  setSelectedPanelIds: (\n    _: readonly string[] | ((prevState: readonly string[]) => string[]),\n  ) => void;\n  selectAllPanels: () => void;\n  togglePanelSelected: (panelId: string, containingTabId: string | undefined) => void;\n};\n\nconst log = Logger.getLogger(__filename);\n\nconst CurrentLayoutContext = createContext<ICurrentLayout | undefined>(undefined);\nCurrentLayoutContext.displayName = \"CurrentLayoutContext\";\n\nexport function usePanelMosaicId(): string {\n  return useGuaranteedContext(CurrentLayoutContext).mosaicId;\n}\nexport function useCurrentLayoutActions(): CurrentLayoutActions {\n  return useGuaranteedContext(CurrentLayoutContext).actions;\n}\nexport function useCurrentLayoutSelector<T>(selector: (layoutState: LayoutState) => T): T {\n  const currentLayout = useGuaranteedContext(CurrentLayoutContext);\n  const [_, forceUpdate] = useReducer((x: number) => x + 1, 0);\n\n  // Catch locations using unstable function selectors\n  useShouldNotChangeOften(selector, () =>\n    log.warn(\n      \"useCurrentLayoutSelector is changing frequently. Rewrite your selector as a stable function.\",\n    ),\n  );\n\n  const state = useRef<{ value: T; selector: typeof selector } | undefined>(undefined);\n  if (!state.current || selector !== state.current.selector) {\n    state.current = {\n      value: selectWithUnstableIdentityWarning(\n        currentLayout.actions.getCurrentLayoutState(),\n        selector,\n      ),\n      selector,\n    };\n  }\n  useLayoutEffect(() => {\n    let mounted = true;\n    const listener = (layoutState: LayoutState) => {\n      // Note: Our removeLayoutStateListener is is too late if the layout state listeners are already\n      // being invoked. Our component might become unmounted during the state listener invocation\n      if (!mounted) {\n        return;\n      }\n      const newValue = selectWithUnstableIdentityWarning(layoutState, selector);\n      if (newValue === state.current?.value) {\n        return;\n      }\n      state.current = {\n        value: newValue,\n        selector,\n      };\n      forceUpdate();\n    };\n    // Update if necessary, i.e. if the state has changed between render and this effect\n    listener(currentLayout.actions.getCurrentLayoutState());\n    currentLayout.addLayoutStateListener(listener);\n    return () => {\n      mounted = false;\n      currentLayout.removeLayoutStateListener(listener);\n    };\n  }, [currentLayout, selector]);\n\n  return state.current.value;\n}\nexport function useSelectedPanels(): SelectedPanelActions {\n  const currentLayout = useGuaranteedContext(CurrentLayoutContext);\n  const [selectedPanelIds, setSelectedPanelIdsState] = useState(() =>\n    currentLayout.getSelectedPanelIds(),\n  );\n  useLayoutEffect(() => {\n    const listener = (newIds: readonly string[]) => setSelectedPanelIdsState(newIds);\n    currentLayout.addSelectedPanelIdsListener(listener);\n    return () => currentLayout.removeSelectedPanelIdsListener(listener);\n  }, [currentLayout]);\n\n  const setSelectedPanelIds = useGuaranteedContext(CurrentLayoutContext).setSelectedPanelIds;\n  const getSelectedPanelIds = useGuaranteedContext(CurrentLayoutContext).getSelectedPanelIds;\n  const { getCurrentLayoutState: getCurrentLayout } = useCurrentLayoutActions();\n\n  const selectAllPanels = useCallback(() => {\n    // eslint-disable-next-line no-restricted-syntax\n    const panelIds = getLeaves(getCurrentLayout().selectedLayout?.data?.layout ?? null);\n    setSelectedPanelIds(panelIds);\n  }, [getCurrentLayout, setSelectedPanelIds]);\n\n  const togglePanelSelected = useCallback(\n    (panelId: string, containingTabId: string | undefined) => {\n      setSelectedPanelIds((selectedIds) => {\n        const { selectedLayout } = getCurrentLayout();\n        if (!selectedLayout?.data) {\n          return selectedIds;\n        }\n        return toggleSelectedPanel(\n          panelId,\n          containingTabId,\n          selectedLayout.data.configById,\n          selectedIds,\n        );\n      });\n    },\n    [setSelectedPanelIds, getCurrentLayout],\n  );\n\n  return useShallowMemo({\n    getSelectedPanelIds,\n    selectedPanelIds,\n    setSelectedPanelIds,\n    selectAllPanels,\n    togglePanelSelected,\n  });\n}\n\nexport default CurrentLayoutContext;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext, useContext } from \"react\";\n\nexport type User = {\n  id: string;\n  avatarImageUrl?: string | null; // eslint-disable-line no-restricted-syntax\n  email: string;\n  orgId: string;\n  orgDisplayName: string | null; // eslint-disable-line no-restricted-syntax\n  orgSlug: string;\n  orgPaid: boolean | null; // eslint-disable-line no-restricted-syntax\n  org: {\n    id: string;\n    slug: string;\n    displayName: string;\n    isEnterprise: boolean;\n    allowsUploads: boolean;\n    supportsEdgeSites: boolean;\n  };\n};\n\nexport interface CurrentUser {\n  currentUser: User | undefined;\n  signIn?: () => void;\n  signOut?: () => Promise<void>;\n}\n\nconst CurrentUserContext = createContext<CurrentUser>({\n  currentUser: undefined,\n});\nCurrentUserContext.displayName = \"CurrentUserContext\";\n\nexport function useCurrentUser(): CurrentUser {\n  return useContext(CurrentUserContext);\n}\n\nexport type UserType =\n  | \"unauthenticated\"\n  | \"authenticated-free\"\n  | \"authenticated-team\"\n  | \"authenticated-enterprise\";\n\nexport function useCurrentUserType(): UserType {\n  const user = useCurrentUser();\n  if (user.currentUser == undefined) {\n    return \"unauthenticated\";\n  }\n\n  if (user.currentUser.org.isEnterprise) {\n    return \"authenticated-enterprise\";\n  }\n\n  if (user.currentUser.orgPaid === true) {\n    return \"authenticated-team\";\n  }\n\n  return \"authenticated-free\";\n}\n\n// ts-prune-ignore-next\nexport default CurrentUserContext;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext } from \"react\";\nimport { StoreApi, useStore } from \"zustand\";\n\nimport { useGuaranteedContext } from \"@foxglove/hooks\";\nimport {\n  ExtensionPanelRegistration,\n  Immutable,\n  RegisterMessageConverterArgs,\n} from \"@foxglove/studio\";\nimport { TopicAliasFunctions } from \"@foxglove/studio-base/players/TopicAliasingPlayer/aliasing\";\nimport { ExtensionInfo, ExtensionNamespace } from \"@foxglove/studio-base/types/Extensions\";\n\nexport type RegisteredPanel = {\n  extensionName: string;\n  extensionNamespace?: ExtensionNamespace;\n  registration: ExtensionPanelRegistration;\n};\n\nexport type ExtensionCatalog = Immutable<{\n  downloadExtension: (url: string) => Promise<Uint8Array>;\n  installExtension: (\n    namespace: ExtensionNamespace,\n    foxeFileData: Uint8Array,\n  ) => Promise<ExtensionInfo>;\n  refreshExtensions: () => Promise<void>;\n  uninstallExtension: (namespace: ExtensionNamespace, id: string) => Promise<void>;\n\n  installedExtensions: undefined | ExtensionInfo[];\n  installedPanels: undefined | Record<string, RegisteredPanel>;\n  installedMessageConverters: undefined | RegisterMessageConverterArgs<unknown>[];\n  installedTopicAliasFunctions: undefined | TopicAliasFunctions;\n}>;\n\nexport const ExtensionCatalogContext = createContext<undefined | StoreApi<ExtensionCatalog>>(\n  undefined,\n);\n\nexport function useExtensionCatalog<T>(\n  selector: (registry: ExtensionCatalog) => T,\n  equalityFn?: (a: T, b: T) => boolean,\n): T {\n  const context = useGuaranteedContext(ExtensionCatalogContext);\n  return useStore(context, selector, equalityFn);\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { ComponentType, createContext, useContext } from \"react\";\n\nimport { PanelStatics } from \"@foxglove/studio-base/components/Panel\";\nimport { ExtensionNamespace } from \"@foxglove/studio-base/types/Extensions\";\nimport { PanelConfig } from \"@foxglove/studio-base/types/panels\";\n\nexport type PanelComponent = ComponentType<{ childId?: string; tabId?: string }> &\n  PanelStatics<PanelConfig>;\n\nexport type PanelInfo = {\n  title: string;\n  type: string;\n  description?: string;\n  thumbnail?: string;\n  help?: React.ReactNode;\n\n  /** Set this to true if a panel has custom toolbar items and so cannot be renamed. */\n  hasCustomToolbar?: boolean;\n\n  /**\n   * The panel module is a function to load the panel.\n   * This is to support our lazy built-in panels\n   */\n  module: () => Promise<{ default: PanelComponent }>;\n  config?: PanelConfig;\n  relatedConfigs?: { [panelId: string]: PanelConfig };\n  preconfigured?: boolean;\n  extensionNamespace?: ExtensionNamespace;\n};\n\n/** PanelCatalog describes the interface for getting available panels */\nexport interface PanelCatalog {\n  /** get a list of the available panels */\n  getPanels(): readonly PanelInfo[];\n\n  /** Get panel information for a specific panel type (i.e. 3d, map, image, etc) */\n  getPanelByType(type: string): PanelInfo | undefined;\n}\n\nconst PanelCatalogContext = createContext<PanelCatalog | undefined>(undefined);\nPanelCatalogContext.displayName = \"PanelCatalogContext\";\n\nexport function usePanelCatalog(): PanelCatalog {\n  const panelCatalog = useContext(PanelCatalogContext);\n  if (!panelCatalog) {\n    throw new Error(\"A PanelCatalogContext provider is required to usePanelCatalog\");\n  }\n\n  return panelCatalog;\n}\n\nexport default PanelCatalogContext;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext } from \"react\";\nimport { StoreApi, useStore } from \"zustand\";\n\nimport { useGuaranteedContext } from \"@foxglove/hooks\";\nimport { Immutable, RenderState, SettingsTree } from \"@foxglove/studio\";\n\nexport type ImmutableSettingsTree = Immutable<SettingsTree>;\n\nexport type SharedPanelState = RenderState[\"sharedPanelState\"];\n\ntype PanelType = string;\n\nexport type PanelStateStore = {\n  /**\n   * Used for forcing remounts on panels to make panels reload their saved configs. This is necessary\n   * because panels are free to ignore updates to their config in the layout and maintain their own\n   * internal state but we need some way of overriding this and forcing the panel to remount.\n   */\n  sequenceNumbers: Record<string, number>;\n\n  /**\n   * Per-panel settings UI trees.\n   */\n  settingsTrees: Record<string, ImmutableSettingsTree | undefined>;\n\n  /** Per-panel default titles. */\n  defaultTitles: Record<string, string | undefined>;\n\n  /**\n   * Transient state shared between panels, keyed by panel type.\n   */\n  sharedPanelState: Record<PanelType, SharedPanelState>;\n\n  /**\n   * Increments the sequence number for the panel, forcing a remount.\n   */\n  incrementSequenceNumber: (panelId: string) => void;\n\n  /**\n   * Updates the settings UI for the given panel.\n   */\n  updateSettingsTree: (panelId: string, settingsTree: ImmutableSettingsTree | undefined) => void;\n\n  /** Updates the default title for the given panel. */\n  updateDefaultTitle: (panelId: string, title: string | undefined) => void;\n\n  /**\n   * Update the transient state associated with a particular panel type.\n   */\n  updateSharedPanelState: (type: PanelType, data: SharedPanelState) => void;\n};\n\nexport const PanelStateContext = createContext<undefined | StoreApi<PanelStateStore>>(undefined);\n\nexport function usePanelStateStore<T>(\n  selector: (store: PanelStateStore) => T,\n  equalityFn?: (a: T, b: T) => boolean,\n): T {\n  const context = useGuaranteedContext(PanelStateContext);\n  return useStore(context, selector, equalityFn);\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext, useContext } from \"react\";\n\nimport { LayoutData } from \"@foxglove/studio-base/context/CurrentLayoutContext/actions\";\nimport { Player, PlayerMetricsCollectorInterface } from \"@foxglove/studio-base/players/types\";\nimport { RegisteredIconNames } from \"@foxglove/studio-base/types/Icons\";\n\nexport type DataSourceFactoryInitializeArgs = {\n  metricsCollector: PlayerMetricsCollectorInterface;\n  file?: File;\n  files?: File[];\n  params?: Record<string, string | undefined>;\n};\n\nexport type DataSourceFactoryType = \"file\" | \"connection\" | \"sample\";\n\nexport type Field = {\n  id: string;\n  label: string;\n  defaultValue?: string;\n  placeholder?: string;\n  description?: string;\n\n  /**\n   * Optional validate function\n   *\n   * The function is called with a value and can return an Error if the value should\n   * be rejected. If the function returns `undefined`, then the value is accepted.\n   */\n  validate?: (value: string) => Error | undefined;\n};\n\nexport interface IDataSourceFactory {\n  id: string;\n\n  // A list of alternate ids used to identify this factory\n  // https://github.com/foxglove/studio/issues/4937\n  legacyIds?: string[];\n\n  type: DataSourceFactoryType;\n  displayName: string;\n  iconName?: RegisteredIconNames;\n  description?: string;\n  docsLinks?: { label?: string; url: string }[];\n  disabledReason?: string | JSX.Element;\n  badgeText?: string;\n  hidden?: boolean;\n  warning?: string | JSX.Element;\n\n  /** Whether to wait for a user to be logged in before initializing this source. */\n  currentUserRequired?: boolean;\n\n  sampleLayout?: LayoutData;\n\n  formConfig?: {\n    // Initialization args are populated with keys of the _id_ field\n    fields: Field[];\n  };\n\n  // If data source initialization supports \"Open File\" workflow, this property lists the supported\n  // file types\n  supportedFileTypes?: string[];\n\n  supportsMultiFile?: boolean;\n\n  // Initialize a player.\n  initialize: (args: DataSourceFactoryInitializeArgs) => Player | undefined;\n}\n\n/**\n * Recently selected source information\n *\n * The _id_ is opaque and up to the PlayerSelectionContext implementation.\n */\nexport type RecentSource = {\n  id: string;\n  title: string;\n  label?: string;\n};\n\n// File data sources accept either file instances or handles\ntype FileDataSourceArgs = {\n  type: \"file\";\n  files?: File[];\n  handle?: FileSystemFileHandle; // foxglove-depcheck-used: @types/wicg-file-system-access\n};\n\ntype ConnectionDataSourceArgs = {\n  type: \"connection\";\n  params?: Record<string, string | undefined>;\n};\n\nexport type DataSourceArgs = FileDataSourceArgs | ConnectionDataSourceArgs;\n\n/**\n * PlayerSelectionContext exposes the available data sources and a function to set the current data source\n */\nexport interface PlayerSelection {\n  selectSource: (sourceId: string, args?: DataSourceArgs) => void;\n  selectRecent: (recentId: string) => void;\n\n  /** Currently selected data source */\n  selectedSource?: IDataSourceFactory;\n\n  /** List of available data sources */\n  availableSources: IDataSourceFactory[];\n\n  /** Recently selected sources */\n  recentSources: RecentSource[];\n}\n\nconst PlayerSelectionContext = createContext<PlayerSelection>({\n  selectSource: () => {},\n  selectRecent: () => {},\n  selectedSource: undefined,\n  availableSources: [],\n  recentSources: [],\n});\nPlayerSelectionContext.displayName = \"PlayerSelectionContext\";\n\nexport function usePlayerSelection(): PlayerSelection {\n  return useContext(PlayerSelectionContext);\n}\n\nexport default PlayerSelectionContext;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { createContext, useCallback } from \"react\";\nimport { StoreApi, useStore } from \"zustand\";\n\nimport { useGuaranteedContext } from \"@foxglove/hooks\";\nimport { Immutable } from \"@foxglove/studio\";\nimport { TimelinePositionedEvent } from \"@foxglove/studio-base/context/EventsContext\";\nimport type { HoverValue } from \"@foxglove/studio-base/types/hoverValue\";\n\n/**\n * Represents the global bounds to which synced plots conform, including the id of the\n * component that set those bounds.\n */\nexport type SyncBounds = {\n  min: number;\n  max: number;\n  sourceId: string;\n  userInteraction: boolean;\n};\n\n/**\n * The TimelineInteractionStateStore manages state related to dynamic user interactions with data in the app.\n * Things like the hovered time value and global bounds for plots are managed here.\n */\nexport type TimelineInteractionStateStore = Immutable<{\n  /** The events overlapping the current hover time, if any. */\n  eventsAtHoverValue: Record<string, TimelinePositionedEvent>;\n\n  /** Shared time bounds for synced plots, if any. */\n  globalBounds: undefined | SyncBounds;\n\n  /** The event directly hovered over by the user, if any. */\n  hoveredEvent: undefined | TimelinePositionedEvent;\n\n  /** The point in time hovered over by the user. */\n  hoverValue: undefined | HoverValue;\n\n  /** Clears the current hover value. */\n  clearHoverValue: (componentId: string) => void;\n\n  /** Sets the events overlapping the current hover time. */\n  setEventsAtHoverValue: (events: TimelinePositionedEvent[]) => void;\n\n  /** Sets new global bounds. */\n  setGlobalBounds: (\n    newBounds:\n      | undefined\n      | SyncBounds\n      | ((oldValue: undefined | SyncBounds) => undefined | SyncBounds),\n  ) => void;\n\n  /** Sets or clears the directly hovered event. */\n  setHoveredEvent: (hoveredEvent: undefined | TimelinePositionedEvent) => void;\n\n  /** Sets the new hover value. */\n  setHoverValue: (value: HoverValue) => void;\n}>;\n\nexport const TimelineInteractionStateContext = createContext<\n  undefined | StoreApi<TimelineInteractionStateStore>\n>(undefined);\nconst selectClearHoverValue = (store: TimelineInteractionStateStore) => store.clearHoverValue;\n\nexport function useClearHoverValue(): TimelineInteractionStateStore[\"clearHoverValue\"] {\n  return useTimelineInteractionState(selectClearHoverValue);\n}\n\nconst selectSetHoverValue = (store: TimelineInteractionStateStore) => {\n  return store.setHoverValue;\n};\n\nexport function useSetHoverValue(): TimelineInteractionStateStore[\"setHoverValue\"] {\n  return useTimelineInteractionState(selectSetHoverValue);\n}\n\n/**\n * Encapsulates logic for selecting the current hover value depending\n * on which component registered the hover value.\n */\nexport function useHoverValue(args?: {\n  componentId: string;\n  isTimestampScale: boolean;\n}): HoverValue | undefined {\n  const hasArgs = !!args;\n  const componentId = args?.componentId;\n  const isTimestampScale = args?.isTimestampScale ?? false;\n\n  const selector = useCallback(\n    (store: TimelineInteractionStateStore) => {\n      if (!hasArgs) {\n        // Raw form -- user needs to check that the value should be shown.\n        return store.hoverValue;\n      }\n      if (store.hoverValue == undefined) {\n        return undefined;\n      }\n      if (store.hoverValue.type === \"PLAYBACK_SECONDS\" && isTimestampScale) {\n        // Always show playback-time hover values for timestamp-based charts.\n        return store.hoverValue;\n      }\n      // Otherwise just show hover bars when hovering over the panel itself.\n      return store.hoverValue.componentId === componentId ? store.hoverValue : undefined;\n    },\n    [hasArgs, componentId, isTimestampScale],\n  );\n\n  return useTimelineInteractionState(selector);\n}\n\n/**\n * This hook wraps all access to the interaction state store. Pass selectors\n * to access parts of the store.\n */\nexport function useTimelineInteractionState<T>(\n  selector: (store: TimelineInteractionStateStore) => T,\n  equalityFn?: (a: T, b: T) => boolean,\n): T {\n  const context = useGuaranteedContext(TimelineInteractionStateContext);\n  return useStore(context, selector, equalityFn);\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext, useCallback, useState } from \"react\";\n\nimport { useShallowMemo, useGuaranteedContext } from \"@foxglove/hooks\";\nimport { generateEmptyTypesLib } from \"@foxglove/studio-base/players/UserNodePlayer/nodeTransformerWorker/generateTypesLib\";\nimport { ros_lib_dts } from \"@foxglove/studio-base/players/UserNodePlayer/nodeTransformerWorker/typescript/ros\";\nimport { Diagnostic, UserNodeLog } from \"@foxglove/studio-base/players/UserNodePlayer/types\";\n\ntype UserNodeState = {\n  rosLib: string;\n  typesLib: string;\n  nodeStates: {\n    [nodeId: string]: {\n      diagnostics: readonly Diagnostic[];\n      logs: readonly UserNodeLog[];\n    };\n  };\n};\n\nexport const UserNodeStateContext = createContext<\n  | {\n      state: UserNodeState;\n      setUserNodeDiagnostics: (nodeId: string, diagnostics: readonly Diagnostic[]) => void;\n      addUserNodeLogs: (nodeId: string, logs: readonly UserNodeLog[]) => void;\n      clearUserNodeLogs: (nodeId: string) => void;\n      setUserNodeRosLib: (rosLib: string) => void;\n      setUserNodeTypesLib: (lib: string) => void;\n    }\n  | undefined\n>(undefined);\nUserNodeStateContext.displayName = \"UserNodeStateContext\";\n\nexport function UserNodeStateProvider({ children }: React.PropsWithChildren<unknown>): JSX.Element {\n  const [state, setState] = useState<UserNodeState>({\n    rosLib: ros_lib_dts,\n    typesLib: generateEmptyTypesLib(),\n    nodeStates: {},\n  });\n\n  const setUserNodeDiagnostics = useCallback(\n    (nodeId: string, diagnostics: readonly Diagnostic[]) => {\n      setState((prevState) => ({\n        ...prevState,\n        nodeStates: {\n          ...prevState.nodeStates,\n          [nodeId]: {\n            logs: [],\n            ...prevState.nodeStates[nodeId],\n            diagnostics, // replace diagnostics\n          },\n        },\n      }));\n    },\n    [],\n  );\n\n  const addUserNodeLogs = useCallback((nodeId: string, logs: readonly UserNodeLog[]) => {\n    setState((prevState) => ({\n      ...prevState,\n      nodeStates: {\n        ...prevState.nodeStates,\n        [nodeId]: {\n          diagnostics: [],\n          ...prevState.nodeStates[nodeId],\n          logs: (prevState.nodeStates[nodeId]?.logs ?? []).concat(logs), // add logs\n        },\n      },\n    }));\n  }, []);\n\n  const clearUserNodeLogs = useCallback((nodeId: string) => {\n    setState((prevState) => ({\n      ...prevState,\n      nodeStates: {\n        ...prevState.nodeStates,\n        [nodeId]: {\n          diagnostics: [],\n          ...prevState.nodeStates[nodeId],\n          logs: [], // clear logs\n        },\n      },\n    }));\n  }, []);\n\n  const setUserNodeRosLib = useCallback((rosLib: string) => {\n    setState((prevState) => ({ ...prevState, rosLib }));\n  }, []);\n\n  const setUserNodeTypesLib = useCallback((typesLib: string) => {\n    setState((prevState) => ({ ...prevState, typesLib }));\n  }, []);\n\n  const value = useShallowMemo({\n    state,\n    setUserNodeDiagnostics,\n    addUserNodeLogs,\n    clearUserNodeLogs,\n    setUserNodeRosLib,\n    setUserNodeTypesLib,\n  });\n\n  return <UserNodeStateContext.Provider value={value}>{children}</UserNodeStateContext.Provider>;\n}\n\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\nexport function useUserNodeState() {\n  return useGuaranteedContext(UserNodeStateContext, \"UserNodeStateContext\");\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext } from \"react\";\nimport { StoreApi, useStore } from \"zustand\";\n\nimport { useGuaranteedContext } from \"@foxglove/hooks\";\nimport { AppSettingsTab } from \"@foxglove/studio-base/components/AppSettingsDialog/AppSettingsDialog\";\nimport { DataSourceDialogItem } from \"@foxglove/studio-base/components/DataSourceDialog\";\nimport { IDataSourceFactory } from \"@foxglove/studio-base/context/PlayerSelectionContext\";\n\nexport const SidebarItemKeys = [\n  \"account\",\n  \"add-panel\",\n  \"app-bar-tour\",\n  \"app-settings\",\n  \"connection\",\n  \"extensions\",\n  \"help\",\n  \"layouts\",\n  \"panel-settings\",\n  \"studio-logs-settings\",\n  \"variables\",\n] as const;\nexport type SidebarItemKey = (typeof SidebarItemKeys)[number];\n\nexport const LeftSidebarItemKeys = [\"panel-settings\", \"topics\", \"problems\"] as const;\nexport type LeftSidebarItemKey = (typeof LeftSidebarItemKeys)[number];\n\nexport const RightSidebarItemKeys = [\"events\", \"variables\", \"studio-logs-settings\"] as const;\nexport type RightSidebarItemKey = (typeof RightSidebarItemKeys)[number];\n\nexport type WorkspaceContextStore = {\n  dialogs: {\n    dataSource: {\n      activeDataSource: undefined | IDataSourceFactory;\n      item: undefined | DataSourceDialogItem;\n      open: boolean;\n    };\n    preferences: {\n      initialTab: undefined | AppSettingsTab;\n      open: boolean;\n    };\n  };\n  featureTours: {\n    active: undefined | string;\n    shown: string[];\n  };\n  playbackControls: {\n    repeat: boolean;\n  };\n  sidebars: {\n    legacy: {\n      item: undefined | SidebarItemKey;\n    };\n    left: {\n      item: undefined | LeftSidebarItemKey;\n      open: boolean;\n      size: undefined | number;\n    };\n    right: {\n      item: undefined | RightSidebarItemKey;\n      open: boolean;\n      size: undefined | number;\n    };\n  };\n};\n\nexport const WorkspaceContext = createContext<undefined | StoreApi<WorkspaceContextStore>>(\n  undefined,\n);\n\nWorkspaceContext.displayName = \"WorkspaceContext\";\n\nexport const WorkspaceStoreSelectors = {\n  selectPanelSettingsOpen: (store: WorkspaceContextStore): boolean => {\n    return (\n      store.sidebars.legacy.item === \"panel-settings\" ||\n      (store.sidebars.left.open && store.sidebars.left.item === \"panel-settings\")\n    );\n  },\n};\n\n/**\n * Fetches values from the workspace store.\n */\nexport function useWorkspaceStore<T>(\n  selector: (store: WorkspaceContextStore) => T,\n  equalityFn?: (a: T, b: T) => boolean,\n): T {\n  const context = useGuaranteedContext(WorkspaceContext);\n  return useStore(context, selector, equalityFn);\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\n/**\n * A wrapper around window.showOpenFilePicker that returns an empty array instead of throwing when\n * the user cancels the file picker.\n */\nexport default async function showOpenFilePicker(\n  options?: OpenFilePickerOptions,\n): Promise<FileSystemFileHandle[] /* foxglove-depcheck-used: @types/wicg-file-system-access */> {\n  try {\n    // return await window.showOpenFilePicker(options);\n    window.document.getElementById(\"studio-file-input\")?.remove();\n    let input = window.document.createElement(\"input\");\n    input.type = \"file\";\n    input.id = \"studio-file-input\";\n    input.style.display = \"none\";\n    if (options?.types) {\n      input.accept = options.types.map((type) => type.accept?.[\"application/octet-stream\"]).join(\",\");\n    }\n    window.document.body.appendChild(input);\n\n    input = window.document.getElementById(\"studio-file-input\") as HTMLInputElement;\n    input.click();\n    const files = await new Promise<FileList>((resolve, reject) => {\n      input.onchange = () => {\n        if (!input.files) {\n          reject(new Error(\"No files selected\"));\n          return;\n        }\n        resolve(input.files);\n      }\n    });\n    return Array.from(files).map(file => {\n      // @ts-ignore\n      return {\n        getFile: async () => file,\n        kind: \"file\",\n        name: file.name,\n        isDirectory: false,\n        isFile: true,\n        createSyncAccessHandle: () => Promise.resolve(),\n        isSameEntry: () => false,\n        queryPermission: () => Promise.resolve(\"granted\"),\n        requestPermission: () => Promise.resolve(\"granted\"),\n        removeEntry: () => Promise.resolve(),\n        createWritable: () => Promise.resolve({\n          write: async (data: any) => {\n            const blob = new Blob([data]);\n            const url = URL.createObjectURL(blob);\n            const a = document.createElement(\"a\");\n            a.href = url;\n            a.download = file.name;\n            a.click();\n            URL.revokeObjectURL(url);\n          },\n          close: () => Promise.resolve(),\n          seek: () => Promise.resolve(),\n          truncate: () => Promise.resolve(),\n          locked: false,\n          abort: () => Promise.resolve(),\n          getWriter: () => Promise.resolve(),\n        }),\n      } as FileSystemFileHandle;\n    });\n\n  } catch (err) {\n    if (err.name === \"AbortError\") {\n      return [];\n    }\n    throw err;\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport path from \"path\";\nimport { useCallback, useMemo } from \"react\";\n\nimport {\n  IDataSourceFactory,\n  usePlayerSelection,\n} from \"@foxglove/studio-base/context/PlayerSelectionContext\";\nimport showOpenFilePicker from \"@foxglove/studio-base/util/showOpenFilePicker\";\n\nexport function useOpenFile(sources: IDataSourceFactory[]): () => Promise<void> {\n  const { selectSource } = usePlayerSelection();\n\n  const allExtensions = useMemo(() => {\n    return sources.reduce((all, source) => {\n      if (!source.supportedFileTypes) {\n        return all;\n      }\n\n      return [...all, ...source.supportedFileTypes];\n    }, [] as string[]);\n  }, [sources]);\n\n  return useCallback(async () => {\n    const [fileHandle] = await showOpenFilePicker({\n      types: [\n        {\n          description: allExtensions.join(\", \"),\n          accept: { \"application/octet-stream\": allExtensions },\n        },\n      ],\n    });\n    if (!fileHandle) {\n      return;\n    }\n\n    const file = await fileHandle.getFile();\n    // Find the first _file_ source which can load our extension\n    const matchingSources = sources.filter((source) => {\n      // Only consider _file_ type sources that have a list of supported file types\n      if (!source.supportedFileTypes || source.type !== \"file\") {\n        return false;\n      }\n\n      const extension = path.extname(file.name);\n      return source.supportedFileTypes.includes(extension);\n    });\n\n    if (matchingSources.length > 1) {\n      throw new Error(`Multiple source matched ${file.name}. This is not supported.`);\n    }\n\n    const foundSource = matchingSources[0];\n    if (!foundSource) {\n      throw new Error(`Cannot find source to handle ${file.name}`);\n    }\n\n    selectSource(foundSource.id, { type: \"file\", handle: fileHandle });\n  }, [allExtensions, selectSource, sources]);\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Draft, produce } from \"immer\";\nimport { union } from \"lodash\";\nimport { Dispatch, SetStateAction, useCallback, useMemo } from \"react\";\n\nimport { useGuaranteedContext } from \"@foxglove/hooks\";\nimport { AppSettingsTab } from \"@foxglove/studio-base/components/AppSettingsDialog/AppSettingsDialog\";\nimport { DataSourceDialogItem } from \"@foxglove/studio-base/components/DataSourceDialog\";\nimport { useCurrentUser } from \"@foxglove/studio-base/context/CurrentUserContext\";\nimport {\n  IDataSourceFactory,\n  usePlayerSelection,\n} from \"@foxglove/studio-base/context/PlayerSelectionContext\";\n\nimport {\n  WorkspaceContext,\n  WorkspaceContextStore,\n  SidebarItemKey,\n  LeftSidebarItemKey,\n  LeftSidebarItemKeys,\n  RightSidebarItemKey,\n  RightSidebarItemKeys,\n} from \"./WorkspaceContext\";\nimport { useOpenFile } from \"./useOpenFile\";\n\nexport type WorkspaceActions = {\n  dialogActions: {\n    dataSource: {\n      close: () => void;\n      open: (item: DataSourceDialogItem, dataSource?: IDataSourceFactory) => void;\n    };\n    openFile: {\n      open: () => Promise<void>;\n    };\n    preferences: {\n      close: () => void;\n      open: (initialTab?: AppSettingsTab) => void;\n    };\n  };\n\n  featureTourActions: {\n    startTour: (tour: string) => void;\n    finishTour: (tour: string) => void;\n  };\n\n  openAccountSettings: () => void;\n  openPanelSettings: () => void;\n  openLayoutBrowser: () => void;\n\n  playbackControlActions: {\n    setRepeat: Dispatch<SetStateAction<boolean>>;\n  };\n\n  sidebarActions: {\n    legacy: {\n      selectItem: (selectedSidebarItem: undefined | SidebarItemKey) => void;\n    };\n    left: {\n      selectItem: (item: undefined | LeftSidebarItemKey) => void;\n      setOpen: Dispatch<SetStateAction<boolean>>;\n      setSize: (size: undefined | number) => void;\n    };\n    right: {\n      selectItem: (item: undefined | RightSidebarItemKey) => void;\n      setOpen: Dispatch<SetStateAction<boolean>>;\n      setSize: (size: undefined | number) => void;\n    };\n  };\n};\n\nexport function setterValue<T>(action: SetStateAction<T>, value: T): T {\n  if (action instanceof Function) {\n    return action(value);\n  }\n\n  return action;\n}\n\n/**\n * Provides various actions to manipulate the workspace state.\n */\nexport function useWorkspaceActions(): WorkspaceActions {\n  const { setState } = useGuaranteedContext(WorkspaceContext);\n\n  const { signIn } = useCurrentUser();\n  const supportsAccountSettings = signIn != undefined;\n\n  const { availableSources } = usePlayerSelection();\n\n  const openFile = useOpenFile(availableSources);\n\n  const set = useCallback(\n    (setter: (draft: Draft<WorkspaceContextStore>) => void) => {\n      setState(produce<WorkspaceContextStore>(setter));\n    },\n    [setState],\n  );\n\n  return useMemo(() => {\n    return {\n      dialogActions: {\n        dataSource: {\n          close: () => {\n            set((draft) => {\n              draft.dialogs.dataSource = {\n                activeDataSource: undefined,\n                item: undefined,\n                open: false,\n              };\n            });\n          },\n\n          open: (\n            selectedDataSourceDialogItem: DataSourceDialogItem,\n            dataSource?: IDataSourceFactory,\n          ) => {\n            set((draft) => {\n              // This cast is necessary to keep typescript from complaining about type depth.\n              (draft as WorkspaceContextStore).dialogs.dataSource.activeDataSource = dataSource;\n              draft.dialogs.dataSource.item = selectedDataSourceDialogItem;\n              draft.dialogs.dataSource.open = true;\n            });\n          },\n        },\n\n        openFile: {\n          open: openFile,\n        },\n\n        preferences: {\n          close: () =>\n            set((draft) => {\n              draft.dialogs.preferences = { open: false, initialTab: undefined };\n            }),\n          open: (initialTab?: AppSettingsTab) => {\n            set((draft) => {\n              draft.dialogs.preferences = { open: true, initialTab };\n            });\n          },\n        },\n      },\n\n      featureTourActions: {\n        startTour: (tour: string) => {\n          set((draft) => {\n            draft.featureTours.active = tour;\n          });\n        },\n        finishTour: (tour: string) => {\n          set((draft) => {\n            draft.featureTours.active = undefined;\n            draft.featureTours.shown = union(draft.featureTours.shown, [tour]);\n          });\n        },\n      },\n\n      openAccountSettings: () =>\n        supportsAccountSettings &&\n        set((draft) => {\n          draft.sidebars.legacy.item = \"account\";\n        }),\n\n      openPanelSettings: () =>\n        set((draft) => {\n          draft.sidebars.left.item = \"panel-settings\";\n          draft.sidebars.left.open = true;\n        }),\n\n      openLayoutBrowser: () =>\n        set((draft) => {\n          draft.sidebars.legacy.item = \"layouts\";\n        }),\n\n      playbackControlActions: {\n        setRepeat: (setter: SetStateAction<boolean>) => {\n          set((draft) => {\n            const repeat = setterValue(setter, draft.playbackControls.repeat);\n            draft.playbackControls.repeat = repeat;\n          });\n        },\n      },\n\n      sidebarActions: {\n        legacy: {\n          selectItem: (selectedSidebarItem: undefined | SidebarItemKey) => {\n            if (selectedSidebarItem === \"app-settings\") {\n              set((draft) => {\n                draft.dialogs.preferences = { open: true, initialTab: undefined };\n              });\n            } else if (selectedSidebarItem === \"app-bar-tour\") {\n              set((draft) => {\n                draft.featureTours.active = \"appBar\";\n              });\n            } else {\n              set((draft) => {\n                draft.sidebars.legacy.item = selectedSidebarItem;\n              });\n            }\n          },\n        },\n        left: {\n          selectItem: (selectedLeftSidebarItem: undefined | LeftSidebarItemKey) => {\n            set((draft) => {\n              draft.sidebars.left.item = selectedLeftSidebarItem;\n              draft.sidebars.left.open = selectedLeftSidebarItem != undefined;\n            });\n          },\n\n          setOpen: (setter: SetStateAction<boolean>) => {\n            set((draft) => {\n              const leftSidebarOpen = setterValue(setter, draft.sidebars.left.open);\n              if (leftSidebarOpen) {\n                const oldItem = LeftSidebarItemKeys.find(\n                  (item) => item === draft.sidebars.left.item,\n                );\n                draft.sidebars.left.open = leftSidebarOpen;\n                draft.sidebars.left.item = oldItem ?? \"panel-settings\";\n              } else {\n                draft.sidebars.left.open = false;\n              }\n            });\n          },\n\n          setSize: (leftSidebarSize: undefined | number) =>\n            set((draft) => {\n              draft.sidebars.left.size = leftSidebarSize;\n            }),\n        },\n        right: {\n          selectItem: (selectedRightSidebarItem: undefined | RightSidebarItemKey) => {\n            set((draft) => {\n              draft.sidebars.right.item = selectedRightSidebarItem;\n              draft.sidebars.right.open = selectedRightSidebarItem != undefined;\n            });\n          },\n\n          setOpen: (setter: SetStateAction<boolean>) => {\n            set((draft) => {\n              const rightSidebarOpen = setterValue(setter, draft.sidebars.right.open);\n              const oldItem = RightSidebarItemKeys.find(\n                (item) => item === draft.sidebars.right.item,\n              );\n              if (rightSidebarOpen) {\n                draft.sidebars.right.open = rightSidebarOpen;\n                draft.sidebars.right.item = oldItem ?? \"variables\";\n              } else {\n                draft.sidebars.right.open = false;\n              }\n            });\n          },\n\n          setSize: (rightSidebarSize: undefined | number) =>\n            set((draft) => {\n              draft.sidebars.right.size = rightSidebarSize;\n            }),\n        },\n      },\n    };\n  }, [openFile, set, supportsAccountSettings]);\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport moment from \"moment-timezone\";\nimport { useCallback, useMemo } from \"react\";\n\nimport { Time } from \"@foxglove/studio\";\nimport { AppSetting } from \"@foxglove/studio-base/AppSetting\";\nimport { TimeDisplayMethod } from \"@foxglove/studio-base/types/panels\";\nimport { formatDate, formatTime } from \"@foxglove/studio-base/util/formatTime\";\nimport { formatTimeRaw } from \"@foxglove/studio-base/util/time\";\n\nimport { useAppConfigurationValue } from \"./useAppConfigurationValue\";\n\nexport interface IAppTimeFormat {\n  formatDate: (date: Time) => string;\n  formatTime: (stamp: Time) => string;\n  formatDuration: (duration: Time) => string;\n  timeFormat: TimeDisplayMethod;\n  setTimeFormat: (format: TimeDisplayMethod) => Promise<void>;\n  timeZone: string | undefined;\n}\n\nexport function useAppTimeFormat(): IAppTimeFormat {\n  const [timeFormat, setTimeFormat] = useAppConfigurationValue<string>(AppSetting.TIME_FORMAT);\n  const [timeZone] = useAppConfigurationValue<string>(AppSetting.TIMEZONE);\n\n  const effectiveFormat: TimeDisplayMethod = useMemo(\n    () => (timeFormat === \"SEC\" ? \"SEC\" : \"TOD\"),\n    [timeFormat],\n  );\n\n  const formatDateCallback = useCallback(\n    (date: Time) => {\n      return formatDate(date, timeZone);\n    },\n    [timeZone],\n  );\n\n  const formatTimeCallback = useCallback(\n    (stamp: Time) => {\n      if (effectiveFormat === \"TOD\") {\n        return formatTime(stamp, timeZone);\n      } else {\n        return formatTimeRaw(stamp);\n      }\n    },\n    [effectiveFormat, timeZone],\n  );\n\n  const formatDurationCallback = useCallback(\n    (duration: Time) => {\n      if (effectiveFormat === \"TOD\") {\n        return (\n          moment.duration(duration.sec * 1e3).format(\"h:mm:ss\", { trim: false }) +\n          `.${duration.nsec}`\n        );\n      } else {\n        return formatTimeRaw(duration);\n      }\n    },\n    [effectiveFormat],\n  );\n\n  return {\n    formatDate: formatDateCallback,\n    formatTime: formatTimeCallback,\n    formatDuration: formatDurationCallback,\n    setTimeFormat,\n    timeFormat: effectiveFormat,\n    timeZone,\n  };\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\nimport { useCallback, useEffect, useState } from \"react\";\n\nimport {\n  AppConfigurationValue,\n  useAppConfiguration,\n} from \"@foxglove/studio-base/context/AppConfigurationContext\";\n\n/**\n * Load a value from app configuration and provide a function to change it\n * This function behaves similarly to useState for a given app configuration key.\n */\nexport function useAppConfigurationValue<T extends AppConfigurationValue>(\n  key: string,\n): [value: T | undefined, setter: (value?: T) => Promise<void>] {\n  const appConfiguration = useAppConfiguration();\n\n  const [configurationValue, setConfigurationValue] = useState<T | undefined>(() => {\n    const val = appConfiguration.get(key) as T | undefined;\n    // coerce empty strings into undefined\n    if (typeof val === \"string\" && val.length === 0) {\n      return undefined;\n    }\n    return val;\n  });\n\n  useEffect(() => {\n    const handler = (val: unknown) => {\n      setConfigurationValue(val as T);\n    };\n\n    appConfiguration.addChangeListener(key, handler);\n    return () => appConfiguration.removeChangeListener(key, handler);\n  }, [key, appConfiguration]);\n\n  const wrappedSetter = useCallback(\n    async (value?: T) => {\n      setConfigurationValue(value);\n      return await appConfiguration.set(key, value);\n    },\n    [appConfiguration, key],\n  );\n\n  return [configurationValue, wrappedSetter];\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport type { VariableValue } from \"@foxglove/studio\";\nimport {\n  LayoutState,\n  useCurrentLayoutActions,\n  useCurrentLayoutSelector,\n} from \"@foxglove/studio-base/context/CurrentLayoutContext\";\n\nexport type GlobalVariables = { [key: string]: VariableValue };\n\nexport const EMPTY_GLOBAL_VARIABLES: GlobalVariables = Object.freeze({});\n\nconst globalVariablesSelector = (state: LayoutState) =>\n  state.selectedLayout?.data?.globalVariables ?? EMPTY_GLOBAL_VARIABLES;\n\nexport default function useGlobalVariables(): {\n  globalVariables: GlobalVariables;\n  setGlobalVariables: (arg0: GlobalVariables) => void;\n  overwriteGlobalVariables: (arg0: GlobalVariables) => void;\n} {\n  const { setGlobalVariables, overwriteGlobalVariables } = useCurrentLayoutActions();\n  const globalVariables = useCurrentLayoutSelector(globalVariablesSelector);\n  return { setGlobalVariables, overwriteGlobalVariables, globalVariables };\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { useRef } from \"react\";\n\n// Call _warn_ if a given value changes twice within 200 ms\nexport default function useShouldNotChangeOften<T>(value: T, warn: () => void): T {\n  const prev = useRef(value);\n  const prevPrev = useRef(value);\n  const lastTime = useRef<number>(Date.now());\n  if (\n    value !== prev.current &&\n    prev.current !== prevPrev.current &&\n    Date.now() - lastTime.current < 200\n  ) {\n    warn();\n  }\n  prevPrev.current = prev.current;\n  prev.current = value;\n  lastTime.current = Date.now();\n  return value;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext, useContext } from \"react\";\n\n// by default, modal dialogs are appended to the document body\n// providing a value to this context will instead cause modals\n// to be appended to the DOM node whose id matches the provided value\nconst DialogHostIdContext = createContext<string | undefined>(undefined);\nDialogHostIdContext.displayName = \"DialogHostIdContext\";\n\nfunction useDialogHostId(): string | undefined {\n  return useContext(DialogHostIdContext);\n}\n\nexport { useDialogHostId };\nexport default DialogHostIdContext;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { GlobalStyles, useTheme } from \"@mui/material\";\n\n/** GlobalCss component configures html, body, and #root with theme elements */\nexport default function GlobalCss(): JSX.Element {\n  const theme = useTheme();\n\n  return (\n    <GlobalStyles\n      styles={{\n        \"html, body\": {\n          boxSizing: \"border-box\",\n          margin: 0,\n          padding: 0,\n          height: \"100%\",\n          width: \"100%\",\n\n          // https://github.com/necolas/normalize.css/blob/master/normalize.css#L12\n          lineHeight: 1.15,\n        },\n        \"*, *:before, *:after\": {\n          boxSizing: \"inherit\",\n        },\n        body: {\n          background: theme.palette.background.default,\n          color: theme.palette.text.primary,\n          font: \"inherit\",\n          fontFamily: theme.typography.body2.fontFamily,\n          fontFeatureSettings: theme.typography.body2.fontFeatureSettings,\n          fontSize: theme.typography.body2.fontSize,\n          fontWeight: theme.typography.body2.fontWeight,\n\n          // Prevent scroll \"bouncing\" since the app workspace is not scrollable. Allows individual\n          // scrollable elements to be scrolled without the whole page moving (even if they don't\n          // preventDefault on scroll events).\n          overscrollBehavior: \"none\",\n        },\n        \"#root\": {\n          height: \"100%\",\n          width: \"100%\",\n          display: \"flex\",\n          flexDirection: \"column\",\n          position: \"relative\",\n          flex: \"1 1 100%\",\n          outline: \"none\",\n          overflow: \"hidden\",\n          zIndex: 0,\n        },\n      }}\n    />\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext } from \"react\";\nimport { AsyncState } from \"react-use/lib/useAsyncFn\";\nimport { StoreApi, useStore } from \"zustand\";\n\nimport { useGuaranteedContext } from \"@foxglove/hooks\";\nimport { Time } from \"@foxglove/rostime\";\nimport { Immutable } from \"@foxglove/studio\";\n\n/**\n * DataSourceEvent representings a single event within a data source.\n */\nexport type DataSourceEvent = {\n  id: string;\n  createdAt: string;\n  deviceId: string;\n  durationNanos: string;\n  endTime: Time;\n  endTimeInSeconds: number;\n  metadata: Record<string, string>;\n  startTime: Time;\n  startTimeInSeconds: number;\n  timestampNanos: string;\n  updatedAt: string;\n};\n\n/**\n * Represents an event including its fractional position on the timeline.\n */\nexport type TimelinePositionedEvent = {\n  /** The event. */\n  event: DataSourceEvent;\n\n  /** The end position of the event, as a value 0-1 relative to the timeline. */\n  endPosition: number;\n\n  /** The start position of the event, as a value 0-1 relative to the timeline. */\n  startPosition: number;\n\n  /** The time, in seconds, relative to the start of the timeline. */\n  secondsSinceStart: number;\n};\n\nexport type EventsStore = Immutable<{\n  /** Used to signal event refreshes. */\n  eventFetchCount: number;\n\n  /** Whether events are supported for the currently loaded source. */\n  eventsSupported: boolean;\n\n  /** Fetched events for this session. */\n  events: AsyncState<TimelinePositionedEvent[]>;\n\n  /** The current event filter expression. */\n  filter: string;\n\n  /** The currently selected event, if any. */\n  selectedEventId: undefined | string;\n\n  /** The active device under which new events should be created. */\n  deviceId: string | undefined;\n\n  /** Refreshes events from api. */\n  refreshEvents: () => void;\n\n  /** Select an event by id or clear the selection. */\n  selectEvent: (id: undefined | string) => void;\n\n  /** Set the fetched events. */\n  setEvents: (events: AsyncState<TimelinePositionedEvent[]>) => void;\n\n  /** Set the flag indicating support for events. */\n  // eslint-disable-next-line @foxglove/no-boolean-parameters\n  setEventsSupported: (supported: boolean) => void;\n\n  /** Update the current filter expression. */\n  setFilter: (filter: string) => void;\n\n  /** Set the active device. */\n  setDeviceId: (deviceId: string | undefined) => void;\n}>;\n\nexport const EventsContext = createContext<undefined | StoreApi<EventsStore>>(undefined);\n\nexport function useEvents<T>(\n  selector: (store: EventsStore) => T,\n  equalityFn?: (a: T, b: T) => boolean,\n): T {\n  const context = useGuaranteedContext(EventsContext);\n  return useStore(context, selector, equalityFn);\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { ReactNode, useState } from \"react\";\nimport { AsyncState } from \"react-use/lib/useAsyncFn\";\nimport { createStore } from \"zustand\";\n\nimport {\n  EventsContext,\n  EventsStore,\n  TimelinePositionedEvent,\n} from \"@foxglove/studio-base/context/EventsContext\";\n\nconst NO_EVENTS: TimelinePositionedEvent[] = [];\n\nfunction createEventsStore() {\n  return createStore<EventsStore>((set) => ({\n    eventFetchCount: 0,\n    events: { loading: false, value: NO_EVENTS },\n    filter: \"\",\n    selectedEventId: undefined,\n    eventsSupported: false,\n    deviceId: undefined,\n\n    refreshEvents: () => set((old) => ({ eventFetchCount: old.eventFetchCount + 1 })),\n    selectEvent: (id: undefined | string) => set({ selectedEventId: id }),\n    setEvents: (events: AsyncState<TimelinePositionedEvent[]>) =>\n      set({ events, selectedEventId: undefined }),\n    setFilter: (filter: string) => set({ filter }),\n    // eslint-disable-next-line @foxglove/no-boolean-parameters\n    setEventsSupported: (eventsSupported: boolean) => set({ eventsSupported }),\n    setDeviceId: (deviceId: string | undefined) => set({ deviceId }),\n  }));\n}\n\nexport default function EventsProvider({ children }: { children?: ReactNode }): JSX.Element {\n  const [store] = useState(createEventsStore);\n\n  return <EventsContext.Provider value={store}>{children}</EventsContext.Provider>;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext } from \"react\";\nimport { StoreApi, useStore } from \"zustand\";\n\nimport { useGuaranteedContext } from \"@foxglove/hooks\";\nimport { LogLevel } from \"@foxglove/log\";\n\ntype StudioLogConfigChannel = { name: string; enabled: boolean };\n\ninterface IStudioLogsSettings {\n  readonly globalLevel: LogLevel;\n\n  readonly channels: ReadonlyArray<{ name: string; enabled: boolean }>;\n\n  // Enable/disable a channel. Name is the full name of the channel.\n  enableChannel(name: string): void;\n  disableChannel(name: string): void;\n\n  // Enable/disable an entire prefix. Any channels with a name starting with the prefix will be toggled\n  enablePrefix(prefix: string): void;\n  disablePrefix(prefix: string): void;\n\n  // Set the global log level for all channels\n  // This does not affect whether a channel is enabled or disabled\n  setGlobalLevel(level: LogLevel): void;\n}\n\nconst StudioLogsSettingsContext = createContext<undefined | StoreApi<IStudioLogsSettings>>(\n  undefined,\n);\n\nfunction useStudioLogsSettings(): IStudioLogsSettings {\n  const context = useGuaranteedContext(StudioLogsSettingsContext);\n  return useStore(context);\n}\n\nexport { StudioLogsSettingsContext, useStudioLogsSettings };\nexport type { IStudioLogsSettings, StudioLogConfigChannel };\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createStore, StoreApi } from \"zustand\";\n\nimport Log, { Logger, LogLevel, toLogLevel } from \"@foxglove/log\";\nimport {\n  IStudioLogsSettings,\n  StudioLogConfigChannel,\n} from \"@foxglove/studio-base/context/StudioLogsSettingsContext\";\n\nimport { LocalStorageSaveState } from \"./types\";\n\nconst log = Log.getLogger(__filename);\n\nconst defaultGlobalLevel: LogLevel = process.env.NODE_ENV === \"development\" ? \"debug\" : \"warn\";\n\nfunction createStudioLogsSettingsStore(\n  initialState?: LocalStorageSaveState,\n): StoreApi<IStudioLogsSettings> {\n  const globalLevel = toLogLevel(initialState?.globalLevel ?? defaultGlobalLevel);\n  const disabledChannels = initialState?.disabledChannels ?? [];\n\n  log.debug(`Initializing log Config. ${disabledChannels.length} disabled channels.`);\n  const channels: StudioLogConfigChannel[] = [];\n\n  // Lookup channel by name, there might be multiple channels that use the same name\n  const channelByName = new Map<string, Logger[]>();\n\n  const sortedChannels = Log.channels().sort((a, b) => a.name().localeCompare(b.name()));\n\n  for (const channel of sortedChannels) {\n    const name = channel.name() ? channel.name() : \"<root>\";\n\n    if (disabledChannels.includes(name)) {\n      channel.setLevel(\"warn\");\n    } else {\n      channel.setLevel(globalLevel);\n    }\n\n    // enabled means the channel meets at least the global logging level?\n    // if the channel is greater than the global logging level it is not enabled?\n\n    // Only add to the channels list (for the provider) if we haven't seen this name.\n    // If another channel has the same name we only add to the channels list once because they\n    // are indistiguishable from each other.\n    if (!channelByName.has(name)) {\n      channels.push({\n        name,\n        enabled: channel.isLevelOn(globalLevel),\n      });\n    }\n\n    const existing = channelByName.get(name) ?? [];\n    existing.push(channel);\n    channelByName.set(name, existing);\n  }\n\n  function regenerateChannels(\n    get: () => IStudioLogsSettings,\n    set: (partial: Partial<IStudioLogsSettings>) => void,\n  ) {\n    const currentGlobalLevel = get().globalLevel;\n    let didChange = false;\n    for (const channel of channels) {\n      const logChannels = channelByName.get(channel.name);\n      if (!logChannels) {\n        continue;\n      }\n\n      const anyChannel = logChannels[0];\n      if (anyChannel && anyChannel.isLevelOn(currentGlobalLevel) !== channel.enabled) {\n        channel.enabled = !channel.enabled;\n        didChange = true;\n      }\n    }\n\n    if (!didChange) {\n      return;\n    }\n\n    set({ channels: [...channels] });\n  }\n\n  return createStore<IStudioLogsSettings>((set, get) => ({\n    globalLevel,\n\n    channels,\n\n    setGlobalLevel(level: LogLevel) {\n      log.debug(`Set global level: ${level}`);\n\n      // Enable the underlying log channels\n      for (const [_, logChannels] of channelByName) {\n        for (const channel of logChannels) {\n          channel.setLevel(level);\n        }\n      }\n\n      set({ globalLevel: level });\n      regenerateChannels(get, set);\n    },\n\n    enableChannel(name: string) {\n      log.debug(`Enable channel: ${name}`);\n\n      // Enable the underlying log channels\n      const logChannels = channelByName.get(name) ?? [];\n      for (const channel of logChannels) {\n        channel.setLevel(\"debug\");\n      }\n\n      regenerateChannels(get, set);\n    },\n\n    disableChannel(name: string) {\n      log.debug(`Disable channel: ${name}`);\n\n      // Enable the underlying log channels\n      const logChannels = channelByName.get(name) ?? [];\n      for (const channel of logChannels) {\n        channel.setLevel(\"warn\");\n      }\n\n      regenerateChannels(get, set);\n    },\n\n    enablePrefix(prefix: string) {\n      log.debug(`Enable prefix ${prefix}`);\n      // find all channels matching the prefix and enable them\n      for (const [key, logChannels] of channelByName) {\n        if (key.startsWith(prefix)) {\n          for (const channel of logChannels) {\n            channel.setLevel(\"debug\");\n          }\n        }\n      }\n\n      regenerateChannels(get, set);\n    },\n\n    disablePrefix(prefix: string) {\n      log.debug(`Disable prefix ${prefix}`);\n\n      for (const [key, logChannels] of channelByName) {\n        if (key.startsWith(prefix)) {\n          for (const channel of logChannels) {\n            channel.setLevel(\"warn\");\n          }\n        }\n      }\n\n      regenerateChannels(get, set);\n    },\n  }));\n}\n\nexport { createStudioLogsSettingsStore };\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { PropsWithChildren, useEffect, useRef, useState } from \"react\";\nimport { useLocalStorage } from \"react-use\";\n\nimport Log from \"@foxglove/log\";\nimport { StudioLogsSettingsContext } from \"@foxglove/studio-base/context/StudioLogsSettingsContext\";\n\nimport { createStudioLogsSettingsStore } from \"./store\";\nimport { LocalStorageSaveState } from \"./types\";\n\nfunction StudioLogsSettingsProvider(props: PropsWithChildren<unknown>): JSX.Element {\n  const [studioLogsSettingsSavedState, setStudioLogsSettingsSavedState] =\n    useLocalStorage<LocalStorageSaveState>(\"fox.studio-logs-settings\", {});\n\n  const [studioLogsSettingsStore, setStudioLogsSettingsStore] = useState(() =>\n    createStudioLogsSettingsStore(studioLogsSettingsSavedState),\n  );\n\n  // To avoid resetting effect below when the localstorage state changes we use a ref for the localstorage state\n  const savedStateRef = useRef<LocalStorageSaveState | undefined>(studioLogsSettingsSavedState);\n  useEffect(() => {\n    savedStateRef.current = studioLogsSettingsSavedState;\n  });\n\n  // Setup an interval to check for changes to the total number of logging channels\n  //\n  // When the total number of channels changes we re-initialize the settings store so we display any\n  // newly added log channels.\n  useEffect(() => {\n    const storeChannelsCount = studioLogsSettingsStore.getState().channels.length;\n    const intervalHandle = setInterval(() => {\n      if (storeChannelsCount !== Log.channels().length) {\n        setStudioLogsSettingsStore(createStudioLogsSettingsStore(savedStateRef.current));\n      }\n    }, 1000);\n\n    return () => clearInterval(intervalHandle);\n  }, [studioLogsSettingsStore, studioLogsSettingsSavedState]);\n\n  useEffect(() => {\n    return studioLogsSettingsStore.subscribe((value) => {\n      const disabledChannels: string[] = [];\n\n      for (const channel of value.channels) {\n        if (!channel.enabled) {\n          disabledChannels.push(channel.name);\n        }\n      }\n      setStudioLogsSettingsSavedState({ globalLevel: value.globalLevel, disabledChannels });\n    });\n  }, [studioLogsSettingsStore, setStudioLogsSettingsSavedState]);\n\n  return (\n    <StudioLogsSettingsContext.Provider value={studioLogsSettingsStore}>\n      {props.children}\n    </StudioLogsSettingsContext.Provider>\n  );\n}\n\nexport { StudioLogsSettingsProvider };\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { isEqual, keyBy } from \"lodash\";\nimport { ReactNode, useState } from \"react\";\nimport { createStore, StoreApi } from \"zustand\";\n\nimport { TimelinePositionedEvent } from \"@foxglove/studio-base/context/EventsContext\";\nimport {\n  TimelineInteractionStateContext,\n  TimelineInteractionStateStore,\n  SyncBounds,\n} from \"@foxglove/studio-base/context/TimelineInteractionStateContext\";\nimport { HoverValue } from \"@foxglove/studio-base/types/hoverValue\";\n\nfunction createTimelineInteractionStateStore(): StoreApi<TimelineInteractionStateStore> {\n  return createStore((set) => {\n    return {\n      eventsAtHoverValue: {},\n      globalBounds: undefined,\n      hoveredEvent: undefined,\n      hoverValue: undefined,\n\n      clearHoverValue: (componentId: string) =>\n        set((store) => ({\n          hoverValue: store.hoverValue?.componentId === componentId ? undefined : store.hoverValue,\n        })),\n\n      setEventsAtHoverValue: (eventsAtHoverValue: TimelinePositionedEvent[]) =>\n        set({ eventsAtHoverValue: keyBy(eventsAtHoverValue, (event) => event.event.id) }),\n\n      setGlobalBounds: (\n        newBounds:\n          | undefined\n          | SyncBounds\n          | ((oldValue: undefined | SyncBounds) => undefined | SyncBounds),\n      ) => {\n        if (typeof newBounds === \"function\") {\n          set((store) => ({ globalBounds: newBounds(store.globalBounds) }));\n        } else {\n          set({ globalBounds: newBounds });\n        }\n      },\n\n      setHoveredEvent: (hoveredEvent: undefined | TimelinePositionedEvent) => {\n        if (hoveredEvent) {\n          set({\n            hoveredEvent,\n            hoverValue: {\n              componentId: `event_${hoveredEvent.event.id}`,\n              type: \"PLAYBACK_SECONDS\",\n              value: hoveredEvent.secondsSinceStart,\n            },\n          });\n        } else {\n          set({ hoveredEvent: undefined, hoverValue: undefined });\n        }\n      },\n\n      setHoverValue: (newValue: HoverValue) =>\n        set((store) => ({\n          hoverValue: isEqual(newValue, store.hoverValue) ? store.hoverValue : newValue,\n        })),\n    };\n  });\n}\n\nexport default function TimelineInteractionStateProvider({\n  children,\n}: {\n  children?: ReactNode;\n}): JSX.Element {\n  const [store] = useState(createTimelineInteractionStateStore());\n\n  return (\n    <TimelineInteractionStateContext.Provider value={store}>\n      {children}\n    </TimelineInteractionStateContext.Provider>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { IconButton, IconButtonProps, Tooltip } from \"@mui/material\";\nimport { forwardRef } from \"react\";\nimport tinycolor from \"tinycolor2\";\nimport { makeStyles } from \"tss-react/mui\";\n\nconst useStyles = makeStyles()((theme) => ({\n  tooltip: {\n    marginTop: `${theme.spacing(0.5)} !important`,\n  },\n  iconButton: {\n    borderRadius: 0,\n    fontSize: 24,\n    padding: theme.spacing(1.25),\n\n    \"svg:not(.MuiSvgIcon-root)\": {\n      fontSize: \"1em\",\n    },\n    \"&:hover\": {\n      backgroundColor: tinycolor(theme.palette.common.white).setAlpha(0.08).toRgbString(),\n    },\n    \"&.Mui-selected\": {\n      backgroundColor: theme.palette.appBar.primary,\n    },\n    \"&.Mui-disabled\": {\n      color: \"currentColor\",\n      opacity: theme.palette.action.disabledOpacity,\n    },\n  },\n}));\n\ntype AppBarIconButtonProps = Omit<IconButtonProps, \"title\"> & { title?: React.ReactNode };\n\nexport const AppBarIconButton = forwardRef<HTMLButtonElement, AppBarIconButtonProps>(\n  (props, ref) => {\n    const { title, className, children, color = \"inherit\", ...rest } = props;\n    const { classes, cx } = useStyles();\n\n    return (\n      <Tooltip\n        disableInteractive\n        classes={{ tooltip: classes.tooltip }}\n        title={title}\n        arrow={false}\n        enterDelay={200}\n      >\n        <span>\n          <IconButton color={color} ref={ref} className={cx(classes.iconButton, className)} {...rest}>\n            {children}\n          </IconButton>\n        </span>\n      </Tooltip>\n    );\n  },\n);\n\nAppBarIconButton.displayName = \"AppBarIconButton\";\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { CSSProperties } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nconst DEFAULT_END_TEXT_LENGTH = 16;\n\nconst useStyles = makeStyles()(() => ({\n  root: {\n    display: \"flex\",\n    justifyContent: \"flex-start\",\n    overflow: \"hidden\",\n  },\n  start: {\n    overflow: \"hidden\",\n    textOverflow: \"ellipsis\",\n    whiteSpace: \"nowrap\",\n    flexShrink: 1,\n  },\n  end: {\n    whiteSpace: \"nowrap\",\n    flexBasis: \"content\",\n    flexGrow: 0,\n    flexShrink: 0,\n    maxWidth: \"100%\",\n    overflow: \"hidden\",\n    textOverflow: \"ellipsis\",\n  },\n}));\n\ntype Props = {\n  text: string;\n  endTextLength?: number;\n  className?: string;\n  style?: CSSProperties;\n};\n\nexport default function TextMiddleTruncate({\n  text,\n  endTextLength,\n  className,\n  style,\n}: Props): JSX.Element {\n  const { classes, cx } = useStyles();\n  let startTextLen = Math.max(\n    0,\n    text.length -\n      (endTextLength == undefined || endTextLength === 0 ? DEFAULT_END_TEXT_LENGTH : endTextLength),\n  );\n  // Don't split at or immediately after whitespace.\n  while (startTextLen < text.length && text.charAt(startTextLen).match(/\\s/)) {\n    startTextLen += 2;\n  }\n  const startText = text.substring(0, startTextLen);\n  const endText = text.substring(startTextLen);\n\n  if (!startText) {\n    return (\n      <div className={cx(classes.end, className)} style={style}>\n        {endText}\n      </div>\n    );\n  }\n\n  return (\n    <div\n      data-testid=\"text-middle-truncate\"\n      className={cx(className, classes.root)}\n      title={text}\n      style={style}\n    >\n      <div className={classes.start}>{startText}</div>\n      <div className={classes.end}>{endText}</div>\n    </div>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { ChevronRight12Regular } from \"@fluentui/react-icons\";\nimport { Divider, Menu, MenuItem, MenuItemProps } from \"@mui/material\";\nimport { PropsWithChildren, ReactNode, useState } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nexport type MenuItem =\n  | {\n      type: \"item\";\n      label: ReactNode;\n      key: string;\n      disabled?: boolean;\n      shortcut?: string;\n      onClick?: MenuItemProps[\"onClick\"];\n      external?: boolean;\n    }\n  | { type: \"divider\" };\n\nconst useStyles = makeStyles<void, \"endIcon\">()((theme, _params, classes) => ({\n  menu: {\n    pointerEvents: \"none\",\n  },\n  paper: {\n    pointerEvents: \"auto\",\n    marginTop: theme.spacing(-1),\n  },\n  menuItem: {\n    justifyContent: \"space-between\",\n    cursor: \"pointer\",\n    gap: theme.spacing(2),\n\n    \"&.Mui-selected, &.Mui-selected:hover\": {\n      backgroundColor: theme.palette.action.hover,\n    },\n    [`:not(:hover, :focus) .${classes.endIcon}`]: {\n      opacity: 0.6,\n    },\n    kbd: {\n      font: \"inherit\",\n      color: theme.palette.text.disabled,\n    },\n  },\n  menuList: {\n    minWidth: 180,\n    maxWidth: 220,\n  },\n  endIcon: {\n    marginRight: theme.spacing(-0.75),\n  },\n}));\n\nexport function NestedMenuItem(\n  props: PropsWithChildren<{\n    id?: string;\n    items: MenuItem[];\n    open: boolean;\n    onPointerEnter: (itemId: string) => void;\n  }>,\n): JSX.Element {\n  const { classes } = useStyles();\n  const { children, items, open, onPointerEnter, id } = props;\n  const [anchorEl, setAnchorEl] = useState<undefined | HTMLLIElement>(undefined);\n\n  const handlePointerEnter = () => {\n    if (id) {\n      onPointerEnter(id);\n    }\n  };\n\n  return (\n    <>\n      <MenuItem\n        id={id}\n        ref={(element) => setAnchorEl(element ?? undefined)}\n        selected={open}\n        className={classes.menuItem}\n        onPointerEnter={handlePointerEnter}\n        data-testid={id}\n      >\n        {children}\n        <ChevronRight12Regular className={classes.endIcon} />\n      </MenuItem>\n      <Menu\n        classes={{\n          root: classes.menu,\n          paper: classes.paper,\n        }}\n        open={open}\n        disablePortal\n        anchorEl={anchorEl}\n        onClose={() => setAnchorEl(undefined)}\n        onMouseLeave={() => {\n          setAnchorEl(undefined);\n        }}\n        anchorOrigin={{ vertical: \"top\", horizontal: \"right\" }}\n        MenuListProps={{ dense: true, className: classes.menuList }}\n        autoFocus={false}\n        disableAutoFocus\n        disableEnforceFocus\n        hideBackdrop\n      >\n        {items.map((item, idx) =>\n          item.type !== \"divider\" ? (\n            <MenuItem\n              className={classes.menuItem}\n              key={item.key}\n              onClick={item.onClick}\n              disabled={item.disabled}\n            >\n              {item.label}\n              {item.shortcut ? <kbd>{item.shortcut}</kbd> : undefined}\n            </MenuItem>\n          ) : (\n            <Divider key={`${idx}-divider`} variant=\"middle\" />\n          ),\n        )}\n      </Menu>\n    </>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Menu, PaperProps, PopoverPosition, PopoverReference } from \"@mui/material\";\nimport { useCallback, useMemo, useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { makeStyles } from \"tss-react/mui\";\nimport { shallow } from \"zustand/shallow\";\n\nimport TextMiddleTruncate from \"@foxglove/studio-base/components/TextMiddleTruncate\";\nimport { useAnalytics } from \"@foxglove/studio-base/context/AnalyticsContext\";\nimport { useCurrentUserType } from \"@foxglove/studio-base/context/CurrentUserContext\";\nimport { usePlayerSelection } from \"@foxglove/studio-base/context/PlayerSelectionContext\";\nimport {\n  WorkspaceContextStore,\n  useWorkspaceStore,\n} from \"@foxglove/studio-base/context/Workspace/WorkspaceContext\";\nimport { useWorkspaceActions } from \"@foxglove/studio-base/context/Workspace/useWorkspaceActions\";\nimport { AppEvent } from \"@foxglove/studio-base/services/IAnalytics\";\n\nimport { MenuItem, NestedMenuItem } from \"./NestedMenuItem\";\n\ntype AppMenuProps = {\n  handleClose: () => void;\n  anchorEl?: HTMLElement;\n  anchorReference?: PopoverReference;\n  anchorPosition?: PopoverPosition;\n  disablePortal?: boolean;\n  open: boolean;\n};\n\nconst useStyles = makeStyles()({\n  menuList: {\n    minWidth: 180,\n    maxWidth: 220,\n  },\n  truncate: {\n    alignSelf: \"center !important\",\n  },\n});\n\nconst selectWorkspace = (store: WorkspaceContextStore) => store;\n\nexport function AppMenu(props: AppMenuProps): JSX.Element {\n  const { open, handleClose, anchorEl, anchorReference, anchorPosition, disablePortal } = props;\n  const { classes } = useStyles();\n  const { t } = useTranslation(\"appBar\");\n\n  const [nestedMenu, setNestedMenu] = useState<string | undefined>();\n\n  const currentUserType = useCurrentUserType();\n  const analytics = useAnalytics();\n\n  const { recentSources, selectRecent } = usePlayerSelection();\n  const {\n    sidebars: {\n      left: { open: leftSidebarOpen },\n      right: { open: rightSidebarOpen },\n    },\n  } = useWorkspaceStore(selectWorkspace, shallow);\n  const { sidebarActions, dialogActions } = useWorkspaceActions();\n\n  const handleNestedMenuClose = useCallback(() => {\n    setNestedMenu(undefined);\n    handleClose();\n  }, [handleClose]);\n\n  const handleItemPointerEnter = useCallback((id: string) => {\n    setNestedMenu(id);\n  }, []);\n\n  const handleAnalytics = useCallback(\n    (cta: string) => {\n      void analytics.logEvent(AppEvent.APP_MENU_CLICK, {\n        user: currentUserType,\n        cta,\n      });\n    },\n    [analytics, currentUserType],\n  );\n\n  // FILE\n\n  const fileItems = useMemo(() => {\n    const items: MenuItem[] = [\n      {\n        type: \"item\",\n        label: t(\"open\"),\n        key: \"open\",\n        onClick: () => {\n          dialogActions.dataSource.open(\"start\");\n          handleAnalytics(\"open-data-source-dialog\");\n          handleNestedMenuClose();\n        },\n      },\n      {\n        type: \"item\",\n        label: t(\"openLocalFile\"),\n        key: \"open-file\",\n        onClick: () => {\n          handleAnalytics(\"open-file\");\n          handleNestedMenuClose();\n          dialogActions.openFile.open().catch(console.error);\n        },\n      },\n      {\n        type: \"item\",\n        label: t(\"openConnection\"),\n        key: \"open-connection\",\n        onClick: () => {\n          dialogActions.dataSource.open(\"connection\");\n          handleAnalytics(\"open-connection\");\n          handleNestedMenuClose();\n        },\n      },\n      { type: \"divider\" },\n      { type: \"item\", label: t(\"recentDataSources\"), key: \"recent-sources\", disabled: true },\n    ];\n\n    recentSources.slice(0, 5).map((recent) => {\n      items.push({\n        type: \"item\",\n        key: recent.id,\n        onClick: () => {\n          handleAnalytics(\"open-recent\");\n          selectRecent(recent.id);\n          handleNestedMenuClose();\n        },\n        label: <TextMiddleTruncate text={recent.title} className={classes.truncate} />,\n      });\n    });\n\n    return items;\n  }, [\n    classes.truncate,\n    dialogActions,\n    handleAnalytics,\n    handleNestedMenuClose,\n    recentSources,\n    selectRecent,\n    t,\n  ]);\n\n  // VIEW\n\n  const viewItems = useMemo<MenuItem[]>(\n    () => [\n      {\n        type: \"item\",\n        label: leftSidebarOpen ? t(\"hideLeftSidebar\") : t(\"showLeftSidebar\"),\n        key: \"left-sidebar\",\n        shortcut: \"[\",\n        onClick: () => {\n          sidebarActions.left.setOpen(!leftSidebarOpen);\n          handleNestedMenuClose();\n        },\n      },\n      {\n        type: \"item\",\n        label: rightSidebarOpen ? t(\"hideRightSidebar\") : t(\"showRightSidebar\"),\n        key: \"right-sidebar\",\n        shortcut: \"]\",\n        onClick: () => {\n          sidebarActions.right.setOpen(!rightSidebarOpen);\n          handleNestedMenuClose();\n        },\n      },\n    ],\n    [\n      handleNestedMenuClose,\n      leftSidebarOpen,\n      rightSidebarOpen,\n      sidebarActions.left,\n      sidebarActions.right,\n      t,\n    ],\n  );\n\n  // HELP\n\n  const onAboutClick = useCallback(() => {\n    dialogActions.preferences.open(\"about\");\n    handleAnalytics(\"about\");\n    handleNestedMenuClose();\n  }, [dialogActions.preferences, handleAnalytics, handleNestedMenuClose]);\n\n  const onDocsClick = useCallback(() => {\n    handleAnalytics(\"docs\");\n    window.open(\"https://foxglove.dev/docs\", \"_blank\");\n    handleNestedMenuClose();\n  }, [handleAnalytics, handleNestedMenuClose]);\n\n  const onSlackClick = useCallback(() => {\n    handleAnalytics(\"join-slack\");\n    window.open(\"https://foxglove.dev/slack\", \"_blank\");\n    handleNestedMenuClose();\n  }, [handleAnalytics, handleNestedMenuClose]);\n\n  const onDemoClick = useCallback(() => {\n    dialogActions.dataSource.open(\"demo\");\n    handleAnalytics(\"demo\");\n    handleNestedMenuClose();\n  }, [dialogActions.dataSource, handleAnalytics, handleNestedMenuClose]);\n\n  const helpItems = useMemo<MenuItem[]>(\n    () => [\n      { type: \"item\", key: \"about\", label: t(\"about\"), onClick: onAboutClick },\n      { type: \"divider\" },\n      { type: \"item\", key: \"docs\", label: t(\"viewOurDocs\"), onClick: onDocsClick, external: true },\n      {\n        type: \"item\",\n        key: \"join-slack\",\n        label: t(\"joinOurSlack\"),\n        onClick: onSlackClick,\n        external: true,\n      },\n      { type: \"divider\" },\n      { type: \"item\", key: \"demo\", label: t(\"exploreSampleData\"), onClick: onDemoClick },\n    ],\n    [onAboutClick, onDemoClick, onDocsClick, onSlackClick, t],\n  );\n\n  return (\n    <>\n      <Menu\n        anchorEl={anchorEl}\n        anchorReference={anchorReference}\n        anchorPosition={anchorPosition}\n        disablePortal={disablePortal}\n        id=\"app-menu\"\n        open={open}\n        disableAutoFocusItem\n        onClose={handleNestedMenuClose}\n        MenuListProps={{\n          \"aria-labelledby\": \"app-menu-button\",\n          dense: true,\n          className: classes.menuList,\n        }}\n        PaperProps={\n          {\n            \"data-tourid\": \"app-menu\",\n          } as Partial<PaperProps & { \"data-tourid\"?: string }>\n        }\n      >\n        <NestedMenuItem\n          onPointerEnter={handleItemPointerEnter}\n          items={fileItems}\n          open={nestedMenu === \"app-menu-file\"}\n          id=\"app-menu-file\"\n        >\n          {t(\"file\")}\n        </NestedMenuItem>\n        <NestedMenuItem\n          onPointerEnter={handleItemPointerEnter}\n          items={viewItems}\n          open={nestedMenu === \"app-menu-view\"}\n          id=\"app-menu-view\"\n        >\n          {t(\"view\")}\n        </NestedMenuItem>\n        <NestedMenuItem\n          onPointerEnter={handleItemPointerEnter}\n          items={helpItems}\n          open={nestedMenu === \"app-menu-help\"}\n          id=\"app-menu-help\"\n        >\n          {t(\"help\")}\n        </NestedMenuItem>\n      </Menu>\n    </>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport CheckBoxOutlineBlankIcon from \"@mui/icons-material/CheckBoxOutlineBlank\";\nimport CloseIcon from \"@mui/icons-material/Close\";\nimport FilterNoneIcon from \"@mui/icons-material/FilterNone\";\nimport MinimizeIcon from \"@mui/icons-material/Minimize\";\nimport { IconButton } from \"@mui/material\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport Stack from \"@foxglove/studio-base/components/Stack\";\n\nexport type CustomWindowControlsProps = {\n  showCustomWindowControls?: boolean;\n  isMaximized?: boolean;\n  onMinimizeWindow?: () => void;\n  onMaximizeWindow?: () => void;\n  onUnmaximizeWindow?: () => void;\n  onCloseWindow?: () => void;\n};\n\nconst useStyles = makeStyles()((theme) => ({\n  closeButton: {\n    \":hover\": {\n      backgroundColor: theme.palette.error.main,\n    },\n  },\n}));\n\nexport function CustomWindowControls({\n  isMaximized = false,\n  onMinimizeWindow,\n  onMaximizeWindow,\n  onUnmaximizeWindow,\n  onCloseWindow,\n}: Omit<CustomWindowControlsProps, \"showCustomWindowControls\">): JSX.Element {\n  const { classes } = useStyles();\n  return (\n    <Stack direction=\"row\" gap={1} paddingX={1}>\n      <IconButton\n        size=\"small\"\n        color=\"inherit\"\n        onClick={onMinimizeWindow}\n        data-testid=\"win-minimize\"\n      >\n        <MinimizeIcon fontSize=\"inherit\" color=\"inherit\" />\n      </IconButton>\n\n      <IconButton\n        size=\"small\"\n        color=\"inherit\"\n        onClick={isMaximized ? onUnmaximizeWindow : onMaximizeWindow}\n        data-testid=\"win-maximize\"\n      >\n        {isMaximized ? (\n          <FilterNoneIcon fontSize=\"inherit\" color=\"inherit\" />\n        ) : (\n          <CheckBoxOutlineBlankIcon fontSize=\"inherit\" color=\"inherit\" />\n        )}\n      </IconButton>\n\n      <IconButton\n        className={classes.closeButton}\n        size=\"small\"\n        color=\"inherit\"\n        onClick={onCloseWindow}\n        data-testid=\"win-close\"\n      >\n        <CloseIcon fontSize=\"inherit\" color=\"inherit\" />\n      </IconButton>\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { SvgIcon, SvgIconProps } from \"@mui/material\";\n\nexport function FoxgloveLogo(props: SvgIconProps): JSX.Element {\n  return (\n    <SvgIcon viewBox=\"0 0 400 400\" {...props}>\n      <title>Foxglove</title>\n      <g fill=\"currentColor\">\n        <ellipse cx=\"143.854\" cy=\"297.143\" rx=\"38.839\" ry=\"38.8571\" />\n        <ellipse opacity=\"0.5\" cx=\"255.89\" cy=\"297.143\" rx=\"38.839\" ry=\"38.8571\" />\n        <ellipse opacity=\"0.5\" cx=\"311.161\" cy=\"200\" rx=\"38.839\" ry=\"38.8571\" />\n        <path d=\"M143.899 64C153.005 64 161.384 67.1164 168.028 72.3414C176.674 79.3821 187.705 83.603 199.722 83.603C211.739 83.603 222.77 79.3821 231.416 72.3414C238.06 67.1164 246.438 64 255.545 64C277.126 64 294.621 81.5031 294.621 103.094C294.621 124.685 277.126 142.189 255.545 142.189C246.438 142.189 238.06 139.072 231.416 133.847C222.77 126.806 211.739 122.586 199.722 122.586C187.705 122.586 176.674 126.806 168.028 133.847C161.384 139.072 153.005 142.189 143.899 142.189C122.318 142.189 104.823 124.685 104.823 103.094C104.823 81.5031 122.318 64 143.899 64Z\" />\n        <path d=\"M88.0761 161.177C97.1825 161.177 105.561 164.294 112.205 169.519C120.851 176.559 131.882 180.78 143.899 180.78C155.916 180.78 166.947 176.559 175.593 169.519C182.237 164.294 190.616 161.177 199.722 161.177C221.303 161.177 238.798 178.68 238.798 200.272C238.798 221.863 221.303 239.366 199.722 239.366C190.616 239.366 182.237 236.249 175.593 231.024C166.947 223.984 155.916 219.763 143.899 219.763C131.882 219.763 120.851 223.984 112.205 231.024C105.561 236.249 97.1825 239.366 88.0761 239.366C66.495 239.366 49 221.863 49 200.272C49 178.68 66.495 161.177 88.0761 161.177Z\" />\n      </g>\n    </SvgIcon>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Tooltip, Typography } from \"@mui/material\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { useMemoryInfo } from \"@foxglove/hooks\";\n\nconst useStyles = makeStyles()((theme) => ({\n  root: {\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    flexDirection: \"column\",\n    position: \"relative\",\n    width: 50,\n    flex: \"1 0 50px\",\n    fontSize: theme.typography.caption.fontSize,\n    overflow: \"hidden\",\n  },\n  label: {\n    fontWeight: \"bold\",\n  },\n  text: {\n    lineHeight: 1.1,\n  },\n}));\n\nfunction toMB(bytes: number): number {\n  return bytes / 1024 / 1024;\n}\n\nfunction MemoryUseIndicator(): JSX.Element {\n  const memoryInfo = useMemoryInfo({ refreshIntervalMs: 5000 });\n  const { classes, cx } = useStyles();\n\n  // If we can't load memory info (maybe not supported) then we don't show any indicator\n  if (!memoryInfo) {\n    return <></>;\n  }\n\n  const usedPercent = (memoryInfo.usedJSHeapSize / memoryInfo.jsHeapSizeLimit) * 100;\n  const usedMb = toMB(memoryInfo.usedJSHeapSize).toLocaleString();\n  const limitMb = toMB(memoryInfo.jsHeapSizeLimit).toLocaleString();\n\n  return (\n    <Tooltip arrow={false} title={`Used (MB): ${usedMb} / ${limitMb}`} placement=\"bottom\">\n      <div className={classes.root}>\n        <Typography className={cx(classes.label, classes.text)} variant=\"caption\">\n          MEM\n        </Typography>\n        <Typography className={classes.text} variant=\"caption\">\n          {usedPercent.toFixed(2)}%\n        </Typography>\n      </div>\n    </Tooltip>\n  );\n}\n\nexport { MemoryUseIndicator };\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\nimport { useCallback } from \"react\";\n\nimport { PanelSelection } from \"@foxglove/studio-base/components/PanelCatalog\";\nimport { useCurrentLayoutActions } from \"@foxglove/studio-base/context/CurrentLayoutContext\";\nimport { getPanelIdForType } from \"@foxglove/studio-base/util/layout\";\n\nexport default function useAddPanel(): (selection: PanelSelection) => void {\n  const { addPanel } = useCurrentLayoutActions();\n  return useCallback(\n    ({ type, config, relatedConfigs }: PanelSelection) => {\n      const id = getPanelIdForType(type);\n      addPanel({ id, config, relatedConfigs });\n    },\n    [addPanel],\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Menu, PaperProps, PopoverPosition, PopoverReference } from \"@mui/material\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { PanelCatalog } from \"@foxglove/studio-base/components/PanelCatalog\";\nimport useAddPanel from \"@foxglove/studio-base/hooks/useAddPanel\";\n\nconst useStyles = makeStyles()((theme) => ({\n  menuList: {\n    minWidth: 270,\n    paddingBottom: theme.spacing(1),\n  },\n}));\n\ntype AddPanelProps = {\n  anchorEl?: HTMLElement;\n  anchorPosition?: PopoverPosition;\n  anchorReference?: PopoverReference;\n  disablePortal?: boolean;\n  handleClose: () => void;\n  open: boolean;\n};\n\nexport function AddPanelMenu(props: AddPanelProps): JSX.Element {\n  const { classes } = useStyles();\n  const { anchorEl, anchorPosition, anchorReference, disablePortal, handleClose, open } = props;\n  const addPanel = useAddPanel();\n\n  return (\n    <Menu\n      id=\"add-panel-menu\"\n      anchorEl={anchorEl}\n      anchorPosition={anchorPosition}\n      anchorReference={anchorReference}\n      disablePortal={disablePortal}\n      open={open}\n      onClose={handleClose}\n      MenuListProps={{\n        dense: true,\n        disablePadding: true,\n        \"aria-labelledby\": \"add-panel-button\",\n        className: classes.menuList,\n      }}\n      anchorOrigin={{\n        horizontal: \"left\",\n        vertical: \"bottom\",\n      }}\n      transformOrigin={{\n        vertical: \"top\",\n        horizontal: \"left\",\n      }}\n      PaperProps={\n        {\n          \"data-tourid\": \"add-panel-menu\",\n        } as Partial<PaperProps & { \"data-tourid\"?: string }>\n      }\n    >\n      <PanelCatalog\n        isMenu\n        // Close when a drag starts so the modal menu doesn't block the drop targets\n        onDragStart={handleClose}\n        onPanelSelect={(selection) => {\n          addPanel(selection);\n          handleClose();\n        }}\n      />\n    </Menu>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport CloseIcon from \"@mui/icons-material/Close\";\nimport { Dialog, IconButton, Stack, Typography } from \"@mui/material\";\nimport { useState } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { Immutable } from \"@foxglove/studio\";\nimport { PlayerProblem } from \"@foxglove/studio-base/players/types\";\n\nimport WssErrorModalScreenshot from \"./WssErrorModal.png\";\n\nconst useStyles = makeStyles()({\n  image: {\n    maxWidth: \"24rem\",\n  },\n});\n\nexport default function WssErrorModal(\n  props: Immutable<{ playerProblems?: PlayerProblem[] }>,\n): JSX.Element {\n  const { playerProblems } = props;\n  const { classes } = useStyles();\n\n  const [open, setOpen] = useState(true);\n  const [hasDismissedWssErrorModal, setHasDismissedWssErrorModal] = useState(false);\n\n  const handleClose = () => {\n    setOpen(false);\n    setHasDismissedWssErrorModal(true);\n  };\n\n  const hasWssConnectionProblem = playerProblems?.find(\n    (problem) =>\n      problem.severity === \"error\" && problem.message === \"Insecure WebSocket connection\",\n  );\n\n  if (hasDismissedWssErrorModal || !hasWssConnectionProblem) {\n    return <></>;\n  }\n\n  return (\n    <Dialog open={open} onClose={handleClose}>\n      <Stack\n        direction=\"row\"\n        justifyContent=\"space-between\"\n        alignItems=\"flex-start\"\n        paddingX={3}\n        paddingTop={2}\n      >\n        <Typography variant=\"h3\" paddingTop={1}>\n          WebSocket SSL Error\n        </Typography>\n        <IconButton onClick={() => setOpen(false)} edge=\"end\">\n          <CloseIcon />\n        </IconButton>\n      </Stack>\n      <Stack paddingX={3} paddingY={2} rowGap={2}>\n        <Typography variant=\"body1\" color=\"text.secondary\">\n          By default, Chrome prevents a secure <code>https://</code> page from connecting to an\n          insecure <code>ws://</code> WebSocket server. To allow the connection, enable &quot;Unsafe\n          Scripts&quot; for this page.\n        </Typography>\n        <Typography variant=\"body1\" color=\"text.secondary\">\n          Click the shield icon at the end of your address bar, and then click &quot;Load Unsafe\n          Scripts.&quot;\n        </Typography>\n        <img src={WssErrorModalScreenshot} alt=\"WSS screenshot\" className={classes.image} />\n      </Stack>\n    </Dialog>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { ErrorCircle20Filled } from \"@fluentui/react-icons\";\nimport { Button, Chip, CircularProgress, IconButton, Menu, MenuItem, MenuProps, alpha, keyframes, styled } from \"@mui/material\";\nimport BusinessCenterIcon from '@mui/icons-material/BusinessCenter';\nimport { useTranslation } from \"react-i18next\";\nimport { makeStyles } from \"tss-react/mui\";\nimport KeyboardArrowDownIcon from '@mui/icons-material/KeyboardArrowDown';\n\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport WssErrorModal from \"@foxglove/studio-base/components/WssErrorModal\";\nimport { useWorkspaceActions } from \"@foxglove/studio-base/context/Workspace/useWorkspaceActions\";\nimport { PlayerPresence } from \"@foxglove/studio-base/players/types\";\nimport { usePlayerSelection } from \"@foxglove/studio-base/context/PlayerSelectionContext\";\n\nimport { useEffect, useLayoutEffect } from \"react\";\n\nconst ICON_SIZE = 18;\n\nconst useStyles = makeStyles<void, \"adornmentError\">()((theme, _params, _classes) => ({\n  sourceName: {\n    font: \"inherit\",\n    fontSize: theme.typography.body2.fontSize,\n    display: \"flex\",\n    alignItems: \"center\",\n    gap: theme.spacing(0.5),\n    padding: theme.spacing(1.5),\n    paddingInlineEnd: theme.spacing(0.75),\n    whiteSpace: \"nowrap\",\n    minWidth: 0,\n  },\n  adornment: {\n    display: \"flex\",\n    flex: \"none\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    position: \"relative\",\n    color: theme.palette.appBar.primary,\n    width: ICON_SIZE,\n    height: ICON_SIZE,\n    marginLeft: theme.spacing(1.2),\n    marginRight: theme.spacing(1.2),\n  },\n  adornmentError: {\n    color: theme.palette.error.main,\n  },\n  spinner: {\n    position: \"absolute\",\n    top: 0,\n    right: 0,\n    left: 0,\n    bottom: 0,\n    margin: \"auto\",\n  },\n  textTruncate: {\n    maxWidth: \"30vw\",\n    overflow: \"hidden\",\n  },\n  iconButton: {\n    padding: 0,\n    position: \"relative\",\n    zIndex: 1,\n    fontSize: ICON_SIZE - 2,\n\n    \"svg:not(.MuiSvgIcon-root)\": {\n      fontSize: \"1rem\",\n    },\n  },\n}));\n\n// const selectPlayerName = (ctx: MessagePipelineContext) => ctx.playerState.name;\nconst selectPlayerPresence = (ctx: MessagePipelineContext) => ctx.playerState.presence;\nconst selectPlayerProblems = (ctx: MessagePipelineContext) => ctx.playerState.problems;\n// const selectSeek = (ctx: MessagePipelineContext) => ctx.seekPlayback;\n\n\nexport function DataSource(): JSX.Element {\n  const { t } = useTranslation(\"appBar\");\n  const { classes, cx } = useStyles();\n\n  // const playerName = useMessagePipeline(selectPlayerName);\n  const playerPresence = useMessagePipeline(selectPlayerPresence);\n  const playerProblems = useMessagePipeline(selectPlayerProblems) ?? [];\n  // const seek = useMessagePipeline(selectSeek);\n\n  const { sidebarActions, dialogActions } = useWorkspaceActions();\n\n  // A crude but correct proxy (for our current architecture) for whether a connection is live\n  // const isLiveConnection = seek == undefined;\n\n  const reconnecting = playerPresence === PlayerPresence.RECONNECTING;\n  const initializing = playerPresence === PlayerPresence.INITIALIZING;\n  const error =\n    playerPresence === PlayerPresence.ERROR ||\n    playerProblems.some((problem) => problem.severity === \"error\");\n  const loading = reconnecting || initializing;\n\n  // const playerConnected = playerPresence === PlayerPresence.PRESENT;\n\n  // const playerDisplayName =\n  //   initializing && playerName == undefined ? \"Initializing...\" : playerName;\n\n  const [anchorEl, setAnchorEl] = React.useState<null | HTMLElement>(null);\n  const [source, setSource] = React.useState<string | null>(null);\n  const open = Boolean(anchorEl);\n  const handleClick = (event: React.MouseEvent<HTMLElement>) => {\n    setAnchorEl(event.currentTarget);\n  };\n\n  const { selectedSource, availableSources, selectSource } = usePlayerSelection();\n\n  const handleClose = (event: any, reason?: string) => {\n    setAnchorEl(null);\n    if (event == null || reason != undefined || reason == \"backdropClick\" || reason == \"escapeKeyDown\") {\n      return;\n    }\n    let selection = event.currentTarget.getAttribute(\"data-source\");\n    let source = availableSources.find((source) => source.id === selection)?.id;\n    if (!source) {\n      return;\n    }\n    if (source == \"ros1-local-bagfile\") {\n      dialogActions.openFile.open().catch(console.error);\n      return;\n    }\n    selectSource(source, { type: \"connection\", params: { url: \"ws://localhost:9090\" } });\n  };\n\n  useEffect(() => {\n    if (selectedSource != undefined && selectedSource.id != source) {\n      setSource(selectedSource.id ?? null);\n    }\n  }, [selectedSource?.id]);\n\n  useLayoutEffect(() => {\n    if (source == undefined && selectedSource?.id == undefined) {\n      selectSource(\"rosbridge-websocket\", { type: \"connection\", params: { url: \"ws://localhost:9090\" } });\n    }\n  }, [source]);\n\n\n  const liveAnim = keyframes`\n  0% {\n    opacity: 1;\n  }\n    30% {\n    opacity: 0.5;\n  }\n  60% {\n    opacity: 1;\n  }\n  100% {\n    opacity: 1;\n  }\n`\n\n  const sourceItems = [\n    {\n      key: \"rosbridge-websocket\",\n      el: <MenuItem onClick={handleClose} selected={source === \"rosbridge-websocket\"}\n        key=\"rosbridge-websocket\"\n        disableRipple data-source=\"rosbridge-websocket\">\n        <Chip label=\"LIVE\" color=\"error\" sx={{\n          height: 20,\n          width: 'auto',\n          marginRight: 1,\n          paddingLeft: 0,\n          paddingRight: 0,\n          '& .MuiChip-label': {\n            fontSize: 9,\n            paddingLeft: 1,\n            paddingRight: 1,\n          },\n        }} /> ROS Bridge\n      </MenuItem>,\n      displayEl: <>\n        <Chip label=\"LIVE\" color=\"error\" sx={{\n          animation: `${liveAnim} 5s ease infinite`,\n          height: 20,\n          width: 'auto',\n          marginRight: 1,\n          paddingLeft: 0,\n          paddingRight: 0,\n          '& .MuiChip-label': {\n            fontSize: 9,\n            paddingLeft: 1,\n            paddingRight: 1,\n          },\n        }} /> ROS Bridge\n      </>\n    },\n    {\n      key: \"ros1-local-bagfile\",\n      el: <MenuItem onClick={handleClose} disableRipple data-source=\"ros1-local-bagfile\" selected={source === \"ros1-local-bagfile\"} key=\"ros1-local-bagfile\">\n        <BusinessCenterIcon /> ROS Bag\n      </MenuItem>,\n      displayEl: <>\n        <BusinessCenterIcon sx={{\n          fontSize: 22,\n          marginRight: 1.9,\n          marginLeft: 0.8\n        }} /> ROS Bag\n      </>\n    }\n  ];\n\n\n  const StyledMenu = styled((props: MenuProps) => (\n    <Menu\n      elevation={0}\n      anchorOrigin={{\n        vertical: 'bottom',\n        horizontal: 'center',\n      }}\n      transformOrigin={{\n        vertical: 'top',\n        horizontal: 'center',\n      }}\n      {...props}\n    />\n  ))(({ theme }) => ({\n    '& .MuiPaper-root': {\n      borderRadius: 6,\n      marginTop: theme.spacing(1),\n      minWidth: 180,\n      padding: 0,\n      boxShadow:\n        'rgb(255, 255, 255) 0px 0px 0px 0px, rgba(0, 0, 0, 0.05) 0px 0px 0px 1px, rgba(0, 0, 0, 0.1) 0px 10px 15px -3px, rgba(0, 0, 0, 0.05) 0px 4px 6px -2px',\n      '& .MuiMenuItem-root': {\n        '& .MuiSvgIcon-root': {\n          fontSize: 22,\n          marginRight: theme.spacing(1.9),\n          marginLeft: theme.spacing(0.8),\n        },\n        '&:active': {\n          backgroundColor: alpha(\n            theme.palette.primary.main,\n            theme.palette.action.selectedOpacity,\n          ),\n        },\n      },\n    },\n  }));\n\n\n  return (\n    <>\n      <WssErrorModal playerProblems={playerProblems} />\n      <Stack direction=\"row\" alignItems=\"center\">\n        {/* <div className={classes.sourceName}>\n          <div className={classes.textTruncate}>\n            <TextMiddleTruncate text={playerDisplayName ?? `<${t(\"unknown\")}>`} />\n          </div>\n          {isLiveConnection && (\n            <>\n              <span>/</span>\n              <EndTimestamp />\n            </>\n          )}\n        </div> */}\n        <div>\n          <Button\n            id=\"select-source-button\"\n            aria-controls={open ? 'select-source-menu' : undefined}\n            aria-haspopup=\"true\"\n            aria-expanded={open ? 'true' : undefined}\n            variant=\"contained\"\n            disableElevation\n            onClick={handleClick}\n            endIcon={<KeyboardArrowDownIcon />}\n          >\n            {\n              sourceItems.find((item) => item.key === source)?.displayEl ?? t('selectSource')\n            }\n          </Button>\n          <StyledMenu\n            id=\"select-source-menu\"\n            MenuListProps={{\n              'aria-labelledby': 'select-source-button',\n            }}\n            anchorEl={anchorEl}\n            open={open}\n            onClose={handleClose}\n          >\n            {sourceItems.map((item) => item.el)}\n          </StyledMenu>\n        </div>\n        <div className={cx(classes.adornment, { [classes.adornmentError]: error })}>\n          {loading && (\n            <CircularProgress\n              size={ICON_SIZE}\n              color=\"inherit\"\n              className={classes.spinner}\n              variant=\"indeterminate\"\n            />\n          )}\n          {error && (\n            <IconButton\n              color=\"inherit\"\n              className={classes.iconButton}\n              onClick={() => {\n                sidebarActions.left.setOpen(true);\n                sidebarActions.left.selectItem(\"problems\");\n              }}\n            >\n              <ErrorCircle20Filled />\n            </IconButton>\n          )}\n        </div>\n      </Stack>\n    </>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { Dialog, DialogContent, DialogTitle, DialogActions, Button } from \"@mui/material\";\nimport { useCallback, useEffect, useRef, useState } from \"react\";\nimport { useKeyPressEvent } from \"react-use\";\n\ntype ConfirmVariant = \"danger\" | \"primary\";\ntype ConfirmAction = \"ok\" | \"cancel\";\n\ntype ConfirmOptions = {\n  // the title of the confirm modal\n  title: string;\n  // text in the body of the confirm modal. Specify a string or JSX Element\n  prompt?: string | JSX.Element;\n  // the text for the OK button - defaults to \"OK\"\n  ok?: string;\n  // the text for the cancel button - defaults to \"Cancel\"\n  // set to false to completely hide the cancel button\n  cancel?: string | false;\n  // indicate the type of confirmation\n  variant?: ConfirmVariant;\n};\n\ntype ConfirmModalProps = ConfirmOptions & {\n  onComplete: (value: ConfirmAction) => void;\n};\n\nfunction ConfirmModal(props: ConfirmModalProps) {\n  const originalOnComplete = props.onComplete;\n\n  const completed = useRef(false);\n  const onComplete = useCallback(\n    (result: ConfirmAction) => {\n      if (!completed.current) {\n        completed.current = true;\n        originalOnComplete(result);\n      }\n    },\n    [originalOnComplete],\n  );\n\n  useKeyPressEvent(\"Enter\", () => onComplete(\"ok\"));\n\n  // Ensure we still call onComplete(undefined) when the component unmounts, if it hasn't been\n  // called already\n  useEffect(() => {\n    return () => onComplete(\"cancel\");\n  }, [onComplete]);\n\n  const buttons = [\n    props.cancel !== false && (\n      <Button\n        size=\"large\"\n        variant=\"outlined\"\n        color=\"inherit\"\n        key=\"cancel\"\n        onClick={() => onComplete(\"cancel\")}\n      >\n        {props.cancel ?? \"Cancel\"}\n      </Button>\n    ),\n    <Button\n      key=\"confirm\"\n      variant=\"contained\"\n      size=\"large\"\n      color={props.variant === \"danger\" ? \"error\" : \"primary\"}\n      type=\"submit\"\n    >\n      {props.ok ?? \"OK\"}\n    </Button>,\n  ];\n  if (props.variant === \"danger\") {\n    buttons.reverse();\n  }\n\n  return (\n    <Dialog open onClose={() => onComplete(\"cancel\")} maxWidth=\"xs\" fullWidth>\n      <form\n        onSubmit={(event) => {\n          event.preventDefault();\n          onComplete(\"ok\");\n        }}\n      >\n        <DialogTitle>{props.title}</DialogTitle>\n        <DialogContent>{props.prompt}</DialogContent>\n        <DialogActions>{buttons}</DialogActions>\n      </form>\n    </Dialog>\n  );\n}\n\n// Returns a function that can be used similarly to the DOM confirm(), but\n// backed by a React element rather than a native modal, and asynchronous.\nexport function useConfirm(): [\n  confirm: (options: ConfirmOptions) => Promise<ConfirmAction>,\n  confirmModal: JSX.Element | undefined,\n] {\n  const [modal, setModal] = useState<JSX.Element | undefined>();\n\n  const openConfirm = useCallback(async (options: ConfirmOptions) => {\n    return await new Promise<ConfirmAction>((resolve) => {\n      setModal(\n        <ConfirmModal\n          {...options}\n          onComplete={(value) => {\n            resolve(value);\n            setModal(undefined);\n          }}\n        />,\n      );\n    });\n  }, []);\n\n  return [openConfirm, modal];\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport {\n  Divider,\n  Menu,\n  MenuItem,\n  PaperProps,\n  PopoverPosition,\n  PopoverReference,\n} from \"@mui/material\";\nimport { useSnackbar } from \"notistack\";\nimport { useCallback } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport Logger from \"@foxglove/log\";\nimport { AppSettingsTab } from \"@foxglove/studio-base/components/AppSettingsDialog/AppSettingsDialog\";\nimport { useAnalytics } from \"@foxglove/studio-base/context/AnalyticsContext\";\nimport {\n  useCurrentUser,\n  useCurrentUserType,\n} from \"@foxglove/studio-base/context/CurrentUserContext\";\nimport { useWorkspaceActions } from \"@foxglove/studio-base/context/Workspace/useWorkspaceActions\";\nimport { useConfirm } from \"@foxglove/studio-base/hooks/useConfirm\";\nimport { AppEvent } from \"@foxglove/studio-base/services/IAnalytics\";\n\nconst log = Logger.getLogger(__filename);\n\nconst useStyles = makeStyles()({\n  menuList: {\n    minWidth: 200,\n  },\n});\n\ntype UserMenuProps = {\n  handleClose: () => void;\n  anchorEl?: HTMLElement;\n  anchorReference?: PopoverReference;\n  anchorPosition?: PopoverPosition;\n  disablePortal?: boolean;\n  open: boolean;\n};\n\nexport function UserMenu({\n  anchorEl,\n  anchorReference,\n  anchorPosition,\n  disablePortal,\n  handleClose,\n  open,\n}: UserMenuProps): JSX.Element {\n  const { classes } = useStyles();\n  const { currentUser, signIn, signOut } = useCurrentUser();\n  const currentUserType = useCurrentUserType();\n  const analytics = useAnalytics();\n  const { enqueueSnackbar } = useSnackbar();\n  const [confirm, confirmModal] = useConfirm();\n\n  const { dialogActions } = useWorkspaceActions();\n\n  const beginSignOut = useCallback(async () => {\n    try {\n      await signOut?.();\n    } catch (error) {\n      log.error(error);\n      enqueueSnackbar((error as Error).toString(), { variant: \"error\" });\n    }\n  }, [enqueueSnackbar, signOut]);\n\n  const onSignoutClick = useCallback(() => {\n    void confirm({\n      title: \"Are you sure you want to sign out?\",\n      ok: \"Sign out\",\n    }).then((response) => {\n      if (response === \"ok\") {\n        void beginSignOut();\n      }\n    });\n  }, [beginSignOut, confirm]);\n\n  const onSignInClick = useCallback(() => {\n    void analytics.logEvent(AppEvent.APP_BAR_CLICK_CTA, {\n      user: currentUserType,\n      cta: \"sign-in\",\n    });\n    signIn?.();\n  }, [analytics, currentUserType, signIn]);\n\n  const onSettingsClick = useCallback(\n    (tab?: AppSettingsTab) => {\n      void analytics.logEvent(AppEvent.APP_BAR_CLICK_CTA, {\n        user: currentUserType,\n        cta: \"app-settings-dialog\",\n      });\n      dialogActions.preferences.open(tab);\n    },\n    [analytics, currentUserType, dialogActions.preferences],\n  );\n\n  const onProfileClick = useCallback(() => {\n    void analytics.logEvent(AppEvent.APP_BAR_CLICK_CTA, {\n      user: currentUserType,\n      cta: \"profile\",\n    });\n    window.open(process.env.FOXGLOVE_ACCOUNT_PROFILE_URL, \"_blank\");\n  }, [analytics, currentUserType]);\n\n  const onDocsClick = useCallback(() => {\n    void analytics.logEvent(AppEvent.APP_BAR_CLICK_CTA, {\n      user: currentUserType,\n      cta: \"docs\",\n    });\n    window.open(\"https://foxglove.dev/docs\", \"_blank\");\n  }, [analytics, currentUserType]);\n\n  const onSlackClick = useCallback(() => {\n    void analytics.logEvent(AppEvent.APP_BAR_CLICK_CTA, {\n      user: currentUserType,\n      cta: \"join-slack\",\n    });\n    window.open(\"https://foxglove.dev/slack\", \"_blank\");\n  }, [analytics, currentUserType]);\n\n  return (\n    <>\n      <Menu\n        anchorEl={anchorEl}\n        anchorReference={anchorReference}\n        anchorPosition={anchorPosition}\n        disablePortal={disablePortal}\n        id=\"user-menu\"\n        open={open}\n        onClose={handleClose}\n        onClick={handleClose}\n        MenuListProps={{ className: classes.menuList, dense: true }}\n        PaperProps={\n          {\n            \"data-tourid\": \"user-menu\",\n          } as Partial<PaperProps & { \"data-tourid\"?: string }>\n        }\n      >\n        {currentUser && <MenuItem disabled>{currentUser.email}</MenuItem>}\n        <MenuItem onClick={() => onSettingsClick()}>Settings</MenuItem>\n        <MenuItem onClick={() => onSettingsClick(\"extensions\")}>Extensions</MenuItem>\n        {currentUser && <MenuItem onClick={onProfileClick}>User profile</MenuItem>}\n        <Divider variant=\"middle\" />\n        <MenuItem onClick={onDocsClick}>Documentation</MenuItem>\n        <MenuItem onClick={onSlackClick}>Join Slack community</MenuItem>\n        {signIn != undefined && <Divider variant=\"middle\" />}\n        {currentUser ? (\n          <MenuItem onClick={onSignoutClick}>Sign out</MenuItem>\n        ) : signIn != undefined ? (\n          <MenuItem onClick={onSignInClick}>Sign in</MenuItem>\n        ) : undefined}\n      </Menu>\n      {confirmModal}\n    </>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport {\n  ChevronDown12Regular,\n  PanelLeft24Filled,\n  PanelLeft24Regular,\n  PanelRight24Filled,\n  PanelRight24Regular,\n  SlideAdd24Regular,\n} from \"@fluentui/react-icons\";\nimport { Avatar, Button, IconButton, Tooltip, AppBar as MuiAppBar } from \"@mui/material\";\nimport { useCallback, useLayoutEffect, useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport tc from \"tinycolor2\";\nimport { makeStyles } from \"tss-react/mui\";\nimport { shallow } from \"zustand/shallow\";\n\nimport { AppSetting } from \"@foxglove/studio-base/AppSetting\";\nimport { AppBarIconButton } from \"@foxglove/studio-base/components/AppBar/AppBarIconButton\";\nimport { AppMenu } from \"@foxglove/studio-base/components/AppBar/AppMenu\";\nimport {\n  CustomWindowControls,\n  CustomWindowControlsProps,\n} from \"@foxglove/studio-base/components/AppBar/CustomWindowControls\";\nimport { FoxgloveLogo } from \"@foxglove/studio-base/components/FoxgloveLogo\";\nimport { MemoryUseIndicator } from \"@foxglove/studio-base/components/MemoryUseIndicator\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { useAnalytics } from \"@foxglove/studio-base/context/AnalyticsContext\";\nimport { useAppContext } from \"@foxglove/studio-base/context/AppContext\";\nimport {\n  LayoutState,\n  useCurrentLayoutSelector,\n} from \"@foxglove/studio-base/context/CurrentLayoutContext\";\nimport { useCurrentUser } from \"@foxglove/studio-base/context/CurrentUserContext\";\nimport {\n  useWorkspaceStore,\n  WorkspaceContextStore,\n} from \"@foxglove/studio-base/context/Workspace/WorkspaceContext\";\nimport { useWorkspaceActions } from \"@foxglove/studio-base/context/Workspace/useWorkspaceActions\";\nimport { useAppConfigurationValue } from \"@foxglove/studio-base/hooks\";\nimport { AppEvent } from \"@foxglove/studio-base/services/IAnalytics\";\nimport { fonts } from \"@foxglove/studio-base/util/sharedStyleConstants\";\n\nimport { AddPanelMenu } from \"./AddPanelMenu\";\nimport { DataSource } from \"./DataSource\";\nimport { UserMenu } from \"./UserMenu\";\nimport { APP_BAR_HEIGHT } from \"./constants\";\n\nconst useStyles = makeStyles<{ leftInset?: number; debugDragRegion?: boolean }, \"avatar\">()(\n  (theme, { leftInset, debugDragRegion = false }, classes) => {\n    const DRAGGABLE_STYLE: Record<string, string> = { WebkitAppRegion: \"drag\" };\n    const NOT_DRAGGABLE_STYLE: Record<string, string> = { WebkitAppRegion: \"no-drag\" };\n    if (debugDragRegion) {\n      DRAGGABLE_STYLE.backgroundColor = \"green\";\n      NOT_DRAGGABLE_STYLE.backgroundColor = \"red\";\n    }\n    return {\n      appBar: {\n        gridArea: \"appbar\",\n        boxShadow: \"none\",\n        backgroundColor: theme.palette.common.white,\n        borderBottom: `2px solid ${theme.palette.divider}`,\n        color: theme.palette.appBar.main,\n        height: APP_BAR_HEIGHT,\n\n        // Leave space for system window controls on the right on Windows.\n        // Use hard-coded padding for Mac because it looks better than env(titlebar-area-x).\n        paddingLeft: leftInset,\n        paddingRight: \"calc(100% - env(titlebar-area-x) - env(titlebar-area-width))\",\n        ...DRAGGABLE_STYLE, // make custom window title bar draggable for desktop app\n      },\n      toolbar: {\n        display: \"grid\",\n        width: \"100%\",\n        gridTemplateAreas: `\"start middle end\"`,\n        gridTemplateColumns: \"1fr auto 1fr\",\n        alignItems: \"center\",\n      },\n      logo: {\n        padding: theme.spacing(0.75, 0.5),\n        fontSize: \"2rem\",\n        color: theme.palette.appBar.primary,\n        borderRadius: 0,\n        marginLeft: theme.spacing(1),\n\n        \"svg:not(.MuiSvgIcon-root)\": {\n          fontSize: \"1em\",\n          color: theme.palette.appBar.primary,\n          fill: \"currentColor\",\n        },\n        \"&:hover\": {\n          backgroundColor: tc(theme.palette.common.white).setAlpha(0.08).toRgbString(),\n        },\n        \"&.Mui-selected\": {\n          backgroundColor: theme.palette.appBar.primary,\n          color: theme.palette.common.white,\n        },\n        \"&.Mui-disabled\": {\n          color: \"currentColor\",\n          opacity: theme.palette.action.disabledOpacity,\n        },\n      },\n      dropDownIcon: {\n        fontSize: \"12px !important\",\n      },\n      start: {\n        gridArea: \"start\",\n        display: \"flex\",\n        flex: 1,\n        alignItems: \"center\",\n      },\n      startInner: {\n        display: \"flex\",\n        alignItems: \"center\",\n        ...NOT_DRAGGABLE_STYLE, // make buttons clickable for desktop app\n      },\n      middle: {\n        gridArea: \"middle\",\n        justifySelf: \"center\",\n        overflow: \"hidden\",\n        maxWidth: \"100%\",\n        ...NOT_DRAGGABLE_STYLE, // make buttons clickable for desktop app\n      },\n      end: {\n        gridArea: \"end\",\n        flex: 1,\n        display: \"flex\",\n        justifyContent: \"flex-end\",\n      },\n      endInner: {\n        display: \"flex\",\n        alignItems: \"center\",\n        ...NOT_DRAGGABLE_STYLE, // make buttons clickable for desktop app\n      },\n      keyEquivalent: {\n        fontFamily: fonts.MONOSPACE,\n        background: tc(theme.palette.common.white).darken(45).toString(),\n        padding: theme.spacing(0, 0.5),\n        aspectRatio: 1,\n        borderRadius: theme.shape.borderRadius,\n        marginLeft: theme.spacing(1),\n      },\n      tooltip: {\n        marginTop: `${theme.spacing(0.5)} !important`,\n      },\n      avatar: {\n        color: theme.palette.common.white,\n        backgroundColor: tc(theme.palette.appBar.main).lighten().toString(),\n        height: theme.spacing(3.5),\n        width: theme.spacing(3.5),\n      },\n      iconButton: {\n        padding: theme.spacing(1),\n        borderRadius: 0,\n\n        \"&:hover\": {\n          backgroundColor: tc(theme.palette.common.white).setAlpha(0.08).toString(),\n\n          [`.${classes.avatar}`]: {\n            backgroundColor: tc(theme.palette.appBar.main).lighten(20).toString(),\n          },\n        },\n        \"&.Mui-selected\": {\n          backgroundColor: theme.palette.appBar.primary,\n\n          [`.${classes.avatar}`]: {\n            backgroundColor: tc(theme.palette.appBar.main).setAlpha(0.3).toString(),\n          },\n        },\n      },\n      button: {\n        marginInline: theme.spacing(1),\n        backgroundColor: theme.palette.appBar.primary,\n\n        \"&:hover\": {\n          backgroundColor: theme.palette.augmentColor({\n            color: { main: theme.palette.appBar.primary as string },\n          }).dark,\n        },\n      },\n    };\n  },\n);\n\ntype AppBarProps = CustomWindowControlsProps & {\n  leftInset?: number;\n  onDoubleClick?: () => void;\n  debugDragRegion?: boolean;\n  disableSignIn?: boolean;\n};\n\nconst selectCurrentLayoutId = ({ selectedLayout }: LayoutState) => selectedLayout?.id;\nconst selectWorkspace = (store: WorkspaceContextStore) => store;\n\nexport function AppBar(props: AppBarProps): JSX.Element {\n  const {\n    debugDragRegion,\n    disableSignIn = false,\n    isMaximized,\n    leftInset,\n    onCloseWindow,\n    onDoubleClick,\n    onMaximizeWindow,\n    onMinimizeWindow,\n    onUnmaximizeWindow,\n    showCustomWindowControls = false,\n  } = props;\n  const { classes, cx, theme } = useStyles({ leftInset, debugDragRegion });\n  const { currentUser, signIn } = useCurrentUser();\n  const { t } = useTranslation(\"appBar\");\n\n  const { appBarLayoutButton } = useAppContext();\n\n  const analytics = useAnalytics();\n  const [enableMemoryUseIndicator = false] = useAppConfigurationValue<boolean>(\n    AppSetting.ENABLE_MEMORY_USE_INDICATOR,\n  );\n\n  const currentLayoutId = useCurrentLayoutSelector(selectCurrentLayoutId);\n\n  const {\n    sidebars: {\n      left: { open: leftSidebarOpen },\n      right: { open: rightSidebarOpen },\n    },\n  } = useWorkspaceStore(selectWorkspace, shallow);\n  const { sidebarActions } = useWorkspaceActions();\n\n  const [appMenuEl, setAppMenuEl] = useState<undefined | HTMLElement>(undefined);\n  const [userAnchorEl, setUserAnchorEl] = useState<undefined | HTMLElement>(undefined);\n  const [panelAnchorEl, setPanelAnchorEl] = useState<undefined | HTMLElement>(undefined);\n\n  const appMenuOpen = Boolean(appMenuEl);\n  const userMenuOpen = Boolean(userAnchorEl);\n  const panelMenuOpen = Boolean(panelAnchorEl);\n\n  // onComponentDidMount\n  useLayoutEffect(() => {\n    let container = document.getElementById(\"app-top-bar\");\n    if (container) {\n      let navButton = document.getElementById(\"menu-button\");\n      let navButton2 = document.getElementById(\"menu-button-2\");\n      if (navButton2) {\n        // move menu button into app-top-bar\n        navButton?.style.setProperty(\"display\", \"none\");\n        navButton2.classList.remove(\"d-none\");\n        container.prepend(navButton2);\n      }\n    }\n    let navCurrent = document.getElementById(\"3d-panel-nav-link\");\n    if (navCurrent) {\n      navCurrent.classList.add(\"active\");\n    }\n  }, []);\n\n  const handleDoubleClick = useCallback(\n    (event: React.MouseEvent) => {\n      event.stopPropagation();\n      event.preventDefault();\n      onDoubleClick?.();\n    },\n    [onDoubleClick],\n  );\n\n  return (\n    <>\n      <MuiAppBar\n        className={classes.appBar}\n        position=\"relative\"\n        color=\"inherit\"\n        elevation={0}\n        onDoubleClick={handleDoubleClick}\n        data-tourid=\"app-bar\"\n      >\n        <div className={classes.toolbar}>\n          <div className={classes.start}>\n            <div className={classes.startInner} id=\"app-top-bar\">\n              <IconButton\n                className={cx(classes.logo, { \"Mui-selected\": appMenuOpen })}\n                color=\"inherit\"\n                id=\"app-menu-button\"\n                title=\"Menu\"\n                aria-controls={appMenuOpen ? \"app-menu\" : undefined}\n                aria-haspopup=\"true\"\n                aria-expanded={appMenuOpen ? \"true\" : undefined}\n                data-tourid=\"app-menu-button\"\n                onClick={(event) => {\n                  setAppMenuEl(event.currentTarget);\n                }}\n              >\n                <FoxgloveLogo fontSize=\"inherit\" color=\"inherit\" />\n                <ChevronDown12Regular\n                  className={classes.dropDownIcon}\n                  primaryFill={theme.palette.appBar.primary}\n                />\n              </IconButton>\n              <AppMenu\n                open={appMenuOpen}\n                anchorEl={appMenuEl}\n                handleClose={() => setAppMenuEl(undefined)}\n              />\n              <AppBarIconButton\n                className={cx({ \"Mui-selected\": panelMenuOpen })}\n                color=\"inherit\"\n                disabled={currentLayoutId == undefined}\n                id=\"add-panel-button\"\n                data-tourid=\"add-panel-button\"\n                title=\"Add panel\"\n                aria-label=\"Add panel button\"\n                aria-controls={panelMenuOpen ? \"add-panel-menu\" : undefined}\n                aria-haspopup=\"true\"\n                aria-expanded={panelMenuOpen ? \"true\" : undefined}\n                onClick={(event) => {\n                  setPanelAnchorEl(event.currentTarget);\n                }}\n              >\n                <SlideAdd24Regular />\n              </AppBarIconButton>\n            </div>\n          </div>\n\n          <div className={classes.middle}>\n            <DataSource />\n          </div>\n\n          <div className={classes.end}>\n            <div className={classes.endInner}>\n              {enableMemoryUseIndicator && <MemoryUseIndicator />}\n              {appBarLayoutButton}\n              <Stack direction=\"row\" alignItems=\"center\" data-tourid=\"sidebar-button-group\">\n                <AppBarIconButton\n                  title={\n                    <>\n                      {leftSidebarOpen ? \"Hide\" : \"Show\"} left sidebar---{\" \"}\n                      <kbd className={classes.keyEquivalent}>[</kbd>\n                    </>\n                  }\n                  aria-label={`${leftSidebarOpen ? \"Hide\" : \"Show\"} left sidebar`}\n                  onClick={() => sidebarActions.left.setOpen(!leftSidebarOpen)}\n                  data-tourid=\"left-sidebar-button\"\n                >\n                  {leftSidebarOpen ? <PanelLeft24Filled /> : <PanelLeft24Regular />}\n                </AppBarIconButton>\n                <AppBarIconButton\n                  title={\n                    <>\n                      {rightSidebarOpen ? \"Hide\" : \"Show\"} right sidebar---{\" \"}\n                      <kbd className={classes.keyEquivalent}>]</kbd>\n                    </>\n                  }\n                  aria-label={`${rightSidebarOpen ? \"Hide\" : \"Show\"} right sidebar`}\n                  onClick={() => sidebarActions.right.setOpen(!rightSidebarOpen)}\n                  data-tourid=\"right-sidebar-button\"\n                >\n                  {rightSidebarOpen ? <PanelRight24Filled /> : <PanelRight24Regular />}\n                </AppBarIconButton>\n              </Stack>\n              {!disableSignIn && !currentUser && signIn != undefined && (\n                <Button\n                  variant=\"contained\"\n                  color=\"primary\"\n                  className={classes.button}\n                  size=\"small\"\n                  onClick={() => {\n                    signIn();\n                    void analytics.logEvent(AppEvent.APP_BAR_CLICK_CTA, {\n                      user: \"unauthenticated\",\n                      cta: \"sign-in\",\n                    });\n                  }}\n                >\n                  {t(\"signIn\")}\n                </Button>\n              )}\n              <Tooltip\n                classes={{ tooltip: classes.tooltip }}\n                title={currentUser?.email ?? \"Profile\"}\n                arrow={false}\n              >\n                <IconButton\n                  className={cx(classes.iconButton, { \"Mui-selected\": userMenuOpen })}\n                  aria-label=\"User profile menu button\"\n                  color=\"inherit\"\n                  id=\"user-button\"\n                  data-tourid=\"user-button\"\n                  aria-controls={userMenuOpen ? \"user-menu\" : undefined}\n                  aria-haspopup=\"true\"\n                  aria-expanded={userMenuOpen ? \"true\" : undefined}\n                  onClick={(event) => setUserAnchorEl(event.currentTarget)}\n                  data-testid=\"user-button\"\n                >\n                  <Avatar\n                    src={currentUser?.avatarImageUrl ?? undefined}\n                    className={classes.avatar}\n                    variant=\"rounded\"\n                  />\n                </IconButton>\n              </Tooltip>\n              {showCustomWindowControls && (\n                <CustomWindowControls\n                  onMinimizeWindow={onMinimizeWindow}\n                  isMaximized={isMaximized}\n                  onUnmaximizeWindow={onUnmaximizeWindow}\n                  onMaximizeWindow={onMaximizeWindow}\n                  onCloseWindow={onCloseWindow}\n                />\n              )}\n            </div>\n          </div>\n        </div>\n      </MuiAppBar>\n      <AddPanelMenu\n        anchorEl={panelAnchorEl}\n        open={panelMenuOpen}\n        handleClose={() => setPanelAnchorEl(undefined)}\n      />\n      <UserMenu\n        anchorEl={userAnchorEl}\n        open={userMenuOpen}\n        handleClose={() => setUserAnchorEl(undefined)}\n      />\n    </>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useLayoutEffect, useRef } from \"react\";\nimport * as THREE from \"three\";\nimport { makeStyles } from \"tss-react/mui\";\n\nconst useStyles = makeStyles()({\n  container: {\n    position: \"absolute\",\n    top: \"0\",\n    left: \"0\",\n    width: \"100%\",\n    height: \"100%\",\n  },\n});\n\nexport default function Snow({ effect }: { effect: \"snow\" | \"confetti\" }): JSX.Element {\n  const { classes } = useStyles();\n  const containerRef = useRef<HTMLDivElement>(ReactNull);\n\n  useLayoutEffect(() => {\n    let requestID: ReturnType<typeof requestAnimationFrame>;\n    const container = containerRef.current;\n    if (!container) {\n      return;\n    }\n\n    const scene = new THREE.Scene();\n    const camera = new THREE.OrthographicCamera();\n\n    const POINT_COUNT = effect === \"snow\" ? 75 : 100;\n    const positions = new Float32Array(POINT_COUNT * 3);\n    const colors = new Float32Array(POINT_COUNT * 3);\n    const sizes = new Float32Array(POINT_COUNT);\n    const phases = new Float32Array(POINT_COUNT);\n\n    const vertex = new THREE.Vector3();\n    const color = new THREE.Color();\n    for (let i = 0; i < POINT_COUNT; i++) {\n      vertex.x = Math.random();\n      vertex.y = Math.random();\n      vertex.z = -1.0;\n      vertex.toArray(positions, i * 3);\n\n      if (effect === \"snow\") {\n        color.setRGB(1.0, 1.0, 1.0);\n      } else {\n        color.setHSL(Math.random(), 1.0, 0.5);\n      }\n      color.toArray(colors, i * 3);\n\n      sizes[i] = Math.random();\n      phases[i] = Math.random() * Math.PI;\n    }\n\n    const geometry = new THREE.BufferGeometry();\n    geometry.setAttribute(\"position\", new THREE.BufferAttribute(positions, 3));\n    geometry.setAttribute(\"color\", new THREE.BufferAttribute(colors, 3));\n    geometry.setAttribute(\"size\", new THREE.BufferAttribute(sizes, 1));\n    geometry.setAttribute(\"phase\", new THREE.BufferAttribute(phases, 1));\n\n    const material = new THREE.ShaderMaterial({\n      uniforms: {\n        time: { value: 1.0 },\n        yspeed: { value: effect === \"snow\" ? 0.1 : 0.2 },\n        wind: { value: effect === \"snow\" ? 0.02 : 0.0 },\n      },\n      vertexShader: /* glsl */ `\n      uniform float time;\n      uniform float yspeed;\n      uniform float wind;\n      attribute vec3 color;\n      attribute float size;\n      attribute float phase;\n      const float xspeed = 10.0;\n      const float amplitude = 0.03;\n      const float minsize = 5.0;\n      const float maxsize = 12.0;\n      varying vec4 vcolor;\n      void main() {\n        vcolor = vec4(color, 1.0);\n        float x = mix(-1.0, 1.0, mod(\n          position.x + sin(phase + time * xspeed * yspeed) * amplitude + time * xspeed * yspeed * wind,\n          1.0));\n\t\t\t\tfloat y = mix(-1.0, 1.0, mod(position.y - time * yspeed * mix(0.2, 1.0, size), 1.0));\n\t\t\t\tgl_PointSize = mix(minsize, maxsize, size);\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(x, y, position.z, 1.0);\n\t\t\t}\n      `,\n      fragmentShader: /* glsl */ `\n      varying vec4 vcolor;\n\t\t\tvoid main() {\n        if (length(gl_PointCoord * 2.0 - 1.0) > 1.0) {\n          discard;\n        }\n\t\t\t\tgl_FragColor = vcolor;\n\t\t\t}\n      `,\n    });\n\n    const points = new THREE.Points(geometry, material);\n    scene.add(points);\n\n    const renderer = new THREE.WebGLRenderer({ alpha: true });\n    renderer.setPixelRatio(window.devicePixelRatio);\n    renderer.setSize(container.clientWidth, container.clientHeight);\n    container.appendChild(renderer.domElement);\n\n    const startTime = new Date();\n    function render() {\n      const time = (new Date().getTime() - startTime.getTime()) / 1000.0;\n      material.uniforms.time = { value: time };\n\n      renderer.render(scene, camera);\n    }\n\n    let animating = true;\n    function animate() {\n      if (!animating) {\n        return;\n      }\n\n      requestID = requestAnimationFrame(animate);\n      render();\n    }\n\n    animate();\n\n    return () => {\n      animating = false;\n      geometry.dispose();\n      material.dispose();\n      renderer.dispose();\n      container.removeChild(renderer.domElement);\n      cancelAnimationFrame(requestID);\n    };\n  }, [effect]);\n\n  return <div className={classes.container} ref={containerRef} />;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { SvgIcon, SvgIconProps } from \"@mui/material\";\n\nexport default function BlockheadFilledIcon(props: SvgIconProps): JSX.Element {\n  return (\n    <SvgIcon {...props}>\n      <g fill=\"currentColor\">\n        <rect x=\"8.07\" y=\"5.38\" width=\"7.87\" height=\"7.87\" rx=\"2\" />\n        <path d=\"M12,1.53A10.5,10.5,0,1,0,22.5,12,10.51,10.51,0,0,0,12,1.53ZM18.41,19l-1.67-2.61a2.47,2.47,0,0,0-2-1H9.26a2.48,2.48,0,0,0-2,1L5.59,19a9.5,9.5,0,1,1,12.82,0Z\" />\n      </g>\n    </SvgIcon>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { SvgIcon, SvgIconProps } from \"@mui/material\";\n\nexport default function BlockheadIcon(props: SvgIconProps): JSX.Element {\n  return (\n    <SvgIcon {...props}>\n      <g fill=\"currentColor\">\n        <path d=\"M22.5,12A10.5,10.5,0,1,0,5.08,19.87l0,0,.35.28a10,10,0,0,0,1.55,1l.24.12.6.29.4.16.48.17.45.14.48.13c.15,0,.3.07.46.09a5,5,0,0,0,.56.09l.39.05c.32,0,.65.05,1,.05s.66,0,1-.05l.39-.05a5,5,0,0,0,.56-.09,3.41,3.41,0,0,0,.46-.1,3.59,3.59,0,0,0,.47-.12l.47-.14.46-.17.42-.17.55-.26.29-.15a9.84,9.84,0,0,0,1.54-1l.35-.28,0,0A10.44,10.44,0,0,0,22.5,12Zm-5.12,7.82-.15.11-.58.34-.2.12-.61.29a1,1,0,0,1-.18.08,6.77,6.77,0,0,1-.75.28l-.35.1-.48.12-.37.08-.53.08-.31,0c-.29,0-.58,0-.87,0s-.58,0-.87,0l-.31,0-.53-.08-.37-.08-.48-.12L9.09,21a6.77,6.77,0,0,1-.75-.28,1,1,0,0,1-.18-.08l-.61-.29-.2-.12c-.2-.11-.39-.22-.58-.35l-.15-.1-.22-.17L8.06,17a1.51,1.51,0,0,1,1.22-.62h5.44a1.51,1.51,0,0,1,1.21.6l1.67,2.65A1.84,1.84,0,0,1,17.38,19.82Zm-.63-3.38a2.49,2.49,0,0,0-2-1H9.28a2.5,2.5,0,0,0-2,1.07L5.62,19a9.5,9.5,0,1,1,12.76,0Z\" />\n        <path d=\"M14,5.36h-3.9a2,2,0,0,0-2,2v3.9a2,2,0,0,0,2,2H14a2,2,0,0,0,2-2V7.36A2,2,0,0,0,14,5.36Zm1,5.9a1,1,0,0,1-1,1h-3.9a1,1,0,0,1-1-1V7.36a1,1,0,0,1,1-1H14a1,1,0,0,1,1,1Z\" />\n      </g>\n    </SvgIcon>\n  );\n}\n","var _g;\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nimport * as React from \"react\";\nvar SvgDatabaseSettings = function SvgDatabaseSettings(props) {\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    viewBox: \"0 0 24 24\"\n  }, props), _g || (_g = /*#__PURE__*/React.createElement(\"g\", {\n    fill: \"currentColor\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"m22.6 19.07-1.07-.83c.02-.16.04-.32.04-.49s-.01-.33-.04-.49l1.06-.83a.26.26 0 0 0 .06-.32l-1-1.73c-.06-.11-.19-.15-.31-.11l-1.24.5c-.26-.2-.54-.37-.85-.49l-.19-1.32c-.01-.12-.12-.21-.24-.21h-2c-.12 0-.23.09-.25.21l-.19 1.32c-.3.13-.59.29-.85.49l-1.24-.5c-.11-.04-.24 0-.31.11l-1 1.73c-.06.11-.04.24.06.32l1.06.83a3.908 3.908 0 0 0 0 .98l-1.06.83a.26.26 0 0 0-.06.32l1 1.73c.06.11.19.15.31.11l1.24-.5c.26.2.54.37.85.49l.19 1.32c.02.12.12.21.25.21h2c.12 0 .23-.09.25-.21l.19-1.32c.3-.13.59-.29.84-.49l1.25.5c.11.04.24 0 .31-.11l1-1.73a.26.26 0 0 0-.06-.32Zm-4.78.18c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5Z\"\n  }), /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M4 6v12c0 .69.32 1.29.77 1.78.45.48 1.08.88 1.79 1.2 1.43.64 3.35 1.02 5.43 1.02.51 0 .53-.02 1.01-.07-.42-.52-.46-.84-.88-1.43-1.87-.01-3.78-.36-4.95-.89-.6-.27-1.04-.57-1.32-.86-.28-.29-.37-.54-.37-.75V8.39c.32.22.68.42 1.07.59C7.98 9.62 9.9 10 11.98 10s4-.38 5.43-1.02c.39-.17.75-.37 1.07-.59v3.43h.75c.49 0 .75.56.75.56V6.01c0-.69-.32-1.29-.77-1.78-.45-.48-1.08-.88-1.79-1.2-1.43-.64-3.35-1.02-5.43-1.02s-4 .38-5.43 1.02c-.71.32-1.34.72-1.79 1.2C4.31 4.72 4 5.32 4 6.01Zm1.5 0c0-.21.09-.46.36-.75.28-.3.72-.6 1.32-.86 1.2-.54 2.9-.89 4.82-.89s3.62.35 4.82.89c.6.27 1.04.57 1.32.86.27.29.36.54.36.75s-.09.46-.36.75c-.28.3-.72.6-1.32.86-1.19.54-2.9.89-4.82.89s-3.62-.35-4.82-.89c-.6-.27-1.04-.57-1.32-.86-.27-.29-.36-.54-.36-.75Z\"\n  }))));\n};\nexport default SvgDatabaseSettings;","var _path;\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nimport * as React from \"react\";\nvar SvgPanelLayout = function SvgPanelLayout(props) {\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    viewBox: \"0 0 24 24\"\n  }, props), _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    fill: \"currentColor\",\n    d: \"M19.25 4H4.75C3.23 4 2 5.23 2 6.75v10.5C2 18.77 3.23 20 4.75 20h14.5c1.52 0 2.75-1.23 2.75-2.75V6.75C22 5.23 20.77 4 19.25 4Zm1.25 2.75v4.5h-3.27V5.5h2.02c.69 0 1.25.56 1.25 1.25Zm-8.06 6h3.29v5.75h-3.29v-5.75Zm0-1.5V5.5h3.29v5.75h-3.29Zm-8.94 6V6.75c0-.69.56-1.25 1.25-1.25h6.19v13H4.75c-.69 0-1.25-.56-1.25-1.25Zm15.75 1.25h-2.02v-5.75h3.27v4.5c0 .69-.56 1.25-1.25 1.25Z\"\n  })));\n};\nexport default SvgPanelLayout;","var _g;\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nimport * as React from \"react\";\nvar SvgPanelSettings = function SvgPanelSettings(props) {\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    xmlns: \"http://www.w3.org/2000/svg\",\n    viewBox: \"0 0 24 24\"\n  }, props), _g || (_g = /*#__PURE__*/React.createElement(\"g\", {\n    fill: \"currentColor\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M4.75 18.5c-.69 0-1.25-.56-1.25-1.25V6.75c0-.69.56-1.25 1.25-1.25h14.5c.69 0 1.25.56 1.25 1.25v4.98c.55.29 1.05.65 1.5 1.08V6.75C22 5.23 20.77 4 19.25 4H4.75C3.23 4 2 5.23 2 6.75v10.5C2 18.77 3.23 20 4.75 20h6.75c-.2-.47-.34-.98-.42-1.5H4.75Z\"\n  }), /*#__PURE__*/React.createElement(\"path\", {\n    d: \"m22.28 18.82-1.07-.83c.02-.16.04-.32.04-.49s-.01-.33-.04-.49l1.06-.83a.26.26 0 0 0 .06-.32l-1-1.73c-.06-.11-.19-.15-.31-.11l-1.24.5c-.26-.2-.54-.37-.85-.49l-.19-1.32c-.01-.12-.12-.21-.24-.21h-2c-.12 0-.23.09-.25.21l-.19 1.32c-.3.13-.59.29-.85.49l-1.24-.5c-.11-.04-.24 0-.31.11l-1 1.73c-.06.11-.04.24.06.32l1.06.83a3.908 3.908 0 0 0 0 .98l-1.06.83a.26.26 0 0 0-.06.32l1 1.73c.06.11.19.15.31.11l1.24-.5c.26.2.54.37.85.49l.19 1.32c.02.12.12.21.25.21h2c.12 0 .23-.09.25-.21l.19-1.32c.3-.13.59-.29.84-.49l1.25.5c.11.04.24 0 .31-.11l1-1.73a.26.26 0 0 0-.06-.32ZM17.5 19c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5Z\"\n  }))));\n};\nexport default SvgPanelSettings;","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport {\n  Add24Regular,\n  AppsAddIn24Regular,\n  BarcodeScanner24Regular,\n  BookStar24Regular,\n  BracesVariable24Regular,\n  Delete24Regular,\n  Dismiss24Regular,\n  DismissCircle24Regular,\n  Document24Regular,\n  DocumentLink24Regular,\n  Edit24Regular,\n  Flow16Regular,\n  GridDots24Filled,\n  Settings20Regular,\n  SlideAdd24Regular,\n  Sparkle24Regular,\n  TextBulletListLtr24Regular,\n} from \"@fluentui/react-icons\";\n\nimport BlockheadFilledIcon from \"@foxglove/studio-base/components/BlockheadFilledIcon\";\nimport BlockheadIcon from \"@foxglove/studio-base/components/BlockheadIcon\";\nimport { RegisteredIconNames } from \"@foxglove/studio-base/types/Icons\";\n\nimport DatabaseSettings from \"../assets/database-settings.svg\";\nimport PanelLayout from \"../assets/panel-layout.svg\";\nimport PanelSettings from \"../assets/panel-settings.svg\";\n\nconst icons: {\n  // This makes it a type error to forget to add an icon here once it has been added to RegisteredIconNames.\n  [N in RegisteredIconNames]: React.ReactElement;\n} = {\n  Add: <Add24Regular />,\n  AddIn: <AppsAddIn24Regular />,\n  BacklogList: <TextBulletListLtr24Regular />,\n  Blockhead: <BlockheadIcon />,\n  BlockheadFilled: <BlockheadFilledIcon />,\n  BookStar: <BookStar24Regular />,\n  Cancel: <Dismiss24Regular />,\n  DatabaseSettings: <DatabaseSettings />,\n  Delete: <Delete24Regular />,\n  Edit: <Edit24Regular />,\n  ErrorBadge: <DismissCircle24Regular />,\n  FileASPX: <DocumentLink24Regular />,\n  FiveTileGrid: <PanelLayout />,\n  Flow: <Flow16Regular />,\n  GenericScan: <BarcodeScanner24Regular />,\n  OpenFile: <Document24Regular />,\n  PanelSettings: <PanelSettings />,\n  RectangularClipping: <SlideAdd24Regular />,\n  Settings: <Settings20Regular />,\n  Sparkle: <Sparkle24Regular />,\n  Variable2: <BracesVariable24Regular />,\n  ROS: <GridDots24Filled />,\n};\n\nexport default icons;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport ICONS from \"@foxglove/studio-base/theme/icons\";\nimport { RegisteredIconNames } from \"@foxglove/studio-base/types/Icons\";\n\ntype BuiltinIconProps = {\n  name?: RegisteredIconNames;\n};\n\nexport function BuiltinIcon(props: BuiltinIconProps): JSX.Element {\n  if (props.name == undefined) {\n    return <></>;\n  }\n  return ICONS[props.name];\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { FormHelperText, TextField } from \"@mui/material\";\nimport { ChangeEvent, useState } from \"react\";\n\nimport { Field } from \"@foxglove/studio-base/context/PlayerSelectionContext\";\n\ntype Props = {\n  disabled: boolean;\n  field: Field;\n  onChange: (newValue: string | undefined) => void;\n  onError: (message: string) => void;\n};\n\nexport function FormField(props: Props): JSX.Element {\n  const [error, setError] = useState<string | undefined>();\n  const field = props.field;\n\n  const onChange = (event: ChangeEvent<HTMLInputElement>) => {\n    setError(undefined);\n\n    const maybeError = field.validate?.(event.target.value);\n\n    if (maybeError instanceof Error) {\n      setError(maybeError.message);\n      props.onError(maybeError.message);\n      return;\n    }\n\n    props.onChange(event.target.value);\n  };\n\n  return (\n    <div>\n      <TextField\n        fullWidth\n        disabled={props.disabled}\n        key={field.label}\n        label={field.label}\n        error={error != undefined}\n        helperText={error}\n        FormHelperTextProps={{\n          variant: \"standard\",\n        }}\n        placeholder={field.placeholder}\n        defaultValue={field.defaultValue}\n        onChange={onChange}\n        variant=\"outlined\"\n        InputProps={{\n          notched: false,\n        }}\n        InputLabelProps={{ shrink: true }}\n      />\n      <FormHelperText>{field.description}</FormHelperText>\n    </div>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport ChevronLeftIcon from \"@mui/icons-material/ChevronLeft\";\nimport { Button } from \"@mui/material\";\nimport { PropsWithChildren } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { useWorkspaceActions } from \"@foxglove/studio-base/context/Workspace/useWorkspaceActions\";\n\ntype ViewProps = {\n  onOpen?: () => void;\n};\n\nconst useStyles = makeStyles()((theme) => ({\n  content: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    flexGrow: 1,\n    height: \"100%\",\n    justifyContent: \"space-between\",\n    gap: theme.spacing(2),\n    overflowY: \"auto\",\n  },\n}));\n\nexport default function View(props: PropsWithChildren<ViewProps>): JSX.Element {\n  const { onOpen } = props;\n  const { classes } = useStyles();\n  const { dialogActions } = useWorkspaceActions();\n\n  return (\n    <>\n      <div className={classes.content}>{props.children}</div>\n      <Stack\n        direction=\"row\"\n        justifyContent=\"space-between\"\n        alignItems=\"center\"\n        paddingX={4}\n        paddingBottom={4}\n        paddingTop={2}\n      >\n        <Button\n          startIcon={<ChevronLeftIcon fontSize=\"large\" />}\n          onClick={() => dialogActions.dataSource.open(\"start\")}\n          size=\"large\"\n        >\n          Back\n        </Button>\n\n        <Stack direction=\"row\" gap={2}>\n          <Button\n            size=\"large\"\n            color=\"inherit\"\n            variant=\"outlined\"\n            onClick={() => dialogActions.dataSource.close()}\n          >\n            Cancel\n          </Button>\n          <Button size=\"large\" variant=\"contained\" onClick={onOpen} disabled={onOpen == undefined}>\n            Open\n          </Button>\n        </Stack>\n      </Stack>\n    </>\n  );\n\n  return <>{props.children}</>;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Alert, Link, Tab, Tabs, Typography, useMediaQuery, useTheme } from \"@mui/material\";\nimport { useState, useMemo, useCallback, useLayoutEffect, FormEvent } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { BuiltinIcon } from \"@foxglove/studio-base/components/BuiltinIcon\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { useAnalytics } from \"@foxglove/studio-base/context/AnalyticsContext\";\nimport { usePlayerSelection } from \"@foxglove/studio-base/context/PlayerSelectionContext\";\nimport {\n  WorkspaceContextStore,\n  useWorkspaceStore,\n} from \"@foxglove/studio-base/context/Workspace/WorkspaceContext\";\nimport { useWorkspaceActions } from \"@foxglove/studio-base/context/Workspace/useWorkspaceActions\";\nimport { AppEvent } from \"@foxglove/studio-base/services/IAnalytics\";\n\nimport { FormField } from \"./FormField\";\nimport View from \"./View\";\n\nconst useStyles = makeStyles()((theme) => ({\n  grid: {\n    padding: theme.spacing(4, 4, 0),\n    columnGap: theme.spacing(4),\n    rowGap: theme.spacing(2),\n\n    [theme.breakpoints.up(\"md\")]: {\n      overflow: \"hidden\",\n      display: \"grid\",\n      padding: theme.spacing(4, 4, 0, 4),\n      gridTemplateAreas: `\n        \"header header\"\n        \"sidebar form\"\n      `,\n      gridTemplateColumns: \"240px 1fr\",\n      gridTemplateRows: \"auto auto\",\n    },\n  },\n  header: {\n    gridArea: \"header\",\n  },\n  form: {\n    gridArea: \"form\",\n    overflowY: \"auto\",\n  },\n  formInner: {\n    [theme.breakpoints.up(\"md\")]: {\n      height: theme.spacing(43), // this is aproximately the height of the tallest form\n    },\n  },\n  sidebar: {\n    gridArea: \"sidebar\",\n    overflowY: \"auto\",\n  },\n  tab: {\n    \"> svg:not(.MuiSvgIcon-root)\": {\n      display: \"flex\",\n      flex: \"none\",\n      color: theme.palette.primary.main,\n      marginRight: theme.spacing(1.5),\n    },\n    [theme.breakpoints.up(\"md\")]: {\n      textAlign: \"right\",\n      flexDirection: \"row\",\n      justifyContent: \"flex-start\",\n      alignItems: \"center\",\n      minHeight: \"auto\",\n      paddingTop: theme.spacing(1.5),\n      paddingBottom: theme.spacing(1.5),\n    },\n  },\n  indicator: {\n    [theme.breakpoints.up(\"md\")]: {\n      right: 0,\n      width: \"100%\",\n      backgroundColor: theme.palette.action.hover,\n      borderRadius: theme.shape.borderRadius,\n    },\n  },\n}));\n\nconst selectDataSourceDialog = (store: WorkspaceContextStore) => store.dialogs.dataSource;\n\nexport default function Connection(): JSX.Element {\n  const { classes } = useStyles();\n  const theme = useTheme();\n  const mdUp = useMediaQuery(theme.breakpoints.up(\"md\"));\n\n  const { activeDataSource } = useWorkspaceStore(selectDataSourceDialog);\n  const { dialogActions } = useWorkspaceActions();\n\n  const { availableSources, selectSource } = usePlayerSelection();\n  const analytics = useAnalytics();\n\n  // connectionSources is the list of availableSources supporting \"connections\"\n  const connectionSources = useMemo(() => {\n    return availableSources.filter((source) => {\n      return source.type === \"connection\" && source.hidden !== true;\n    });\n  }, [availableSources]);\n\n  // List enabled sources before disabled sources so the default selected item is an available source\n  const enabledSourcesFirst = useMemo(() => {\n    const enabledSources = connectionSources.filter((source) => source.disabledReason == undefined);\n    const disabledSources = connectionSources.filter((source) => source.disabledReason);\n    return [...enabledSources, ...disabledSources];\n  }, [connectionSources]);\n\n  const [selectedConnectionIdx, setSelectedConnectionIdx] = useState<number>(() => {\n    const foundIdx = connectionSources.findIndex((source) => source === activeDataSource);\n    const selectedIdx = foundIdx < 0 ? 0 : foundIdx;\n    void analytics.logEvent(AppEvent.DIALOG_SELECT_VIEW, {\n      type: \"live\",\n      data: enabledSourcesFirst[selectedIdx]?.id,\n    });\n    return selectedIdx;\n  });\n\n  const selectedSource = useMemo(\n    () => enabledSourcesFirst[selectedConnectionIdx],\n    [enabledSourcesFirst, selectedConnectionIdx],\n  );\n\n  const [fieldErrors, setFieldErrors] = useState(new Map<string, string>());\n  const [fieldValues, setFieldValues] = useState<Record<string, string | undefined>>({});\n\n  useLayoutEffect(() => {\n    const connectionIdx = connectionSources.findIndex((source) => source === activeDataSource);\n    if (connectionIdx >= 0) {\n      setSelectedConnectionIdx(connectionIdx);\n    }\n  }, [activeDataSource, connectionSources]);\n\n  // clear field values when the user changes the source tab\n  useLayoutEffect(() => {\n    const defaultFieldValues: Record<string, string | undefined> = {};\n    for (const field of selectedSource?.formConfig?.fields ?? []) {\n      if (field.defaultValue != undefined) {\n        defaultFieldValues[field.id] = field.defaultValue;\n      }\n    }\n    setFieldValues(defaultFieldValues);\n  }, [selectedSource]);\n\n  const onOpen = useCallback(() => {\n    if (!selectedSource) {\n      return;\n    }\n    selectSource(selectedSource.id, { type: \"connection\", params: fieldValues });\n    void analytics.logEvent(AppEvent.DIALOG_CLOSE, { activeDataSource });\n    dialogActions.dataSource.close();\n  }, [\n    selectedSource,\n    selectSource,\n    fieldValues,\n    analytics,\n    activeDataSource,\n    dialogActions.dataSource,\n  ]);\n\n  const disableOpen = selectedSource?.disabledReason != undefined || fieldErrors.size > 0;\n\n  const onSubmit = useCallback(\n    (event: FormEvent) => {\n      event.preventDefault();\n      if (!disableOpen) {\n        onOpen();\n      }\n    },\n    [disableOpen, onOpen],\n  );\n\n  return (\n    <View onOpen={disableOpen ? undefined : onOpen}>\n      <Stack className={classes.grid}>\n        <header className={classes.header}>\n          <Typography variant=\"h3\" fontWeight={600} gutterBottom>\n            Open a new connection\n          </Typography>\n        </header>\n        <div className={classes.sidebar}>\n          <Tabs\n            classes={{ indicator: classes.indicator }}\n            variant=\"scrollable\"\n            textColor=\"inherit\"\n            orientation={mdUp ? \"vertical\" : \"horizontal\"}\n            onChange={(_event, newValue: number) => {\n              setSelectedConnectionIdx(newValue);\n              void analytics.logEvent(AppEvent.DIALOG_SELECT_VIEW, {\n                type: \"live\",\n                data: enabledSourcesFirst[newValue]?.id,\n              });\n            }}\n            value={selectedConnectionIdx}\n          >\n            {enabledSourcesFirst.map((source, idx) => {\n              const { id, iconName, displayName } = source;\n              return (\n                <Tab\n                  value={idx}\n                  key={id}\n                  icon={mdUp ? <BuiltinIcon name={iconName ?? \"Flow\"} /> : undefined}\n                  label={displayName}\n                  className={classes.tab}\n                />\n              );\n            })}\n          </Tabs>\n        </div>\n\n        <Stack className={classes.form} key={selectedSource?.id} flex=\"1 0\">\n          <form onSubmit={onSubmit}>\n            <Stack className={classes.formInner} gap={2}>\n              {selectedSource?.disabledReason == undefined &&\n                selectedSource?.warning != undefined && (\n                  <Alert severity=\"warning\">{selectedSource.warning}</Alert>\n                )}\n              {selectedSource?.disabledReason != undefined && (\n                <Alert severity=\"warning\">{selectedSource.disabledReason}</Alert>\n              )}\n\n              {selectedSource?.description && <Typography>{selectedSource.description}</Typography>}\n              {selectedSource?.formConfig != undefined && (\n                <Stack flexGrow={1} justifyContent=\"space-between\">\n                  <Stack gap={2}>\n                    {selectedSource.formConfig.fields.map((field) => (\n                      <FormField\n                        key={field.id}\n                        field={field}\n                        disabled={selectedSource.disabledReason != undefined}\n                        onError={(err) => {\n                          setFieldErrors((existing) => {\n                            existing.set(field.id, err);\n                            return new Map(existing);\n                          });\n                        }}\n                        onChange={(newValue) => {\n                          setFieldErrors((existing) => {\n                            existing.delete(field.id);\n                            return new Map(existing);\n                          });\n                          setFieldValues((existing) => {\n                            return {\n                              ...existing,\n                              [field.id]: newValue,\n                            };\n                          });\n                        }}\n                      />\n                    ))}\n                  </Stack>\n                </Stack>\n              )}\n              <Stack direction=\"row\" gap={1}>\n                {(selectedSource?.docsLinks ?? []).map((item) => (\n                  <Link\n                    key={item.url}\n                    color=\"primary\"\n                    href={item.url}\n                    target=\"_blank\"\n                    rel=\"noreferrer\"\n                  >\n                    {item.label ? `View docs for ${item.label}` : \"View docs\"}\n                  </Link>\n                ))}\n              </Stack>\n            </Stack>\n          </form>\n        </Stack>\n      </Stack>\n    </View>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { SvgIcon, SvgIconProps } from \"@mui/material\";\n\nexport default function FoxgloveLogoText(props: SvgIconProps): JSX.Element {\n  return (\n    <SvgIcon viewBox=\"0 0 909 204\" {...props}>\n      <title>Foxglove</title>\n      <g>\n        <path\n          d=\"M313.65 92.55H295.05V156H269.85V92.55H258.15V80.25L270.15 73.8V69.9C270.15 59.3 272.55 51.9 277.35 47.7C282.15 43.4 289.25 41.25 298.65 41.25C302.95 41.25 306.85 41.6 310.35 42.3C313.95 43 317.25 43.85 320.25 44.85L314.25 62.25C312.75 61.85 311.05 61.45 309.15 61.05C307.25 60.65 305.15 60.45 302.85 60.45C300.15 60.45 298.15 61.3 296.85 63C295.65 64.6 295.05 66.9 295.05 69.9V73.65H313.65V92.55ZM402.362 114.6C402.362 128.4 398.712 139 391.412 146.4C384.212 153.8 374.312 157.5 361.712 157.5C353.912 157.5 346.962 155.85 340.862 152.55C334.862 149.15 330.112 144.3 326.612 138C323.212 131.6 321.512 123.8 321.512 114.6C321.512 101 325.112 90.55 332.312 83.25C339.612 75.85 349.562 72.15 362.162 72.15C369.962 72.15 376.862 73.8 382.862 77.1C388.962 80.4 393.712 85.2 397.112 91.5C400.612 97.8 402.362 105.5 402.362 114.6ZM347.162 114.6C347.162 122.3 348.312 128.15 350.612 132.15C352.912 136.05 356.712 138 362.012 138C367.212 138 370.962 136.05 373.262 132.15C375.562 128.15 376.712 122.3 376.712 114.6C376.712 107 375.562 101.3 373.262 97.5C370.962 93.6 367.162 91.65 361.862 91.65C356.662 91.65 352.912 93.6 350.612 97.5C348.312 101.3 347.162 107 347.162 114.6ZM434.075 114L408.125 73.65H436.775L451.175 98.4L465.725 73.65H494.375L468.125 114L495.575 156H466.925L451.175 129.3L435.425 156H406.775L434.075 114ZM533.61 72.15C539.01 72.15 543.61 73.2 547.41 75.3C551.21 77.4 554.36 80.3 556.86 84H557.46L559.41 73.65H581.01V156.15C581.01 167.85 577.46 176.75 570.36 182.85C563.36 188.95 552.76 192 538.56 192C532.36 192 526.76 191.65 521.76 190.95C516.76 190.25 511.86 189 507.06 187.2V166.65C512.16 168.75 517.16 170.3 522.06 171.3C526.96 172.4 532.46 172.95 538.56 172.95C550.06 172.95 555.81 167.7 555.81 157.2V155.55C555.81 154.15 555.86 152.55 555.96 150.75C556.16 148.85 556.36 147.05 556.56 145.35H555.81C553.41 149.25 550.31 152.25 546.51 154.35C542.81 156.45 538.36 157.5 533.16 157.5C523.86 157.5 516.46 153.8 510.96 146.4C505.56 139 502.86 128.5 502.86 114.9C502.86 101.2 505.61 90.65 511.11 83.25C516.71 75.85 524.21 72.15 533.61 72.15ZM542.46 92.1C533.16 92.1 528.51 99.85 528.51 115.35C528.51 123.05 529.66 128.75 531.96 132.45C534.36 136.05 537.96 137.85 542.76 137.85C548.06 137.85 551.86 136.3 554.16 133.2C556.46 130.1 557.61 125 557.61 117.9V114.75C557.61 107.05 556.46 101.35 554.16 97.65C551.96 93.95 548.06 92.1 542.46 92.1ZM628.064 156H602.714V42H628.064V156ZM726.386 114.6C726.386 128.4 722.736 139 715.436 146.4C708.236 153.8 698.336 157.5 685.736 157.5C677.936 157.5 670.986 155.85 664.886 152.55C658.886 149.15 654.136 144.3 650.636 138C647.236 131.6 645.536 123.8 645.536 114.6C645.536 101 649.136 90.55 656.336 83.25C663.636 75.85 673.586 72.15 686.186 72.15C693.986 72.15 700.886 73.8 706.886 77.1C712.986 80.4 717.736 85.2 721.136 91.5C724.636 97.8 726.386 105.5 726.386 114.6ZM671.186 114.6C671.186 122.3 672.336 128.15 674.636 132.15C676.936 136.05 680.736 138 686.036 138C691.236 138 694.986 136.05 697.286 132.15C699.586 128.15 700.736 122.3 700.736 114.6C700.736 107 699.586 101.3 697.286 97.5C694.986 93.6 691.186 91.65 685.886 91.65C680.686 91.65 676.936 93.6 674.636 97.5C672.336 101.3 671.186 107 671.186 114.6ZM761.399 156L730.049 73.65H756.449L771.449 121.35C771.949 123.05 772.399 125.15 772.799 127.65C773.299 130.05 773.599 132.25 773.699 134.25H774.299C774.399 132.15 774.649 129.95 775.049 127.65C775.549 125.35 776.099 123.3 776.699 121.5L791.999 73.65H818.249L786.899 156H761.399ZM864.582 72.15C876.182 72.15 885.382 75.35 892.182 81.75C898.982 88.05 902.382 97.35 902.382 109.65V121.35H850.332C850.532 126.75 852.282 131.05 855.582 134.25C858.882 137.45 863.582 139.05 869.682 139.05C874.882 139.05 879.632 138.55 883.932 137.55C888.332 136.55 892.832 134.95 897.432 132.75V151.5C893.332 153.6 888.982 155.1 884.382 156C879.882 157 874.282 157.5 867.582 157.5C859.282 157.5 851.882 156 845.382 153C838.982 150 833.932 145.4 830.232 139.2C826.632 132.9 824.832 124.95 824.832 115.35C824.832 105.65 826.482 97.6 829.782 91.2C833.082 84.8 837.682 80.05 843.582 76.95C849.582 73.75 856.582 72.15 864.582 72.15ZM865.032 89.7C861.132 89.7 857.882 90.95 855.282 93.45C852.782 95.85 851.282 99.7 850.782 105H879.132C879.032 100.7 877.832 97.1 875.532 94.2C873.232 91.2 869.732 89.7 865.032 89.7Z\"\n          fill=\"currentColor\"\n        />\n        <circle cx=\"63.4983\" cy=\"166\" r=\"26\" fill=\"currentColor\" />\n        <circle opacity=\"0.5\" cx=\"138.498\" cy=\"166\" r=\"26\" fill=\"currentColor\" />\n        <circle opacity=\"0.5\" cx=\"175.498\" cy=\"101\" r=\"26\" fill=\"currentColor\" />\n        <path\n          d=\"M63.5281 10C69.6242 10 75.2332 12.0853 79.6808 15.5814C85.4685 20.2924 92.8532 23.1167 100.898 23.1167C108.942 23.1167 116.327 20.2924 122.114 15.5814C126.562 12.0853 132.171 10 138.267 10C152.714 10 164.426 21.7116 164.426 36.1587C164.426 50.6057 152.714 62.3174 138.267 62.3174C132.171 62.3174 126.562 60.2321 122.114 56.736C116.327 52.0249 108.942 49.2007 100.898 49.2007C92.8532 49.2007 85.4685 52.0249 79.6808 56.736C75.2332 60.2321 69.6242 62.3174 63.5281 62.3174C49.081 62.3174 37.3694 50.6057 37.3694 36.1587C37.3694 21.7116 49.081 10 63.5281 10Z\"\n          fill=\"currentColor\"\n        />\n        <path\n          d=\"M26.1587 75.023C32.2548 75.023 37.8638 77.1083 42.3114 80.6044C48.0991 85.3155 55.4838 88.1397 63.5282 88.1397C71.5726 88.1397 78.9574 85.3155 84.745 80.6044C89.1927 77.1083 94.8017 75.023 100.898 75.023C115.345 75.023 127.056 86.7347 127.056 101.182C127.056 115.629 115.345 127.34 100.898 127.34C94.8017 127.34 89.1927 125.255 84.745 121.759C78.9574 117.048 71.5726 114.224 63.5282 114.224C55.4838 114.224 48.0991 117.048 42.3114 121.759C37.8638 125.255 32.2548 127.34 26.1587 127.34C11.7116 127.34 0 115.629 0 101.182C0 86.7347 11.7116 75.023 26.1587 75.023Z\"\n          fill=\"currentColor\"\n        />\n      </g>\n    </SvgIcon>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Button, Link, List, ListItem, ListItemButton, SvgIcon, Typography } from \"@mui/material\";\nimport { ReactNode, useMemo } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport tinycolor from \"tinycolor2\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { DataSourceDialogItem } from \"@foxglove/studio-base/components/DataSourceDialog/DataSourceDialog\";\nimport FoxgloveLogoText from \"@foxglove/studio-base/components/FoxgloveLogoText\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport TextMiddleTruncate from \"@foxglove/studio-base/components/TextMiddleTruncate\";\nimport { useAnalytics } from \"@foxglove/studio-base/context/AnalyticsContext\";\nimport {\n  useCurrentUser,\n  useCurrentUserType,\n} from \"@foxglove/studio-base/context/CurrentUserContext\";\nimport { usePlayerSelection } from \"@foxglove/studio-base/context/PlayerSelectionContext\";\nimport { useWorkspaceActions } from \"@foxglove/studio-base/context/Workspace/useWorkspaceActions\";\nimport { AppEvent } from \"@foxglove/studio-base/services/IAnalytics\";\n\nconst useStyles = makeStyles()((theme) => ({\n  logo: {\n    width: 212,\n    height: \"auto\",\n    marginLeft: theme.spacing(-1),\n  },\n  grid: {\n    [theme.breakpoints.up(\"md\")]: {\n      display: \"grid\",\n      gridTemplateAreas: `\n        \"header spacer\"\n        \"content sidebar\"\n      `,\n      gridTemplateRows: `content auto`,\n      gridTemplateColumns: `1fr 375px`,\n    },\n  },\n  header: {\n    padding: theme.spacing(6),\n    gridArea: \"header\",\n\n    [theme.breakpoints.down(\"md\")]: {\n      padding: theme.spacing(4),\n    },\n    [`@media (max-height: ${theme.breakpoints.values.sm})`]: {\n      display: \"none\",\n    },\n  },\n  content: {\n    padding: theme.spacing(0, 6, 6),\n    overflow: \"hidden\",\n    gridArea: \"content\",\n\n    [theme.breakpoints.down(\"md\")]: {\n      padding: theme.spacing(0, 4, 4),\n    },\n    [`@media (max-height: ${theme.breakpoints.values.sm})`]: {\n      paddingTop: theme.spacing(6),\n    },\n  },\n  spacer: {\n    gridArea: \"spacer\",\n    backgroundColor: tinycolor(theme.palette.text.primary).setAlpha(0.04).toRgbString(),\n\n    [`@media (max-height: ${theme.breakpoints.values.sm})`]: {\n      display: \"none\",\n    },\n  },\n  sidebar: {\n    gridArea: \"sidebar\",\n    backgroundColor: tinycolor(theme.palette.text.primary).setAlpha(0.04).toRgbString(),\n    padding: theme.spacing(0, 5, 5),\n\n    [theme.breakpoints.down(\"md\")]: {\n      padding: theme.spacing(4),\n    },\n    [`@media (max-height: ${theme.breakpoints.values.sm})`]: {\n      paddingTop: theme.spacing(6),\n    },\n  },\n  button: {\n    whiteSpace: \"nowrap\",\n    textOverflow: \"ellipsis\",\n    overflow: \"hidden\",\n  },\n  connectionButton: {\n    textAlign: \"left\",\n    justifyContent: \"flex-start\",\n    padding: theme.spacing(2, 3),\n    gap: theme.spacing(1.5),\n    borderColor: theme.palette.divider,\n\n    \".MuiButton-startIcon .MuiSvgIcon-fontSizeLarge\": {\n      fontSize: 28,\n    },\n  },\n  recentListItemButton: {\n    overflow: \"hidden\",\n    color: theme.palette.primary.main,\n\n    \"&:hover\": {\n      backgroundColor: \"transparent\",\n      color: theme.palette.primary[theme.palette.mode === \"dark\" ? \"light\" : \"dark\"],\n    },\n  },\n  recentSourceSecondary: {\n    color: \"inherit\",\n  },\n  featureList: {\n    paddingLeft: theme.spacing(1.5),\n\n    \"li:not(:last-of-type)\": {\n      marginBottom: theme.spacing(0.5),\n    },\n  },\n}));\n\ntype DataSourceOptionProps = {\n  text: string;\n  secondaryText: string;\n  icon: JSX.Element;\n  onClick: () => void;\n  href?: string;\n  target: \"_blank\";\n};\n\nfunction DataSourceOption(props: DataSourceOptionProps): JSX.Element {\n  const { icon, onClick, text, secondaryText, href, target } = props;\n  const { classes } = useStyles();\n  const button = (\n    <Button\n      className={classes.connectionButton}\n      fullWidth\n      color=\"inherit\"\n      variant=\"outlined\"\n      size=\"large\"\n      startIcon={icon}\n      onClick={onClick}\n    >\n      <Stack flex=\"auto\" zeroMinWidth>\n        <Typography variant=\"subtitle1\" color=\"text.primary\">\n          {text}\n        </Typography>\n        <Typography variant=\"body2\" color=\"text.secondary\" noWrap>\n          {secondaryText}\n        </Typography>\n      </Stack>\n    </Button>\n  );\n\n  return href ? (\n    <Link href={href} target={target} style={{ textDecoration: \"none\" }}>\n      {button}\n    </Link>\n  ) : (\n    button\n  );\n}\n\ntype SidebarItem = {\n  id: string;\n  title: string;\n  text: ReactNode;\n  actions?: ReactNode;\n};\n\nfunction SidebarItems(props: {\n  onSelectView: (newValue: DataSourceDialogItem) => void;\n}): JSX.Element {\n  const { onSelectView } = props;\n  const { signIn } = useCurrentUser();\n  const currentUserType = useCurrentUserType();\n  const analytics = useAnalytics();\n  const { classes } = useStyles();\n  const { t } = useTranslation(\"openDialog\");\n\n  const { freeUser, teamOrEnterpriseUser } = useMemo(() => {\n    const demoItem = {\n      id: \"new\",\n      title: t(\"newToFoxgloveStudio\"),\n      text: t(\"newToFoxgloveStudioDescription\"),\n      actions: (\n        <>\n          <Button\n            onClick={() => {\n              onSelectView(\"demo\");\n              void analytics.logEvent(AppEvent.DIALOG_SELECT_VIEW, { type: \"demo\" });\n              void analytics.logEvent(AppEvent.DIALOG_CLICK_CTA, {\n                user: currentUserType,\n                cta: \"demo\",\n              });\n            }}\n            className={classes.button}\n            variant=\"outlined\"\n          >\n            {t(\"exploreSampleData\")}\n          </Button>\n          <Button\n            href=\"https://foxglove.dev/docs/studio/connection/data-sources\"\n            target=\"_blank\"\n            className={classes.button}\n            onClick={() => {\n              void analytics.logEvent(AppEvent.DIALOG_CLICK_CTA, {\n                user: currentUserType,\n                cta: \"docs\",\n              });\n            }}\n          >\n            {t(\"viewOurDocs\")}\n          </Button>\n        </>\n      ),\n    };\n    return {\n      freeUser: [demoItem],\n      teamOrEnterpriseUser: [\n        demoItem,\n        {\n          id: \"join-community\",\n          title: t(\"joinOurCommunity\"),\n          text: t(\"joinOurCommunityDescription\"),\n          actions: (\n            <>\n              <Button\n                href=\"https://foxglove.dev/slack\"\n                target=\"_blank\"\n                className={classes.button}\n                variant=\"outlined\"\n                onClick={() => {\n                  void analytics.logEvent(AppEvent.DIALOG_CLICK_CTA, {\n                    user: currentUserType,\n                    cta: \"join-slack\",\n                  });\n                }}\n              >\n                {t(\"joinOurSlack\")}\n              </Button>\n              <Button\n                href=\"https://github.com/foxglove/studio/issues/new/choose\"\n                target=\"_blank\"\n                className={classes.button}\n                onClick={() => {\n                  void analytics.logEvent(AppEvent.DIALOG_CLICK_CTA, {\n                    user: currentUserType,\n                    cta: \"go-to-github\",\n                  });\n                }}\n              >\n                {t(\"openAGitHubIssue\")}\n              </Button>\n            </>\n          ),\n        },\n        {\n          id: \"need-help\",\n          title: t(\"needHelp\"),\n          text: t(\"needHelpDescription\"),\n          actions: (\n            <>\n              <Button\n                href=\"https://foxglove.dev/docs/studio\"\n                target=\"_blank\"\n                className={classes.button}\n                variant=\"outlined\"\n                onClick={() => {\n                  void analytics.logEvent(AppEvent.DIALOG_CLICK_CTA, {\n                    user: currentUserType,\n                    cta: \"docs\",\n                  });\n                }}\n              >\n                {t(\"viewOurDocs\")}\n              </Button>\n              <Button\n                href=\"https://foxglove.dev/tutorials\"\n                target=\"_blank\"\n                className={classes.button}\n                onClick={() => {\n                  void analytics.logEvent(AppEvent.DIALOG_CLICK_CTA, {\n                    user: currentUserType,\n                    cta: \"tutorials\",\n                  });\n                }}\n              >\n                {t(\"seeTutorials\")}\n              </Button>\n            </>\n          ),\n        },\n      ],\n    };\n  }, [analytics, classes.button, currentUserType, onSelectView, t]);\n\n  const sidebarItems: SidebarItem[] = useMemo(() => {\n    switch (currentUserType) {\n      case \"unauthenticated\":\n        return [\n          ...freeUser,\n          {\n            id: \"collaborate\",\n            title: t(\"collaborateTitle\"),\n            text: (\n              <ul className={classes.featureList}>\n                <li>{t(\"secureStorageOfData\")}</li>\n                <li>{t(\"convenientWebInterface\")}</li>\n                <li>{t(\"canBeShared\")}</li>\n              </ul>\n            ),\n            actions: signIn ? (\n              <>\n                <Button\n                  className={classes.button}\n                  variant=\"outlined\"\n                  onClick={() => {\n                    void analytics.logEvent(AppEvent.DIALOG_CLICK_CTA, {\n                      user: currentUserType,\n                      cta: \"create-account\",\n                    });\n                    signIn();\n                  }}\n                >\n                  {t(\"createAFreeAccount\")}\n                </Button>\n                <Button\n                  className={classes.button}\n                  onClick={() => {\n                    void analytics.logEvent(AppEvent.DIALOG_CLICK_CTA, {\n                      user: currentUserType,\n                      cta: \"sign-in\",\n                    });\n                    signIn();\n                  }}\n                >\n                  {t(\"signIn\")}\n                </Button>\n              </>\n            ) : (\n              <Button\n                href=\"https://foxglove.dev/data-platform\"\n                target=\"_blank\"\n                className={classes.button}\n                variant=\"outlined\"\n                onClick={() => {\n                  void analytics.logEvent(AppEvent.DIALOG_CLICK_CTA, {\n                    user: currentUserType,\n                    cta: \"create-account\",\n                  });\n                }}\n              >\n                {t(\"learnMore\")}\n              </Button>\n            ),\n          },\n        ];\n      case \"authenticated-free\":\n        return [\n          {\n            id: \"start-collaborating\",\n            title: t(\"startCollaborating\"),\n            text: t(\"startCollaboratingDescription\"),\n            actions: (\n              <>\n                <Button\n                  href=\"https://console.foxglove.dev/recordings\"\n                  target=\"_blank\"\n                  variant=\"outlined\"\n                  className={classes.button}\n                  onClick={() => {\n                    void analytics.logEvent(AppEvent.DIALOG_CLICK_CTA, {\n                      user: currentUserType,\n                      cta: \"upload-to-dp\",\n                    });\n                  }}\n                >\n                  {t(\"uploadToDataPlatform\")}\n                </Button>\n                <Button\n                  href=\"https://foxglove.dev/docs/studio/layouts#team-layouts\"\n                  target=\"_blank\"\n                  className={classes.button}\n                >\n                  {t(\"shareLayouts\")}\n                </Button>\n              </>\n            ),\n          },\n          ...freeUser,\n        ];\n      case \"authenticated-team\":\n        return teamOrEnterpriseUser;\n      case \"authenticated-enterprise\":\n        return teamOrEnterpriseUser;\n    }\n  }, [\n    analytics,\n    classes.button,\n    classes.featureList,\n    currentUserType,\n    freeUser,\n    signIn,\n    teamOrEnterpriseUser,\n    t,\n  ]);\n\n  return (\n    <>\n      {sidebarItems.map((item) => (\n        <Stack key={item.id}>\n          <Typography variant=\"h5\" gutterBottom>\n            {item.title}\n          </Typography>\n          <Typography variant=\"body2\" color=\"text.secondary\">\n            {item.text}\n          </Typography>\n          {item.actions != undefined && (\n            <Stack direction=\"row\" flexWrap=\"wrap\" alignItems=\"center\" gap={1} paddingTop={1.5}>\n              {item.actions}\n            </Stack>\n          )}\n        </Stack>\n      ))}\n    </>\n  );\n}\n\nexport default function Start(): JSX.Element {\n  const { recentSources, selectRecent } = usePlayerSelection();\n  const { classes } = useStyles();\n  const analytics = useAnalytics();\n  const { t } = useTranslation(\"openDialog\");\n  const { dialogActions } = useWorkspaceActions();\n\n  const startItems = useMemo(() => {\n    return [\n      {\n        key: \"open-local-file\",\n        text: t(\"openLocalFile\"),\n        secondaryText: t(\"openLocalFileDescription\"),\n        icon: (\n          <SvgIcon fontSize=\"large\" color=\"primary\" viewBox=\"0 0 2048 2048\">\n            <path d=\"M1955 1533l-163-162v677h-128v-677l-163 162-90-90 317-317 317 317-90 90zM256 1920h1280v128H128V0h1115l549 549v475h-128V640h-512V128H256v1792zM1280 512h293l-293-293v293z\" />\n          </SvgIcon>\n        ),\n        onClick: () => {\n          dialogActions.dataSource.open(\"file\");\n          void analytics.logEvent(AppEvent.DIALOG_SELECT_VIEW, { type: \"local\" });\n        },\n      },\n      {\n        key: \"open-url\",\n        text: t(\"openUrl\"),\n        secondaryText: t(\"openUrlDescription\"),\n        icon: (\n          <SvgIcon fontSize=\"large\" color=\"primary\" viewBox=\"0 0 2048 2048\">\n            <path d=\"M256 1920h512v128H128V0h1115l549 549v91h-640V128H256v1792zM1280 512h293l-293-293v293zm128 256q133 0 249 50t204 137 137 203 50 250q0 133-50 249t-137 204-203 137-250 50q-133 0-249-50t-204-137-137-203-50-250q0-133 50-249t137-204 203-137 250-50zm0 1152q21 0 37-14t28-38 21-53 15-57 9-53 6-41h-230q2 14 5 39t10 53 16 58 21 52 27 39 35 15zm126-384q1-32 1-64t1-64q0-63-3-128h-250q-3 65-3 128 0 64 3 128h251zm-638-128q0 32 4 64t12 64h243q-3-64-3-128 0-63 3-128H912q-8 32-12 64t-4 64zm512-512q-19 0-34 15t-27 39-21 53-15 57-10 53-6 39h225q-2-13-6-37t-11-53-16-58-20-54-27-39-32-15zm253 384q3 65 3 128v64q0 32-2 64h242q8-32 12-64t4-64q0-32-4-64t-12-64h-243zm190-128q-43-75-108-131t-145-88q21 52 32 107t19 112h202zm-637-218q-78 32-142 88t-107 130h200q13-111 49-218zm-249 730q42 73 106 129t142 88q-21-51-31-106t-17-111H965zm642 215q77-32 139-87t105-128h-198q-5 51-15 109t-31 106z\" />\n          </SvgIcon>\n        ),\n        iconProps: { iconName: \"FileASPX\" },\n        href: \"https://console.foxglove.dev/recordings\",\n        onClick: () => {\n          void analytics.logEvent(AppEvent.DIALOG_SELECT_VIEW, { type: \"data-platform\" });\n        },\n      },\n      {\n        key: \"open-connection\",\n        text: t(\"openConnection\"),\n        secondaryText: t(\"openConnectionDescription\"),\n        icon: (\n          <SvgIcon fontSize=\"large\" color=\"primary\" viewBox=\"0 0 2048 2048\">\n            <path d=\"M1408 256h640v640h-640V640h-120l-449 896H640v256H0v-640h640v256h120l449-896h199V256zM512 1664v-384H128v384h384zm1408-896V384h-384v384h384z\" />\n          </SvgIcon>\n        ),\n        onClick: () => {\n          dialogActions.dataSource.open(\"connection\");\n          void analytics.logEvent(AppEvent.DIALOG_SELECT_VIEW, { type: \"live\" });\n        },\n      },\n    ];\n  }, [analytics, dialogActions.dataSource, t]);\n\n  return (\n    <Stack className={classes.grid}>\n      <header className={classes.header}>\n        <FoxgloveLogoText color=\"primary\" className={classes.logo} />\n      </header>\n      <Stack className={classes.content}>\n        <Stack gap={4}>\n          <Stack gap={1}>\n            <Typography variant=\"h5\" gutterBottom>\n              {t(\"openDataSource\")}\n            </Typography>\n            {startItems.map((item) => (\n              <DataSourceOption\n                key={item.key}\n                text={item.text}\n                secondaryText={item.secondaryText}\n                icon={item.icon}\n                onClick={item.onClick}\n                href={item.href}\n                target=\"_blank\"\n              />\n            ))}\n          </Stack>\n          {recentSources.length > 0 && (\n            <Stack gap={1}>\n              <Typography variant=\"h5\" gutterBottom>\n                {t(\"recentDataSources\")}\n              </Typography>\n              <List disablePadding>\n                {recentSources.slice(0, 5).map((recent) => (\n                  <ListItem disablePadding key={recent.id} id={recent.id}>\n                    <ListItemButton\n                      disableGutters\n                      onClick={() => selectRecent(recent.id)}\n                      className={classes.recentListItemButton}\n                    >\n                      <TextMiddleTruncate\n                        className={classes.recentSourceSecondary}\n                        text={recent.title}\n                      />\n                    </ListItemButton>\n                  </ListItem>\n                ))}\n              </List>\n            </Stack>\n          )}\n        </Stack>\n      </Stack>\n      <div className={classes.spacer} />\n      <Stack gap={4} className={classes.sidebar}>\n        <SidebarItems onSelectView={dialogActions.dataSource.open} />\n      </Stack>\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport CloseIcon from \"@mui/icons-material/Close\";\nimport { Dialog, IconButton } from \"@mui/material\";\nimport { useCallback, useLayoutEffect, useMemo } from \"react\";\nimport { useMountedState } from \"react-use\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport Snow from \"@foxglove/studio-base/components/DataSourceDialog/Snow\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { useAnalytics } from \"@foxglove/studio-base/context/AnalyticsContext\";\nimport { usePlayerSelection } from \"@foxglove/studio-base/context/PlayerSelectionContext\";\nimport {\n  WorkspaceContextStore,\n  useWorkspaceStore,\n} from \"@foxglove/studio-base/context/Workspace/WorkspaceContext\";\nimport { useWorkspaceActions } from \"@foxglove/studio-base/context/Workspace/useWorkspaceActions\";\nimport { AppEvent } from \"@foxglove/studio-base/services/IAnalytics\";\n\nimport Connection from \"./Connection\";\nimport Start from \"./Start\";\n\nconst DataSourceDialogItems = [\"start\", \"file\", \"demo\", \"remote\", \"connection\"] as const;\nexport type DataSourceDialogItem = (typeof DataSourceDialogItems)[number];\n\ntype DataSourceDialogProps = {\n  backdropAnimation?: boolean;\n};\n\nconst useStyles = makeStyles()((theme) => ({\n  paper: {\n    maxWidth: `calc(min(${theme.breakpoints.values.md}px, 100% - ${theme.spacing(4)}))`,\n  },\n  closeButton: {\n    position: \"absolute\",\n    right: 0,\n    top: 0,\n    margin: theme.spacing(3),\n  },\n}));\n\nconst selectDataSourceDialog = (store: WorkspaceContextStore) => store.dialogs.dataSource;\n\nexport function DataSourceDialog(props: DataSourceDialogProps): JSX.Element {\n  const { backdropAnimation } = props;\n  const { classes } = useStyles();\n  const { availableSources, selectSource } = usePlayerSelection();\n  const { dialogActions } = useWorkspaceActions();\n  const { activeDataSource, item: activeView } = useWorkspaceStore(selectDataSourceDialog);\n\n  const isMounted = useMountedState();\n\n  const firstSampleSource = useMemo(() => {\n    return availableSources.find((source) => source.type === \"sample\");\n  }, [availableSources]);\n\n  const analytics = useAnalytics();\n\n  const onModalClose = useCallback(() => {\n    void analytics.logEvent(AppEvent.DIALOG_CLOSE, { activeDataSource });\n    dialogActions.dataSource.close();\n  }, [analytics, activeDataSource, dialogActions.dataSource]);\n\n  useLayoutEffect(() => {\n    if (activeView === \"file\") {\n      dialogActions.openFile\n        .open()\n        .catch((err) => {\n          console.error(err);\n        })\n        .finally(() => {\n          // set the view back to start so the user can click to open file again\n          if (isMounted()) {\n            dialogActions.dataSource.open(\"start\");\n          }\n        });\n    } else if (activeView === \"demo\" && firstSampleSource) {\n      selectSource(firstSampleSource.id);\n    }\n  }, [activeView, dialogActions, firstSampleSource, isMounted, selectSource]);\n\n  const backdrop = useMemo(() => {\n    const now = new Date();\n    if (backdropAnimation === false) {\n      return;\n    } else if (now >= new Date(now.getFullYear(), 11, 25)) {\n      return <Snow effect=\"snow\" />;\n    } else if (now < new Date(now.getFullYear(), 0, 2)) {\n      return <Snow effect=\"confetti\" />;\n    }\n    return;\n  }, [backdropAnimation]);\n\n  const view = useMemo(() => {\n    switch (activeView) {\n      case \"demo\": {\n        return {\n          title: \"\",\n          component: <></>,\n        };\n      }\n      case \"connection\":\n        return {\n          title: \"Open new connection\",\n          component: <Connection />,\n        };\n      default:\n        return {\n          title: \"Get started\",\n          component: <Start />,\n        };\n    }\n  }, [activeView]);\n\n  return (\n    <Dialog\n      open\n      onClose={onModalClose}\n      fullWidth\n      maxWidth=\"lg\"\n      BackdropProps={{ children: backdrop }}\n      PaperProps={{\n        square: false,\n        elevation: 4,\n        className: classes.paper,\n      }}\n    >\n      <IconButton className={classes.closeButton} onClick={onModalClose} edge=\"end\">\n        <CloseIcon />\n      </IconButton>\n      <Stack\n        flexGrow={1}\n        fullHeight\n        justifyContent=\"space-between\"\n        overflow={activeView === \"connection\" ? \"hidden\" : undefined}\n      >\n        {view.component}\n      </Stack>\n    </Dialog>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { alpha, Dialog, Typography } from \"@mui/material\";\nimport { PropsWithChildren } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nconst useStyles = makeStyles()((theme) => ({\n  outer: {\n    background: alpha(theme.palette.background.paper, 0.84),\n    backgroundImage: `linear-gradient(${theme.palette.action.hover}, ${theme.palette.action.hover})`,\n    pointerEvents: \"none\",\n    padding: theme.spacing(5),\n    boxShadow: \"none\",\n    maxHeight: \"none\", // override inset for titlebar area on Windows desktop app\n  },\n  inner: {\n    borderRadius: 16,\n    height: \"100%\",\n    border: `2px dashed ${theme.palette.text.primary}`,\n    display: \"flex\",\n    flexDirection: \"column\",\n    textAlign: \"center\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    fontWeight: 800,\n    padding: theme.spacing(5),\n    lineHeight: \"normal\",\n  },\n}));\n\nfunction DropOverlay(props: PropsWithChildren<{ open: boolean }>): JSX.Element {\n  const { classes } = useStyles();\n  return (\n    <Dialog\n      fullScreen\n      open={props.open}\n      style={{ zIndex: 10000000 }}\n      classes={{ paperFullScreen: classes.outer }}\n    >\n      <div className={classes.inner}>\n        <Typography variant=\"h1\" align=\"center\">\n          {props.children}\n        </Typography>\n      </div>\n    </Dialog>\n  );\n}\n\nexport default DropOverlay;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { useSnackbar } from \"notistack\";\nimport { extname } from \"path\";\nimport { useCallback, useLayoutEffect, useState } from \"react\";\n\nimport Logger from \"@foxglove/log\";\nimport DropOverlay from \"@foxglove/studio-base/components/DropOverlay\";\n\nconst log = Logger.getLogger(__filename);\n\ntype Props = {\n  allowedExtensions?: string[];\n  onDrop?: (event: {\n    files?: File[];\n    handles?: FileSystemFileHandle[]; // foxglove-depcheck-used: @types/wicg-file-system-access\n  }) => void;\n};\n\nexport default function DocumentDropListener(props: Props): JSX.Element {\n  const [hovering, setHovering] = useState(false);\n\n  const { onDrop: onDropProp, allowedExtensions } = props;\n\n  const { enqueueSnackbar } = useSnackbar();\n\n  const onDrop = useCallback(\n    async (ev: DragEvent) => {\n      setHovering(false);\n\n      if (!ev.dataTransfer || !allowedExtensions) {\n        return;\n      }\n\n      let handles: FileSystemFileHandle[] | undefined = [];\n      const handlePromises: Promise<FileSystemHandle | ReactNull>[] = [];\n      const allFiles: File[] = [];\n      const directories: FileSystemDirectoryEntry[] = [];\n      const dataItems = ev.dataTransfer.items;\n      for (const item of Array.from(dataItems)) {\n        // Attempt to grab the filesystem handle if the feature is available.\n        // A file system handle is more versatile than File instances.\n        // Note: awaiting on the fileSystemHandle function triggered a (bug?) where all other\n        // dataTransfer items were ignored\n        //\n        // getAsFileSystemHandle is only available in a secure context. If called outside a secure\n        // context the observed behavior is a browser (tab) crash. To avoid the crash we check that\n        // we are in a secure context and only call the api if available.\n        //\n        // Handles power features like recents which require saving handles in indexeddb. This check\n        // allows us to gracefully degrade away from this feature if the user deploys Studio in an\n        // unsecure context.\n        if (window.isSecureContext && \"getAsFileSystemHandle\" in item) {\n          handlePromises.push(item.getAsFileSystemHandle());\n        } else {\n          log.info(\n            \"getAsFileSystemHandle not available on a dropped item. Features requiring handles will not be available for the item\",\n            item,\n          );\n        }\n\n        const entry = item.webkitGetAsEntry();\n\n        // Keep track of all File and Directory instaces\n        if (entry?.isFile === true) {\n          const file = item.getAsFile();\n          if (file) {\n            allFiles.push(file);\n          }\n        } else if (entry?.isDirectory === true) {\n          directories.push(entry as FileSystemDirectoryEntry);\n        }\n      }\n\n      // If we had any directories, then we will not use handles and instead use File instances.\n      // A future enhancement could be to load handles from directories.\n      if (directories.length === 0) {\n        for (const promise of handlePromises) {\n          const fileSystemHandle = await promise;\n          if (fileSystemHandle instanceof FileSystemFileHandle) {\n            handles.push(fileSystemHandle);\n          }\n        }\n      }\n\n      // Allow event to bubble for non-file based drag and drop\n      if (allFiles.length === 0 && directories.length === 0 && handles.length === 0) {\n        return;\n      }\n\n      for (const directory of directories) {\n        // Read the list of files and folders in this directory (non-recursively)\n        const entries = await new Promise<FileSystemEntry[]>((resolve, reject) => {\n          directory.createReader().readEntries(resolve, reject);\n        });\n\n        // Add all files in this directory to our list of files\n        for (const entry of entries) {\n          if (entry.isFile) {\n            const file = await new Promise<File>((resolve, reject) => {\n              (entry as FileSystemFileEntry).file(resolve, reject);\n            });\n            allFiles.push(file);\n          }\n        }\n      }\n\n      // If we had any directories, then we will not use handles and instead use File instances.\n      // A future enhancement could be to load handles from directories.\n      if (directories.length > 0 || handles.length === 0) {\n        handles = undefined;\n      }\n\n      const filteredFiles = allFiles.filter((file) =>\n        allowedExtensions.includes(extname(file.name)),\n      );\n      const filteredHandles = handles?.filter((handle) =>\n        allowedExtensions.includes(extname(handle.name)),\n      );\n\n      // Check for no supported files\n      if (filteredFiles.length === 0 && filteredHandles?.length === 0) {\n        enqueueSnackbar(\"The file format is unsupported.\", { variant: \"error\" });\n        return;\n      }\n\n      ev.preventDefault();\n      ev.stopPropagation();\n\n      onDropProp?.({ files: filteredFiles, handles: filteredHandles });\n    },\n    [enqueueSnackbar, onDropProp, allowedExtensions],\n  );\n\n  const onDragOver = useCallback(\n    (ev: DragEvent) => {\n      if (!allowedExtensions) {\n        return;\n      }\n\n      const { dataTransfer } = ev;\n      if (dataTransfer?.types.includes(\"Files\") === true) {\n        ev.stopPropagation();\n        ev.preventDefault();\n        dataTransfer.dropEffect = \"copy\";\n        setHovering(true);\n      }\n    },\n    [allowedExtensions],\n  );\n\n  const onDragLeave = useCallback(() => {\n    setHovering(false);\n  }, []);\n\n  useLayoutEffect(() => {\n    document.addEventListener(\"dragover\", onDragOver);\n    document.addEventListener(\"drop\", onDrop);\n    document.addEventListener(\"dragleave\", onDragLeave);\n    return () => {\n      document.removeEventListener(\"dragover\", onDragOver);\n      document.removeEventListener(\"drop\", onDrop);\n      document.removeEventListener(\"dragleave\", onDragLeave);\n    };\n  }, [onDragLeave, onDragOver, onDrop]);\n\n  return (\n    <>\n      <input // Expose a hidden input for Puppeteer to use to drop a file in.\n        type=\"file\"\n        style={{ display: \"none\" }}\n        onChange={(event) => {\n          if (event.target.files) {\n            props.onDrop?.({ files: Array.from(event.target.files) });\n          }\n        }}\n        data-puppeteer-file-upload\n        multiple\n      />\n      <DropOverlay open={hovering}>Drop a file here</DropOverlay>\n    </>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { escapeRegExp } from \"lodash\";\n\n/**\n * Renders the given text with the span matching highlight wrapped in a\n * <mark> component.\n */\nexport function HighlightedText({\n  text,\n  highlight,\n}: {\n  text: string;\n  highlight?: string;\n}): JSX.Element {\n  if (highlight == undefined || !highlight.trim()) {\n    return <span>{text}</span>;\n  }\n  const regex = new RegExp(`(${escapeRegExp(highlight)})`, \"gi\");\n  const parts = text.split(regex);\n  return (\n    <span>\n      {parts\n        .filter((part) => part)\n        .map((part, i) =>\n          regex.test(part) ? <mark key={i}>{part}</mark> : <span key={i}>{part}</span>,\n        )}\n    </span>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { alpha } from \"@mui/material\";\nimport { compact } from \"lodash\";\nimport { Fragment } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { HighlightedText } from \"@foxglove/studio-base/components/HighlightedText\";\nimport {\n  TimelinePositionedEvent,\n  DataSourceEvent,\n} from \"@foxglove/studio-base/context/EventsContext\";\n\nconst useStyles = makeStyles<void, \"eventMetadata\" | \"eventSelected\">()(\n  (theme, _params, classes) => ({\n    spacer: {\n      cursor: \"default\",\n      height: theme.spacing(1),\n      gridColumn: \"span 2\",\n    },\n    event: {\n      display: \"contents\",\n      cursor: \"pointer\",\n      \"&:hover\": {\n        [`.${classes.eventMetadata}`]: {\n          backgroundColor: alpha(theme.palette.info.main, theme.palette.action.hoverOpacity),\n          borderColor: theme.palette.info.main,\n        },\n      },\n    },\n    eventSelected: {\n      [`.${classes.eventMetadata}`]: {\n        backgroundColor: alpha(theme.palette.info.main, theme.palette.action.activatedOpacity),\n        borderColor: theme.palette.info.main,\n        boxShadow: `0 0 0 1px ${theme.palette.info.main}`,\n      },\n    },\n    eventHovered: {\n      [`.${classes.eventMetadata}`]: {\n        backgroundColor: alpha(theme.palette.info.main, theme.palette.action.hoverOpacity),\n        borderColor: theme.palette.info.main,\n      },\n    },\n    eventMetadata: {\n      padding: theme.spacing(1),\n      backgroundColor: theme.palette.background.default,\n      borderRight: `1px solid ${theme.palette.divider}`,\n      borderBottom: `1px solid ${theme.palette.divider}`,\n\n      \"&:nth-of-type(odd)\": {\n        borderLeft: `1px solid ${theme.palette.divider}`,\n      },\n      \"&:first-of-type\": {\n        borderTop: `1px solid ${theme.palette.divider}`,\n        borderTopLeftRadius: theme.shape.borderRadius,\n      },\n      \"&:nth-of-type(2)\": {\n        borderTop: `1px solid ${theme.palette.divider}`,\n        borderTopRightRadius: theme.shape.borderRadius,\n      },\n      \"&:nth-last-of-type(2)\": {\n        borderBottomRightRadius: theme.shape.borderRadius,\n      },\n      \"&:nth-last-of-type(3)\": {\n        borderBottomLeftRadius: theme.shape.borderRadius,\n      },\n    },\n  }),\n);\n\nfunction formatEventDuration(event: DataSourceEvent) {\n  if (event.durationNanos === \"0\") {\n    // instant\n    return \"-\";\n  }\n\n  if (!event.durationNanos) {\n    return \"\";\n  }\n\n  const intDuration = BigInt(event.durationNanos);\n\n  if (intDuration >= BigInt(1e9)) {\n    return `${Number(intDuration / BigInt(1e9))}s`;\n  }\n\n  if (intDuration >= BigInt(1e6)) {\n    return `${Number(intDuration / BigInt(1e6))}ms`;\n  }\n\n  if (intDuration >= BigInt(1e3)) {\n    return `${Number(intDuration / BigInt(1e3))}µs`;\n  }\n\n  return `${event.durationNanos}ns`;\n}\n\nfunction EventViewComponent(params: {\n  event: TimelinePositionedEvent;\n  filter: string;\n  formattedTime: string;\n  isHovered: boolean;\n  isSelected: boolean;\n  onClick: (event: TimelinePositionedEvent) => void;\n  onHoverStart: (event: TimelinePositionedEvent) => void;\n  onHoverEnd: (event: TimelinePositionedEvent) => void;\n}): JSX.Element {\n  const { event, filter, formattedTime, isHovered, isSelected, onClick, onHoverStart, onHoverEnd } =\n    params;\n  const { classes, cx } = useStyles();\n\n  const fields = compact([\n    [\"timestamp\", formattedTime],\n    Number(event.event.durationNanos) > 0 && [\"duration\", formatEventDuration(event.event)],\n    ...Object.entries(event.event.metadata),\n  ]);\n\n  return (\n    <div\n      data-testid=\"sidebar-event\"\n      className={cx(classes.event, {\n        [classes.eventSelected]: isSelected,\n        [classes.eventHovered]: isHovered,\n      })}\n      onClick={() => onClick(event)}\n      onMouseEnter={() => onHoverStart(event)}\n      onMouseLeave={() => onHoverEnd(event)}\n    >\n      {fields.map(([key, value]) => (\n        <Fragment key={key}>\n          <div className={classes.eventMetadata}>\n            <HighlightedText text={key ?? \"\"} highlight={filter} />\n          </div>\n          <div className={classes.eventMetadata}>\n            <HighlightedText text={value ?? \"\"} highlight={filter} />\n          </div>\n        </Fragment>\n      ))}\n      <div className={classes.spacer} />\n    </div>\n  );\n}\n\nexport const EventView = React.memo(EventViewComponent);\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport ClearIcon from \"@mui/icons-material/Clear\";\nimport SearchIcon from \"@mui/icons-material/Search\";\nimport { AppBar, CircularProgress, IconButton, TextField, Typography } from \"@mui/material\";\nimport { useCallback, useMemo } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport {\n  EventsStore,\n  TimelinePositionedEvent,\n  useEvents,\n} from \"@foxglove/studio-base/context/EventsContext\";\nimport {\n  TimelineInteractionStateStore,\n  useTimelineInteractionState,\n} from \"@foxglove/studio-base/context/TimelineInteractionStateContext\";\nimport { useAppTimeFormat } from \"@foxglove/studio-base/hooks\";\n\nimport { EventView } from \"./EventView\";\n\nconst useStyles = makeStyles()((theme) => ({\n  appBar: {\n    top: -1,\n    zIndex: theme.zIndex.appBar - 1,\n    display: \"flex\",\n    flexDirection: \"row\",\n    padding: theme.spacing(1),\n    gap: theme.spacing(1),\n    alignItems: \"center\",\n    borderBottom: `1px solid ${theme.palette.divider}`,\n  },\n  grid: {\n    display: \"grid\",\n    flexShrink: 1,\n    gridTemplateColumns: \"auto 1fr\",\n    overflowY: \"auto\",\n    padding: theme.spacing(1),\n  },\n  root: {\n    backgroundColor: theme.palette.background.paper,\n    maxHeight: \"100%\",\n  },\n}));\n\nconst selectSeek = (ctx: MessagePipelineContext) => ctx.seekPlayback;\nconst selectEventFilter = (store: EventsStore) => store.filter;\nconst selectSetEventFilter = (store: EventsStore) => store.setFilter;\nconst selectEvents = (store: EventsStore) => store.events;\nconst selectHoveredEvent = (store: TimelineInteractionStateStore) => store.hoveredEvent;\nconst selectSetHoveredEvent = (store: TimelineInteractionStateStore) => store.setHoveredEvent;\nconst selectEventsAtHoverValue = (store: TimelineInteractionStateStore) => store.eventsAtHoverValue;\nconst selectSelectedEventId = (store: EventsStore) => store.selectedEventId;\nconst selectSelectEvent = (store: EventsStore) => store.selectEvent;\n\nexport function EventsList(): JSX.Element {\n  const events = useEvents(selectEvents);\n  const selectedEventId = useEvents(selectSelectedEventId);\n  const selectEvent = useEvents(selectSelectEvent);\n  const { formatTime } = useAppTimeFormat();\n  const seek = useMessagePipeline(selectSeek);\n  const eventsAtHoverValue = useTimelineInteractionState(selectEventsAtHoverValue);\n  const hoveredEvent = useTimelineInteractionState(selectHoveredEvent);\n  const setHoveredEvent = useTimelineInteractionState(selectSetHoveredEvent);\n  const filter = useEvents(selectEventFilter);\n  const setFilter = useEvents(selectSetEventFilter);\n\n  const timestampedEvents = useMemo(\n    () =>\n      (events.value ?? []).map((event) => {\n        return { ...event, formattedTime: formatTime(event.event.startTime) };\n      }),\n    [events, formatTime],\n  );\n\n  const clearFilter = useCallback(() => {\n    setFilter(\"\");\n  }, [setFilter]);\n\n  const onClick = useCallback(\n    (event: TimelinePositionedEvent) => {\n      if (event.event.id === selectedEventId) {\n        selectEvent(undefined);\n      } else {\n        selectEvent(event.event.id);\n      }\n\n      if (seek) {\n        seek(event.event.startTime);\n      }\n    },\n    [seek, selectEvent, selectedEventId],\n  );\n\n  const onHoverEnd = useCallback(() => {\n    setHoveredEvent(undefined);\n  }, [setHoveredEvent]);\n\n  const onHoverStart = useCallback(\n    (event: TimelinePositionedEvent) => {\n      setHoveredEvent(event);\n    },\n    [setHoveredEvent],\n  );\n\n  const { classes } = useStyles();\n\n  return (\n    <Stack className={classes.root} fullHeight>\n      <AppBar className={classes.appBar} position=\"sticky\" color=\"inherit\" elevation={0}>\n        <TextField\n          variant=\"filled\"\n          fullWidth\n          value={filter}\n          onChange={(event) => setFilter(event.currentTarget.value)}\n          placeholder=\"Search by key, value, or key:value\"\n          InputProps={{\n            startAdornment: <SearchIcon fontSize=\"small\" />,\n            endAdornment: filter !== \"\" && (\n              <IconButton edge=\"end\" onClick={clearFilter} size=\"small\">\n                <ClearIcon fontSize=\"small\" />\n              </IconButton>\n            ),\n          }}\n        />\n      </AppBar>\n      {events.loading && (\n        <Stack flex=\"auto\" padding={2} fullHeight alignItems=\"center\" justifyContent=\"center\">\n          <CircularProgress />\n        </Stack>\n      )}\n      {events.error && (\n        <Stack flex=\"auto\" padding={2} fullHeight alignItems=\"center\" justifyContent=\"center\">\n          <Typography align=\"center\" color=\"error\">\n            Error loading events.\n          </Typography>\n        </Stack>\n      )}\n      {events.value && events.value.length === 0 && (\n        <Stack flex=\"auto\" padding={2} fullHeight alignItems=\"center\" justifyContent=\"center\">\n          <Typography align=\"center\" color=\"text.secondary\">\n            No Events\n          </Typography>\n        </Stack>\n      )}\n      <div className={classes.grid}>\n        {timestampedEvents.map((event) => {\n          return (\n            <EventView\n              key={event.event.id}\n              event={event}\n              filter={filter}\n              formattedTime={event.formattedTime}\n              // When hovering within the event list only show hover state on directly\n              // hovered event.\n              isHovered={\n                hoveredEvent\n                  ? event.event.id === hoveredEvent.event.id\n                  : eventsAtHoverValue[event.event.id] != undefined\n              }\n              isSelected={event.event.id === selectedEventId}\n              onClick={onClick}\n              onHoverStart={onHoverStart}\n              onHoverEnd={onHoverEnd}\n            />\n          );\n        })}\n      </div>\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { PropsWithChildren } from \"react\";\n\n/**\n * Reduces the amount of nesting required to wrap a subtree with multiple React context providers.\n * Rather than indenting each provider inside the next, all providers can be passed in a flat array\n * to the MultiProvider.\n */\nexport default function MultiProvider({\n  children,\n  providers,\n}: PropsWithChildren<{ providers: readonly JSX.Element[] }>): JSX.Element {\n  const wrapped = providers.reduceRight(\n    (wrappedChildren, provider) => React.cloneElement(provider, undefined, wrappedChildren),\n    children,\n  );\n  // TS requires our return type to be Element instead of Node\n  return <>{wrapped}</>;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport MoreVertIcon from \"@mui/icons-material/MoreVert\";\nimport { IconButton, Menu, MenuItem, SvgIconProps } from \"@mui/material\";\nimport { useTranslation } from \"react-i18next\";\nimport { makeStyles } from \"tss-react/mui\";\n\nconst useStyles = makeStyles()((theme) => ({\n  iconButtonSmall: {\n    padding: theme.spacing(0.91125), // round out the overall height to 30px\n    borderRadius: 0,\n  },\n}));\n\nexport function ActionMenu({\n  allowShare,\n  onReset,\n  onShare,\n  fontSize = \"medium\",\n}: {\n  allowShare: boolean;\n  onReset: () => void;\n  onShare: () => void;\n  fontSize?: SvgIconProps[\"fontSize\"];\n}): JSX.Element {\n  const { classes, cx } = useStyles();\n  const [anchorEl, setAnchorEl] = React.useState<undefined | HTMLElement>();\n  const { t } = useTranslation(\"panelSettings\");\n  const open = Boolean(anchorEl);\n  const handleClick = (event: React.MouseEvent<HTMLButtonElement>) => {\n    setAnchorEl(event.currentTarget);\n  };\n  const handleClose = () => {\n    setAnchorEl(undefined);\n  };\n\n  return (\n    <div>\n      <IconButton\n        className={cx({ [classes.iconButtonSmall]: fontSize === \"small\" })}\n        id=\"basic-button\"\n        aria-controls={open ? \"basic-menu\" : undefined}\n        aria-haspopup=\"true\"\n        aria-expanded={open ? \"true\" : undefined}\n        onClick={handleClick}\n      >\n        <MoreVertIcon fontSize={fontSize} />\n      </IconButton>\n      <Menu\n        id=\"basic-menu\"\n        anchorEl={anchorEl}\n        open={open}\n        onClose={handleClose}\n        MenuListProps={{\n          \"aria-labelledby\": \"basic-button\",\n        }}\n      >\n        <MenuItem\n          disabled={!allowShare}\n          onClick={() => {\n            onShare();\n            handleClose();\n          }}\n        >\n          {t(\"importOrExportSettingsWithEllipsis\")}\n        </MenuItem>\n        <MenuItem\n          onClick={() => {\n            onReset();\n            handleClose();\n          }}\n        >\n          {t(\"resetToDefaults\")}\n        </MenuItem>\n      </Menu>\n    </div>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport TagIcon from \"@mui/icons-material/Tag\";\nimport { TextField } from \"@mui/material\";\nimport { useCallback, useState, useEffect, useMemo } from \"react\";\nimport { HexAlphaColorPicker, HexColorPicker } from \"react-colorful\";\nimport tinycolor from \"tinycolor2\";\nimport { makeStyles } from \"tss-react/mui\";\nimport { useDebouncedCallback } from \"use-debounce\";\n\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { fonts } from \"@foxglove/studio-base/util/sharedStyleConstants\";\n\nconst useStyles = makeStyles()((theme) => ({\n  container: {\n    padding: theme.spacing(2),\n  },\n  picker: {\n    \"&.react-colorful\": {\n      width: \"100%\",\n      gap: theme.spacing(0.75),\n    },\n    \".react-colorful__last-control\": {\n      borderRadius: 0,\n    },\n    \".react-colorful__saturation\": {\n      borderRadius: 0,\n    },\n    \".react-colorful__hue\": {\n      order: -1,\n    },\n    \".react-colorful__hue-pointer\": {\n      zIndex: 4,\n    },\n  },\n}));\n\ntype ColorPickerInputProps = {\n  alphaType: \"none\" | \"alpha\";\n  value: undefined | string;\n  onChange: (value: string) => void;\n  onEnterKey?: () => void;\n};\n\nfunction isValidHexColor(color: string, alphaType: \"none\" | \"alpha\") {\n  return alphaType === \"alpha\" ? /^[0-9a-f]{8}$/i.test(color) : /^[0-9a-f]{6}$/i.test(color);\n}\n\nexport function ColorPickerControl(props: ColorPickerInputProps): JSX.Element {\n  const { alphaType, onChange, value, onEnterKey } = props;\n\n  const { classes } = useStyles();\n\n  const parsedValue = useMemo(() => (value ? tinycolor(value) : undefined), [value]);\n  const displayValue =\n    alphaType === \"alpha\" ? parsedValue?.toHex8String() : parsedValue?.toHexString();\n  const swatchColor = displayValue ?? \"#00000044\";\n\n  const [editedValue, setEditedValue] = useState(\"\");\n\n  const editedValueIsInvalid = editedValue.length > 0 && !isValidHexColor(editedValue, alphaType);\n\n  const updateColor = useDebouncedCallback((newValue: string) => {\n    onChange(newValue);\n  });\n\n  const updateEditedValue = useCallback(\n    (newValue: string) => {\n      setEditedValue(newValue);\n\n      if (isValidHexColor(newValue, alphaType)) {\n        onChange(`#${newValue}`);\n      }\n    },\n    [alphaType, onChange],\n  );\n\n  useEffect(() => {\n    setEditedValue((alphaType === \"alpha\" ? parsedValue?.toHex8() : parsedValue?.toHex()) ?? \"\");\n  }, [alphaType, parsedValue]);\n\n  return (\n    <Stack className={classes.container} gap={1}>\n      {alphaType === \"alpha\" ? (\n        <HexAlphaColorPicker\n          className={classes.picker}\n          color={swatchColor}\n          onChange={(newValue) => updateColor(newValue)}\n        />\n      ) : (\n        <HexColorPicker\n          className={classes.picker}\n          color={swatchColor}\n          onChange={(newValue) => updateColor(newValue)}\n        />\n      )}\n      <TextField\n        size=\"small\"\n        error={editedValueIsInvalid}\n        InputProps={{\n          onFocus: (event) => event.target.select(),\n          role: \"input\",\n          startAdornment: <TagIcon fontSize=\"small\" />,\n          style: { fontFamily: fonts.MONOSPACE },\n        }}\n        placeholder={alphaType === \"alpha\" ? \"RRGGBBAA\" : \"RRGGBB\"}\n        value={editedValue}\n        onKeyDown={(event) => event.key === \"Enter\" && onEnterKey?.()}\n        onChange={(event) => updateEditedValue(event.target.value)}\n      />\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Theme } from \"@mui/material\";\nimport tinycolor from \"tinycolor2\";\nimport { makeStyles } from \"tss-react/mui\";\n\nfunction calculateBorderColor(theme: Theme, color: string): string {\n  const parsedColor = tinycolor(color);\n  return parsedColor.isValid()\n    ? theme.palette.getContrastText(parsedColor.toHexString())\n    : theme.palette.text.primary;\n}\n\ntype ColorSwatchProps = {\n  color: string;\n  size?: \"small\" | \"medium\" | \"large\";\n} & React.HTMLAttributes<HTMLDivElement>;\n\nconst useStyles = makeStyles()((theme) => ({\n  root: {\n    // Color on top of white/black diagonal gradient. Color must be specified as a gradient because a\n    // background color can't be stacked on top of a background image.\n    backgroundImage: `linear-gradient(to bottom right, white 50%, black 50%)`,\n    borderRadius: theme.shape.borderRadius,\n    display: \"inline-flex\",\n    aspectRatio: \"1/1\",\n    flexShrink: 0,\n  },\n  swatch: {\n    aspectRatio: \"1/1\",\n  },\n  sizeSmall: {\n    height: theme.spacing(2),\n    width: theme.spacing(2),\n  },\n  sizeMedium: {\n    height: theme.spacing(2),\n    width: theme.spacing(2),\n  },\n  sizeLarge: {\n    height: theme.spacing(3),\n    width: theme.spacing(3),\n  },\n}));\n\nexport function ColorSwatch(props: ColorSwatchProps): JSX.Element {\n  const { color, size = \"medium\", className, ...rest } = props;\n  const { classes, cx, theme } = useStyles();\n\n  return (\n    <div\n      className={cx(\n        classes.root,\n        {\n          [classes.sizeSmall]: size === \"small\",\n          [classes.sizeMedium]: size === \"medium\",\n          [classes.sizeLarge]: size === \"large\",\n        },\n        className,\n      )}\n      {...rest}\n    >\n      <div\n        title={color}\n        className={classes.swatch}\n        style={{\n          backgroundColor: color,\n          border: `1px solid ${calculateBorderColor(theme, color)}`,\n        }}\n      />\n    </div>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport CancelIcon from \"@mui/icons-material/Cancel\";\nimport { TextField, Popover, IconButton } from \"@mui/material\";\nimport { useCallback, MouseEvent, useState, useMemo } from \"react\";\nimport tinycolor from \"tinycolor2\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { fonts } from \"@foxglove/studio-base/util/sharedStyleConstants\";\n\nimport { ColorPickerControl } from \"./ColorPickerControl\";\nimport { ColorSwatch } from \"./ColorSwatch\";\n\nconst useStyles = makeStyles<void, \"iconButton\">()((theme, _params, classes) => ({\n  root: {\n    position: \"relative\",\n  },\n  rootDisabled: {\n    pointerEvents: \"none\",\n  },\n  textField: {\n    \".MuiInputBase-formControl.MuiInputBase-root\": {\n      padding: 0,\n    },\n    \".MuiInputBase-root\": {\n      cursor: \"pointer\",\n\n      [`:not(:hover) .${classes.iconButton}`]: {\n        visibility: \"hidden\",\n      },\n    },\n    \".MuiInputBase-input\": {\n      alignItems: \"center\",\n      fontFeatureSettings: `${fonts.SANS_SERIF_FEATURE_SETTINGS}, \"zero\"`,\n    },\n  },\n  iconButton: {\n    marginRight: theme.spacing(0.25),\n    opacity: theme.palette.action.disabledOpacity,\n\n    \":hover\": {\n      background: \"transparent\",\n      opacity: 1,\n    },\n  },\n  colorSwatch: {\n    marginLeft: theme.spacing(0.75),\n  },\n}));\n\ntype ColorPickerInputProps = {\n  alphaType: \"none\" | \"alpha\";\n  disabled?: boolean;\n  value: undefined | string;\n  onChange: (value: undefined | string) => void;\n  placeholder?: string;\n  readOnly?: boolean;\n  hideClearButton?: boolean;\n};\n\nexport function ColorPickerInput(props: ColorPickerInputProps): JSX.Element {\n  const { alphaType, disabled, onChange, readOnly, hideClearButton, value } = props;\n\n  const { classes, cx } = useStyles();\n\n  const [anchorElement, setAnchorElement] = useState<undefined | HTMLDivElement>(undefined);\n\n  const parsedValue = useMemo(() => (value ? tinycolor(value) : undefined), [value]);\n  const displayValue =\n    alphaType === \"alpha\" ? parsedValue?.toHex8String() : parsedValue?.toHexString();\n  const swatchColor = displayValue ?? \"#00000044\";\n\n  const handleClick = useCallback((event: MouseEvent<HTMLDivElement>) => {\n    setAnchorElement(event.currentTarget);\n  }, []);\n\n  const handleClose = useCallback(() => {\n    setAnchorElement(undefined);\n  }, []);\n\n  const clearValue = useCallback(() => {\n    onChange(undefined);\n  }, [onChange]);\n\n  const open = Boolean(anchorElement);\n\n  const shouldHideClearButton = (displayValue ?? \"\") === \"\" || (hideClearButton ?? false);\n  return (\n    <Stack\n      className={cx(classes.root, {\n        [classes.rootDisabled]: disabled === true || readOnly === true,\n      })}\n    >\n      <TextField\n        className={classes.textField}\n        fullWidth\n        disabled={disabled}\n        placeholder={props.placeholder}\n        size=\"small\"\n        value={displayValue ?? \"\"}\n        variant=\"filled\"\n        InputProps={{\n          readOnly: true,\n          startAdornment: (\n            <ColorSwatch\n              className={classes.colorSwatch}\n              color={swatchColor}\n              onClick={handleClick}\n              size=\"small\"\n            />\n          ),\n          endAdornment: !shouldHideClearButton && (\n            <IconButton\n              size=\"small\"\n              className={classes.iconButton}\n              onClick={clearValue}\n              disabled={disabled}\n            >\n              <CancelIcon />\n            </IconButton>\n          ),\n        }}\n      />\n      <Popover\n        open={open}\n        anchorEl={anchorElement}\n        onClose={handleClose}\n        anchorOrigin={{\n          vertical: \"bottom\",\n          horizontal: \"left\",\n        }}\n        transformOrigin={{\n          vertical: \"top\",\n          horizontal: \"center\",\n        }}\n      >\n        <ColorPickerControl\n          alphaType={alphaType}\n          value={value}\n          onChange={onChange}\n          onEnterKey={handleClose}\n        />\n      </Popover>\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Popover, TextField, useTheme } from \"@mui/material\";\nimport { useCallback, useState } from \"react\";\nimport tinycolor from \"tinycolor2\";\n\nimport Stack from \"@foxglove/studio-base/components/Stack\";\n\nimport { ColorPickerControl } from \"./ColorPickerControl\";\nimport { ColorSwatch } from \"./ColorSwatch\";\n\nexport function ColorGradientInput({\n  colors,\n  disabled = false,\n  onChange,\n  readOnly = false,\n}: {\n  colors: undefined | readonly [string, string];\n  disabled?: boolean;\n  onChange: (colors: [string, string]) => void;\n  readOnly?: boolean;\n}): JSX.Element {\n  const [leftAnchor, setLeftAnchor] = useState<undefined | HTMLDivElement>(undefined);\n  const [rightAnchor, setRightAnchor] = useState<undefined | HTMLDivElement>(undefined);\n\n  const handleLeftClick = useCallback(\n    (event: React.MouseEvent<HTMLDivElement>) => {\n      if (readOnly) {\n        return;\n      }\n\n      setLeftAnchor(event.currentTarget);\n      setRightAnchor(undefined);\n    },\n    [readOnly],\n  );\n\n  const handleRightClick = useCallback(\n    (event: React.MouseEvent<HTMLDivElement>) => {\n      if (readOnly) {\n        return;\n      }\n\n      setLeftAnchor(undefined);\n      setRightAnchor(event.currentTarget);\n    },\n    [readOnly],\n  );\n\n  const handleClose = useCallback(() => {\n    setLeftAnchor(undefined);\n    setRightAnchor(undefined);\n  }, []);\n\n  const leftColor = colors?.[0] ?? \"#000000\";\n  const rightColor = colors?.[1] ?? \"#FFFFFF\";\n  const safeLeftColor = tinycolor(leftColor).isValid() ? leftColor : \"#000000\";\n  const safeRightColor = tinycolor(rightColor).isValid() ? rightColor : \"#FFFFFF\";\n\n  const theme = useTheme();\n\n  return (\n    <Stack\n      direction=\"row\"\n      alignItems=\"center\"\n      position=\"relative\"\n      paddingX={0.75}\n      style={{\n        opacity: disabled ? 0.5 : 1,\n        pointerEvents: disabled ? \"none\" : \"auto\",\n        background: `linear-gradient(to right, ${safeLeftColor}, ${safeRightColor}), repeating-conic-gradient(transparent 0 90deg, ${theme.palette.action.disabled} 90deg 180deg) top left/10px 10px repeat`,\n      }}\n    >\n      <ColorSwatch color={safeLeftColor} onClick={handleLeftClick} />\n      <TextField\n        variant=\"filled\"\n        size=\"small\"\n        fullWidth\n        value={`${leftColor} / ${rightColor}`}\n        style={{ visibility: \"hidden\" }}\n      />\n      <ColorSwatch color={safeRightColor} onClick={handleRightClick} />\n      <Popover\n        open={leftAnchor != undefined}\n        anchorEl={leftAnchor}\n        onClose={handleClose}\n        anchorOrigin={{\n          vertical: \"bottom\",\n          horizontal: \"left\",\n        }}\n        transformOrigin={{\n          vertical: \"top\",\n          horizontal: \"center\",\n        }}\n      >\n        <ColorPickerControl\n          value={leftColor}\n          alphaType=\"alpha\"\n          onChange={(newValue) => onChange([newValue, rightColor])}\n          onEnterKey={handleClose}\n        />\n      </Popover>\n      <Popover\n        open={rightAnchor != undefined}\n        anchorEl={rightAnchor}\n        onClose={handleClose}\n        anchorOrigin={{\n          vertical: \"bottom\",\n          horizontal: \"left\",\n        }}\n        transformOrigin={{\n          vertical: \"top\",\n          horizontal: \"center\",\n        }}\n      >\n        <ColorPickerControl\n          value={rightColor}\n          alphaType=\"alpha\"\n          onChange={(newValue) => onChange([leftColor, newValue])}\n          onEnterKey={handleClose}\n        />\n      </Popover>\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport ChevronLeftIcon from \"@mui/icons-material/ChevronLeft\";\nimport ChevronRightIcon from \"@mui/icons-material/ChevronRight\";\nimport { IconButton, TextFieldProps, TextField } from \"@mui/material\";\nimport { clamp, isFinite } from \"lodash\";\nimport { ReactNode, useCallback, useRef } from \"react\";\nimport { useLatest } from \"react-use\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { fonts } from \"@foxglove/studio-base/util/sharedStyleConstants\";\n\nconst useStyles = makeStyles()((theme) => ({\n  iconButton: {\n    \"&.MuiIconButton-edgeStart\": {\n      marginLeft: theme.spacing(-0.75),\n      borderTopRightRadius: 0,\n      borderBottomRightRadius: 0,\n    },\n    \"&.MuiIconButton-edgeEnd\": {\n      marginRight: theme.spacing(-0.75),\n      borderTopLeftRadius: 0,\n      borderBottomLeftRadius: 0,\n    },\n  },\n\n  textField: {\n    \".MuiInputBase-formControl.MuiInputBase-root\": {\n      paddingTop: 0,\n      paddingBottom: 0,\n    },\n    \".MuiInputBase-input\": {\n      textAlign: \"center\",\n      fontFamily: fonts.MONOSPACE,\n      cursor: \"ew-resize\",\n\n      \"&::-webkit-outer-spin-button, &::-webkit-inner-spin-button\": {\n        appearance: \"none\",\n        margin: 0,\n      },\n    },\n    \"@media (pointer: fine)\": {\n      \".MuiIconButton-root\": {\n        visibility: \"hidden\",\n      },\n      \"&:hover .MuiIconButton-root\": {\n        visibility: \"visible\",\n      },\n    },\n  },\n  textFieldReadonly: {\n    \".MuiInputBase-input\": {\n      cursor: \"auto\",\n    },\n  },\n}));\n\nexport function NumberInput(\n  props: {\n    iconUp?: ReactNode;\n    iconDown?: ReactNode;\n    max?: number;\n    min?: number;\n    precision?: number;\n    readOnly?: boolean;\n    step?: number;\n    value?: number;\n    onChange: (value: undefined | number) => void;\n  } & Omit<TextFieldProps, \"onChange\">,\n): JSX.Element {\n  const { classes, cx } = useStyles();\n  const {\n    value,\n    iconDown,\n    iconUp,\n    step = 1,\n    min,\n    max,\n    onChange,\n    disabled,\n    readOnly,\n    precision = 2,\n  } = props;\n\n  const inputRef = useRef<HTMLInputElement>(ReactNull);\n\n  // Maintain our own internal scrub value during the scrub to prevent jitter.\n  const scrubValue = useRef(0);\n\n  const latestValue = useLatest(value);\n\n  const placeHolderValue = isFinite(Number(props.placeholder))\n    ? Number(props.placeholder)\n    : undefined;\n\n  const updateValue = useCallback(\n    (newValue: undefined | number) => {\n      if (disabled === true || readOnly === true) {\n        return;\n      }\n\n      const clampedValue =\n        newValue == undefined\n          ? undefined\n          : clamp(newValue, min ?? Number.NEGATIVE_INFINITY, max ?? Number.POSITIVE_INFINITY);\n      onChange(clampedValue != undefined ? Number(clampedValue.toFixed(precision)) : clampedValue);\n    },\n    [disabled, readOnly, min, max, onChange, precision],\n  );\n\n  const onPointerDown = useCallback(\n    (event: React.PointerEvent) => {\n      event.currentTarget.setPointerCapture(event.pointerId);\n      const scrubStart = latestValue.current ?? placeHolderValue ?? 0;\n      scrubValue.current = isFinite(scrubStart) ? scrubStart : 0;\n    },\n    [latestValue, placeHolderValue],\n  );\n\n  const onPointerUp = useCallback((event: React.PointerEvent) => {\n    event.currentTarget.releasePointerCapture(event.pointerId);\n  }, []);\n\n  const onPointerMove = useCallback(\n    (event: React.PointerEvent<HTMLInputElement>) => {\n      if (event.buttons === 1) {\n        event.preventDefault();\n        event.currentTarget.blur();\n        const scale = event.shiftKey ? 10 : 1;\n        const delta =\n          Math.sign(event.movementX) *\n          Math.pow(Math.abs(event.movementX), 1.5) *\n          0.1 *\n          step *\n          scale;\n        scrubValue.current += delta;\n        updateValue(scrubValue.current);\n      }\n    },\n    [step, updateValue],\n  );\n\n  const displayValue =\n    inputRef.current === document.activeElement ? value : value?.toFixed(precision);\n\n  return (\n    <TextField\n      {...props}\n      value={displayValue ?? \"\"}\n      onChange={(event) =>\n        updateValue(event.target.value.length > 0 ? Number(event.target.value) : undefined)\n      }\n      type=\"number\"\n      className={cx(classes.textField, { [classes.textFieldReadonly]: readOnly })}\n      inputProps={{\n        ref: inputRef,\n        step,\n        onPointerDown,\n        onPointerUp,\n        onPointerMove,\n      }}\n      InputProps={{\n        readOnly,\n        startAdornment: (\n          <IconButton\n            className={classes.iconButton}\n            size=\"small\"\n            edge=\"start\"\n            tabIndex={-1} // Disable tabbing to the step buttons.\n            onClick={(event: React.MouseEvent) =>\n              updateValue((value ?? placeHolderValue ?? 0) - (event.shiftKey ? step * 10 : step))\n            }\n          >\n            {iconDown ?? <ChevronLeftIcon fontSize=\"small\" />}\n          </IconButton>\n        ),\n        endAdornment: (\n          <IconButton\n            className={classes.iconButton}\n            size=\"small\"\n            edge=\"end\"\n            tabIndex={-1} // Disable tabbing to the step buttons.\n            onClick={(event: React.MouseEvent) =>\n              updateValue((value ?? placeHolderValue ?? 0) + (event.shiftKey ? step * 10 : step))\n            }\n          >\n            {iconUp ?? <ChevronRightIcon fontSize=\"small\" />}\n          </IconButton>\n        ),\n      }}\n    />\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useCallback } from \"react\";\n\nimport Stack from \"@foxglove/studio-base/components/Stack\";\n\nimport { NumberInput } from \"./NumberInput\";\n\ntype Vec2Props = {\n  disabled?: boolean;\n  onChange: (value: undefined | [undefined | number, undefined | number]) => void;\n  precision?: number;\n  readOnly?: boolean;\n  step?: number;\n  placeholder?: readonly [undefined | string, undefined | string];\n  value: undefined | readonly [undefined | number, undefined | number];\n  min?: number;\n  max?: number;\n};\n\nexport function Vec2Input(props: Vec2Props): JSX.Element {\n  const {\n    disabled = false,\n    onChange,\n    precision,\n    readOnly = false,\n    step,\n    value,\n    min,\n    max,\n    placeholder,\n  } = props;\n\n  const onChangeCallback = useCallback(\n    (position: number, inputValue: undefined | number) => {\n      const newValue: [undefined | number, undefined | number] = [...(value ?? [0, 0])];\n      newValue[position] = inputValue;\n      onChange(newValue);\n    },\n    [onChange, value],\n  );\n\n  return (\n    <Stack gap={0.25}>\n      <NumberInput\n        size=\"small\"\n        disabled={disabled}\n        readOnly={readOnly}\n        variant=\"filled\"\n        fullWidth\n        precision={precision}\n        step={step}\n        placeholder={placeholder?.[0]}\n        value={value?.[0]}\n        min={min}\n        max={max}\n        onChange={(newValue) => onChangeCallback(0, newValue)}\n      />\n      <NumberInput\n        size=\"small\"\n        disabled={disabled}\n        readOnly={readOnly}\n        variant=\"filled\"\n        fullWidth\n        precision={precision}\n        step={step}\n        placeholder={placeholder?.[1]}\n        value={value?.[1]}\n        min={min}\n        max={max}\n        onChange={(newValue) => onChangeCallback(1, newValue)}\n      />\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useCallback } from \"react\";\n\nimport Stack from \"@foxglove/studio-base/components/Stack\";\n\nimport { NumberInput } from \"./NumberInput\";\n\ntype Vec3Props = {\n  disabled?: boolean;\n  onChange: (\n    value: undefined | [undefined | number, undefined | number, undefined | number],\n  ) => void;\n  precision?: number;\n  readOnly?: boolean;\n  step?: number;\n  placeholder?: readonly [undefined | string, undefined | string, undefined | string];\n  value: undefined | readonly [undefined | number, undefined | number, undefined | number];\n  min?: number;\n  max?: number;\n};\n\nexport function Vec3Input(props: Vec3Props): JSX.Element {\n  const {\n    disabled = false,\n    onChange,\n    precision,\n    readOnly = false,\n    step,\n    value,\n    min,\n    max,\n    placeholder,\n  } = props;\n\n  const onChangeCallback = useCallback(\n    (position: number, inputValue: undefined | number) => {\n      const newValue: [undefined | number, undefined | number, undefined | number] = [\n        ...(value ?? [0, 0, 0]),\n      ];\n      newValue[position] = inputValue;\n      onChange(newValue);\n    },\n    [onChange, value],\n  );\n\n  return (\n    <Stack gap={0.25}>\n      <NumberInput\n        size=\"small\"\n        disabled={disabled}\n        readOnly={readOnly}\n        variant=\"filled\"\n        fullWidth\n        precision={precision}\n        step={step}\n        placeholder={placeholder?.[0]}\n        value={value?.[0]}\n        min={min}\n        max={max}\n        onChange={(newValue) => onChangeCallback(0, newValue)}\n      />\n      <NumberInput\n        size=\"small\"\n        disabled={disabled}\n        readOnly={readOnly}\n        variant=\"filled\"\n        fullWidth\n        precision={precision}\n        step={step}\n        placeholder={placeholder?.[1]}\n        value={value?.[1]}\n        min={min}\n        max={max}\n        onChange={(newValue) => onChangeCallback(1, newValue)}\n      />\n      <NumberInput\n        size=\"small\"\n        disabled={disabled}\n        readOnly={readOnly}\n        variant=\"filled\"\n        fullWidth\n        precision={precision}\n        step={step}\n        placeholder={placeholder?.[2]}\n        value={value?.[2]}\n        min={min}\n        max={max}\n        onChange={(newValue) => onChangeCallback(2, newValue)}\n      />\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport CancelIcon from \"@mui/icons-material/Cancel\";\nimport ErrorIcon from \"@mui/icons-material/Error\";\nimport {\n  Autocomplete,\n  MenuItem,\n  MenuList,\n  MenuListProps,\n  Select,\n  TextField,\n  ToggleButton,\n  ToggleButtonGroup,\n  Tooltip,\n  Typography,\n} from \"@mui/material\";\nimport { makeStyles } from \"tss-react/mui\";\nimport { v4 as uuid } from \"uuid\";\n\nimport { Immutable, SettingsTreeAction, SettingsTreeField } from \"@foxglove/studio\";\nimport MessagePathInput from \"@foxglove/studio-base/components/MessagePathSyntax/MessagePathInput\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\n\nimport { ColorGradientInput, ColorPickerInput, NumberInput, Vec2Input, Vec3Input } from \"./inputs\";\n\n/** Used to allow both undefined and empty string in select inputs. */\nconst UNDEFINED_SENTINEL_VALUE = uuid();\n/** Used to avoid MUI errors when an invalid option is selected */\nconst INVALID_SENTINEL_VALUE = uuid();\n\nconst useStyles = makeStyles<void, \"error\">()((theme, _params, classes) => {\n  const prefersDarkMode = theme.palette.mode === \"dark\";\n  const inputBackgroundColor = prefersDarkMode\n    ? \"rgba(255, 255, 255, 0.09)\"\n    : \"rgba(0, 0, 0, 0.06)\";\n\n  return {\n    autocomplete: {\n      \".MuiInputBase-root.MuiInputBase-sizeSmall\": {\n        paddingInline: 0,\n        paddingBlock: theme.spacing(0.3125),\n      },\n    },\n    clearIndicator: {\n      marginRight: theme.spacing(-0.25),\n      opacity: theme.palette.action.disabledOpacity,\n\n      \":hover\": {\n        background: \"transparent\",\n        opacity: 1,\n      },\n    },\n    error: {},\n    fieldLabel: {\n      color: theme.palette.text.secondary,\n      overflow: \"hidden\",\n      textOverflow: \"ellipsis\",\n      whiteSpace: \"nowrap\",\n    },\n    fieldWrapper: {\n      minWidth: theme.spacing(14),\n      marginRight: theme.spacing(0.5),\n      [`&.${classes.error} .MuiInputBase-root, .MuiInputBase-root.${classes.error}`]: {\n        outline: `1px ${theme.palette.error.main} solid`,\n        outlineOffset: -1,\n      },\n    },\n    multiLabelWrapper: {\n      display: \"grid\",\n      gridTemplateColumns: \"1fr auto\",\n      columnGap: theme.spacing(0.5),\n      height: \"100%\",\n      width: \"100%\",\n      alignItems: \"center\",\n      textAlign: \"end\",\n    },\n    pseudoInputWrapper: {\n      borderRadius: theme.shape.borderRadius,\n      fontSize: \"0.75em\",\n      backgroundColor: inputBackgroundColor,\n\n      input: {\n        height: \"1.77em\",\n      },\n      \"&:hover\": {\n        backgroundColor: prefersDarkMode ? \"rgba(255, 255, 255, 0.13)\" : \"rgba(0, 0, 0, 0.09)\",\n        // Reset on touch devices, it doesn't add specificity\n        \"@media (hover: none)\": {\n          backgroundColor: inputBackgroundColor,\n        },\n      },\n      \"&:focus-within\": {\n        backgroundColor: inputBackgroundColor,\n      },\n    },\n    styledToggleButtonGroup: {\n      backgroundColor: theme.palette.action.hover,\n      gap: theme.spacing(0.25),\n      overflowX: \"auto\",\n\n      \"& .MuiToggleButtonGroup-grouped\": {\n        margin: theme.spacing(0.55),\n        borderRadius: theme.shape.borderRadius,\n        paddingTop: 0,\n        paddingBottom: 0,\n        borderColor: \"transparent !important\",\n        lineHeight: 1.75,\n\n        \"&.Mui-selected\": {\n          background: theme.palette.background.paper,\n          borderColor: \"transparent\",\n\n          \"&:hover\": {\n            borderColor: theme.palette.action.active,\n          },\n        },\n        \"&:not(:first-of-type)\": {\n          borderRadius: theme.shape.borderRadius,\n        },\n        \"&:first-of-type\": {\n          borderRadius: theme.shape.borderRadius,\n        },\n      },\n    },\n  };\n});\n\nfunction FieldInput({\n  actionHandler,\n  field,\n  path,\n}: {\n  actionHandler: (action: SettingsTreeAction) => void;\n  field: Immutable<SettingsTreeField>;\n  path: readonly string[];\n}): JSX.Element {\n  const { classes, cx } = useStyles();\n\n  switch (field.input) {\n    case \"autocomplete\":\n      return (\n        <Autocomplete\n          className={classes.autocomplete}\n          size=\"small\"\n          freeSolo={true}\n          value={field.value}\n          disabled={field.disabled}\n          readOnly={field.readonly}\n          ListboxComponent={MenuList}\n          ListboxProps={{ dense: true } as Partial<MenuListProps>}\n          renderOption={(props, option, { selected }) => (\n            <MenuItem selected={selected} {...props}>\n              {option}\n            </MenuItem>\n          )}\n          componentsProps={{\n            clearIndicator: {\n              size: \"small\",\n              className: classes.clearIndicator,\n            },\n          }}\n          clearIcon={<CancelIcon fontSize=\"small\" />}\n          renderInput={(params) => (\n            <TextField {...params} variant=\"filled\" size=\"small\" placeholder={field.placeholder} />\n          )}\n          onInputChange={(_event, value) =>\n            actionHandler({ action: \"update\", payload: { path, input: \"autocomplete\", value } })\n          }\n          onChange={(_event, value) =>\n            actionHandler({\n              action: \"update\",\n              payload: { path, input: \"autocomplete\", value: value ?? undefined },\n            })\n          }\n          options={field.items}\n        />\n      );\n    case \"number\":\n      return (\n        <NumberInput\n          size=\"small\"\n          variant=\"filled\"\n          value={field.value}\n          disabled={field.disabled}\n          readOnly={field.readonly}\n          placeholder={field.placeholder}\n          fullWidth\n          max={field.max}\n          min={field.min}\n          precision={field.precision}\n          step={field.step}\n          onChange={(value) =>\n            actionHandler({ action: \"update\", payload: { path, input: \"number\", value } })\n          }\n        />\n      );\n    case \"toggle\":\n      return (\n        <ToggleButtonGroup\n          className={classes.styledToggleButtonGroup}\n          fullWidth\n          value={field.value ?? UNDEFINED_SENTINEL_VALUE}\n          exclusive\n          disabled={field.disabled}\n          size=\"small\"\n          onChange={(_event, value) => {\n            if (value != undefined && field.readonly !== true) {\n              actionHandler({\n                action: \"update\",\n                payload: {\n                  path,\n                  input: \"toggle\",\n                  value: value === UNDEFINED_SENTINEL_VALUE ? undefined : value,\n                },\n              });\n            }\n          }}\n        >\n          {field.options.map((opt) => (\n            <ToggleButton\n              key={(typeof opt === \"object\" ? opt.value : opt) ?? UNDEFINED_SENTINEL_VALUE}\n              value={(typeof opt === \"object\" ? opt.value : opt) ?? UNDEFINED_SENTINEL_VALUE}\n            >\n              {typeof opt === \"object\" ? opt.label : opt}\n            </ToggleButton>\n          ))}\n        </ToggleButtonGroup>\n      );\n    case \"string\":\n      return (\n        <TextField\n          variant=\"filled\"\n          size=\"small\"\n          fullWidth\n          disabled={field.disabled}\n          value={field.value ?? \"\"}\n          placeholder={field.placeholder}\n          InputProps={{\n            readOnly: field.readonly,\n          }}\n          onChange={(event) =>\n            actionHandler({\n              action: \"update\",\n              payload: { path, input: \"string\", value: event.target.value },\n            })\n          }\n        />\n      );\n    case \"boolean\":\n      return (\n        <ToggleButtonGroup\n          className={classes.styledToggleButtonGroup}\n          fullWidth\n          value={field.value ?? false}\n          exclusive\n          disabled={field.disabled}\n          size=\"small\"\n          onChange={(_event, value) => {\n            if (value != undefined && field.readonly !== true) {\n              actionHandler({\n                action: \"update\",\n                payload: { path, input: \"boolean\", value },\n              });\n            }\n          }}\n        >\n          <ToggleButton value={false}>Off</ToggleButton>\n          <ToggleButton value={true}>On</ToggleButton>\n        </ToggleButtonGroup>\n      );\n    case \"rgb\":\n      return (\n        <ColorPickerInput\n          alphaType=\"none\"\n          disabled={field.disabled}\n          readOnly={field.readonly}\n          placeholder={field.placeholder}\n          value={field.value?.toString()}\n          onChange={(value) =>\n            actionHandler({\n              action: \"update\",\n              payload: { path, input: \"rgb\", value },\n            })\n          }\n          hideClearButton={field.hideClearButton}\n        />\n      );\n    case \"rgba\":\n      return (\n        <ColorPickerInput\n          alphaType=\"alpha\"\n          disabled={field.disabled}\n          readOnly={field.readonly}\n          placeholder={field.placeholder}\n          value={field.value?.toString()}\n          onChange={(value) =>\n            actionHandler({\n              action: \"update\",\n              payload: { path, input: \"rgba\", value },\n            })\n          }\n        />\n      );\n    case \"messagepath\":\n      return (\n        <Stack className={classes.pseudoInputWrapper} direction=\"row\">\n          <MessagePathInput\n            path={field.value ?? \"\"}\n            disabled={field.disabled}\n            readOnly={field.readonly}\n            supportsMathModifiers={field.supportsMathModifiers}\n            onChange={(value) =>\n              actionHandler({\n                action: \"update\",\n                payload: { path, input: \"messagepath\", value },\n              })\n            }\n            validTypes={field.validTypes}\n          />\n        </Stack>\n      );\n    case \"select\": {\n      const selectedOptionIndex = // use findIndex instead of find to avoid confusing TypeScript with union of arrays\n        field.options.findIndex((option) => option.value === field.value);\n      const selectedOption = field.options[selectedOptionIndex];\n\n      const isEmpty = field.options.length === 0;\n      let selectValue = field.value;\n      if (!selectedOption) {\n        selectValue = INVALID_SENTINEL_VALUE;\n      } else if (selectValue == undefined) {\n        // We can't pass value={undefined} or we get a React error \"A component is changing an\n        // uncontrolled input to be controlled\" when changing the value to be non-undefined.\n        selectValue = UNDEFINED_SENTINEL_VALUE;\n      }\n\n      const hasError = !selectedOption && (!isEmpty || field.value != undefined);\n      return (\n        <Select\n          className={cx({ [classes.error]: hasError })}\n          size=\"small\"\n          displayEmpty\n          fullWidth\n          disabled={field.disabled}\n          readOnly={field.readonly}\n          variant=\"filled\"\n          value={selectValue}\n          renderValue={(_value) => {\n            // Use field.value rather than the passed-in value so we can render the value even when\n            // it was not present in the list of options.\n            const value = field.value;\n            for (const option of field.options) {\n              if (option.value === value) {\n                return option.label.trim();\n              }\n            }\n            return value;\n          }}\n          onChange={(event) =>\n            actionHandler({\n              action: \"update\",\n              payload: {\n                path,\n                input: \"select\",\n                value:\n                  event.target.value === UNDEFINED_SENTINEL_VALUE\n                    ? undefined\n                    : (event.target.value as undefined | string | string[]),\n              },\n            })\n          }\n          MenuProps={{ MenuListProps: { dense: true } }}\n        >\n          {field.options.map(({ label, value = UNDEFINED_SENTINEL_VALUE }) => (\n            <MenuItem key={value} value={value}>\n              {label}\n            </MenuItem>\n          ))}\n          {isEmpty && <MenuItem disabled>No options</MenuItem>}\n          {!selectedOption && (\n            <MenuItem style={{ display: \"none\" }} value={INVALID_SENTINEL_VALUE} />\n          )}\n        </Select>\n      );\n    }\n    case \"gradient\":\n      return (\n        <ColorGradientInput\n          colors={field.value}\n          disabled={field.disabled}\n          readOnly={field.readonly}\n          onChange={(value) =>\n            actionHandler({ action: \"update\", payload: { path, input: \"gradient\", value } })\n          }\n        />\n      );\n    case \"vec3\":\n      return (\n        <Vec3Input\n          step={field.step}\n          placeholder={field.placeholder}\n          value={field.value}\n          precision={field.precision}\n          disabled={field.disabled}\n          readOnly={field.readonly}\n          min={field.min}\n          max={field.max}\n          onChange={(value) =>\n            actionHandler({ action: \"update\", payload: { path, input: \"vec3\", value } })\n          }\n        />\n      );\n    case \"vec2\":\n      return (\n        <Vec2Input\n          step={field.step}\n          value={field.value}\n          placeholder={field.placeholder}\n          precision={field.precision}\n          disabled={field.disabled}\n          readOnly={field.readonly}\n          min={field.min}\n          max={field.max}\n          onChange={(value) =>\n            actionHandler({ action: \"update\", payload: { path, input: \"vec2\", value } })\n          }\n        />\n      );\n  }\n}\n\nfunction FieldLabel({ field }: { field: Immutable<SettingsTreeField> }): JSX.Element {\n  const { classes } = useStyles();\n\n  if (field.input === \"vec2\") {\n    const labels = field.labels ?? [\"X\", \"Y\"];\n    return (\n      <>\n        <div className={classes.multiLabelWrapper}>\n          <Typography\n            title={field.label}\n            variant=\"subtitle2\"\n            color=\"text.secondary\"\n            noWrap\n            flex=\"auto\"\n          >\n            {field.label}\n          </Typography>\n          {labels.map((label, index) => (\n            <Typography\n              key={label}\n              title={field.label}\n              variant=\"subtitle2\"\n              color=\"text.secondary\"\n              noWrap\n              style={{ gridColumn: index === 0 ? \"span 1\" : \"2 / span 1\" }}\n              flex=\"auto\"\n            >\n              {label}\n            </Typography>\n          ))}\n        </div>\n      </>\n    );\n  } else if (field.input === \"vec3\") {\n    const labels = field.labels ?? [\"X\", \"Y\", \"Z\"];\n    return (\n      <>\n        <div className={classes.multiLabelWrapper}>\n          <Typography\n            title={field.label}\n            variant=\"subtitle2\"\n            color=\"text.secondary\"\n            noWrap\n            flex=\"auto\"\n          >\n            {field.label}\n          </Typography>\n          {labels.map((label, index) => (\n            <Typography\n              key={label}\n              title={field.label}\n              variant=\"subtitle2\"\n              color=\"text.secondary\"\n              noWrap\n              style={{ gridColumn: index === 0 ? \"span 1\" : \"2 / span 1\" }}\n              flex=\"auto\"\n            >\n              {label}\n            </Typography>\n          ))}\n        </div>\n      </>\n    );\n  } else {\n    return (\n      <>\n        <Typography\n          className={classes.fieldLabel}\n          title={field.help ?? field.label}\n          variant=\"subtitle2\"\n        >\n          {field.label}\n        </Typography>\n      </>\n    );\n  }\n}\n\nfunction FieldEditorComponent({\n  actionHandler,\n  field,\n  path,\n}: {\n  actionHandler: (action: SettingsTreeAction) => void;\n  field: Immutable<SettingsTreeField>;\n  path: readonly string[];\n}): JSX.Element {\n  const indent = Math.min(path.length, 4);\n  const paddingLeft = 0.75 + 2 * (indent - 1);\n  const { classes, cx } = useStyles();\n\n  return (\n    <>\n      <Stack\n        direction=\"row\"\n        alignItems=\"center\"\n        justifyContent=\"flex-end\"\n        gap={0.5}\n        paddingLeft={paddingLeft}\n        fullHeight\n      >\n        {field.error && (\n          <Tooltip\n            arrow\n            placement=\"top\"\n            title={<Typography variant=\"subtitle2\">{field.error}</Typography>}\n          >\n            <ErrorIcon color=\"error\" fontSize=\"small\" />\n          </Tooltip>\n        )}\n        <FieldLabel field={field} />\n      </Stack>\n      <div className={cx(classes.fieldWrapper, { [classes.error]: field.error != undefined })}>\n        <FieldInput actionHandler={actionHandler} field={field} path={path} />\n      </div>\n      <Stack paddingBottom={0.25} style={{ gridColumn: \"span 2\" }} />\n    </>\n  );\n}\n\nexport const FieldEditor = React.memo(FieldEditorComponent);\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport Clock from \"@mui/icons-material/AccessTime\";\nimport Add from \"@mui/icons-material/Add\";\nimport Addchart from \"@mui/icons-material/Addchart\";\nimport Points from \"@mui/icons-material/BlurOn\";\nimport Check from \"@mui/icons-material/Check\";\nimport Circle from \"@mui/icons-material/Circle\";\nimport Clear from \"@mui/icons-material/Clear\";\nimport Delete from \"@mui/icons-material/Delete\";\nimport Walk from \"@mui/icons-material/DirectionsWalk\";\nimport Flag from \"@mui/icons-material/Flag\";\nimport Folder from \"@mui/icons-material/Folder\";\nimport FolderOpen from \"@mui/icons-material/FolderOpen\";\nimport Grid from \"@mui/icons-material/GridOn\";\nimport Hive from \"@mui/icons-material/HiveOutlined\";\nimport Shapes from \"@mui/icons-material/Interests\";\nimport World from \"@mui/icons-material/Language\";\nimport Background from \"@mui/icons-material/Layers\";\nimport Map from \"@mui/icons-material/Map\";\nimport MoveDown from \"@mui/icons-material/MoveDown\";\nimport MoveUp from \"@mui/icons-material/MoveUp\";\nimport NorthWest from \"@mui/icons-material/NorthWest\";\nimport NoteFilled from \"@mui/icons-material/Note\";\nimport Note from \"@mui/icons-material/NoteOutlined\";\nimport Move from \"@mui/icons-material/OpenWith\";\nimport Camera from \"@mui/icons-material/PhotoCamera\";\nimport PrecisionManufacturing from \"@mui/icons-material/PrecisionManufacturing\";\nimport Radar from \"@mui/icons-material/Radar\";\nimport Settings from \"@mui/icons-material/Settings\";\nimport Share from \"@mui/icons-material/Share\";\nimport SouthEast from \"@mui/icons-material/SouthEast\";\nimport Star from \"@mui/icons-material/StarOutline\";\nimport Timeline from \"@mui/icons-material/Timeline\";\nimport Topic from \"@mui/icons-material/Topic\";\nimport Collapse from \"@mui/icons-material/UnfoldLess\";\nimport Expand from \"@mui/icons-material/UnfoldMore\";\nimport Cells from \"@mui/icons-material/ViewComfy\";\nimport Cube from \"@mui/icons-material/ViewInAr\";\nimport ImageProjection from \"@mui/icons-material/Vrpano\";\n\nimport { SettingsIcon } from \"@foxglove/studio\";\n\nconst icons: Record<SettingsIcon, typeof Add> = {\n  Add,\n  Addchart,\n  Background,\n  Camera,\n  Cells,\n  Check,\n  Circle,\n  Clear,\n  Clock,\n  Collapse,\n  Cube,\n  Delete,\n  Expand,\n  Flag,\n  Folder,\n  FolderOpen,\n  Grid,\n  Hive,\n  ImageProjection,\n  Map,\n  Move,\n  MoveDown,\n  MoveUp,\n  NorthWest,\n  Note,\n  NoteFilled,\n  Points,\n  PrecisionManufacturing,\n  Radar,\n  Settings,\n  Shapes,\n  Share,\n  SouthEast,\n  Star,\n  Timeline,\n  Topic,\n  Walk,\n  World,\n};\n\nexport { icons };\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport MoreVertIcon from \"@mui/icons-material/MoreVert\";\nimport { Menu, MenuItem, IconButton, ListItemIcon, ListItemText, Divider } from \"@mui/material\";\nimport { useState } from \"react\";\n\nimport { SettingsTreeNodeAction } from \"@foxglove/studio\";\n\nimport { icons } from \"./icons\";\n\nexport function NodeActionsMenu({\n  actions,\n  onSelectAction,\n}: {\n  actions: readonly SettingsTreeNodeAction[];\n  onSelectAction: (actionId: string) => void;\n}): JSX.Element {\n  const [anchorEl, setAnchorEl] = useState<undefined | HTMLButtonElement>(undefined);\n  const open = Boolean(anchorEl);\n\n  const handleClick = (event: React.MouseEvent<HTMLButtonElement>) => {\n    setAnchorEl(event.currentTarget);\n  };\n\n  const handleClose = (id: string) => {\n    onSelectAction(id);\n    setAnchorEl(undefined);\n  };\n\n  const anyItemHasIcon = actions.some((action) => action.type === \"action\" && action.icon);\n\n  return (\n    <>\n      <IconButton\n        title=\"More actions\"\n        aria-controls={open ? \"node-actions-menu\" : undefined}\n        aria-haspopup=\"true\"\n        aria-expanded={open ? \"true\" : undefined}\n        onClick={handleClick}\n        data-testid=\"node-actions-menu-button\"\n        size=\"small\"\n      >\n        <MoreVertIcon fontSize=\"small\" />\n      </IconButton>\n      <Menu\n        id=\"basic-menu\"\n        anchorEl={anchorEl}\n        open={open}\n        onClose={() => setAnchorEl(undefined)}\n        MenuListProps={{\n          \"aria-label\": \"node actions button\",\n          dense: true,\n        }}\n      >\n        {actions.map((action, index) => {\n          if (action.type === \"divider\") {\n            return (\n              <Divider variant={anyItemHasIcon ? \"inset\" : \"fullWidth\"} key={`divider_${index}`} />\n            );\n          }\n          const Icon = action.icon ? icons[action.icon] : undefined;\n          return (\n            <MenuItem key={action.id} onClick={() => handleClose(action.id)}>\n              {Icon && (\n                <ListItemIcon>\n                  <Icon fontSize=\"small\" />\n                </ListItemIcon>\n              )}\n              <ListItemText inset={!Icon && anyItemHasIcon} disableTypography>\n                {action.label}\n              </ListItemText>\n            </MenuItem>\n          );\n        })}\n      </Menu>\n    </>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Checkbox, CheckboxProps, SvgIcon, IconButtonProps } from \"@mui/material\";\nimport { makeStyles } from \"tss-react/mui\";\n\nconst useStyles = makeStyles()((theme) => ({\n  checkbox: {\n    borderRadius: theme.shape.borderRadius,\n    padding: theme.spacing(1),\n\n    \"&:hover\": {\n      backgroundColor: theme.palette.action.hover,\n    },\n  },\n  checkboxSizeSmall: {\n    padding: theme.spacing(0.625),\n  },\n}));\n\nexport function VisibilityToggle(\n  props: CheckboxProps & { size: IconButtonProps[\"size\"] },\n): JSX.Element {\n  const { className, onChange, ...rest } = props;\n  const { classes, cx } = useStyles();\n\n  const handleChange: CheckboxProps[\"onChange\"] = (event, checked) => {\n    onChange?.(event, checked);\n    event.currentTarget.blur();\n  };\n\n  return (\n    <Checkbox\n      className={cx(className, classes.checkbox, {\n        [classes.checkboxSizeSmall]: props.size === \"small\",\n      })}\n      onChange={handleChange}\n      {...rest}\n      title=\"Toggle visibility\"\n      icon={\n        <SvgIcon fontSize=\"small\" viewBox=\"0 0 16 16\" color=\"disabled\">\n          {/* Eye open */}\n          <path\n            fill=\"currentColor\"\n            d=\"M13.508 7.801c.556-.527 1.036-1.134 1.422-1.801h-1.185C12.48 7.814 10.378 9 8 9 5.622 9 3.52 7.814 2.254 6H1.07c.386.667.866 1.274 1.421 1.801L.896 9.396l.708.707L3.26 8.446c.71.523 1.511.932 2.374 1.199l-.617 2.221.964.268.626-2.255C7.06 9.96 7.525 10 8 10c.475 0 .94-.041 1.392-.12l.626 2.254.964-.268-.617-2.221c.863-.267 1.663-.676 2.374-1.2l1.657 1.658.708-.707-1.595-1.595z\"\n            fillRule=\"nonzero\"\n          />\n        </SvgIcon>\n      }\n      checkedIcon={\n        <SvgIcon fontSize=\"small\" viewBox=\"0 0 16 16\">\n          {/* Eye closed */}\n          <g fill=\"currentColor\">\n            <path\n              d=\"M8 10c1.105 0 2-.895 2-2 0-1.105-.895-2-2-2-1.104 0-2 .895-2 2 0 1.105.896 2 2 2z\"\n              fillRule=\"nonzero\"\n            />\n            <path\n              d=\"M8 4c2.878 0 5.378 1.621 6.635 4-1.257 2.379-3.757 4-6.635 4-2.878 0-5.377-1.621-6.635-4C2.623 5.621 5.122 4 8 4zm0 7c-2.3 0-4.322-1.194-5.478-3C3.678 6.194 5.7 5 8 5c2.3 0 4.322 1.194 5.479 3C12.322 9.806 10.3 11 8 11z\"\n              fillRule=\"evenodd\"\n            />\n          </g>\n        </SvgIcon>\n      }\n    />\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { sortBy } from \"lodash\";\n\nimport { Immutable, SettingsTreeNode, SettingsTreeNodes } from \"@foxglove/studio\";\n\n/**\n * Filters and sorts roots to prepare them for rendering.\n */\nexport function prepareSettingsNodes(\n  roots: Immutable<SettingsTreeNodes>,\n): Immutable<Array<[string, SettingsTreeNode]>> {\n  // Use sortBy here for stable sorting.\n  return sortBy(\n    Object.entries(roots).filter(\n      (entry): entry is [string, SettingsTreeNode] => entry[1] != undefined,\n    ),\n    (entry) => entry[1].order,\n  );\n}\n\n/**\n * Recursively filter out nodes that don't match the given filter.\n */\nexport function filterTreeNodes(\n  nodes: Immutable<SettingsTreeNodes>,\n  filter: string,\n): Immutable<SettingsTreeNodes> {\n  const result: Record<string, Immutable<SettingsTreeNode>> = {};\n  Object.entries(nodes).forEach(([key, node]) => {\n    if (node == undefined) {\n      return;\n    }\n\n    // Include node in results if any children match the filter.\n    const filtered = filterTreeNodes(node.children ?? {}, filter);\n    if (Object.values(filtered).length > 0) {\n      result[key] = { ...node, children: filtered };\n    }\n\n    // Match on label or key in tree.\n    const stringToMatch = (node.label ?? key).toLocaleLowerCase();\n    if (stringToMatch.includes(filter.toLocaleLowerCase())) {\n      result[key] = node;\n    }\n    return;\n  });\n\n  return result;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport ArrowDownIcon from \"@mui/icons-material/ArrowDropDown\";\nimport ArrowRightIcon from \"@mui/icons-material/ArrowRight\";\nimport CheckIcon from \"@mui/icons-material/Check\";\nimport EditIcon from \"@mui/icons-material/Edit\";\nimport ErrorIcon from \"@mui/icons-material/Error\";\nimport { Button, Divider, IconButton, TextField, Tooltip, Typography } from \"@mui/material\";\nimport { TFunction } from \"i18next\";\nimport { isEqual, partition } from \"lodash\";\nimport memoizeWeak from \"memoize-weak\";\nimport { ChangeEvent, useCallback, useEffect, useMemo, useRef } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport tinycolor from \"tinycolor2\";\nimport { keyframes } from \"tss-react\";\nimport { makeStyles } from \"tss-react/mui\";\nimport { useImmer } from \"use-immer\";\n\nimport { filterMap } from \"@foxglove/den/collection\";\nimport {\n  Immutable,\n  SettingsTreeAction,\n  SettingsTreeNode,\n  SettingsTreeNodeActionItem,\n} from \"@foxglove/studio\";\nimport { HighlightedText } from \"@foxglove/studio-base/components/HighlightedText\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\n\nimport { FieldEditor } from \"./FieldEditor\";\nimport { NodeActionsMenu } from \"./NodeActionsMenu\";\nimport { VisibilityToggle } from \"./VisibilityToggle\";\nimport { icons } from \"./icons\";\nimport { prepareSettingsNodes } from \"./utils\";\n\nexport type NodeEditorProps = {\n  actionHandler: (action: SettingsTreeAction) => void;\n  defaultOpen?: boolean;\n  filter?: string;\n  focusedPath?: readonly string[];\n  path: readonly string[];\n  settings?: Immutable<SettingsTreeNode>;\n};\n\nexport const NODE_HEADER_MIN_HEIGHT = 35;\n\nconst useStyles = makeStyles()((theme) => ({\n  actionButton: {\n    padding: theme.spacing(0.5),\n  },\n  editNameField: {\n    font: \"inherit\",\n    gridColumn: \"span 2\",\n    width: \"100%\",\n\n    \".MuiInputBase-input\": {\n      fontSize: \"0.75rem\",\n      padding: theme.spacing(0.75, 1),\n    },\n  },\n  focusedNode: {\n    animation: `\n      ${keyframes`\n      from {\n        background-color: ${tinycolor(theme.palette.primary.main).setAlpha(0.3).toRgbString()};\n      }\n      to {\n        background-color: transparent;\n      }`}\n      0.5s ease-in-out\n    `,\n  },\n  fieldPadding: {\n    gridColumn: \"span 2\",\n    height: theme.spacing(0.5),\n  },\n  iconWrapper: {\n    position: \"absolute\",\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    top: \"50%\",\n    left: 0,\n    transform: \"translate(-97.5%, -50%)\",\n  },\n\n  nodeHeader: {\n    display: \"flex\",\n    gridColumn: \"span 2\",\n    paddingRight: theme.spacing(0.5),\n    minHeight: NODE_HEADER_MIN_HEIGHT,\n\n    \"@media (pointer: fine)\": {\n      \".MuiCheckbox-root\": {\n        visibility: \"visible\",\n      },\n\n      \"[data-node-function=edit-label]\": {\n        visibility: \"hidden\",\n      },\n\n      \"&:hover\": {\n        backgroundColor: theme.palette.action.hover,\n\n        \".MuiCheckbox-root\": {\n          visibility: \"visible\",\n        },\n\n        \"[data-node-function=edit-label]\": {\n          visibility: \"visible\",\n        },\n      },\n    },\n  },\n  nodeHeaderVisible: {\n    \"@media (pointer: fine)\": {\n      \".MuiCheckbox-root\": {\n        visibility: \"hidden\",\n      },\n      \"&:hover\": {\n        \".MuiCheckbox-root\": {\n          visibility: \"visible\",\n        },\n      },\n    },\n  },\n\n  nodeHeaderToggle: {\n    display: \"grid\",\n    alignItems: \"center\",\n    gridTemplateColumns: \"auto 1fr auto\",\n    opacity: 0.6,\n    position: \"relative\",\n    userSelect: \"none\",\n    width: \"100%\",\n  },\n  nodeHeaderToggleHasProperties: {\n    cursor: \"pointer\",\n  },\n  nodeHeaderToggleVisible: {\n    opacity: 1,\n  },\n  errorTooltip: {\n    whiteSpace: \"pre-line\",\n    maxHeight: \"15vh\",\n    overflowY: \"auto\",\n  },\n}));\n\nfunction ExpansionArrow({ expanded }: { expanded: boolean }): JSX.Element {\n  const { classes } = useStyles();\n\n  const Component = expanded ? ArrowDownIcon : ArrowRightIcon;\n  return (\n    <div className={classes.iconWrapper}>\n      <Component />\n    </div>\n  );\n}\n\nconst makeStablePath = memoizeWeak((path: readonly string[], key: string) => [...path, key]);\n\ntype SelectVisibilityFilterValue = \"all\" | \"visible\" | \"invisible\";\nconst SelectVisibilityFilterOptions: (t: TFunction<\"settingsEditor\">) => {\n  label: string;\n  value: SelectVisibilityFilterValue;\n}[] = (t) => [\n  { label: t(\"listAll\"), value: \"all\" },\n  { label: t(\"listVisible\"), value: \"visible\" },\n  { label: t(\"listInvisible\"), value: \"invisible\" },\n];\nfunction showVisibleFilter(child: Immutable<SettingsTreeNode>): boolean {\n  // want to show children with undefined visibility\n  return child.visible !== false;\n}\nfunction showInvisibleFilter(child: Immutable<SettingsTreeNode>): boolean {\n  // want to show children with undefined visibility\n  return child.visible !== true;\n}\nconst getSelectVisibilityFilterField = (t: TFunction<\"settingsEditor\">) =>\n  ({\n    input: \"select\",\n    label: t(\"filterList\"),\n    help: t(\"filterListHelp\"),\n    options: SelectVisibilityFilterOptions(t),\n  } as const);\n\ntype State = {\n  editing: boolean;\n  focusedPath: undefined | readonly string[];\n  open: boolean;\n  visibilityFilter: SelectVisibilityFilterValue;\n};\n\nfunction NodeEditorComponent(props: NodeEditorProps): JSX.Element {\n  const { actionHandler, defaultOpen = true, filter, focusedPath, settings = {} } = props;\n  const [state, setState] = useImmer<State>({\n    editing: false,\n    focusedPath: undefined,\n    open: defaultOpen,\n    visibilityFilter: \"all\",\n  });\n  const { t } = useTranslation(\"settingsEditor\");\n  const { classes, cx, theme } = useStyles();\n\n  const indent = props.path.length;\n  const allowVisibilityToggle = props.settings?.visible != undefined;\n  const visible = props.settings?.visible !== false;\n  const selectVisibilityFilterEnabled = props.settings?.enableVisibilityFilter === true;\n\n  const selectVisibilityFilter = (action: SettingsTreeAction) => {\n    if (action.action === \"update\" && action.payload.input === \"select\") {\n      setState((draft) => {\n        draft.visibilityFilter = action.payload.value as SelectVisibilityFilterValue;\n      });\n    }\n  };\n\n  const toggleVisibility = () => {\n    actionHandler({\n      action: \"update\",\n      payload: { input: \"boolean\", path: [...props.path, \"visible\"], value: !visible },\n    });\n  };\n\n  const handleNodeAction = (actionId: string) => {\n    actionHandler({ action: \"perform-node-action\", payload: { id: actionId, path: props.path } });\n  };\n\n  const isFocused = isEqual(focusedPath, props.path);\n\n  useEffect(() => {\n    const isOnFocusedPath =\n      focusedPath != undefined && isEqual(props.path, focusedPath.slice(0, props.path.length));\n\n    if (isOnFocusedPath) {\n      setState((draft) => {\n        draft.open = true;\n      });\n    }\n\n    if (isFocused) {\n      rootRef.current?.scrollIntoView();\n    }\n  }, [focusedPath, isFocused, props.path, setState]);\n\n  const { fields, children } = settings;\n  const hasChildren = children != undefined && Object.keys(children).length > 0;\n  const hasProperties = fields != undefined || hasChildren;\n\n  const rootRef = useRef<HTMLDivElement>(ReactNull);\n\n  const fieldEditors = filterMap(Object.entries(fields ?? {}), ([key, field]) => {\n    return field ? (\n      <FieldEditor\n        key={key}\n        field={field}\n        path={makeStablePath(props.path, key)}\n        actionHandler={actionHandler}\n      />\n    ) : undefined;\n  });\n\n  const filterFn =\n    state.visibilityFilter === \"visible\"\n      ? showVisibleFilter\n      : state.visibilityFilter === \"invisible\"\n      ? showInvisibleFilter\n      : undefined;\n  const childNodes = filterMap(prepareSettingsNodes(children ?? {}), ([key, child]) => {\n    return !filterFn || filterFn(child) ? (\n      <NodeEditor\n        actionHandler={actionHandler}\n        defaultOpen={child.defaultExpansionState === \"collapsed\" ? false : true}\n        filter={filter}\n        focusedPath={focusedPath}\n        key={key}\n        settings={child}\n        path={makeStablePath(props.path, key)}\n      />\n    ) : undefined;\n  });\n\n  const IconComponent = settings.icon ? icons[settings.icon] : undefined;\n\n  const onEditLabel = useCallback(\n    (event: ChangeEvent<HTMLInputElement>) => {\n      if (settings.renamable === true) {\n        actionHandler({\n          action: \"update\",\n          payload: { path: [...props.path, \"label\"], input: \"string\", value: event.target.value },\n        });\n      }\n    },\n    [actionHandler, props.path, settings.renamable],\n  );\n\n  const toggleEditing = useCallback(() => {\n    setState((draft) => {\n      draft.editing = !draft.editing;\n    });\n  }, [setState]);\n\n  const toggleOpen = useCallback(() => {\n    setState((draft) => {\n      if (!draft.editing) {\n        draft.open = !draft.open;\n      }\n    });\n  }, [setState]);\n\n  const onLabelKeyDown = useCallback(\n    (event: React.KeyboardEvent) => {\n      if (event.key === \"Enter\" || event.key === \"Escape\") {\n        toggleEditing();\n      }\n    },\n    [toggleEditing],\n  );\n\n  const [inlineActions, menuActions] = useMemo(\n    () =>\n      partition(\n        settings.actions,\n        (action): action is SettingsTreeNodeActionItem =>\n          action.type === \"action\" && action.display === \"inline\",\n      ),\n    [settings.actions],\n  );\n\n  return (\n    <>\n      <div\n        className={cx(classes.nodeHeader, {\n          [classes.focusedNode]: isFocused,\n          [classes.nodeHeaderVisible]: visible,\n        })}\n        ref={rootRef}\n      >\n        <div\n          className={cx(classes.nodeHeaderToggle, {\n            [classes.nodeHeaderToggleHasProperties]: hasProperties,\n            [classes.nodeHeaderToggleVisible]: visible,\n          })}\n          style={{\n            marginLeft: theme.spacing(0.75 + 2 * indent),\n          }}\n          onClick={toggleOpen}\n          data-testid={`settings__nodeHeaderToggle__${props.path.join(\"-\")}`}\n        >\n          {hasProperties && <ExpansionArrow expanded={state.open} />}\n          {IconComponent && (\n            <IconComponent\n              fontSize=\"small\"\n              color=\"inherit\"\n              style={{\n                marginRight: theme.spacing(0.5),\n                opacity: 0.8,\n              }}\n            />\n          )}\n          {state.editing ? (\n            <TextField\n              className={classes.editNameField}\n              autoFocus\n              variant=\"filled\"\n              onChange={onEditLabel}\n              value={settings.label}\n              onBlur={toggleEditing}\n              onKeyDown={onLabelKeyDown}\n              onFocus={(event) => event.target.select()}\n              InputProps={{\n                endAdornment: (\n                  <IconButton\n                    className={classes.actionButton}\n                    title=\"Rename\"\n                    data-node-function=\"edit-label\"\n                    color=\"primary\"\n                    onClick={(event) => {\n                      event.stopPropagation();\n                      toggleEditing();\n                    }}\n                  >\n                    <CheckIcon fontSize=\"small\" />\n                  </IconButton>\n                ),\n              }}\n            />\n          ) : (\n            <Typography\n              noWrap={true}\n              flex=\"auto\"\n              variant=\"subtitle2\"\n              fontWeight={indent < 2 ? 600 : 400}\n              color={visible ? \"text.primary\" : \"text.disabled\"}\n            >\n              <HighlightedText text={settings.label ?? t(\"general\")} highlight={filter} />\n            </Typography>\n          )}\n        </div>\n        <Stack alignItems=\"center\" direction=\"row\">\n          {settings.renamable === true && !state.editing && (\n            <IconButton\n              className={classes.actionButton}\n              title=\"Rename\"\n              data-node-function=\"edit-label\"\n              color=\"primary\"\n              onClick={(event) => {\n                event.stopPropagation();\n                toggleEditing();\n              }}\n            >\n              <EditIcon fontSize=\"small\" />\n            </IconButton>\n          )}\n          {settings.visible != undefined && (\n            <VisibilityToggle\n              size=\"small\"\n              checked={visible}\n              onChange={toggleVisibility}\n              style={{ opacity: allowVisibilityToggle ? 1 : 0 }}\n              disabled={!allowVisibilityToggle}\n            />\n          )}\n          {inlineActions.map((action) => {\n            const Icon = action.icon ? icons[action.icon] : undefined;\n            const handler = () =>\n              actionHandler({\n                action: \"perform-node-action\",\n                payload: { id: action.id, path: props.path },\n              });\n            return Icon ? (\n              <IconButton\n                key={action.id}\n                onClick={handler}\n                title={action.label}\n                className={classes.actionButton}\n              >\n                <Icon fontSize=\"small\" />\n              </IconButton>\n            ) : (\n              <Button\n                key={action.id}\n                onClick={handler}\n                size=\"small\"\n                color=\"inherit\"\n                className={classes.actionButton}\n              >\n                {action.label}\n              </Button>\n            );\n          })}\n          {props.settings?.error && (\n            <Tooltip\n              arrow\n              title={\n                <Typography variant=\"subtitle2\" className={classes.errorTooltip}>\n                  {props.settings.error}\n                </Typography>\n              }\n            >\n              <IconButton size=\"small\" color=\"error\">\n                <ErrorIcon fontSize=\"small\" />\n              </IconButton>\n            </Tooltip>\n          )}\n\n          {menuActions.length > 0 && (\n            <NodeActionsMenu actions={menuActions} onSelectAction={handleNodeAction} />\n          )}\n        </Stack>\n      </div>\n      {state.open && fieldEditors.length > 0 && (\n        <>\n          <div className={classes.fieldPadding} />\n          {fieldEditors}\n          <div className={classes.fieldPadding} />\n        </>\n      )}\n      {state.open && selectVisibilityFilterEnabled && hasChildren && (\n        <FieldEditor\n          key=\"visibilityFilter\"\n          field={{ ...getSelectVisibilityFilterField(t), value: state.visibilityFilter }}\n          path={makeStablePath(props.path, \"visibilityFilter\")}\n          actionHandler={selectVisibilityFilter}\n        />\n      )}\n      {state.open && childNodes}\n      {indent === 1 && <Divider style={{ gridColumn: \"span 2\" }} />}\n    </>\n  );\n}\n\nexport const NodeEditor = React.memo(NodeEditorComponent);\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport ClearIcon from \"@mui/icons-material/Clear\";\nimport SearchIcon from \"@mui/icons-material/Search\";\nimport { IconButton, TextField } from \"@mui/material\";\nimport memoizeWeak from \"memoize-weak\";\nimport { useCallback, useMemo, useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { Immutable, SettingsTree, SettingsTreeAction, SettingsTreeField } from \"@foxglove/studio\";\nimport { useConfigById } from \"@foxglove/studio-base/PanelAPI\";\nimport { FieldEditor } from \"@foxglove/studio-base/components/SettingsTreeEditor/FieldEditor\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { useSelectedPanels } from \"@foxglove/studio-base/context/CurrentLayoutContext\";\nimport { usePanelCatalog } from \"@foxglove/studio-base/context/PanelCatalogContext\";\nimport { usePanelStateStore } from \"@foxglove/studio-base/context/PanelStateContext\";\nimport { PANEL_TITLE_CONFIG_KEY, getPanelTypeFromId } from \"@foxglove/studio-base/util/layout\";\n\nimport { NodeEditor } from \"./NodeEditor\";\nimport { filterTreeNodes, prepareSettingsNodes } from \"./utils\";\n\nconst useStyles = makeStyles()((theme) => ({\n  appBar: {\n    top: 0,\n    marginRight: 1,\n    zIndex: theme.zIndex.appBar,\n    padding: theme.spacing(0.5),\n    position: \"sticky\",\n    backgroundColor: theme.palette.background.paper,\n  },\n  fieldGrid: {\n    display: \"grid\",\n    gridTemplateColumns: \"minmax(20%, 20ch) auto\",\n    columnGap: theme.spacing(1),\n  },\n  textField: {\n    \".MuiOutlinedInput-notchedOutline\": {\n      border: \"none\",\n    },\n  },\n  startAdornment: {\n    display: \"flex\",\n  },\n}));\n\nconst makeStablePath = memoizeWeak((key: string) => [key]);\n\nexport default function SettingsTreeEditor({\n  settings,\n}: {\n  settings: Immutable<SettingsTree>;\n}): JSX.Element {\n  const { classes } = useStyles();\n  const { actionHandler, focusedPath } = settings;\n  const [filterText, setFilterText] = useState<string>(\"\");\n  const { t } = useTranslation(\"settingsEditor\");\n\n  const filteredNodes = useMemo(() => {\n    if (filterText.length > 0) {\n      return filterTreeNodes(settings.nodes, filterText);\n    } else {\n      return settings.nodes;\n    }\n  }, [settings.nodes, filterText]);\n\n  const definedNodes = useMemo(() => prepareSettingsNodes(filteredNodes), [filteredNodes]);\n\n  const { selectedPanelIds } = useSelectedPanels();\n  const selectedPanelId = useMemo(\n    () => (selectedPanelIds.length === 1 ? selectedPanelIds[0] : undefined),\n    [selectedPanelIds],\n  );\n  const panelCatalog = usePanelCatalog();\n  const panelType = useMemo(\n    () => (selectedPanelId != undefined ? getPanelTypeFromId(selectedPanelId) : undefined),\n    [selectedPanelId],\n  );\n  const panelInfo = useMemo(\n    () => (panelType != undefined ? panelCatalog.getPanelByType(panelType) : undefined),\n    [panelCatalog, panelType],\n  );\n  const [config, saveConfig] = useConfigById(selectedPanelId);\n  const defaultPanelTitle = usePanelStateStore((state) =>\n    selectedPanelId ? state.defaultTitles[selectedPanelId] : undefined,\n  );\n  const customPanelTitle =\n    typeof config?.[PANEL_TITLE_CONFIG_KEY] === \"string\"\n      ? config[PANEL_TITLE_CONFIG_KEY]\n      : undefined;\n  const panelTitleField = useMemo<SettingsTreeField>(\n    () => ({\n      input: \"string\",\n      label: t(\"title\"),\n      placeholder: defaultPanelTitle ?? panelInfo?.title,\n      value: customPanelTitle,\n    }),\n    [customPanelTitle, defaultPanelTitle, panelInfo?.title, t],\n  );\n  const handleTitleChange = useCallback(\n    (action: SettingsTreeAction) => {\n      if (action.action === \"update\" && action.payload.path[0] === PANEL_TITLE_CONFIG_KEY) {\n        saveConfig({ [PANEL_TITLE_CONFIG_KEY]: action.payload.value });\n      }\n    },\n    [saveConfig],\n  );\n\n  const showTitleField = filterText.length === 0 && panelInfo?.hasCustomToolbar !== true;\n\n  return (\n    <Stack fullHeight>\n      {settings.enableFilter === true && (\n        <header className={classes.appBar}>\n          <TextField\n            id=\"settings-filter\"\n            variant=\"filled\"\n            data-testid=\"settings-filter-field\"\n            onChange={(event) => setFilterText(event.target.value)}\n            value={filterText}\n            className={classes.textField}\n            fullWidth\n            placeholder={t(\"searchPanelSettings\")}\n            InputProps={{\n              size: \"small\",\n              startAdornment: (\n                <label className={classes.startAdornment} htmlFor=\"settings-filter\">\n                  <SearchIcon fontSize=\"small\" />\n                </label>\n              ),\n              endAdornment: filterText && (\n                <IconButton\n                  size=\"small\"\n                  title={t(\"clearSearch\")}\n                  onClick={() => setFilterText(\"\")}\n                  edge=\"end\"\n                >\n                  <ClearIcon fontSize=\"small\" />\n                </IconButton>\n              ),\n            }}\n          />\n        </header>\n      )}\n      <div className={classes.fieldGrid}>\n        {showTitleField && (\n          <>\n            <Stack paddingBottom={0.5} style={{ gridColumn: \"span 2\" }} />\n            <FieldEditor\n              field={panelTitleField}\n              path={[PANEL_TITLE_CONFIG_KEY]}\n              actionHandler={handleTitleChange}\n            />\n          </>\n        )}\n        {definedNodes.map(([key, root]) => (\n          <NodeEditor\n            key={key}\n            actionHandler={actionHandler}\n            defaultOpen={root.defaultExpansionState === \"collapsed\" ? false : true}\n            filter={filterText}\n            focusedPath={focusedPath}\n            path={makeStablePath(key)}\n            settings={root}\n          />\n        ))}\n      </div>\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { ArrowDownload20Filled } from \"@fluentui/react-icons\";\nimport CloseIcon from \"@mui/icons-material/Close\";\nimport DeleteOutline from \"@mui/icons-material/DeleteOutline\";\nimport {\n  Button,\n  IconButton,\n  Dialog,\n  DialogContent,\n  DialogActions,\n  TextField,\n  Typography,\n  outlinedInputClasses,\n} from \"@mui/material\";\nimport { useCallback, useMemo, useState } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport CopyButton from \"@foxglove/studio-base/components/CopyButton\";\nimport HoverableIconButton from \"@foxglove/studio-base/components/HoverableIconButton\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { downloadTextFile } from \"@foxglove/studio-base/util/download\";\nimport { fonts } from \"@foxglove/studio-base/util/sharedStyleConstants\";\n\nexport type ShareJsonModalProps = {\n  onRequestClose: () => void;\n  onChange: (value: unknown) => void;\n  initialValue: unknown;\n  title: string;\n};\n\nconst useStyles = makeStyles()((theme) => ({\n  textarea: {\n    [`.${outlinedInputClasses.root}`]: {\n      backgroundColor: theme.palette.action.hover,\n      fontFamily: fonts.MONOSPACE,\n      maxHeight: \"60vh\",\n      overflowY: \"auto\",\n      padding: theme.spacing(0.25),\n    },\n  },\n}));\n\nexport function ShareJsonModal({\n  initialValue = {},\n  onChange,\n  onRequestClose,\n  title,\n}: ShareJsonModalProps): JSX.Element {\n  const { classes } = useStyles();\n  const [value, setValue] = useState(JSON.stringify(initialValue, undefined, 2) ?? \"\");\n\n  const { decodedValue, error } = useMemo(() => {\n    try {\n      return { decodedValue: JSON.parse(value === \"\" ? \"{}\" : value) as unknown, error: undefined };\n    } catch (err) {\n      return { decodedValue: undefined, error: err as Error };\n    }\n  }, [value]);\n\n  const handleSubmit = useCallback(() => {\n    onChange(decodedValue);\n    onRequestClose();\n  }, [decodedValue, onChange, onRequestClose]);\n\n  const handleDownload = useCallback(() => {\n    downloadTextFile(value, \"layout.json\");\n  }, [value]);\n\n  const getText = useCallback(() => value, [value]);\n\n  return (\n    <Dialog open onClose={onRequestClose} maxWidth=\"sm\" fullWidth>\n      <Stack\n        direction=\"row\"\n        justifyContent=\"space-between\"\n        alignItems=\"flex-start\"\n        paddingX={3}\n        paddingTop={2}\n      >\n        <Stack>\n          <Typography variant=\"h4\" fontWeight={600} gutterBottom>\n            {title}\n          </Typography>\n        </Stack>\n\n        <IconButton onClick={onRequestClose} edge=\"end\">\n          <CloseIcon />\n        </IconButton>\n      </Stack>\n      <DialogContent>\n        <TextField\n          className={classes.textarea}\n          fullWidth\n          multiline\n          rows={10}\n          value={value}\n          onChange={(event) => setValue(event.target.value)}\n          autoFocus\n          error={error != undefined}\n          helperText={\n            error ? \"The JSON provided is invalid.\" : \" \" // pass whitespace to prevent height from jumping\n          }\n          inputProps={{ \"data-testid\": \"share-json-input\" }}\n          FormHelperTextProps={{ variant: \"standard\" }}\n          spellCheck={false}\n        />\n      </DialogContent>\n      <DialogActions>\n        <Stack direction=\"row\" gap={1}>\n          <IconButton onClick={handleDownload} title=\"Download\" aria-label=\"Download\">\n            <ArrowDownload20Filled />\n          </IconButton>\n          <CopyButton color=\"default\" getText={getText} />\n          <HoverableIconButton\n            activeColor=\"error\"\n            onClick={() => setValue(\"{}\")}\n            title=\"Clear\"\n            aria-label=\"Clear\"\n            icon={<DeleteOutline />}\n          />\n        </Stack>\n\n        <Stack flex=\"auto\" />\n\n        <Button\n          disabled={error != undefined}\n          variant=\"contained\"\n          size=\"large\"\n          onClick={handleSubmit}\n        >\n          Apply\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Divider, Typography } from \"@mui/material\";\nimport { useCallback, useEffect, useMemo, useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { useUnmount } from \"react-use\";\n\nimport { SettingsTree } from \"@foxglove/studio\";\nimport { useConfigById } from \"@foxglove/studio-base/PanelAPI\";\nimport EmptyState from \"@foxglove/studio-base/components/EmptyState\";\nimport { ActionMenu } from \"@foxglove/studio-base/components/PanelSettings/ActionMenu\";\nimport SettingsTreeEditor from \"@foxglove/studio-base/components/SettingsTreeEditor\";\nimport { ShareJsonModal } from \"@foxglove/studio-base/components/ShareJsonModal\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport {\n  LayoutState,\n  useCurrentLayoutActions,\n  useCurrentLayoutSelector,\n  useSelectedPanels,\n} from \"@foxglove/studio-base/context/CurrentLayoutContext\";\nimport { usePanelCatalog } from \"@foxglove/studio-base/context/PanelCatalogContext\";\nimport {\n  PanelStateStore,\n  usePanelStateStore,\n} from \"@foxglove/studio-base/context/PanelStateContext\";\nimport { PanelConfig } from \"@foxglove/studio-base/types/panels\";\nimport { TAB_PANEL_TYPE } from \"@foxglove/studio-base/util/globalConstants\";\nimport { getPanelTypeFromId } from \"@foxglove/studio-base/util/layout\";\n\nconst singlePanelIdSelector = (state: LayoutState) =>\n  typeof state.selectedLayout?.data?.layout === \"string\"\n    ? state.selectedLayout.data.layout\n    : undefined;\n\nconst selectIncrementSequenceNumber = (store: PanelStateStore) => store.incrementSequenceNumber;\n\nconst EMPTY_SETTINGS_TREE: SettingsTree = Object.freeze({\n  actionHandler: () => undefined,\n  nodes: {},\n});\n\nexport default function PanelSettings({\n  selectedPanelIdsForTests,\n}: React.PropsWithChildren<{\n  selectedPanelIdsForTests?: readonly string[];\n}>): JSX.Element {\n  const { t } = useTranslation(\"panelSettings\");\n  const singlePanelId = useCurrentLayoutSelector(singlePanelIdSelector);\n  const {\n    selectedPanelIds: originalSelectedPanelIds,\n    setSelectedPanelIds,\n    selectAllPanels,\n  } = useSelectedPanels();\n  const selectedPanelIds = selectedPanelIdsForTests ?? originalSelectedPanelIds;\n\n  // If no panel is selected and there is only one panel in the layout, select it\n  useEffect(() => {\n    if (selectedPanelIds.length === 0 && singlePanelId != undefined) {\n      selectAllPanels();\n    }\n  }, [selectAllPanels, selectedPanelIds, singlePanelId]);\n\n  const selectedPanelId = useMemo(\n    () => (selectedPanelIds.length === 1 ? selectedPanelIds[0] : undefined),\n    [selectedPanelIds],\n  );\n\n  // Automatically deselect the panel we were editing when the settings sidebar closes\n  useUnmount(() => {\n    if (selectedPanelId != undefined) {\n      setSelectedPanelIds([]);\n    }\n  });\n\n  const panelCatalog = usePanelCatalog();\n  const { getCurrentLayoutState: getCurrentLayout, savePanelConfigs } = useCurrentLayoutActions();\n  const panelType = useMemo(\n    () => (selectedPanelId != undefined ? getPanelTypeFromId(selectedPanelId) : undefined),\n    [selectedPanelId],\n  );\n  const panelInfo = useMemo(\n    () => (panelType != undefined ? panelCatalog.getPanelByType(panelType) : undefined),\n    [panelCatalog, panelType],\n  );\n\n  const incrementSequenceNumber = usePanelStateStore(selectIncrementSequenceNumber);\n\n  const [showShareModal, setShowShareModal] = useState(false);\n  const shareModal = useMemo(() => {\n    const panelConfigById = getCurrentLayout().selectedLayout?.data?.configById;\n    if (selectedPanelId == undefined || !showShareModal || !panelConfigById) {\n      return ReactNull;\n    }\n    return (\n      <ShareJsonModal\n        onRequestClose={() => setShowShareModal(false)}\n        initialValue={panelConfigById[selectedPanelId] ?? {}}\n        onChange={(config) => {\n          savePanelConfigs({\n            configs: [{ id: selectedPanelId, config: config as PanelConfig, override: true }],\n          });\n          incrementSequenceNumber(selectedPanelId);\n        }}\n        title={t(\"importOrExportSettings\")}\n      />\n    );\n  }, [\n    getCurrentLayout,\n    selectedPanelId,\n    showShareModal,\n    savePanelConfigs,\n    incrementSequenceNumber,\n    t,\n  ]);\n\n  const [config] = useConfigById(selectedPanelId);\n\n  const settingsTree = usePanelStateStore((state) =>\n    selectedPanelId ? state.settingsTrees[selectedPanelId] : undefined,\n  );\n\n  const resetToDefaults = useCallback(() => {\n    if (selectedPanelId) {\n      savePanelConfigs({\n        configs: [{ id: selectedPanelId, config: {}, override: true }],\n      });\n      incrementSequenceNumber(selectedPanelId);\n    }\n  }, [incrementSequenceNumber, savePanelConfigs, selectedPanelId]);\n\n  if (selectedPanelId == undefined) {\n    return <EmptyState>{t(\"selectAPanelToEditItsSettings\")}</EmptyState>;\n  }\n\n  if (!config) {\n    return <EmptyState>{t(\"loadingPanelSettings\")}</EmptyState>;\n  }\n\n  const showTitleField = panelInfo != undefined && panelInfo.hasCustomToolbar !== true;\n  const title = panelInfo?.title ?? t(\"unknown\");\n\n  return (\n    <Stack fullHeight flex=\"auto\" gap={1}>\n      {shareModal}\n      <Stack gap={2} justifyContent=\"flex-start\" flex=\"auto\">\n        <Stack flex=\"auto\">\n          {settingsTree && (\n            <>\n              <Stack\n                paddingLeft={0.75}\n                direction=\"row\"\n                alignItems=\"center\"\n                justifyContent=\"space-between\"\n              >\n                <Typography variant=\"subtitle2\">{t(\"panelName\", { title })}</Typography>\n                <ActionMenu\n                  key={1}\n                  fontSize=\"small\"\n                  allowShare={panelType !== TAB_PANEL_TYPE}\n                  onReset={resetToDefaults}\n                  onShare={() => setShowShareModal(true)}\n                />\n              </Stack>\n              <Divider />\n            </>\n          )}\n          {settingsTree || showTitleField ? (\n            <SettingsTreeEditor\n              key={selectedPanelId}\n              settings={settingsTree ?? EMPTY_SETTINGS_TREE}\n            />\n          ) : (\n            <Stack flex=\"auto\" alignItems=\"center\" justifyContent=\"center\" paddingX={1}>\n              <Typography variant=\"body2\" color=\"text.secondary\" align=\"center\">\n                {t(\"panelDoesNotHaveSettings\")}\n              </Typography>\n            </Stack>\n          )}\n        </Stack>\n      </Stack>\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport AddIcon from \"@mui/icons-material/Add\";\nimport RemoveIcon from \"@mui/icons-material/Remove\";\nimport {\n  Alert,\n  Button,\n  CircularProgress,\n  Dialog,\n  DialogActions,\n  TextField,\n  ToggleButton,\n  ToggleButtonGroup,\n  Typography,\n  FormLabel,\n  FormControl,\n  IconButton,\n  ButtonGroup,\n} from \"@mui/material\";\nimport { countBy } from \"lodash\";\nimport { KeyboardEvent, useCallback } from \"react\";\nimport { useAsyncFn } from \"react-use\";\nimport { keyframes } from \"tss-react\";\nimport { makeStyles } from \"tss-react/mui\";\nimport { useImmer } from \"use-immer\";\n\nimport Log from \"@foxglove/log\";\nimport { toDate, toNanoSec } from \"@foxglove/rostime\";\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { useAppContext } from \"@foxglove/studio-base/context/AppContext\";\nimport { EventsStore, useEvents } from \"@foxglove/studio-base/context/EventsContext\";\nimport { useAppTimeFormat } from \"@foxglove/studio-base/hooks\";\n\nconst log = Log.getLogger(__filename);\n\nconst fadeInAnimation = keyframes`\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n`;\n\nconst useStyles = makeStyles<void, \"toggleButton\">()((theme, _params, classes) => ({\n  grid: {\n    alignItems: \"center\",\n    display: \"grid\",\n    gridTemplateColumns: \"1fr 1fr auto\",\n    gap: theme.spacing(1),\n    overflow: \"auto\",\n    alignContent: \"flex-start\",\n  },\n  row: {\n    animation: `${fadeInAnimation} 0.2s ease-in-out`,\n    display: \"contents\",\n  },\n  toggleButton: {\n    border: \"none\",\n    lineHeight: 1,\n  },\n  toggleButtonGroup: {\n    marginRight: theme.spacing(-1),\n    gap: theme.spacing(0.25),\n\n    [`.${classes.toggleButton}`]: {\n      borderRadius: `${theme.shape.borderRadius}px !important`,\n      marginLeft: \"0px !important\",\n      borderLeft: \"none !important\",\n    },\n  },\n}));\n\ntype KeyValue = { key: string; value: string };\n\nconst selectCurrentTime = (ctx: MessagePipelineContext) => ctx.playerState.activeData?.currentTime;\nconst selectRefreshEvents = (store: EventsStore) => store.refreshEvents;\nconst selectDeviceId = (store: EventsStore) => store.deviceId;\n\nexport function CreateEventDialog(props: { onClose: () => void }): JSX.Element {\n  const { onClose } = props;\n\n  const { classes } = useStyles();\n\n  const refreshEvents = useEvents(selectRefreshEvents);\n  const currentTime = useMessagePipeline(selectCurrentTime);\n  const [event, setEvent] = useImmer<{\n    startTime: undefined | Date;\n    duration: undefined | number;\n    durationUnit: \"sec\" | \"nsec\";\n    metadataEntries: KeyValue[];\n  }>({\n    startTime: currentTime ? toDate(currentTime) : undefined,\n    duration: 0,\n    durationUnit: \"sec\",\n    metadataEntries: [{ key: \"\", value: \"\" }],\n  });\n\n  const updateMetadata = useCallback(\n    (index: number, updateType: keyof KeyValue, value: string) => {\n      setEvent((draft) => {\n        const keyval = draft.metadataEntries[index];\n        if (keyval) {\n          keyval[updateType] = value;\n\n          // Automatically add new row if we're at the end and have both key and value.\n          if (\n            index === draft.metadataEntries.length - 1 &&\n            keyval.key.length > 0 &&\n            keyval.value.length > 0\n          ) {\n            draft.metadataEntries.push({ key: \"\", value: \"\" });\n          }\n        }\n      });\n    },\n    [setEvent],\n  );\n\n  const { formatTime } = useAppTimeFormat();\n  const { createEvent: appModuleCreateEvent } = useAppContext();\n\n  const countedMetadata = countBy(event.metadataEntries, (kv) => kv.key);\n  const duplicateKey = Object.entries(countedMetadata).find(\n    ([key, count]) => key.length > 0 && count > 1,\n  );\n  const canSubmit = event.startTime != undefined && event.duration != undefined && !duplicateKey;\n\n  const deviceId = useEvents(selectDeviceId);\n\n  const [createdEvent, createEvent] = useAsyncFn(async () => {\n    if (event.startTime == undefined || event.duration == undefined || deviceId == undefined) {\n      return;\n    }\n\n    const filteredMeta = event.metadataEntries.filter(\n      (entry) => entry.key.length > 0 && entry.value.length > 0,\n    );\n    const keyedMetadata = Object.fromEntries(\n      filteredMeta.map((entry) => [entry.key.trim(), entry.value.trim()]),\n    );\n\n    await appModuleCreateEvent?.({\n      deviceId,\n      timestamp: event.startTime.toISOString(),\n      durationNanos: toNanoSec(\n        event.durationUnit === \"sec\"\n          ? { sec: event.duration, nsec: 0 }\n          : { sec: 0, nsec: event.duration },\n      ).toString(),\n      metadata: keyedMetadata,\n    });\n\n    onClose();\n    refreshEvents();\n  }, [appModuleCreateEvent, deviceId, event, onClose, refreshEvents]);\n\n  const onMetaDataKeyDown = useCallback(\n    (keyboardEvent: KeyboardEvent) => {\n      if (keyboardEvent.key === \"Enter\") {\n        createEvent().catch((error) => log.error(error));\n      }\n    },\n    [createEvent],\n  );\n\n  const addRow = useCallback(\n    (index: number) => {\n      setEvent((draft) => {\n        draft.metadataEntries.splice(index + 1, 0, { key: \"\", value: \"\" });\n      });\n    },\n    [setEvent],\n  );\n\n  const removeRow = useCallback(\n    (index: number) => {\n      setEvent((draft) => {\n        if (draft.metadataEntries.length > 1) {\n          draft.metadataEntries.splice(index, 1);\n        }\n      });\n    },\n    [setEvent],\n  );\n\n  const formattedStartTime = currentTime ? formatTime(currentTime) : \"-\";\n\n  return (\n    <Dialog open onClose={onClose} fullWidth maxWidth=\"sm\">\n      <Stack paddingX={3} paddingTop={2}>\n        <Typography variant=\"h2\">Create event</Typography>\n      </Stack>\n      <Stack paddingX={3} paddingTop={2}>\n        <div className={classes.grid}>\n          <FormControl>\n            <FormLabel>Start Time</FormLabel>\n            <Typography paddingY={1}>{formattedStartTime}</Typography>\n          </FormControl>\n          <TextField\n            value={event.duration ?? \"\"}\n            fullWidth\n            label=\"Duration\"\n            onChange={(ev) => {\n              const duration = Number(ev.currentTarget.value);\n              setEvent((oldEvent) => ({\n                ...oldEvent,\n                duration: duration > 0 ? duration : undefined,\n              }));\n            }}\n            type=\"number\"\n            InputProps={{\n              endAdornment: (\n                <ToggleButtonGroup\n                  className={classes.toggleButtonGroup}\n                  size=\"small\"\n                  exclusive\n                  value={event.durationUnit}\n                  onChange={(_ev, durationUnit) => {\n                    if (event.durationUnit !== durationUnit) {\n                      setEvent((old) => ({ ...old, durationUnit }));\n                    }\n                  }}\n                >\n                  <ToggleButton className={classes.toggleButton} tabIndex={-1} value=\"sec\">\n                    sec\n                  </ToggleButton>\n                  <ToggleButton className={classes.toggleButton} tabIndex={-1} value=\"nsec\">\n                    nsec\n                  </ToggleButton>\n                </ToggleButtonGroup>\n              ),\n            }}\n          />\n          <ButtonGroup style={{ visibility: \"hidden\" }}>\n            <IconButton tabIndex={-1} data-testid=\"add\">\n              <AddIcon />\n            </IconButton>\n            <IconButton tabIndex={-1}>\n              <AddIcon />\n            </IconButton>\n          </ButtonGroup>\n        </div>\n      </Stack>\n      <Stack paddingX={3} paddingTop={2}>\n        <FormLabel>Metadata</FormLabel>\n        <div className={classes.grid}>\n          {event.metadataEntries.map(({ key, value }, index) => {\n            const hasDuplicate = ((key.length > 0 ? countedMetadata[key] : undefined) ?? 0) > 1;\n            return (\n              <div className={classes.row} key={index}>\n                <TextField\n                  fullWidth\n                  value={key}\n                  autoFocus={index === 0}\n                  placeholder=\"Key (string)\"\n                  error={hasDuplicate}\n                  onKeyDown={onMetaDataKeyDown}\n                  onChange={(evt) => updateMetadata(index, \"key\", evt.currentTarget.value)}\n                />\n                <TextField\n                  fullWidth\n                  value={value}\n                  placeholder=\"Value (string)\"\n                  error={hasDuplicate}\n                  onKeyDown={onMetaDataKeyDown}\n                  onChange={(evt) => updateMetadata(index, \"value\", evt.currentTarget.value)}\n                />\n                <ButtonGroup>\n                  <IconButton tabIndex={-1} onClick={() => addRow(index)}>\n                    <AddIcon />\n                  </IconButton>\n                  <IconButton\n                    tabIndex={-1}\n                    onClick={() => removeRow(index)}\n                    style={{ visibility: event.metadataEntries.length > 1 ? \"visible\" : \"hidden\" }}\n                  >\n                    <RemoveIcon />\n                  </IconButton>\n                </ButtonGroup>\n              </div>\n            );\n          })}\n        </div>\n      </Stack>\n      <DialogActions>\n        <Button variant=\"outlined\" size=\"large\" onClick={onClose}>\n          Cancel\n        </Button>\n        <Button\n          variant=\"contained\"\n          size=\"large\"\n          onClick={createEvent}\n          disabled={!canSubmit || createdEvent.loading}\n        >\n          {createdEvent.loading && (\n            <CircularProgress color=\"inherit\" size=\"1rem\" style={{ marginRight: \"0.5rem\" }} />\n          )}\n          Create Event\n        </Button>\n      </DialogActions>\n      {duplicateKey && <Alert severity=\"error\">Duplicate key {duplicateKey[0]}</Alert>}\n      {createdEvent.error?.message && <Alert severity=\"error\">{createdEvent.error.message}</Alert>}\n    </Dialog>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Typography } from \"@mui/material\";\nimport { useMemo } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { Time } from \"@foxglove/rostime\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { useAppTimeFormat } from \"@foxglove/studio-base/hooks\";\nimport { fonts } from \"@foxglove/studio-base/util/sharedStyleConstants\";\nimport { isAbsoluteTime, formatTimeRaw } from \"@foxglove/studio-base/util/time\";\n\ntype Props = {\n  disableDate?: boolean;\n  horizontal?: boolean;\n  time: Time;\n  title?: string;\n};\n\nconst useStyles = makeStyles()({\n  numericValue: {\n    fontFeatureSettings: `${fonts.SANS_SERIF_FEATURE_SETTINGS}, \"zero\"`,\n  },\n});\n\nexport default function Timestamp(props: Props): JSX.Element {\n  const { classes } = useStyles();\n  const { disableDate = false, horizontal = false, time, title } = props;\n  const { formatDate, formatTime } = useAppTimeFormat();\n  const currentTimeStr = useMemo(() => formatTime(time), [time, formatTime]);\n  const rawTimeStr = useMemo(() => formatTimeRaw(time), [time]);\n  const date = useMemo(() => formatDate(time), [formatDate, time]);\n\n  if (!isAbsoluteTime(time)) {\n    return (\n      <Stack title={title} direction=\"row\" alignItems=\"center\" flexGrow={0}>\n        <Typography className={classes.numericValue} variant=\"inherit\">\n          {rawTimeStr}\n        </Typography>\n      </Stack>\n    );\n  }\n\n  return (\n    <Stack\n      title={title}\n      gap={horizontal ? 0 : 1}\n      flexWrap={horizontal ? \"nowrap\" : \"wrap\"}\n      direction={horizontal ? \"row\" : \"column\"}\n      alignItems={horizontal ? \"center\" : \"flex-start\"}\n      justifyContent={horizontal ? \"flex-start\" : \"center\"}\n    >\n      {!disableDate && (\n        <>\n          <Typography\n            className={classes.numericValue}\n            noWrap\n            fontWeight={!horizontal ? 700 : undefined}\n            variant=\"inherit\"\n          >\n            {date}\n          </Typography>\n          {horizontal && <>&nbsp;</>}\n        </>\n      )}\n\n      <Stack direction=\"row\" alignItems=\"center\" flexShrink={0} gap={0.5}>\n        <Typography variant=\"inherit\" className={classes.numericValue}>\n          {currentTimeStr}\n        </Typography>\n      </Stack>\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport TextMiddleTruncate from \"@foxglove/studio-base/components/TextMiddleTruncate\";\n\n/**\n * Render multiline text using TextMiddleTruncate for each line.\n */\nexport function MultilineMiddleTruncate(props: { text: string }): JSX.Element {\n  const { text } = props;\n  return (\n    <>\n      {text.split(\"\\n\").map((line) => (\n        <TextMiddleTruncate key={line} text={line} />\n      ))}\n    </>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Skeleton, Typography } from \"@mui/material\";\nimport { MutableRefObject, useEffect, useRef } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { Time } from \"@foxglove/rostime\";\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport Timestamp from \"@foxglove/studio-base/components/Timestamp\";\nimport { useAppTimeFormat } from \"@foxglove/studio-base/hooks\";\nimport { subtractTimes } from \"@foxglove/studio-base/players/UserNodePlayer/nodeTransformerWorker/typescript/userUtils/time\";\nimport { PlayerPresence } from \"@foxglove/studio-base/players/types\";\nimport { formatDuration } from \"@foxglove/studio-base/util/formatTime\";\nimport { fonts } from \"@foxglove/studio-base/util/sharedStyleConstants\";\nimport { formatTimeRaw, isAbsoluteTime } from \"@foxglove/studio-base/util/time\";\n\nimport { MultilineMiddleTruncate } from \"./MultilineMiddleTruncate\";\n\nconst useStyles = makeStyles()({\n  overline: {\n    opacity: 0.6,\n  },\n  numericValue: {\n    fontFeatureSettings: `${fonts.SANS_SERIF_FEATURE_SETTINGS}, \"zero\"`,\n  },\n});\n\nconst selectStartTime = (ctx: MessagePipelineContext) => ctx.playerState.activeData?.startTime;\nconst selectEndTime = (ctx: MessagePipelineContext) => ctx.playerState.activeData?.endTime;\nconst selectPlayerName = (ctx: MessagePipelineContext) => ctx.playerState.name;\nconst selectPlayerPresence = ({ playerState }: MessagePipelineContext) => playerState.presence;\nconst selectSeek = (ctx: MessagePipelineContext) => ctx.seekPlayback;\n\nfunction DataSourceInfoContent(props: {\n  disableSource?: boolean;\n  durationRef: MutableRefObject<ReactNull | HTMLDivElement>;\n  endTimeRef: MutableRefObject<ReactNull | HTMLDivElement>;\n  playerName?: string;\n  playerPresence: PlayerPresence;\n  startTime?: Time;\n  isLiveConnection: boolean;\n}): JSX.Element {\n  const {\n    disableSource = false,\n    durationRef,\n    endTimeRef,\n    playerName,\n    playerPresence,\n    startTime,\n  } = props;\n  const { classes } = useStyles();\n  const { t } = useTranslation(\"dataSourceInfo\");\n\n  const isLiveConnection = props.isLiveConnection;\n\n  return (\n    <Stack gap={1.5}>\n      {!disableSource && (\n        <Stack>\n          <Typography className={classes.overline} display=\"block\" variant=\"overline\">\n            {t(\"currentSource\")}\n          </Typography>\n          {playerPresence === PlayerPresence.INITIALIZING ? (\n            <Typography variant=\"inherit\">\n              <Skeleton animation=\"wave\" width=\"40%\" />\n            </Typography>\n          ) : playerPresence === PlayerPresence.RECONNECTING ? (\n            <Typography variant=\"inherit\">{t(\"waitingForConnection\")}</Typography>\n          ) : playerName ? (\n            <Typography variant=\"inherit\" component=\"span\">\n              <MultilineMiddleTruncate text={playerName} />\n            </Typography>\n          ) : (\n            <Typography className={classes.numericValue} variant=\"inherit\">\n              &mdash;\n            </Typography>\n          )}\n        </Stack>\n      )}\n\n      <Stack>\n        <Typography className={classes.overline} variant=\"overline\">\n          {t(\"startTime\")}\n        </Typography>\n        {playerPresence === PlayerPresence.INITIALIZING ? (\n          <Skeleton animation=\"wave\" width=\"50%\" />\n        ) : startTime ? (\n          <Timestamp horizontal time={startTime} />\n        ) : (\n          <Typography className={classes.numericValue} variant=\"inherit\">\n            &mdash;\n          </Typography>\n        )}\n      </Stack>\n\n      {!isLiveConnection && (\n        <Stack>\n          <Typography className={classes.overline} variant=\"overline\">\n            {t(\"endTime\")}\n          </Typography>\n          {playerPresence === PlayerPresence.INITIALIZING ? (\n            <Skeleton animation=\"wave\" width=\"50%\" />\n          ) : (\n            <Typography className={classes.numericValue} variant=\"inherit\" ref={endTimeRef}>\n              &mdash;\n            </Typography>\n          )}\n        </Stack>\n      )}\n\n      <Stack>\n        <Typography className={classes.overline} variant=\"overline\">\n          {t(\"duration\")}\n        </Typography>\n        {playerPresence === PlayerPresence.INITIALIZING ? (\n          <Skeleton animation=\"wave\" width={100} />\n        ) : (\n          <Typography className={classes.numericValue} variant=\"inherit\" ref={durationRef}>\n            &mdash;\n          </Typography>\n        )}\n      </Stack>\n    </Stack>\n  );\n}\n\nconst MemoDataSourceInfoContent = React.memo(DataSourceInfoContent);\n\nconst EmDash = \"\\u2014\";\n\nexport function DataSourceInfoView({ disableSource }: { disableSource?: boolean }): JSX.Element {\n  const startTime = useMessagePipeline(selectStartTime);\n  const endTime = useMessagePipeline(selectEndTime);\n  const playerName = useMessagePipeline(selectPlayerName);\n  const playerPresence = useMessagePipeline(selectPlayerPresence);\n  const seek = useMessagePipeline(selectSeek);\n\n  const durationRef = useRef<HTMLDivElement>(ReactNull);\n  const endTimeRef = useRef<HTMLDivElement>(ReactNull);\n  const { formatDate, formatTime } = useAppTimeFormat();\n\n  // We bypass react and update the DOM elements directly for better performance here.\n  useEffect(() => {\n    if (durationRef.current) {\n      const duration = endTime && startTime ? subtractTimes(endTime, startTime) : undefined;\n      if (duration) {\n        const durationStr = formatDuration(duration);\n        durationRef.current.innerText = durationStr;\n      } else {\n        durationRef.current.innerText = EmDash;\n      }\n    }\n    if (endTimeRef.current) {\n      if (endTime) {\n        const date = formatDate(endTime);\n        endTimeRef.current.innerText = !isAbsoluteTime(endTime)\n          ? `${formatTimeRaw(endTime)}`\n          : `${date} ${formatTime(endTime)}`;\n      } else {\n        endTimeRef.current.innerHTML = EmDash;\n      }\n    }\n  }, [endTime, formatTime, startTime, playerPresence, formatDate]);\n\n  return (\n    <MemoDataSourceInfoContent\n      disableSource={disableSource}\n      durationRef={durationRef}\n      endTimeRef={endTimeRef}\n      playerName={playerName}\n      playerPresence={playerPresence}\n      startTime={startTime}\n      isLiveConnection={seek == undefined}\n    />\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { SvgIcon, SvgIconProps } from \"@mui/material\";\n\nexport default function EventIcon(props: SvgIconProps): JSX.Element {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M18.03,3.03H6.03c-.55,0-1,.45-1,1v3h0v9.42c0,.36,.18,.69,.5,.87l6.5,3.71,6.5-3.71c.31-.18,.5-.51,.5-.87V4.03c0-.55-.45-1-1-1Z\" />\n    </SvgIcon>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { SvgIcon, SvgIconProps } from \"@mui/material\";\n\nexport default function EventOutlinedIcon(props: SvgIconProps): JSX.Element {\n  return (\n    <SvgIcon {...props}>\n      <path d=\"M17.03,5.03V15.87l-5,2.85-5-2.85V5.03h10m1-2H6.03c-.55,0-1,.45-1,1v12.42c0,.36,.18,.69,.5,.87l6.5,3.71,6.5-3.71c.31-.18,.5-.51,.5-.87V4.03c0-.55-.45-1-1-1h0Z\" />\n    </SvgIcon>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport ArrowDropDownIcon from \"@mui/icons-material/ArrowDropDown\";\nimport CheckIcon from \"@mui/icons-material/Check\";\nimport { Button, ListItemIcon, ListItemText, Menu, MenuItem } from \"@mui/material\";\nimport { useCallback, useEffect, useState } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { useMessagePipeline } from \"@foxglove/studio-base/components/MessagePipeline\";\nimport {\n  LayoutState,\n  useCurrentLayoutActions,\n  useCurrentLayoutSelector,\n} from \"@foxglove/studio-base/context/CurrentLayoutContext\";\n\nconst SPEED_OPTIONS = [0.01, 0.02, 0.05, 0.1, 0.2, 0.5, 0.8, 1, 2, 3, 5];\n\nconst formatSpeed = (val: number) => `${val < 0.1 ? val.toFixed(2) : val}×`;\n\nconst configSpeedSelector = (state: LayoutState) =>\n  state.selectedLayout?.data?.playbackConfig.speed;\n\nconst useStyles = makeStyles()((theme) => ({\n  button: {\n    padding: theme.spacing(0.625, 0.5),\n    backgroundColor: \"transparent\",\n\n    \":hover\": {\n      backgroundColor: theme.palette.action.hover,\n    },\n  },\n}));\n\nexport default function PlaybackSpeedControls(): JSX.Element {\n  const { classes } = useStyles();\n  const [anchorEl, setAnchorEl] = useState<undefined | HTMLElement>(undefined);\n  const open = Boolean(anchorEl);\n  const configSpeed = useCurrentLayoutSelector(configSpeedSelector);\n  const speed = useMessagePipeline(\n    useCallback(({ playerState }) => playerState.activeData?.speed, []),\n  );\n  const setPlaybackSpeed = useMessagePipeline(useCallback((state) => state.setPlaybackSpeed, []));\n  const { setPlaybackConfig } = useCurrentLayoutActions();\n  const setSpeed = useCallback(\n    (newSpeed: number) => {\n      setPlaybackConfig({ speed: newSpeed });\n      setPlaybackSpeed?.(newSpeed);\n    },\n    [setPlaybackConfig, setPlaybackSpeed],\n  );\n\n  const handleClick = (event: React.MouseEvent<HTMLButtonElement>) => {\n    setAnchorEl(event.currentTarget);\n  };\n\n  const handleClose = () => {\n    setAnchorEl(undefined);\n  };\n\n  // Set the speed to the speed that we got from the config whenever we get a new Player.\n  useEffect(() => {\n    if (configSpeed != undefined) {\n      setPlaybackSpeed?.(configSpeed);\n    }\n  }, [configSpeed, setPlaybackSpeed]);\n\n  const displayedSpeed = speed ?? configSpeed;\n\n  return (\n    <>\n      <Button\n        className={classes.button}\n        id=\"playback-speed-button\"\n        aria-controls={open ? \"playback-speed-menu\" : undefined}\n        aria-haspopup=\"true\"\n        aria-expanded={open ? \"true\" : undefined}\n        onClick={handleClick}\n        data-testid=\"PlaybackSpeedControls-Dropdown\"\n        disabled={setPlaybackSpeed == undefined}\n        disableRipple\n        variant=\"contained\"\n        color=\"inherit\"\n        endIcon={<ArrowDropDownIcon />}\n      >\n        {displayedSpeed == undefined ? \"–\" : formatSpeed(displayedSpeed)}\n      </Button>\n      <Menu\n        id=\"playback-speed-menu\"\n        anchorEl={anchorEl}\n        open={open}\n        onClose={handleClose}\n        MenuListProps={{\n          \"aria-labelledby\": \"playback-speed-button\",\n          dense: true,\n        }}\n        anchorOrigin={{\n          vertical: \"top\",\n          horizontal: \"left\",\n        }}\n        transformOrigin={{\n          vertical: \"bottom\",\n          horizontal: \"left\",\n        }}\n      >\n        {SPEED_OPTIONS.map((option) => (\n          <MenuItem\n            selected={displayedSpeed === option}\n            key={option}\n            onClick={() => {\n              setSpeed(option);\n              handleClose();\n            }}\n          >\n            {displayedSpeed === option && (\n              <ListItemIcon>\n                <CheckIcon fontSize=\"small\" />\n              </ListItemIcon>\n            )}\n            <ListItemText\n              inset={displayedSpeed !== option}\n              primary={formatSpeed(option)}\n              primaryTypographyProps={{ variant: \"inherit\" }}\n            />\n          </MenuItem>\n        ))}\n      </Menu>\n    </>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport ArrowDropDownIcon from \"@mui/icons-material/ArrowDropDown\";\nimport CheckIcon from \"@mui/icons-material/Check\";\nimport WarningIcon from \"@mui/icons-material/Warning\";\nimport {\n  TextField,\n  IconButton,\n  Menu,\n  MenuItem,\n  ListItemIcon,\n  ListItemText,\n  filledInputClasses,\n  iconButtonClasses,\n  inputBaseClasses,\n} from \"@mui/material\";\nimport { useState, useCallback, useMemo, useEffect, MouseEvent, useRef } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { Time, isTimeInRangeInclusive } from \"@foxglove/rostime\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { useAppTimeFormat } from \"@foxglove/studio-base/hooks\";\nimport { TimeDisplayMethod } from \"@foxglove/studio-base/types/panels\";\nimport {\n  formatDate,\n  formatTime,\n  getValidatedTimeAndMethodFromString,\n} from \"@foxglove/studio-base/util/formatTime\";\nimport { formatTimeRaw } from \"@foxglove/studio-base/util/time\";\n\ntype PlaybackTimeDisplayMethodProps = {\n  currentTime?: Time;\n  startTime?: Time;\n  endTime?: Time;\n  timezone?: string;\n  onSeek: (arg0: Time) => void;\n  onPause: () => void;\n  isPlaying: boolean;\n};\n\nconst useStyles = makeStyles()((theme) => ({\n  textField: {\n    borderRadius: theme.shape.borderRadius,\n\n    \"&.Mui-disabled\": {\n      [`.${filledInputClasses.root}`]: {\n        backgroundColor: \"transparent\",\n      },\n    },\n    \"&:not(.Mui-disabled):hover\": {\n      backgroundColor: theme.palette.action.hover,\n\n      [`.${iconButtonClasses.root}`]: {\n        visibility: \"visible\",\n      },\n    },\n    [`.${filledInputClasses.root}`]: {\n      backgroundColor: \"transparent\",\n\n      \":hover\": {\n        backgroundColor: \"transparent\",\n      },\n    },\n    [`.${inputBaseClasses.input}`]: {\n      fontFeatureSettings: `${theme.typography.fontFeatureSettings}, 'zero' !important`,\n      minWidth: \"20ch\",\n    },\n    [`.${iconButtonClasses.root}`]: {\n      borderTopLeftRadius: 0,\n      borderBottomLeftRadius: 0,\n      borderLeft: `1px solid ${theme.palette.background.paper}`,\n      visibility: \"hidden\",\n      marginRight: theme.spacing(-1),\n    },\n  },\n  textFieldError: {\n    outline: `1px solid ${theme.palette.error.main}`,\n    outlineOffset: -1,\n\n    [`.${inputBaseClasses.root}`]: {\n      color: theme.palette.error.main,\n      borderLeftColor: theme.palette.error.main,\n    },\n  },\n}));\n\nfunction PlaybackTimeMethodMenu({\n  timeFormat,\n  timeRawString,\n  timeOfDayString,\n  setTimeFormat,\n}: {\n  timeFormat: TimeDisplayMethod;\n  timeRawString?: string;\n  timeOfDayString?: string;\n  setTimeFormat: (format: TimeDisplayMethod) => Promise<void>;\n}): JSX.Element {\n  const [anchorEl, setAnchorEl] = useState<undefined | HTMLElement>(undefined);\n  const open = Boolean(anchorEl);\n\n  const handleClick = (event: MouseEvent<HTMLButtonElement>) => {\n    setAnchorEl(event.currentTarget);\n  };\n\n  const handleClose = () => {\n    setAnchorEl(undefined);\n  };\n\n  return (\n    <>\n      <IconButton\n        id=\"playback-time-display-toggle-button\"\n        aria-controls={open ? \"playback-time-display-toggle-menu\" : undefined}\n        aria-haspopup=\"true\"\n        aria-expanded={open ? \"true\" : undefined}\n        onClick={handleClick}\n      >\n        <ArrowDropDownIcon />\n      </IconButton>\n      <Menu\n        id=\"playback-time-display-toggle-menu\"\n        anchorEl={anchorEl}\n        open={open}\n        onClose={handleClose}\n        MenuListProps={{\n          dense: true,\n          \"aria-labelledby\": \"playback-time-display-toggle-button\",\n        }}\n        anchorOrigin={{\n          vertical: \"top\",\n          horizontal: \"right\",\n        }}\n        transformOrigin={{\n          vertical: \"bottom\",\n          horizontal: \"right\",\n        }}\n      >\n        {[\n          { key: \"TOD\", label: timeOfDayString ?? \"Time of Day\" },\n          { key: \"SEC\", label: timeRawString ?? \"Seconds\" },\n        ].map((option) => (\n          <MenuItem\n            key={option.key}\n            selected={timeFormat === option.key}\n            onClick={async () => await setTimeFormat(option.key as TimeDisplayMethod)}\n          >\n            {timeFormat === option.key && (\n              <ListItemIcon>\n                <CheckIcon fontSize=\"small\" />\n              </ListItemIcon>\n            )}\n            <ListItemText\n              inset={timeFormat !== option.key}\n              primary={option.label}\n              primaryTypographyProps={{ variant: \"inherit\" }}\n            />\n          </MenuItem>\n        ))}\n      </Menu>\n    </>\n  );\n}\n\nexport default function PlaybackTimeDisplayMethod({\n  currentTime,\n  startTime,\n  endTime,\n  timezone,\n  onSeek,\n  onPause,\n  isPlaying,\n}: PlaybackTimeDisplayMethodProps): JSX.Element {\n  const { classes, cx } = useStyles();\n  const timeOutID = useRef<ReturnType<typeof setTimeout> | undefined>(undefined);\n  const timeFormat = useAppTimeFormat();\n  const timeRawString = useMemo(\n    () => (currentTime ? formatTimeRaw(currentTime) : undefined),\n    [currentTime],\n  );\n  const timeOfDayString = useMemo(\n    () => (currentTime ? formatTime(currentTime, timezone) : undefined),\n    [currentTime, timezone],\n  );\n  const currentTimeString = useMemo(\n    () => (timeFormat.timeFormat === \"SEC\" ? timeRawString : timeOfDayString),\n    [timeFormat.timeFormat, timeRawString, timeOfDayString],\n  );\n  const [isEditing, setIsEditing] = useState<boolean>(false);\n  const [inputText, setInputText] = useState<string | undefined>(currentTimeString ?? undefined);\n  const [hasError, setHasError] = useState<boolean>(false);\n\n  const onSubmit = useCallback(\n    (e: React.FormEvent) => {\n      e.preventDefault();\n\n      if (inputText == undefined || inputText.length === 0) {\n        return;\n      }\n      if (!startTime || !currentTime || !endTime) {\n        return;\n      }\n\n      const validTimeAndMethod = getValidatedTimeAndMethodFromString({\n        text: inputText,\n        date: formatDate(currentTime, timezone),\n        timezone,\n      });\n\n      if (validTimeAndMethod == undefined) {\n        setHasError(true);\n        return;\n      }\n\n      // If input is valid, clear error state, exit edit mode, and seek to input timestamp\n      setHasError(false);\n\n      if (\n        validTimeAndMethod.time &&\n        isTimeInRangeInclusive(validTimeAndMethod.time, startTime, endTime)\n      ) {\n        onSeek(validTimeAndMethod.time);\n        if (validTimeAndMethod.method !== timeFormat.timeFormat) {\n          void timeFormat.setTimeFormat(validTimeAndMethod.method);\n        }\n      }\n    },\n    [inputText, startTime, currentTime, endTime, timezone, onSeek, timeFormat],\n  );\n\n  useEffect(() => {\n    // If user submits an empty input field or resumes playback, clear error state and show current timestamp\n    if (hasError && (inputText == undefined || inputText.length === 0 || isPlaying)) {\n      setIsEditing(false);\n      setHasError(false);\n    }\n\n    return () => {\n      if (timeOutID.current != undefined) {\n        clearTimeout(timeOutID.current);\n      }\n    };\n  }, [hasError, inputText, isPlaying]);\n\n  return (\n    <Stack direction=\"row\" alignItems=\"center\" flexGrow={0} gap={0.5}>\n      {currentTime ? (\n        <form onSubmit={onSubmit} style={{ width: \"100%\" }}>\n          <TextField\n            className={cx(classes.textField, { [classes.textFieldError]: hasError })}\n            aria-label=\"Playback Time Method\"\n            data-testid=\"PlaybackTime-text\"\n            value={isEditing ? inputText : currentTimeString}\n            error={hasError}\n            variant=\"filled\"\n            size=\"small\"\n            InputProps={{\n              startAdornment: hasError ? <WarningIcon color=\"error\" /> : undefined,\n              endAdornment: (\n                <PlaybackTimeMethodMenu\n                  {...{\n                    currentTime,\n                    timezone,\n                    timeOfDayString,\n                    timeRawString,\n                    timeFormat: timeFormat.timeFormat,\n                    setTimeFormat: timeFormat.setTimeFormat,\n                  }}\n                />\n              ),\n            }}\n            onFocus={(e) => {\n              onPause();\n              setHasError(false);\n              setIsEditing(true);\n              setInputText(currentTimeString);\n              e.target.select();\n            }}\n            onBlur={(e) => {\n              onSubmit(e);\n              setIsEditing(false);\n              timeOutID.current = setTimeout(() => setHasError(false), 600);\n            }}\n            onChange={(event) => setInputText(event.target.value)}\n          />\n        </form>\n      ) : (\n        <TextField\n          className={cx(classes.textField, \"Mui-disabled\")}\n          disabled\n          variant=\"filled\"\n          size=\"small\"\n          defaultValue={timeFormat.timeFormat === \"SEC\" ? \"0000000000.000000000\" : \"00:00:00.000\"}\n          InputProps={{\n            endAdornment: (\n              <IconButton edge=\"end\" disabled>\n                <ArrowDropDownIcon />\n              </IconButton>\n            ),\n          }}\n        />\n      )}\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { Time } from \"@foxglove/rostime\";\nimport { AppSetting } from \"@foxglove/studio-base/AppSetting\";\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport { useAppConfigurationValue } from \"@foxglove/studio-base/hooks/useAppConfigurationValue\";\n\nimport PlaybackTimeDisplayMethod from \"./PlaybackTimeDisplayMethod\";\n\ntype Props = {\n  onSeek: (seekTo: Time) => void;\n  onPause: () => void;\n};\n\nconst selectActiveData = (ctx: MessagePipelineContext) => ctx.playerState.activeData;\n\nexport default function PlaybackTimeDisplay(props: Props): JSX.Element {\n  const [timezone] = useAppConfigurationValue<string>(AppSetting.TIMEZONE);\n  const activeData = useMessagePipeline(selectActiveData);\n\n  const { isPlaying, startTime, endTime, currentTime } = activeData ?? {};\n\n  return (\n    <PlaybackTimeDisplayMethod\n      currentTime={currentTime}\n      startTime={startTime}\n      endTime={endTime}\n      onSeek={props.onSeek}\n      onPause={props.onPause}\n      isPlaying={isPlaying ?? false}\n      timezone={timezone}\n    />\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useLayoutEffect } from \"react\";\n\nimport { compare, Time } from \"@foxglove/rostime\";\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\n\ntype RepeatAdapterProps = {\n  repeatEnabled: boolean;\n  play: () => void;\n  seek: (to: Time) => void;\n};\n\nfunction activeDataSelector(ctx: MessagePipelineContext) {\n  return ctx.playerState.activeData;\n}\n\n/**\n * RepeatAdapter handled looping from the start of playback when playback reaches the end\n *\n * NOTE: Because repeat adapter receives every message pipeline frame, we isolate its logic inside\n * a separate component so it does not cause virtual DOM diffing on any children.\n */\nexport function RepeatAdapter(props: RepeatAdapterProps): JSX.Element {\n  const { play, seek, repeatEnabled } = props;\n\n  const activeData = useMessagePipeline(activeDataSelector);\n\n  useLayoutEffect(() => {\n    if (!repeatEnabled) {\n      return;\n    }\n\n    const currentTime = activeData?.currentTime;\n    const endTime = activeData?.endTime;\n    const startTime = activeData?.startTime;\n\n    // repeat logic could also live in messagePipeline but since it is only triggered\n    // from playback controls we've implemented it here for now - if there is demand\n    // to toggle repeat from elsewhere this logic can move\n    if (startTime && currentTime && endTime && compare(currentTime, endTime) >= 0) {\n      seek(startTime);\n      // if the user turns on repeat and we are at the end, we assume they want to play from start\n      // even if paused\n      play();\n    }\n  }, [activeData, play, repeatEnabled, seek]);\n\n  return <></>;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { alpha } from \"@mui/material\";\nimport { clamp } from \"lodash\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport {\n  EventsStore,\n  TimelinePositionedEvent,\n  useEvents,\n} from \"@foxglove/studio-base/context/EventsContext\";\nimport {\n  TimelineInteractionStateStore,\n  useTimelineInteractionState,\n} from \"@foxglove/studio-base/context/TimelineInteractionStateContext\";\n\nconst useStyles = makeStyles()(({ transitions, palette }) => ({\n  root: {\n    inset: 0,\n    pointerEvents: \"none\",\n    position: \"absolute\",\n    display: \"flex\",\n    alignItems: \"center\",\n  },\n  tick: {\n    transition: transitions.create(\"height\", { duration: transitions.duration.shortest }),\n    backgroundBlendMode: \"overlay\",\n    backgroundColor: alpha(palette.info.main, 0.58),\n    position: \"absolute\",\n    height: 6,\n  },\n  tickHovered: {\n    transition: transitions.create(\"height\", { duration: transitions.duration.shortest }),\n    backgroundColor: alpha(palette.info.main, 0.58),\n    border: `1px solid ${palette.info.main}`,\n    height: 12,\n  },\n  tickSelected: {\n    transition: transitions.create(\"height\", {\n      duration: transitions.duration.shortest,\n    }),\n    backgroundColor: alpha(palette.info.main, 0.67),\n    height: 12,\n  },\n}));\n\nconst selectEvents = (store: EventsStore) => store.events;\nconst selectHoveredEvent = (store: TimelineInteractionStateStore) => store.hoveredEvent;\nconst selectEventsAtHoverValue = (store: TimelineInteractionStateStore) => store.eventsAtHoverValue;\nconst selectSelectedEventId = (store: EventsStore) => store.selectedEventId;\n\nfunction EventTick({ event }: { event: TimelinePositionedEvent }): JSX.Element {\n  const eventsAtHoverValue = useTimelineInteractionState(selectEventsAtHoverValue);\n  const hoveredEvent = useTimelineInteractionState(selectHoveredEvent);\n  const selectedEventId = useEvents(selectSelectedEventId);\n  const { classes, cx } = useStyles();\n\n  const left = `calc(${clamp(event.startPosition, 0, 1) * 100}% - 1px)`;\n  const right = `calc(100% - ${clamp(event.endPosition, 0, 1) * 100}% - 1px)`;\n\n  return (\n    <div\n      className={cx(classes.tick, {\n        [classes.tickHovered]: hoveredEvent\n          ? event.event.id === hoveredEvent.event.id\n          : eventsAtHoverValue[event.event.id] != undefined,\n        [classes.tickSelected]: selectedEventId === event.event.id,\n      })}\n      style={{ left, right }}\n    />\n  );\n}\n\nconst MemoEventTick = React.memo(EventTick);\n\nexport function EventsOverlay(): JSX.Element {\n  const events = useEvents(selectEvents);\n  const { classes } = useStyles();\n\n  return (\n    <div className={classes.root}>\n      {(events.value ?? []).map((event) => (\n        <MemoEventTick key={event.event.id} event={event} />\n      ))}\n    </div>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Tooltip, Typography } from \"@mui/material\";\nimport { useMemo } from \"react\";\nimport { useResizeDetector } from \"react-resize-detector\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { add, fromSec, toSec } from \"@foxglove/rostime\";\nimport { RpcScales } from \"@foxglove/studio-base/components/Chart/types\";\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport HoverBar from \"@foxglove/studio-base/components/TimeBasedChart/HoverBar\";\nimport { useHoverValue } from \"@foxglove/studio-base/context/TimelineInteractionStateContext\";\nimport { useAppTimeFormat } from \"@foxglove/studio-base/hooks\";\nimport { fonts } from \"@foxglove/studio-base/util/sharedStyleConstants\";\n\nconst useStyles = makeStyles()((theme) => ({\n  tick: {\n    position: \"absolute\",\n    height: 16,\n    borderRadius: 1,\n    width: 2,\n    top: 8,\n    transform: \"translate(-50%, 0)\",\n    backgroundColor: theme.palette.warning.main,\n  },\n  tooltip: {\n    '&[data-popper-placement*=\"top\"] .MuiTooltip-tooltip': {\n      marginBottom: `${theme.spacing(1)} !important`,\n    },\n  },\n}));\n\nfunction getStartTime(ctx: MessagePipelineContext) {\n  return ctx.playerState.activeData?.startTime;\n}\n\nfunction getEndTime(ctx: MessagePipelineContext) {\n  return ctx.playerState.activeData?.endTime;\n}\n\ntype Props = {\n  componentId: string;\n};\n\nexport default function PlaybackBarHoverTicks(props: Props): JSX.Element {\n  const { componentId } = props;\n  const { classes } = useStyles();\n\n  const startTime = useMessagePipeline(getStartTime);\n  const endTime = useMessagePipeline(getEndTime);\n  const hoverValue = useHoverValue({ componentId, isTimestampScale: true });\n  const { formatTime } = useAppTimeFormat();\n\n  // Use a debounce and 0 refresh rate to avoid triggering a resize observation while handling\n  // an existing resize observation.\n  // https://github.com/maslianok/react-resize-detector/issues/45\n  const { width, ref } = useResizeDetector({\n    handleHeight: false,\n    refreshMode: \"debounce\",\n    refreshRate: 0,\n  });\n\n  const hoverTimeDisplay = useMemo(() => {\n    if (\n      !hoverValue ||\n      hoverValue.type !== \"PLAYBACK_SECONDS\" ||\n      !startTime ||\n      hoverValue.value < 0\n    ) {\n      return undefined;\n    }\n    const stamp = add(startTime, fromSec(hoverValue.value));\n    return formatTime(stamp);\n  }, [formatTime, hoverValue, startTime]);\n\n  const scaleBounds = useMemo<RpcScales | undefined>(() => {\n    if (startTime == undefined || endTime == undefined) {\n      return;\n    }\n\n    return {\n      x: {\n        min: 0,\n        max: toSec(endTime) - toSec(startTime),\n        pixelMin: 0,\n        pixelMax: width ?? 0,\n      },\n    };\n  }, [width, startTime, endTime]);\n\n  // Hover time is only displayed when the hover value originates from other components\n  const displayHoverTime = hoverValue != undefined && hoverValue.componentId !== componentId;\n\n  return (\n    <Stack ref={ref} flex=\"auto\">\n      {scaleBounds && (\n        <HoverBar componentId={componentId} scales={scaleBounds} isTimestampScale>\n          <Tooltip\n            arrow\n            classes={{ popper: classes.tooltip }}\n            placement=\"top\"\n            disableFocusListener\n            disableHoverListener\n            disableTouchListener\n            disableInteractive\n            TransitionProps={{ timeout: 0 }}\n            open={displayHoverTime}\n            title={\n              <Typography align=\"center\" variant=\"caption\" fontFamily={fonts.MONOSPACE} noWrap>\n                {hoverTimeDisplay}\n              </Typography>\n            }\n          >\n            <div className={classes.tick} />\n          </Tooltip>\n        </HoverBar>\n      )}\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Divider, Typography } from \"@mui/material\";\nimport { isEmpty } from \"lodash\";\nimport { Fragment } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { subtract as subtractTimes, toSec, Time } from \"@foxglove/rostime\";\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport {\n  TimelineInteractionStateStore,\n  useTimelineInteractionState,\n} from \"@foxglove/studio-base/context/TimelineInteractionStateContext\";\nimport { useAppTimeFormat } from \"@foxglove/studio-base/hooks\";\nimport { fonts } from \"@foxglove/studio-base/util/sharedStyleConstants\";\n\nexport type PlaybackControlsTooltipItem =\n  | { type: \"divider\" }\n  | { type: \"item\"; title: string; value: string };\n\nconst useStyles = makeStyles()((theme) => ({\n  tooltipDivider: {\n    gridColumn: \"span 2\",\n    marginBlock: theme.spacing(0.5),\n    opacity: 0.5,\n  },\n  tooltipWrapper: {\n    fontFeatureSettings: `${theme.typography.fontFeatureSettings}, \"zero\"`,\n    fontFamily: fonts.SANS_SERIF,\n    whiteSpace: \"nowrap\",\n    columnGap: theme.spacing(0.5),\n    display: \"grid\",\n    alignItems: \"center\",\n    gridTemplateColumns: \"auto auto\",\n    width: \"100%\",\n    flexDirection: \"column\",\n  },\n  itemKey: {\n    fontSize: \"0.7rem\",\n    opacity: 0.7,\n    textAlign: \"end\",\n    textTransform: \"lowercase\",\n  },\n}));\n\nconst selectHoveredEvents = (store: TimelineInteractionStateStore) => store.eventsAtHoverValue;\nconst selectStartTime = (ctx: MessagePipelineContext) => ctx.playerState.activeData?.startTime;\n\nexport function PlaybackControlsTooltipContent(params: { stamp: Time }): ReactNull | JSX.Element {\n  const { stamp } = params;\n  const { formatTime, timeFormat } = useAppTimeFormat();\n  const hoveredEvents = useTimelineInteractionState(selectHoveredEvents);\n  const startTime = useMessagePipeline(selectStartTime);\n  const { classes } = useStyles();\n\n  if (!startTime) {\n    return ReactNull;\n  }\n\n  const timeFromStart = subtractTimes(stamp, startTime);\n\n  const tooltipItems: PlaybackControlsTooltipItem[] = [];\n\n  if (!isEmpty(hoveredEvents)) {\n    Object.values(hoveredEvents).forEach(({ event }) => {\n      tooltipItems.push({\n        type: \"item\",\n        title: \"Start\",\n        value: formatTime(event.startTime),\n      });\n      tooltipItems.push({\n        type: \"item\",\n        title: \"End\",\n        value: formatTime(event.endTime),\n      });\n      if (!isEmpty(event.metadata)) {\n        Object.entries(event.metadata).forEach(([metaKey, metaValue]) => {\n          tooltipItems.push({ type: \"item\", title: metaKey, value: metaValue });\n        });\n      }\n      tooltipItems.push({ type: \"divider\" });\n    });\n  }\n\n  switch (timeFormat) {\n    case \"TOD\":\n      tooltipItems.push({ type: \"item\", title: \"Time\", value: formatTime(stamp) });\n      break;\n    case \"SEC\":\n      tooltipItems.push({ type: \"item\", title: \"SEC\", value: formatTime(stamp) });\n      break;\n  }\n\n  tooltipItems.push({\n    type: \"item\",\n    title: \"Elapsed\",\n    value: `${toSec(timeFromStart).toFixed(9)} sec`,\n  });\n\n  return (\n    <div className={classes.tooltipWrapper}>\n      {tooltipItems.map((item, idx) => {\n        if (item.type === \"divider\") {\n          return <Divider key={`divider_${idx}`} className={classes.tooltipDivider} />;\n        }\n        return (\n          <Fragment key={`${item.title}_${idx}`}>\n            <Typography className={classes.itemKey} noWrap>\n              {item.title}\n            </Typography>\n            <Typography variant=\"subtitle2\" noWrap>\n              {item.value}\n            </Typography>\n          </Fragment>\n        );\n      })}\n    </div>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { keyframes } from \"@emotion/react\";\nimport { simplify } from \"intervals-fn\";\nimport { clamp } from \"lodash\";\nimport { useMemo } from \"react\";\nimport tinycolor from \"tinycolor2\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { filterMap } from \"@foxglove/den/collection\";\nimport { Immutable } from \"@foxglove/studio\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { Range } from \"@foxglove/studio-base/util/ranges\";\n\ntype ProgressProps = Immutable<{\n  loading: boolean;\n  availableRanges?: Range[];\n}>;\n\nconst STRIPE_WIDTH = 8;\n\nconst animatedBackground = keyframes`\n  0% { background-position: 0 0; }\n  100% { background-position: ${STRIPE_WIDTH * 2}px 0; }\n`;\n\nconst useStyles = makeStyles()((theme) => ({\n  loadingIndicator: {\n    label: \"ProgressPlot-loadingIndicator\",\n    position: \"absolute\",\n    width: \"100%\",\n    height: \"100%\",\n    animation: `${animatedBackground} 300ms linear infinite`,\n    backgroundRepeat: \"repeat-x\",\n    backgroundSize: `${STRIPE_WIDTH * 2}px 100%`,\n    backgroundImage: `repeating-linear-gradient(${[\n      \"90deg\",\n      `${theme.palette.background.paper}`,\n      `${theme.palette.background.paper} ${STRIPE_WIDTH / 2}px`,\n      `transparent ${STRIPE_WIDTH / 2}px`,\n      `transparent ${STRIPE_WIDTH}px`,\n    ].join(\",\")})`,\n  },\n  range: {\n    label: \"ProgressPlot-range\",\n    position: \"absolute\",\n    backgroundColor:\n      theme.palette.mode === \"dark\"\n        ? tinycolor(theme.palette.text.secondary).darken(25).toHexString()\n        : tinycolor(theme.palette.text.secondary).lighten(25).toHexString(),\n    height: \"100%\",\n  },\n}));\n\nexport function ProgressPlot(props: ProgressProps): JSX.Element {\n  const { availableRanges, loading } = props;\n  const { classes } = useStyles();\n\n  const clampedRanges = useMemo(() => {\n    if (!availableRanges) {\n      return undefined;\n    }\n\n    return availableRanges.map((range) => ({\n      start: clamp(range.start, 0, 1),\n      end: clamp(range.end, 0, 1),\n    }));\n  }, [availableRanges]);\n\n  const ranges = useMemo(() => {\n    if (!clampedRanges) {\n      return <></>;\n    }\n    const mergedRanges = simplify(clampedRanges);\n\n    return filterMap(mergedRanges, (range, idx) => {\n      const width = range.end - range.start;\n      if (width === 0) {\n        return;\n      }\n\n      return (\n        <div\n          className={classes.range}\n          key={idx}\n          style={{\n            width: `${width * 100}%`,\n            left: `${range.start * 100}%`,\n          }}\n        />\n      );\n    });\n  }, [clampedRanges, classes.range]);\n\n  return (\n    <Stack position=\"relative\" fullHeight>\n      {loading && <div className={classes.loadingIndicator} />}\n      {ranges}\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\n/**\n * Interolates betweem min and max. A value of 0 returns min and a value of\n * 1 returns max.\n */\nexport function interpolateValue(value: number, min: number, max: number): number {\n  return min + (max - min) * value;\n}\n\n/**\n * Scales value from its position in the range minA, maxA to the range\n * minB, maxB. A value of minA will return minB, A value of maxA will return maxB.\n */\nexport function scaleValue(\n  value: number,\n  minA: number,\n  maxA: number,\n  minB: number,\n  maxB: number,\n): number {\n  return interpolateValue((value - minA) / (maxA - minA), minB, maxB);\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { clamp } from \"lodash\";\nimport { useCallback, useEffect, useRef, ReactNode, useState, useLayoutEffect } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { scaleValue } from \"@foxglove/den/math\";\n\nexport type HoverOverEvent = {\n  /** Hovered `fraction` value */\n  fraction: number;\n  /** Current hovered X position in client coordinates */\n  clientX: number;\n  /** Current hovered Y position in client coordinates */\n  clientY: number;\n};\n\ntype Props = {\n  fraction: number | undefined;\n  disabled?: boolean;\n  onChange: (value: number) => void;\n  onHoverOver?: (event: HoverOverEvent) => void;\n  onHoverOut?: () => void;\n  renderSlider?: (value?: number) => ReactNode;\n};\n\nconst useStyles = makeStyles()((theme) => ({\n  root: {\n    label: \"Slider-root\",\n    display: \"flex\",\n    width: \"100%\",\n    height: \"100%\",\n    position: \"relative\",\n    alignItems: \"center\",\n    cursor: \"pointer\",\n  },\n  rootDisabled: {\n    label: \"Slider-rootDisabled\",\n    cursor: \"not-allowed\",\n    opacity: theme.palette.action.disabledOpacity,\n  },\n  range: {\n    label: \"Slider-range\",\n    backgroundColor: theme.palette.action.active,\n    position: \"absolute\",\n    height: \"100%\",\n  },\n}));\n\nfunction defaultRenderSlider(value: number | undefined, className: string): ReactNode {\n  if (value == undefined || isNaN(value)) {\n    return ReactNull;\n  }\n  return <div className={className} style={{ width: `${value * 100}%` }} />;\n}\n\nexport default function Slider(props: Props): JSX.Element {\n  const {\n    fraction,\n    disabled = false,\n    renderSlider = defaultRenderSlider,\n    onHoverOver,\n    onHoverOut,\n    onChange,\n  } = props;\n  const { classes, cx } = useStyles();\n\n  const elRef = useRef<HTMLDivElement | ReactNull>(ReactNull);\n\n  const getValueAtMouse = useCallback((ev: React.MouseEvent | MouseEvent): number => {\n    if (!elRef.current) {\n      return 0;\n    }\n    const { left, right } = elRef.current.getBoundingClientRect();\n    const scaled = scaleValue(ev.clientX, left, right, 0, 1);\n    return clamp(scaled, 0, 1);\n  }, []);\n\n  const [mouseDown, setMouseDown] = useState(false);\n  const mouseDownRef = useRef(mouseDown);\n  useLayoutEffect(() => {\n    mouseDownRef.current = mouseDown;\n  }, [mouseDown]);\n\n  const [mouseInside, setMouseInside] = useState(false);\n  const mouseInsideRef = useRef(mouseInside);\n  useLayoutEffect(() => {\n    mouseInsideRef.current = mouseInside;\n  }, [mouseInside]);\n\n  const onMouseEnter = useCallback(() => {\n    setMouseInside(true);\n  }, []);\n\n  const onMouseLeave = useCallback(() => {\n    setMouseInside(false);\n    if (!mouseDownRef.current) {\n      onHoverOut?.();\n    }\n  }, [onHoverOut]);\n\n  const onPointerUp = useCallback((): void => {\n    setMouseDown(false);\n    if (!mouseInsideRef.current) {\n      onHoverOut?.();\n    }\n  }, [onHoverOut]);\n\n  const onPointerMove = useCallback(\n    (ev: React.PointerEvent | PointerEvent): void => {\n      if (mouseDownRef.current && ev.currentTarget !== window) {\n        // onPointerMove is used on the <div/> for hovering, and on the window for dragging. While\n        // dragging we only want to pay attention to the window events (otherwise we'd be handling\n        // each event twice).\n        return;\n      }\n      if (disabled) {\n        return;\n      }\n\n      const val = getValueAtMouse(ev);\n      if (elRef.current) {\n        const elRect = elRef.current.getBoundingClientRect();\n        onHoverOver?.({\n          fraction: val,\n          clientX: ev.clientX,\n          clientY: elRect.y + elRect.height / 2,\n        });\n      }\n      if (!mouseDownRef.current) {\n        return;\n      }\n      onChange(val);\n    },\n    [disabled, getValueAtMouse, onChange, onHoverOver],\n  );\n\n  const onPointerDown = useCallback(\n    (ev: React.PointerEvent<HTMLDivElement>): void => {\n      if (disabled) {\n        return;\n      }\n      if (document.activeElement instanceof HTMLElement) {\n        document.activeElement.blur();\n      }\n      ev.preventDefault();\n      onChange(getValueAtMouse(ev));\n      setMouseDown(true);\n    },\n    [disabled, getValueAtMouse, onChange],\n  );\n\n  useEffect(() => {\n    if (mouseDown) {\n      window.addEventListener(\"pointerup\", onPointerUp);\n      window.addEventListener(\"pointermove\", onPointerMove);\n      return () => {\n        window.removeEventListener(\"pointerup\", onPointerUp);\n        window.removeEventListener(\"pointermove\", onPointerMove);\n      };\n    }\n    return undefined;\n  }, [mouseDown, onPointerMove, onPointerUp]);\n\n  return (\n    <div\n      ref={elRef}\n      onPointerDown={onPointerDown}\n      onPointerMove={onPointerMove}\n      onMouseEnter={onMouseEnter}\n      onMouseLeave={onMouseLeave}\n      className={cx(classes.root, {\n        [classes.rootDisabled]: disabled,\n      })}\n    >\n      {renderSlider(fraction, classes.range)}\n    </div>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Fade, PopperProps, Tooltip } from \"@mui/material\";\nimport type { Instance } from \"@popperjs/core\";\nimport { useCallback, useEffect, useMemo, useState } from \"react\";\nimport { useLatest } from \"react-use\";\nimport { makeStyles } from \"tss-react/mui\";\nimport { v4 as uuidv4 } from \"uuid\";\n\nimport {\n  subtract as subtractTimes,\n  add as addTimes,\n  toSec,\n  fromSec,\n  Time,\n} from \"@foxglove/rostime\";\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport {\n  useClearHoverValue,\n  useSetHoverValue,\n} from \"@foxglove/studio-base/context/TimelineInteractionStateContext\";\nimport { PlayerPresence } from \"@foxglove/studio-base/players/types\";\n\nimport { EventsOverlay } from \"./EventsOverlay\";\nimport PlaybackBarHoverTicks from \"./PlaybackBarHoverTicks\";\nimport { PlaybackControlsTooltipContent } from \"./PlaybackControlsTooltipContent\";\nimport { ProgressPlot } from \"./ProgressPlot\";\nimport Slider, { HoverOverEvent } from \"./Slider\";\n\nconst useStyles = makeStyles()((theme) => ({\n  marker: {\n    backgroundColor: theme.palette.text.primary,\n    position: \"absolute\",\n    height: 16,\n    borderRadius: 1,\n    width: 2,\n    transform: \"translate(-50%, 0)\",\n  },\n  track: {\n    position: \"absolute\",\n    left: 0,\n    right: 0,\n    height: 6,\n    backgroundColor: theme.palette.action.focus,\n  },\n  trackDisabled: {\n    opacity: theme.palette.action.disabledOpacity,\n  },\n}));\n\nconst selectStartTime = (ctx: MessagePipelineContext) => ctx.playerState.activeData?.startTime;\nconst selectCurrentTime = (ctx: MessagePipelineContext) => ctx.playerState.activeData?.currentTime;\nconst selectEndTime = (ctx: MessagePipelineContext) => ctx.playerState.activeData?.endTime;\nconst selectRanges = (ctx: MessagePipelineContext) =>\n  ctx.playerState.progress.fullyLoadedFractionRanges;\nconst selectPresence = (ctx: MessagePipelineContext) => ctx.playerState.presence;\n\ntype Props = {\n  onSeek: (seekTo: Time) => void;\n};\n\nexport default function Scrubber(props: Props): JSX.Element {\n  const { onSeek } = props;\n  const { classes, cx } = useStyles();\n\n  const [hoverComponentId] = useState<string>(() => uuidv4());\n\n  const startTime = useMessagePipeline(selectStartTime);\n  const currentTime = useMessagePipeline(selectCurrentTime);\n  const endTime = useMessagePipeline(selectEndTime);\n  const presence = useMessagePipeline(selectPresence);\n  const ranges = useMessagePipeline(selectRanges);\n\n  const setHoverValue = useSetHoverValue();\n\n  type HoverInfo = {\n    stamp: Time;\n    clientX: number;\n    clientY: number;\n  };\n  const [hoverInfo, setHoverInfo] = useState<HoverInfo | undefined>();\n  const latestHoverInfo = useLatest(hoverInfo);\n\n  const latestStartTime = useLatest(startTime);\n  const latestEndTime = useLatest(endTime);\n\n  const onChange = useCallback(\n    (fraction: number) => {\n      if (!latestStartTime.current || !latestEndTime.current) {\n        return;\n      }\n      onSeek(\n        addTimes(\n          latestStartTime.current,\n          fromSec(fraction * toSec(subtractTimes(latestEndTime.current, latestStartTime.current))),\n        ),\n      );\n    },\n    [onSeek, latestEndTime, latestStartTime],\n  );\n\n  const onHoverOver = useCallback(\n    ({ fraction, clientX, clientY }: HoverOverEvent) => {\n      if (!latestStartTime.current || !latestEndTime.current) {\n        return;\n      }\n      const duration = toSec(subtractTimes(latestEndTime.current, latestStartTime.current));\n      const timeFromStart = fromSec(fraction * duration);\n      setHoverInfo({ stamp: addTimes(latestStartTime.current, timeFromStart), clientX, clientY });\n      setHoverValue({\n        componentId: hoverComponentId,\n        type: \"PLAYBACK_SECONDS\",\n        value: toSec(timeFromStart),\n      });\n    },\n    [hoverComponentId, latestEndTime, latestStartTime, setHoverValue],\n  );\n\n  const clearHoverValue = useClearHoverValue();\n\n  const onHoverOut = useCallback(() => {\n    clearHoverValue(hoverComponentId);\n    setHoverInfo(undefined);\n  }, [clearHoverValue, hoverComponentId]);\n\n  // Clean up the hover value when we are unmounted -- important for storybook.\n  useEffect(() => onHoverOut, [onHoverOut]);\n\n  const renderSlider = useCallback(\n    (val?: number) => {\n      if (val == undefined) {\n        return undefined;\n      }\n      return <div className={classes.marker} style={{ left: `${val * 100}%` }} />;\n    },\n    [classes.marker],\n  );\n\n  const min = startTime && toSec(startTime);\n  const max = endTime && toSec(endTime);\n  const fraction =\n    currentTime && startTime && endTime\n      ? toSec(subtractTimes(currentTime, startTime)) / toSec(subtractTimes(endTime, startTime))\n      : undefined;\n\n  const loading = presence === PlayerPresence.INITIALIZING || presence === PlayerPresence.BUFFERING;\n\n  const popperRef = React.useRef<Instance>(ReactNull);\n\n  const isHovered = hoverInfo != undefined;\n  const popperProps: Partial<PopperProps> = useMemo(\n    () => ({\n      open: isHovered, // Keep the tooltip visible while dragging even when the mouse is outside the playback bar\n      popperRef,\n      modifiers: [\n        {\n          name: \"computeStyles\",\n          options: {\n            gpuAcceleration: false, // Fixes hairline seam on arrow in chrome.\n          },\n        },\n        {\n          name: \"offset\",\n          options: {\n            // Offset popper to hug the track better.\n            offset: [0, 4],\n          },\n        },\n      ],\n      anchorEl: {\n        getBoundingClientRect: () => {\n          return new DOMRect(\n            latestHoverInfo.current?.clientX ?? 0,\n            latestHoverInfo.current?.clientY ?? 0,\n            0,\n            0,\n          );\n        },\n      },\n    }),\n    [isHovered, latestHoverInfo],\n  );\n\n  useEffect(() => {\n    if (popperRef.current != undefined) {\n      void popperRef.current.update();\n    }\n  }, [hoverInfo]);\n\n  return (\n    <Tooltip\n      title={\n        hoverInfo != undefined ? <PlaybackControlsTooltipContent stamp={hoverInfo.stamp} /> : \"\"\n      }\n      placement=\"top\"\n      disableInteractive\n      TransitionComponent={Fade}\n      TransitionProps={{ timeout: 0 }}\n      PopperProps={popperProps}\n    >\n      <Stack\n        direction=\"row\"\n        flexGrow={1}\n        alignItems=\"center\"\n        position=\"relative\"\n        style={{ height: 32 }}\n      >\n        <div className={cx(classes.track, { [classes.trackDisabled]: !startTime })} />\n        <Stack position=\"absolute\" flex=\"auto\" fullWidth style={{ height: 6 }}>\n          <ProgressPlot loading={loading} availableRanges={ranges} />\n        </Stack>\n        <Stack fullHeight fullWidth position=\"absolute\" flex={1}>\n          <Slider\n            disabled={min == undefined || max == undefined}\n            fraction={fraction}\n            onHoverOver={onHoverOver}\n            onHoverOut={onHoverOut}\n            onChange={onChange}\n            renderSlider={renderSlider}\n          />\n        </Stack>\n        <EventsOverlay />\n        <PlaybackBarHoverTicks componentId={hoverComponentId} />\n      </Stack>\n    </Tooltip>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { Time, toMillis, fromMillis } from \"@foxglove/rostime\";\n\nconst ARROW_SEEK_BIG_MS = 500;\nconst ARROW_SEEK_DEFAULT_MS = 100;\nconst ARROW_SEEK_SMALL_MS = 10;\nexport const DIRECTION = {\n  FORWARD: 1,\n  BACKWARD: -1,\n};\n\nexport const jumpSeek = (\n  directionSign: (typeof DIRECTION)[keyof typeof DIRECTION],\n  currentTime: Time,\n  modifierKeys?: { altKey: boolean; shiftKey: boolean },\n): Time => {\n  const timeMs = toMillis(currentTime);\n  const deltaMs =\n    modifierKeys?.altKey === true\n      ? ARROW_SEEK_BIG_MS\n      : modifierKeys?.shiftKey === true\n      ? ARROW_SEEK_SMALL_MS\n      : ARROW_SEEK_DEFAULT_MS;\n  return fromMillis(timeMs + deltaMs * directionSign);\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport {\n  ArrowRepeatAll20Regular,\n  ArrowRepeatAllOff20Regular,\n  Info24Regular,\n  Next20Filled,\n  Next20Regular,\n  Pause20Filled,\n  Pause20Regular,\n  Play20Filled,\n  Play20Regular,\n  Previous20Filled,\n  Previous20Regular,\n} from \"@fluentui/react-icons\";\nimport { Tooltip } from \"@mui/material\";\nimport { useCallback, useMemo, useState } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { Time, compare } from \"@foxglove/rostime\";\nimport { CreateEventDialog } from \"@foxglove/studio-base/components/CreateEventDialog\";\nimport { DataSourceInfoView } from \"@foxglove/studio-base/components/DataSourceInfoView\";\nimport EventIcon from \"@foxglove/studio-base/components/EventIcon\";\nimport EventOutlinedIcon from \"@foxglove/studio-base/components/EventOutlinedIcon\";\nimport HoverableIconButton from \"@foxglove/studio-base/components/HoverableIconButton\";\nimport KeyListener from \"@foxglove/studio-base/components/KeyListener\";\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport PlaybackSpeedControls from \"@foxglove/studio-base/components/PlaybackSpeedControls\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { useCurrentUser } from \"@foxglove/studio-base/context/CurrentUserContext\";\nimport { EventsStore, useEvents } from \"@foxglove/studio-base/context/EventsContext\";\nimport {\n  WorkspaceContextStore,\n  useWorkspaceStore,\n} from \"@foxglove/studio-base/context/Workspace/WorkspaceContext\";\nimport { useWorkspaceActions } from \"@foxglove/studio-base/context/Workspace/useWorkspaceActions\";\nimport { Player, PlayerPresence } from \"@foxglove/studio-base/players/types\";\n\nimport PlaybackTimeDisplay from \"./PlaybackTimeDisplay\";\nimport { RepeatAdapter } from \"./RepeatAdapter\";\nimport Scrubber from \"./Scrubber\";\nimport { DIRECTION, jumpSeek } from \"./sharedHelpers\";\n\nconst useStyles = makeStyles()((theme) => ({\n  root: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    padding: theme.spacing(0.5, 1, 1, 1),\n    position: \"relative\",\n    backgroundColor: theme.palette.background.paper,\n    borderTop: `1px solid ${theme.palette.divider}`,\n    zIndex: 100000,\n  },\n  disabled: {\n    opacity: theme.palette.action.disabledOpacity,\n  },\n  popper: {\n    \"&[data-popper-placement*=top] .MuiTooltip-tooltip\": {\n      margin: theme.spacing(0.5, 0.5, 0.75),\n    },\n  },\n  dataSourceInfoButton: {\n    cursor: \"default\",\n  },\n}));\n\nconst selectPresence = (ctx: MessagePipelineContext) => ctx.playerState.presence;\nconst selectEventsSupported = (store: EventsStore) => store.eventsSupported;\nconst selectPlaybackRepeat = (store: WorkspaceContextStore) => store.playbackControls.repeat;\n\nexport default function PlaybackControls(props: {\n  play: NonNullable<Player[\"startPlayback\"]>;\n  pause: NonNullable<Player[\"pausePlayback\"]>;\n  seek: NonNullable<Player[\"seekPlayback\"]>;\n  playUntil?: Player[\"playUntil\"];\n  isPlaying: boolean;\n  getTimeInfo: () => { startTime?: Time; endTime?: Time; currentTime?: Time };\n}): JSX.Element {\n  const { play, pause, seek, isPlaying, getTimeInfo, playUntil } = props;\n  const presence = useMessagePipeline(selectPresence);\n\n  const { classes, cx } = useStyles();\n  const repeat = useWorkspaceStore(selectPlaybackRepeat);\n  const [createEventDialogOpen, setCreateEventDialogOpen] = useState(false);\n  const { currentUser } = useCurrentUser();\n  const eventsSupported = useEvents(selectEventsSupported);\n\n  const {\n    playbackControlActions: { setRepeat },\n  } = useWorkspaceActions();\n\n  const toggleRepeat = useCallback(() => {\n    setRepeat((old) => !old);\n  }, [setRepeat]);\n\n  const togglePlayPause = useCallback(() => {\n    if (isPlaying) {\n      pause();\n    } else {\n      const { startTime: start, endTime: end, currentTime: current } = getTimeInfo();\n      // if we are at the end, we need to go back to start\n      if (current && end && start && compare(current, end) >= 0) {\n        seek(start);\n      }\n      play();\n    }\n  }, [isPlaying, pause, getTimeInfo, play, seek]);\n\n  const seekForwardAction = useCallback(\n    (ev?: KeyboardEvent) => {\n      const { currentTime } = getTimeInfo();\n      if (!currentTime) {\n        return;\n      }\n\n      // If playUntil is available, we prefer to use that rather than seek, which performs a jump\n      // seek.\n      //\n      // Playing forward up to the desired seek time will play all messages to the panels which\n      // mirrors the behavior panels would expect when playing without stepping. This behavior is\n      // important for some message types which convey state information.\n      //\n      // i.e. Skipping coordinate frame messages may result in incorrectly rendered markers or\n      // missing markers altogther.\n      const targetTime = jumpSeek(DIRECTION.FORWARD, currentTime, ev);\n\n      if (playUntil) {\n        playUntil(targetTime);\n      } else {\n        seek(targetTime);\n      }\n    },\n    [getTimeInfo, playUntil, seek],\n  );\n\n  const seekBackwardAction = useCallback(\n    (ev?: KeyboardEvent) => {\n      const { currentTime } = getTimeInfo();\n      if (!currentTime) {\n        return;\n      }\n      seek(jumpSeek(DIRECTION.BACKWARD, currentTime, ev));\n    },\n    [getTimeInfo, seek],\n  );\n\n  const keyDownHandlers = useMemo(\n    () => ({\n      \" \": togglePlayPause,\n      ArrowLeft: (ev: KeyboardEvent) => {\n        seekBackwardAction(ev);\n      },\n      ArrowRight: (ev: KeyboardEvent) => {\n        seekForwardAction(ev);\n      },\n    }),\n    [seekBackwardAction, seekForwardAction, togglePlayPause],\n  );\n\n  const toggleCreateEventDialog = useCallback(() => {\n    pause();\n    setCreateEventDialogOpen((open) => !open);\n  }, [pause]);\n\n  const disableControls = presence === PlayerPresence.ERROR;\n\n  return (\n    <>\n      <RepeatAdapter play={play} seek={seek} repeatEnabled={repeat} />\n      <KeyListener global keyDownHandlers={keyDownHandlers} />\n      <div className={classes.root}>\n        <Scrubber onSeek={seek} />\n        <Stack direction=\"row\" alignItems=\"center\" flex={1} gap={1} overflowX=\"auto\">\n          <Stack direction=\"row\" flex={1} gap={0.5}>\n            {currentUser && eventsSupported && (\n              <HoverableIconButton\n                size=\"small\"\n                title=\"Create event\"\n                icon={<EventOutlinedIcon />}\n                activeIcon={<EventIcon />}\n                onClick={toggleCreateEventDialog}\n              />\n            )}\n            <Tooltip\n              classes={{ popper: classes.popper }}\n              title={\n                <Stack paddingY={0.75}>\n                  <DataSourceInfoView disableSource />\n                </Stack>\n              }\n            >\n              <HoverableIconButton\n                className={cx(classes.dataSourceInfoButton, {\n                  [classes.disabled]: disableControls,\n                })}\n                size=\"small\"\n                icon={<Info24Regular />}\n              />\n            </Tooltip>\n            <PlaybackTimeDisplay onSeek={seek} onPause={pause} />\n          </Stack>\n          <Stack direction=\"row\" alignItems=\"center\" gap={1}>\n            <HoverableIconButton\n              disabled={disableControls}\n              size=\"small\"\n              title=\"Seek backward\"\n              icon={<Previous20Regular />}\n              activeIcon={<Previous20Filled />}\n              onClick={() => seekBackwardAction()}\n            />\n            <HoverableIconButton\n              disabled={disableControls}\n              size=\"small\"\n              title={isPlaying ? \"Pause\" : \"Play\"}\n              onClick={togglePlayPause}\n              icon={isPlaying ? <Pause20Regular /> : <Play20Regular />}\n              activeIcon={isPlaying ? <Pause20Filled /> : <Play20Filled />}\n            />\n            <HoverableIconButton\n              disabled={disableControls}\n              size=\"small\"\n              title=\"Seek forward\"\n              icon={<Next20Regular />}\n              activeIcon={<Next20Filled />}\n              onClick={() => seekForwardAction()}\n            />\n          </Stack>\n          <Stack direction=\"row\" flex={1} alignItems=\"center\" justifyContent=\"flex-end\" gap={0.5}>\n            <HoverableIconButton\n              size=\"small\"\n              title=\"Loop playback\"\n              color={repeat ? \"primary\" : \"inherit\"}\n              onClick={toggleRepeat}\n              icon={repeat ? <ArrowRepeatAll20Regular /> : <ArrowRepeatAllOff20Regular />}\n            />\n            <PlaybackSpeedControls />\n          </Stack>\n        </Stack>\n        {createEventDialogOpen && eventsSupported && (\n          <CreateEventDialog onClose={toggleCreateEventDialog} />\n        )}\n      </div>\n    </>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { ErrorCircle16Regular, Info16Regular, Warning16Regular } from \"@fluentui/react-icons\";\nimport ArrowDropDownIcon from \"@mui/icons-material/ArrowDropDown\";\nimport {\n  Accordion,\n  AccordionDetails,\n  AccordionSummary,\n  Divider,\n  Typography,\n  accordionSummaryClasses,\n  useTheme,\n} from \"@mui/material\";\nimport { useMemo } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport EmptyState from \"@foxglove/studio-base/components/EmptyState\";\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { DetailsType, NotificationSeverity } from \"@foxglove/studio-base/util/sendNotification\";\nimport { fonts } from \"@foxglove/studio-base/util/sharedStyleConstants\";\n\nconst useStyles = makeStyles()((theme) => ({\n  acccordion: {\n    background: \"none\",\n    boxShadow: \"none\",\n    borderBottom: `1px solid ${theme.palette.divider}`,\n\n    \"&:before\": {\n      display: \"none\",\n    },\n    \"&.Mui-expanded\": {\n      margin: 0,\n    },\n  },\n  accordionDetails: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    fontFamily: fonts.MONOSPACE,\n    fontSize: \"0.6875rem\",\n    padding: theme.spacing(1.125),\n    gap: theme.spacing(1),\n  },\n  acccordionSummary: {\n    height: 30,\n    minHeight: \"auto\",\n    padding: theme.spacing(0, 0.5, 0, 0.75),\n    fontWeight: 500,\n\n    \"&:hover\": {\n      backgroundColor: theme.palette.action.hover,\n    },\n    \"&.Mui-expanded\": {\n      minHeight: \"auto\",\n    },\n    [`& .${accordionSummaryClasses.content}`]: {\n      gap: theme.spacing(0.5),\n      overflow: \"hidden\",\n      alignItems: \"center\",\n      margin: \"0 !important\",\n    },\n    [`& .${accordionSummaryClasses.expandIconWrapper}`]: {\n      transform: \"rotate(-90deg)\",\n    },\n    [`& .${accordionSummaryClasses.expandIconWrapper}.Mui-expanded`]: {\n      transform: \"rotate(0deg)\",\n    },\n  },\n  detailsText: {\n    color: theme.palette.text.primary,\n    fontSize: theme.typography.caption.fontSize,\n    lineHeight: 1.5,\n    whiteSpace: \"pre-wrap\",\n    maxHeight: \"30vh\",\n    overflow: \"auto\",\n    flex: 1,\n    backgroundColor: theme.palette.action.hover,\n    padding: theme.spacing(1),\n  },\n  icon: {\n    flex: \"none\",\n  },\n}));\n\nconst selectPlayerProblems = ({ playerState }: MessagePipelineContext) => playerState.problems;\n\nfunction ProblemIcon({ severity }: { severity: NotificationSeverity }): JSX.Element {\n  const { palette } = useTheme();\n  const { classes } = useStyles();\n\n  switch (severity) {\n    case \"warn\":\n      return <Warning16Regular className={classes.icon} primaryFill={palette.warning.main} />;\n    case \"error\":\n      return <ErrorCircle16Regular className={classes.icon} primaryFill={palette.error.main} />;\n    case \"info\":\n      return <Info16Regular className={classes.icon} primaryFill={palette.info.main} />;\n    default:\n      return <></>;\n  }\n}\n\nfunction ProblemDetails(props: { details: DetailsType; tip?: string }): JSX.Element {\n  const { details, tip } = props;\n  const { classes } = useStyles();\n\n  const content = useMemo(() => {\n    if (details instanceof Error) {\n      return <div className={classes.detailsText}>{details.message}</div>;\n    } else if (details != undefined && details !== \"\") {\n      return (\n        <Typography style={{ whiteSpace: \"pre-line\" /* allow newlines in the details message */ }}>\n          {details}\n        </Typography>\n      );\n    } else if (tip != undefined && tip !== \"\") {\n      return undefined;\n    }\n\n    return \"No details provided\";\n  }, [classes, details, tip]);\n\n  return (\n    <AccordionDetails className={classes.accordionDetails}>\n      {tip && <div>{tip}</div>}\n      {content}\n    </AccordionDetails>\n  );\n}\n\nexport function ProblemsList(): JSX.Element {\n  const { classes } = useStyles();\n  const playerProblems = useMessagePipeline(selectPlayerProblems);\n\n  if (playerProblems == undefined || playerProblems.length === 0) {\n    return <EmptyState>No problems found</EmptyState>;\n  }\n\n  return (\n    <Stack fullHeight flex=\"auto\" overflow=\"auto\">\n      {playerProblems.map((problem, idx) => (\n        <Accordion\n          className={classes.acccordion}\n          key={`${idx}.${problem.severity}.${problem.message}`}\n          TransitionProps={{ unmountOnExit: true }}\n          defaultExpanded\n        >\n          <AccordionSummary\n            className={classes.acccordionSummary}\n            expandIcon={<ArrowDropDownIcon />}\n          >\n            <ProblemIcon severity={problem.severity} />\n            <Typography variant=\"inherit\" noWrap>\n              {problem.message}\n            </Typography>\n          </AccordionSummary>\n          <Divider />\n          <ProblemDetails details={problem.error} tip={problem.tip} />\n        </Accordion>\n      ))}\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { PropsWithChildren, useCallback } from \"react\";\n\n/**\n * RemountOnValueChange will unmount and remount the children when _value_ changes.\n * This is used when you want to \"reset\" the component tree for a specific value change.\n *\n * Note: Use sparingly and prefer hook dependencies to manage state updates. This should be a\n * last resort nuclear option when you think that an entire subtree should be purged.\n */\nexport default function RemountOnValueChange(\n  props: PropsWithChildren<{ value: unknown }>,\n): JSX.Element {\n  // When the value changes, useCallback will create a new component by returning a new\n  // function instance. Since this is a completely new component it will remount its entire tree.\n  const Parent = useCallback(\n    ({ children }: PropsWithChildren<unknown>) => {\n      void props.value; // to suppress eslint complaining about the value in the deps list\n      return <>{children}</>;\n    },\n    [props.value],\n  );\n\n  return <Parent>{props.children}</Parent>;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport CloseIcon from \"@mui/icons-material/Close\";\nimport { Badge, BadgeProps, Divider, IconButton, Tab, Tabs } from \"@mui/material\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport Stack from \"@foxglove/studio-base/components/Stack\";\n\nconst useStyles = makeStyles()((theme) => ({\n  root: {\n    boxSizing: \"content-box\",\n    backgroundColor: theme.palette.background.paper,\n  },\n  badgeRoot: {\n    display: \"flex\",\n    alignItems: \"baseline\",\n    gap: theme.spacing(1),\n  },\n  badge: {\n    fontSize: theme.typography.caption.fontSize,\n    padding: theme.spacing(0.125, 0.75),\n    borderRadius: 8,\n    transform: \"none\",\n    position: \"relative\",\n  },\n  badgeInvisible: {\n    display: \"none\",\n  },\n  anchorRight: {\n    borderLeft: `1px solid ${theme.palette.divider}`,\n  },\n  anchorLeft: {\n    borderRight: `1px solid ${theme.palette.divider}`,\n  },\n  tabs: {\n    minHeight: \"auto\",\n    flex: \"1 1 auto\",\n    overflow: \"hidden\",\n    paddingLeft: theme.spacing(0.25),\n\n    \".MuiTabs-indicator\": {\n      transform: \"scaleX(0.5)\",\n      height: 2,\n    },\n    \".MuiTab-root\": {\n      minHeight: 30,\n      minWidth: theme.spacing(4),\n      padding: theme.spacing(0, 1),\n      color: theme.palette.text.secondary,\n      fontSize: \"0.6875rem\",\n\n      \"&.Mui-selected\": {\n        color: theme.palette.text.primary,\n      },\n    },\n  },\n  iconButton: {\n    padding: theme.spacing(0.91125), // round out the overall height to 30px\n    color: theme.palette.text.secondary,\n    borderRadius: 0,\n\n    \":hover\": {\n      color: theme.palette.text.primary,\n    },\n  },\n  tabContent: {\n    flex: \"auto\",\n    overflow: \"auto\",\n  },\n}));\n\nexport type SidebarItem = {\n  title: string;\n  component: React.ComponentType;\n  badge?: {\n    color: BadgeProps[\"color\"];\n    count: number;\n  };\n};\n\nfunction Noop(): ReactNull {\n  return ReactNull;\n}\n\nexport function Sidebar<K extends string>({\n  items,\n  anchor,\n  onClose,\n  activeTab,\n  setActiveTab,\n}: {\n  items: Map<K, SidebarItem>;\n  anchor: \"right\" | \"left\";\n  onClose: () => void;\n  activeTab: K | undefined;\n  setActiveTab: (newValue: K) => void;\n}): JSX.Element {\n  const { classes, cx } = useStyles();\n\n  const SelectedComponent = (activeTab != undefined && items.get(activeTab)?.component) || Noop;\n\n  return (\n    <Stack\n      className={cx(classes.root, {\n        [classes.anchorLeft]: anchor === \"left\",\n        [classes.anchorRight]: anchor === \"right\",\n      })}\n      flexShrink={0}\n      overflow=\"hidden\"\n      data-tourid={`sidebar-${anchor}`}\n    >\n      <Stack direction=\"row\" justifyContent=\"space-between\" alignItems=\"center\">\n        <Tabs\n          className={classes.tabs}\n          textColor=\"inherit\"\n          value={activeTab ?? false}\n          onChange={(_ev, newValue: K) => {\n            if (newValue !== activeTab) {\n              setActiveTab(newValue);\n            }\n          }}\n        >\n          {Array.from(items.entries(), ([key, item]) => (\n            <Tab\n              key={key}\n              label={\n                <Badge\n                  invisible={item.badge == undefined}\n                  badgeContent={item.badge?.count}\n                  color={item.badge?.color}\n                  classes={{\n                    root: classes.badgeRoot,\n                    badge: classes.badge,\n                    invisible: classes.badgeInvisible,\n                  }}\n                >\n                  {item.title}\n                </Badge>\n              }\n              value={key}\n              data-testid={`${key}-${anchor}`}\n            />\n          ))}\n        </Tabs>\n\n        <IconButton\n          className={classes.iconButton}\n          onClick={onClose}\n          size=\"small\"\n          data-testid={`sidebar-close-${anchor}`}\n        >\n          <CloseIcon fontSize=\"inherit\" />\n        </IconButton>\n      </Stack>\n      <Divider />\n      {activeTab != undefined && (\n        <div className={classes.tabContent}>\n          <SelectedComponent />\n        </div>\n      )}\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { PropsWithChildren, useCallback, useEffect, useState } from \"react\";\nimport { MosaicNode, MosaicWithoutDragDropContext } from \"react-mosaic-component\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport ErrorBoundary from \"@foxglove/studio-base/components/ErrorBoundary\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\n\nimport { Sidebar, SidebarItem } from \"./Sidebar\";\n\nimport \"react-mosaic-component/react-mosaic-component.css\";\n\ntype LayoutNode = \"leftbar\" | \"children\" | \"rightbar\";\n\nconst useStyles = makeStyles()({\n  mosaicWrapper: {\n    flex: \"1 1 100%\",\n\n    // Root drop targets in this top level sidebar mosaic interfere with drag/mouse events from the\n    // PanelList. We don't allow users to edit the mosaic since it's just used for the sidebar, so we\n    // can hide the drop targets.\n    \"& > .mosaic > .drop-target-container\": {\n      display: \"none !important\",\n    },\n  },\n});\n\n/**\n * Extract existing left split percentage from a layout node or return the default.\n */\nfunction mosiacLeftSidebarSplitPercentage(node: MosaicNode<LayoutNode>): number | undefined {\n  if (typeof node !== \"object\") {\n    return undefined;\n  }\n  if (node.first === \"leftbar\") {\n    return node.splitPercentage;\n  } else {\n    return (\n      mosiacLeftSidebarSplitPercentage(node.first) ?? mosiacLeftSidebarSplitPercentage(node.second)\n    );\n  }\n}\n\n/**\n * Extract existing right split percentage from a layout node or return the default.\n */\nfunction mosiacRightSidebarSplitPercentage(node: MosaicNode<LayoutNode>): number | undefined {\n  if (typeof node !== \"object\") {\n    return undefined;\n  }\n  if (node.second === \"rightbar\") {\n    return node.splitPercentage;\n  } else {\n    return (\n      mosiacRightSidebarSplitPercentage(node.first) ??\n      mosiacRightSidebarSplitPercentage(node.second)\n    );\n  }\n}\n\ntype SidebarProps<LeftKey, RightKey> = PropsWithChildren<{\n  leftItems: Map<LeftKey, SidebarItem>;\n  selectedLeftKey: LeftKey | undefined;\n  onSelectLeftKey: (key: LeftKey | undefined) => void;\n  leftSidebarSize: number | undefined;\n  setLeftSidebarSize: (size: number | undefined) => void;\n\n  rightItems: Map<RightKey, SidebarItem>;\n  selectedRightKey: RightKey | undefined;\n  onSelectRightKey: (key: RightKey | undefined) => void;\n  rightSidebarSize: number | undefined;\n  setRightSidebarSize: (size: number | undefined) => void;\n}>;\n\nexport function Sidebars<LeftKey extends string, RightKey extends string>(\n  props: SidebarProps<LeftKey, RightKey>,\n): JSX.Element {\n  const {\n    children,\n    leftItems,\n    selectedLeftKey,\n    onSelectLeftKey,\n    leftSidebarSize,\n    setLeftSidebarSize,\n    rightItems,\n    selectedRightKey,\n    onSelectRightKey,\n    rightSidebarSize,\n    setRightSidebarSize,\n  } = props;\n\n  const [mosaicValue, setMosaicValue] = useState<MosaicNode<LayoutNode>>(\"children\");\n  const { classes } = useStyles();\n\n  const leftSidebarOpen = selectedLeftKey != undefined && leftItems.has(selectedLeftKey);\n  const rightSidebarOpen = selectedRightKey != undefined && rightItems.has(selectedRightKey);\n\n  useEffect(() => {\n    const leftTargetWidth = 320;\n    const rightTargetWidth = 320;\n    const defaultLeftPercentage = 100 * (leftTargetWidth / window.innerWidth);\n    const defaultRightPercentage = 100 * (1 - rightTargetWidth / window.innerWidth);\n\n    setMosaicValue((oldValue) => {\n      let node: MosaicNode<LayoutNode> = \"children\";\n      if (rightSidebarOpen) {\n        node = {\n          direction: \"row\",\n          first: node,\n          second: \"rightbar\",\n          splitPercentage:\n            rightSidebarSize ??\n            mosiacRightSidebarSplitPercentage(oldValue) ??\n            defaultRightPercentage,\n        };\n      }\n      if (leftSidebarOpen) {\n        node = {\n          direction: \"row\",\n          first: \"leftbar\",\n          second: node,\n          splitPercentage:\n            leftSidebarSize ?? mosiacLeftSidebarSplitPercentage(oldValue) ?? defaultLeftPercentage,\n        };\n      }\n      return node;\n    });\n  }, [leftSidebarSize, rightSidebarSize, leftSidebarOpen, rightSidebarOpen]);\n\n  const onChangeMosaicValue = useCallback(\n    (newValue: ReactNull | MosaicNode<LayoutNode>) => {\n      if (newValue != undefined) {\n        setMosaicValue(newValue);\n        setLeftSidebarSize(mosiacLeftSidebarSplitPercentage(newValue));\n        setRightSidebarSize(mosiacRightSidebarSplitPercentage(newValue));\n      }\n    },\n    [setLeftSidebarSize, setRightSidebarSize],\n  );\n\n  return (\n    <Stack direction=\"row\" fullHeight overflow=\"hidden\">\n      {\n        // By always rendering the mosaic, even if we are only showing children, we can prevent the\n        // children from having to re-mount each time the sidebar is opened/closed.\n      }\n      <div className={classes.mosaicWrapper}>\n        <MosaicWithoutDragDropContext<LayoutNode>\n          className=\"\"\n          value={mosaicValue}\n          onChange={onChangeMosaicValue}\n          renderTile={(id) => {\n            switch (id) {\n              case \"children\":\n                return <ErrorBoundary>{children as JSX.Element}</ErrorBoundary>;\n              case \"leftbar\":\n                return (\n                  <ErrorBoundary>\n                    <Sidebar<LeftKey>\n                      anchor=\"left\"\n                      onClose={() => onSelectLeftKey(undefined)}\n                      items={leftItems}\n                      activeTab={selectedLeftKey}\n                      setActiveTab={onSelectLeftKey}\n                    />\n                  </ErrorBoundary>\n                );\n              case \"rightbar\":\n                return (\n                  <ErrorBoundary>\n                    <Sidebar<RightKey>\n                      anchor=\"right\"\n                      onClose={() => onSelectRightKey(undefined)}\n                      items={rightItems}\n                      activeTab={selectedRightKey}\n                      setActiveTab={onSelectRightKey}\n                    />\n                  </ErrorBoundary>\n                );\n            }\n          }}\n          resize={{ minimumPaneSizePercentage: 10 }}\n        />\n      </div>\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\ntype Props = {\n  width?: number;\n};\n\nexport default function AccountSyncGraphic(props: Props): JSX.Element {\n  const { width } = props;\n  return (\n    <svg width={width} viewBox=\"0 0 256 256\">\n      <g stroke=\"currentColor\">\n        <path\n          d=\"M122.63,54.19C103,70.22,90,97.21,90,128c0,22.77,7.08,43.54,18.73,59.3\"\n          fill=\"none\"\n          strokeLinecap=\"round\"\n          strokeWidth=\"4.5\"\n        />\n        <path\n          d=\"M133.32,201.82C153,185.8,166,158.81,166,128c0-22.35-6.82-42.78-18.09-58.43\"\n          fill=\"none\"\n          strokeLinecap=\"round\"\n          strokeWidth=\"4.5\"\n        />\n        <path\n          d=\"M181,170.16a101.44,101.44,0,0,0-53-14.45,102.52,102.52,0,0,0-47.9,11.56\"\n          fill=\"none\"\n          strokeLinecap=\"round\"\n          strokeWidth=\"4.5\"\n        />\n        <path\n          d=\"M76,87.42a101.64,101.64,0,0,0,52,13.87,102.12,102.12,0,0,0,49.85-12.63\"\n          fill=\"none\"\n          strokeLinecap=\"round\"\n          strokeWidth=\"4.5\"\n        />\n        <path d=\"M128,54V202\" fill=\"none\" strokeWidth=\"4.5\" />\n        <path\n          d=\"M192,165.16A74,74,0,0,0,93,62.78,40,40,0,0,1,62.78,93,74,74,0,0,0,164.44,192.4,40,40,0,0,1,192,165.16Z\"\n          fill=\"none\"\n          strokeWidth=\"4.5\"\n        />\n      </g>\n\n      <g fill=\"currentColor\">\n        <circle cx=\"119.46\" cy=\"30.37\" r=\"3\" />\n        <circle cx=\"102.64\" cy=\"33.34\" r=\"3\" />\n        <circle cx=\"33.34\" cy=\"102.64\" r=\"3\" />\n        <circle cx=\"30.37\" cy=\"119.46\" r=\"3\" />\n        <circle cx=\"30.37\" cy=\"136.54\" r=\"3\" />\n        <circle cx=\"33.34\" cy=\"153.36\" r=\"3\" />\n        <circle cx=\"39.18\" cy=\"169.42\" r=\"3\" />\n        <circle cx=\"47.72\" cy=\"184.21\" r=\"3\" />\n        <circle cx=\"58.7\" cy=\"197.3\" r=\"3\" />\n        <circle cx=\"71.79\" cy=\"208.28\" r=\"3\" />\n        <circle cx=\"86.58\" cy=\"216.82\" r=\"3\" />\n        <circle cx=\"102.64\" cy=\"222.66\" r=\"3\" />\n        <circle cx=\"119.46\" cy=\"225.63\" r=\"3\" />\n        <circle cx=\"136.54\" cy=\"225.63\" r=\"3\" />\n        <circle cx=\"153.36\" cy=\"222.66\" r=\"3\" />\n        <circle cx=\"222.66\" cy=\"153.36\" r=\"3\" />\n        <circle cx=\"225.63\" cy=\"136.54\" r=\"3\" />\n        <circle cx=\"225.63\" cy=\"119.46\" r=\"3\" />\n        <circle cx=\"222.66\" cy=\"102.64\" r=\"3\" />\n        <circle cx=\"216.82\" cy=\"86.58\" r=\"3\" />\n        <circle cx=\"208.28\" cy=\"71.79\" r=\"3\" />\n        <circle cx=\"197.3\" cy=\"58.7\" r=\"3\" />\n        <circle cx=\"184.21\" cy=\"47.72\" r=\"3\" />\n        <circle cx=\"169.42\" cy=\"39.18\" r=\"3\" />\n        <circle cx=\"153.36\" cy=\"33.34\" r=\"3\" />\n        <circle cx=\"136.54\" cy=\"30.37\" r=\"3\" />\n      </g>\n\n      <g stroke=\"currentColor\">\n        <path\n          d=\"M28.89,85.13l7.72-12.2a8,8,0,0,1,6.51-3.35H64.88a8,8,0,0,1,6.51,3.35l7.72,12.2\"\n          fill=\"none\"\n          strokeWidth=\"4.5\"\n        />\n        <rect x=\"40\" y=\"29.18\" width=\"28\" height=\"28\" rx=\"7\" fill=\"none\" strokeWidth=\"4.5\" />\n        <circle cx=\"54\" cy=\"54\" r=\"40\" fill=\"none\" strokeWidth=\"4.5\" />\n      </g>\n\n      <g stroke=\"currentColor\">\n        <path\n          d=\"M177.71,234.79l7.72-12.2a8,8,0,0,1,6.51-3.35H213.7a8,8,0,0,1,6.51,3.35l7.71,12.2\"\n          fill=\"none\"\n          strokeWidth=\"4.5\"\n        />\n        <rect x=\"188.82\" y=\"178.84\" width=\"28\" height=\"28\" rx=\"7\" fill=\"none\" strokeWidth=\"4.5\" />\n        <circle cx=\"202.82\" cy=\"203.66\" r=\"40\" fill=\"none\" strokeWidth=\"4.5\" />\n      </g>\n    </svg>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Button, Typography } from \"@mui/material\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { useCurrentUser } from \"@foxglove/studio-base/context/CurrentUserContext\";\n\nimport AccountSyncGraphic from \"./AccountSyncGraphic\";\n\nconst useStyles = makeStyles()((theme) => ({\n  root: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    gap: theme.spacing(2.5),\n  },\n  icon: {\n    display: \"flex\",\n    justifyContent: \"center\",\n    color: theme.palette.primary.main,\n  },\n}));\n\nexport default function SigninForm(): JSX.Element {\n  const { classes } = useStyles();\n  const { signIn } = useCurrentUser();\n\n  return (\n    <div className={classes.root}>\n      <div className={classes.icon}>\n        <AccountSyncGraphic width={192} />\n      </div>\n      <Typography variant=\"body1\">\n        <>\n          Create a Foxglove account to:\n          <ul>\n            <li>Sync your layouts across multiple devices</li>\n            <li>Share your layouts with others</li>\n            <li>Manage and store your robotics data</li>\n          </ul>\n        </>\n      </Typography>\n\n      <Button variant=\"contained\" color=\"primary\" onClick={signIn}>\n        Sign in\n      </Button>\n    </div>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport CloseIcon from \"@mui/icons-material/Close\";\nimport { Dialog, IconButton } from \"@mui/material\";\nimport { useState } from \"react\";\n\nimport SigninForm from \"@foxglove/studio-base/components/SigninForm\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\n\nexport function SignInFormModal(): JSX.Element {\n  const [open, setOpen] = useState(true);\n\n  return (\n    <Dialog open={open} onClose={() => setOpen(false)}>\n      <Stack alignItems=\"end\">\n        <IconButton onClick={() => setOpen(false)}>\n          <CloseIcon />\n        </IconButton>\n      </Stack>\n      <Stack padding={3}>\n        <SigninForm />\n      </Stack>\n    </Dialog>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { extname } from \"path\";\nimport { useMemo } from \"react\";\n\nimport Log, { toLogLevel } from \"@foxglove/log\";\nimport { SettingsTree, SettingsTreeNode, SettingsTreeNodes } from \"@foxglove/studio\";\nimport { useStudioLogsSettings } from \"@foxglove/studio-base/context/StudioLogsSettingsContext\";\n\nconst log = Log.getLogger(__filename);\n\ntype ItemDetail = {\n  type: \"prefix\" | \"channel\";\n  fullPath: string;\n};\n\nfunction useStudioLogsSettingsTree(): SettingsTree {\n  const logsConfig = useStudioLogsSettings();\n\n  return useMemo<SettingsTree>(() => {\n    // When building the settings tree we strip away uninformative parts of the channel name (i.e.\n    // packages, src) to reduce the repetitive noise. However, to enable/disable channels and\n    // prefixes we need to know the original name or prefix. Here we store the stripped path to\n    // original path mapping.\n    const itemDetailByPath = new Map<string, ItemDetail>();\n\n    // Root node of all other settings nodes\n    const settingsRoot: SettingsTreeNodes = {\n      Settings: {\n        label: \"Settings\",\n        fields: {\n          level: {\n            label: \"level\",\n            input: \"select\",\n            value: logsConfig.globalLevel,\n            options: [\n              { label: \"error\", value: \"error\" },\n              { label: \"warn\", value: \"warn\" },\n              { label: \"info\", value: \"info\" },\n              { label: \"debug\", value: \"debug\" },\n            ],\n          },\n        },\n      },\n    };\n\n    // Channels are split into two buckets - \"packages\" and \"misc\". This is the root for \"misc\"\n    // channels.\n    const miscRoot: SettingsTreeNode = {\n      label: \"Misc\",\n      defaultExpansionState: \"expanded\",\n      children: {},\n    };\n\n    for (const channel of logsConfig.channels) {\n      const channelName = channel.name;\n\n      const parts = channelName.split(\"/\");\n\n      // Studio code may live in a `studio` workspace, and we'll still want the tree to work the same\n      const studioSpacePrefix = /^(studio\\/)/.test(channelName) ? `${parts.shift()}/` : \"\";\n\n      const [type, pkgName, srcPath, component, ...rest] = parts;\n\n      // misc entry\n      if (type !== \"packages\") {\n        miscRoot.children![channelName] = {\n          label: channelName,\n          visible: channel.enabled,\n        };\n\n        itemDetailByPath.set(`misc/${channelName}`, {\n          type: \"channel\",\n          fullPath: channel.name,\n        });\n        continue;\n      }\n\n      if (!pkgName) {\n        continue;\n      }\n\n      // The package doesn't keep src files in `src`, drop into the misc items section\n      if (srcPath !== \"src\" || !component) {\n        miscRoot.children![channel.name] = {\n          label: channel.name,\n          visible: channel.enabled,\n        };\n\n        itemDetailByPath.set(`misc/${channelName}`, {\n          type: \"channel\",\n          fullPath: channel.name,\n        });\n        continue;\n      }\n\n      // Setup the package name node\n      const pkgNode = (settingsRoot[pkgName] ??= {\n        label: pkgName,\n        visible: false,\n        children: {},\n      });\n\n      itemDetailByPath.set(pkgName, {\n        type: \"prefix\",\n        fullPath: `${studioSpacePrefix}packages/${pkgName}`,\n      });\n\n      const componentNode = (pkgNode.children![component] ??= {\n        label: component,\n        visible: false,\n      });\n\n      if (channel.enabled) {\n        pkgNode.visible = true;\n        componentNode.visible = true;\n      }\n\n      // The component has a file extension, no subtree is added under the component\n      if (extname(component)) {\n        itemDetailByPath.set(`${pkgName}/${component}`, {\n          type: \"channel\",\n          fullPath: `${studioSpacePrefix}packages/${pkgName}/src/${component}`,\n        });\n        continue;\n      }\n\n      itemDetailByPath.set(`${pkgName}/${component}`, {\n        type: \"prefix\",\n        fullPath: `${studioSpacePrefix}packages/${pkgName}/src/${component}`,\n      });\n\n      // If there are items under the component, add a children entry and add them to the children entry\n      if (rest.length > 0) {\n        // Component node is not a file so it might have children under it\n        componentNode.children ??= {};\n\n        const leafId = rest.join(\"/\");\n        componentNode.children[leafId] = {\n          label: leafId,\n          visible: channel.enabled,\n        };\n\n        itemDetailByPath.set(`${pkgName}/${component}/${leafId}`, {\n          type: \"channel\",\n          fullPath: `${studioSpacePrefix}packages/${pkgName}/src/${component}/${leafId}`,\n        });\n      }\n    }\n\n    // Add misc nodes at the end of root\n    settingsRoot[\"misc\"] = miscRoot;\n\n    return {\n      enableFilter: true,\n      actionHandler: (action) => {\n        log.debug(\"action\", action);\n\n        if (action.action === \"update\" && action.payload.path.join(\".\") === \"Settings.level\") {\n          if (typeof action.payload.value !== \"string\") {\n            return;\n          }\n          logsConfig.setGlobalLevel(toLogLevel(action.payload.value));\n          return;\n        }\n\n        // visibility toggle sends and update as if it was a boolean input\n        if (action.action !== \"update\" || action.payload.input !== \"boolean\") {\n          return;\n        }\n\n        // When using settings visibility toggle the last item of the path is the word \"visible\"\n        // Since that's our only action we ignore any other type of path\n        const path = action.payload.path;\n        const lastPathItem = path[path.length - 1];\n        if (lastPathItem !== \"visible\") {\n          return;\n        }\n\n        const enable = action.payload.value === true;\n\n        const remain = path.slice(0, path.length - 1);\n        const pathStr = remain.join(\"/\");\n\n        const item = itemDetailByPath.get(pathStr);\n        switch (item?.type) {\n          case \"prefix\":\n            if (enable) {\n              logsConfig.enablePrefix(item.fullPath);\n            } else {\n              logsConfig.disablePrefix(item.fullPath);\n            }\n            break;\n          case \"channel\":\n            if (enable) {\n              logsConfig.enableChannel(item.fullPath);\n            } else {\n              logsConfig.disableChannel(item.fullPath);\n            }\n            break;\n          default:\n            // no-op for undefined\n            break;\n        }\n      },\n      nodes: settingsRoot,\n    };\n  }, [logsConfig]);\n}\n\nexport { useStudioLogsSettingsTree };\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport SettingsTreeEditor from \"@foxglove/studio-base/components/SettingsTreeEditor\";\n\nimport { useStudioLogsSettingsTree } from \"./useStudioLogsSettingsTree\";\n\nexport function StudioLogsSettings(): JSX.Element {\n  const logSettings = useStudioLogsSettingsTree();\n\n  return <SettingsTreeEditor settings={logSettings} />;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext, useContext } from \"react\";\n\nimport { ILayoutManager } from \"@foxglove/studio-base/services/ILayoutManager\";\n\nconst LayoutManagerContext = createContext<ILayoutManager | undefined>(undefined);\nLayoutManagerContext.displayName = \"LayoutManagerContext\";\n\nexport function useLayoutManager(): ILayoutManager {\n  const ctx = useContext(LayoutManagerContext);\n  if (ctx == undefined) {\n    throw new Error(\"A LayoutManager provider is required to useLayoutManager\");\n  }\n  return ctx;\n}\n\nexport default LayoutManagerContext;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { enqueueSnackbar } from \"notistack\";\nimport { useEffect, useState } from \"react\";\nimport { useAsync, useMountedState } from \"react-use\";\nimport { useDebounce } from \"use-debounce\";\n\nimport Logger from \"@foxglove/log\";\nimport { useAnalytics } from \"@foxglove/studio-base/context/AnalyticsContext\";\nimport {\n  LayoutID,\n  LayoutState,\n  useCurrentLayoutSelector,\n} from \"@foxglove/studio-base/context/CurrentLayoutContext\";\nimport { useLayoutManager } from \"@foxglove/studio-base/context/LayoutManagerContext\";\nimport { AppEvent } from \"@foxglove/studio-base/services/IAnalytics\";\n\ntype UpdatedLayout = NonNullable<LayoutState[\"selectedLayout\"]>;\n\nconst log = Logger.getLogger(__filename);\n\nconst EMPTY_UNSAVED_LAYOUTS: Record<LayoutID, UpdatedLayout> = {};\nconst SAVE_INTERVAL_MS = 1000;\n\nconst selectCurrentLayout = (state: LayoutState) => state.selectedLayout;\n\n/**\n * Observes changes in the current layout and asynchronously pushes them to the\n * layout manager.\n */\nexport function CurrentLayoutSyncAdapter(): ReactNull {\n  const selectedLayout = useCurrentLayoutSelector(selectCurrentLayout);\n\n  const layoutManager = useLayoutManager();\n\n  const [unsavedLayouts, setUnsavedLayouts] = useState(EMPTY_UNSAVED_LAYOUTS);\n\n  const isMounted = useMountedState();\n\n  const analytics = useAnalytics();\n\n  useEffect(() => {\n    if (selectedLayout?.edited === true) {\n      setUnsavedLayouts((old) => ({\n        ...old,\n        [selectedLayout.id]: selectedLayout,\n      }));\n    }\n  }, [selectedLayout]);\n\n  const [debouncedUnsavedLayouts, debouncedUnsavedLayoutActions] = useDebounce(\n    unsavedLayouts,\n    SAVE_INTERVAL_MS,\n  );\n\n  // Flush and clear pending updates on unmount.\n  useEffect(() => {\n    return () => {\n      debouncedUnsavedLayoutActions.flush();\n      debouncedUnsavedLayoutActions.cancel();\n    };\n  }, [debouncedUnsavedLayoutActions]);\n\n  // Write all pending layout updates to the layout manager. Under the hood this\n  // uses useEffect so it happens after DOM updates are complete.\n  useAsync(async () => {\n    const unsavedLayoutsSnapshot = { ...debouncedUnsavedLayouts };\n    setUnsavedLayouts(EMPTY_UNSAVED_LAYOUTS);\n\n    for (const params of Object.values(unsavedLayoutsSnapshot)) {\n      try {\n        await layoutManager.updateLayout(params);\n      } catch (error) {\n        log.error(error);\n        if (isMounted()) {\n          enqueueSnackbar(`Your changes could not be saved. ${error.toString()}`, {\n            variant: \"error\",\n            key: \"CurrentLayoutProvider.throttledSave\",\n          });\n        }\n      }\n    }\n\n    void analytics.logEvent(AppEvent.LAYOUT_UPDATE);\n  }, [analytics, debouncedUnsavedLayouts, isMounted, layoutManager]);\n\n  return ReactNull;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { isEmpty, omitBy } from \"lodash\";\n\nimport { fromRFC3339String, toRFC3339String, Time } from \"@foxglove/rostime\";\nimport { LayoutID } from \"@foxglove/studio-base/index\";\n\nexport type AppURLState = {\n  ds?: string;\n  dsParams?: Record<string, string>;\n  layoutId?: LayoutID;\n  time?: Time;\n};\n\n/**\n * Encodes app state in a URL's query params.\n *\n * @param url The base URL to encode params into.\n * @param urlState The player state to encode.\n * @returns A url with all app state stored as query pararms.\n */\nexport function updateAppURLState(url: URL, urlState: AppURLState): URL {\n  const newURL = new URL(url.href);\n\n  if (\"layoutId\" in urlState) {\n    if (urlState.layoutId) {\n      newURL.searchParams.set(\"layoutId\", urlState.layoutId);\n    } else {\n      newURL.searchParams.delete(\"layoutId\");\n    }\n  }\n\n  if (\"time\" in urlState) {\n    if (urlState.time) {\n      newURL.searchParams.set(\"time\", toRFC3339String(urlState.time));\n    } else {\n      newURL.searchParams.delete(\"time\");\n    }\n  }\n\n  if (\"ds\" in urlState) {\n    if (urlState.ds) {\n      newURL.searchParams.set(\"ds\", urlState.ds);\n    } else {\n      newURL.searchParams.delete(\"ds\");\n    }\n  }\n\n  if (\"dsParams\" in urlState) {\n    [...newURL.searchParams].forEach(([k, _]) => {\n      if (k.startsWith(\"ds.\")) {\n        newURL.searchParams.delete(k);\n      }\n    });\n\n    Object.entries(urlState.dsParams ?? \"\").forEach(([k, v]) => {\n      newURL.searchParams.set(\"ds.\" + k, v);\n    });\n  }\n\n  newURL.searchParams.sort();\n\n  return newURL;\n}\n\n/**\n * Tries to parse a state url into one of the types we know how to open.\n *\n * @param url URL to try to parse.\n * @returns Parsed URL type or undefined if the url is not a valid URL.\n * @throws Error if URL parsing fails.\n */\nexport function parseAppURLState(url: URL): AppURLState | undefined {\n  const ds = url.searchParams.get(\"ds\") ?? undefined;\n  const layoutId = url.searchParams.get(\"layoutId\");\n  const timeString = url.searchParams.get(\"time\");\n  const time = timeString == undefined ? undefined : fromRFC3339String(timeString);\n  const dsParams: Record<string, string> = {};\n  url.searchParams.forEach((v, k) => {\n    if (k && v && k.startsWith(\"ds.\")) {\n      const cleanKey = k.replace(/^ds./, \"\");\n      dsParams[cleanKey] = v;\n    }\n  });\n\n  const state: AppURLState = omitBy(\n    {\n      layoutId: layoutId ? (layoutId as LayoutID) : undefined,\n      time,\n      ds,\n      dsParams: isEmpty(dsParams) ? undefined : dsParams,\n    },\n    isEmpty,\n  );\n\n  return isEmpty(state) ? undefined : state;\n}\n\n/**\n * Tries to parse app url state from the window's current location.\n */\nexport function windowAppURLState(): AppURLState | undefined {\n  if (typeof window === \"undefined\") {\n    return undefined;\n  }\n\n  try {\n    return parseAppURLState(new URL(window.location.href));\n  } catch {\n    return undefined;\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { isString, pickBy } from \"lodash\";\nimport { useEffect } from \"react\";\nimport { useDebounce } from \"use-debounce\";\n\nimport { useDeepMemo } from \"@foxglove/hooks\";\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport { EventsStore, useEvents } from \"@foxglove/studio-base/context/EventsContext\";\nimport { PlayerCapabilities } from \"@foxglove/studio-base/players/types\";\nimport { AppURLState, updateAppURLState } from \"@foxglove/studio-base/util/appURLState\";\n\nconst selectCanSeek = (ctx: MessagePipelineContext) =>\n  ctx.playerState.capabilities.includes(PlayerCapabilities.playbackControl);\nconst selectCurrentTime = (ctx: MessagePipelineContext) => ctx.playerState.activeData?.currentTime;\nconst selectUrlState = (ctx: MessagePipelineContext) => ctx.playerState.urlState;\nconst selectSelectedEventId = (store: EventsStore) => store.selectedEventId;\n\nfunction updateUrl(newState: AppURLState) {\n  const newStateUrl = updateAppURLState(new URL(window.location.href), newState);\n  window.history.replaceState(undefined, \"\", newStateUrl.href);\n}\n\n/**\n * Syncs our current player state and time with the URL in the address bar.\n */\nexport function useStateToURLSynchronization(): void {\n  const playerUrlState = useMessagePipeline(selectUrlState);\n  const stablePlayerUrlState = useDeepMemo(playerUrlState);\n  const canSeek = useMessagePipeline(selectCanSeek);\n  const currentTime = useMessagePipeline(selectCurrentTime);\n  const [debouncedCurrentTime] = useDebounce(currentTime, 500, { maxWait: 500 });\n  const selectedEventId = useEvents(selectSelectedEventId);\n\n  // Sync current time with the url.\n  useEffect(() => {\n    updateUrl({\n      time: canSeek ? debouncedCurrentTime : undefined,\n    });\n  }, [canSeek, debouncedCurrentTime]);\n\n  // Sync player state with the url.\n  useEffect(() => {\n    if (stablePlayerUrlState == undefined) {\n      return;\n    }\n\n    updateUrl({\n      ds: stablePlayerUrlState.sourceId,\n      dsParams: pickBy(\n        {\n          ...stablePlayerUrlState.parameters,\n          eventId: selectedEventId,\n        },\n        isString,\n      ),\n    });\n  }, [selectedEventId, stablePlayerUrlState]);\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useStateToURLSynchronization } from \"@foxglove/studio-base/hooks/useStateToURLSynchronization\";\n\n// This is in a simple subcomponent so it doesn't trigger rerenders of an entire expensive\n// component like Workspace while it's listening for time values.\nexport function URLStateSyncAdapter(): ReactNull {\n  useStateToURLSynchronization();\n\n  return ReactNull;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useMemo } from \"react\";\n\nimport { CurrentLayoutSyncAdapter } from \"@foxglove/studio-base/components/CurrentLayoutSyncAdapter\";\nimport { URLStateSyncAdapter } from \"@foxglove/studio-base/components/URLStateSyncAdapter\";\nimport { useAppContext } from \"@foxglove/studio-base/context/AppContext\";\n\nexport function SyncAdapters(): JSX.Element {\n  // Sync adapters from app context override any local sync adapters\n  const { syncAdapters } = useAppContext();\n\n  return useMemo(() => {\n    if (syncAdapters) {\n      return <>{...syncAdapters}</>;\n    }\n\n    return (\n      <>\n        <URLStateSyncAdapter />\n        <CurrentLayoutSyncAdapter />\n      </>\n    );\n  }, [syncAdapters]);\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport ClearIcon from \"@mui/icons-material/Clear\";\nimport SearchIcon from \"@mui/icons-material/Search\";\nimport {\n  IconButton,\n  List,\n  ListItem,\n  ListItemText,\n  Skeleton,\n  TextField,\n  Typography,\n  TypographyProps,\n} from \"@mui/material\";\nimport { Fzf, FzfResultItem } from \"fzf\";\nimport { useMemo, useState } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { DirectTopicStatsUpdater } from \"@foxglove/studio-base/components/DirectTopicStatsUpdater\";\nimport EmptyState from \"@foxglove/studio-base/components/EmptyState\";\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { PlayerPresence, TopicStats } from \"@foxglove/studio-base/players/types\";\nimport { Topic } from \"@foxglove/studio-base/src/players/types\";\nimport { fonts } from \"@foxglove/studio-base/util/sharedStyleConstants\";\n\ntype TopicWithStats = Topic & Partial<TopicStats>;\n\nconst topicToFzfResult = (item: TopicWithStats) =>\n  ({\n    item,\n    score: 0,\n    positions: new Set<number>(),\n    start: 0,\n    end: 0,\n  } as FzfResultItem<TopicWithStats>);\n\nconst HighlightChars = ({\n  str,\n  indices,\n  color,\n  offset = 0,\n}: {\n  str: string;\n  indices: Set<number>;\n  color?: TypographyProps[\"color\"];\n  offset?: number;\n}) => {\n  const chars = str.split(\"\");\n\n  const nodes = chars.map((char, i) => {\n    if (indices.has(i + offset)) {\n      return (\n        <Typography component=\"b\" key={i} variant=\"inherit\" color={color ?? \"info.main\"}>\n          {char}\n        </Typography>\n      );\n    }\n    return char;\n  });\n\n  return <>{nodes}</>;\n};\n\nconst useStyles = makeStyles()((theme) => ({\n  appBar: {\n    top: 0,\n    zIndex: theme.zIndex.appBar,\n    padding: theme.spacing(0.5),\n    position: \"sticky\",\n    backgroundColor: theme.palette.background.paper,\n  },\n  listItem: {\n    paddingRight: theme.spacing(1),\n\n    \"&.MuiListItem-dense\": {\n      \".MuiListItemText-root\": {\n        marginTop: theme.spacing(0.5),\n        marginBottom: theme.spacing(0.5),\n      },\n    },\n    \".MuiListItemSecondaryAction-root\": {\n      marginRight: theme.spacing(-1),\n    },\n  },\n  textField: {\n    \".MuiOutlinedInput-notchedOutline\": {\n      border: \"none\",\n    },\n  },\n  aliasedTopicName: {\n    color: theme.palette.primary.main,\n    display: \"block\",\n    textAlign: \"start\",\n  },\n  startAdornment: {\n    display: \"flex\",\n  },\n}));\n\nconst selectPlayerPresence = ({ playerState }: MessagePipelineContext) => playerState.presence;\nconst selectSortedTopics = ({ sortedTopics }: MessagePipelineContext) => sortedTopics;\n\nfunction TopicListItem({\n  topic,\n  positions,\n}: {\n  topic: Topic;\n  positions: Set<number>;\n}): JSX.Element {\n  const { classes } = useStyles();\n  return (\n    <ListItem\n      className={classes.listItem}\n      divider\n      key={topic.name}\n      secondaryAction={\n        <Stack style={{ textAlign: \"right\" }}>\n          <Typography\n            variant=\"caption\"\n            color=\"text.secondary\"\n            data-topic={topic.name}\n            data-topic-stat=\"count\"\n          >\n            &mdash;\n          </Typography>\n          <Typography\n            variant=\"caption\"\n            color=\"text.secondary\"\n            data-topic={topic.name}\n            data-topic-stat=\"frequency\"\n          >\n            &mdash;\n          </Typography>\n        </Stack>\n      }\n    >\n      <ListItemText\n        primary={\n          <>\n            <HighlightChars str={topic.name} indices={positions} />\n            {topic.aliasedFromName && (\n              <Typography variant=\"caption\" className={classes.aliasedTopicName}>\n                from {topic.aliasedFromName}\n              </Typography>\n            )}\n          </>\n        }\n        primaryTypographyProps={{ noWrap: true, title: topic.name }}\n        secondary={\n          topic.schemaName == undefined ? (\n            \"—\"\n          ) : (\n            <HighlightChars\n              str={topic.schemaName}\n              indices={positions}\n              offset={topic.name.length + 1}\n            />\n          )\n        }\n        secondaryTypographyProps={{\n          variant: \"caption\",\n          fontFamily: fonts.MONOSPACE,\n          noWrap: true,\n          title: topic.schemaName,\n        }}\n        style={{ marginRight: \"48px\" }}\n      />\n    </ListItem>\n  );\n}\n\nconst MemoTopicListItem = React.memo(TopicListItem);\n\nexport function TopicList(): JSX.Element {\n  const { classes, cx } = useStyles();\n  const [filterText, setFilterText] = useState<string>(\"\");\n\n  const playerPresence = useMessagePipeline(selectPlayerPresence);\n  const topics = useMessagePipeline(selectSortedTopics);\n\n  const filteredTopics: FzfResultItem<Topic>[] = useMemo(\n    () =>\n      filterText\n        ? new Fzf(topics, {\n            fuzzy: filterText.length > 2 ? \"v2\" : false,\n            sort: true,\n            selector: (item) => `${item.name}|${item.schemaName}`,\n          }).find(filterText)\n        : topics.map((item) => topicToFzfResult(item)),\n    [filterText, topics],\n  );\n\n  if (playerPresence === PlayerPresence.NOT_PRESENT) {\n    return <EmptyState>No data source selected</EmptyState>;\n  }\n\n  if (playerPresence === PlayerPresence.ERROR) {\n    return <EmptyState>An error occurred</EmptyState>;\n  }\n\n  if (playerPresence === PlayerPresence.INITIALIZING) {\n    return (\n      <>\n        <header className={classes.appBar}>\n          <TextField\n            disabled\n            className={classes.textField}\n            fullWidth\n            placeholder=\"Waiting for data...\"\n            InputProps={{\n              size: \"small\",\n              startAdornment: <SearchIcon fontSize=\"small\" />,\n            }}\n          />\n        </header>\n        <List key=\"loading\" dense disablePadding>\n          {[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15].map((i) => (\n            <ListItem className={cx(classes.listItem, \"loading\")} divider key={i}>\n              <ListItemText\n                primary={<Skeleton animation={false} width=\"20%\" />}\n                secondary={<Skeleton animation=\"wave\" width=\"55%\" />}\n                secondaryTypographyProps={{ variant: \"caption\" }}\n              />\n            </ListItem>\n          ))}\n        </List>\n      </>\n    );\n  }\n\n  return (\n    <>\n      <header className={classes.appBar}>\n        <TextField\n          id=\"topic-filter\"\n          variant=\"filled\"\n          disabled={playerPresence !== PlayerPresence.PRESENT}\n          onChange={(event) => setFilterText(event.target.value)}\n          value={filterText}\n          className={classes.textField}\n          fullWidth\n          placeholder=\"Filter by topic or datatype…\"\n          InputProps={{\n            size: \"small\",\n            startAdornment: (\n              <label className={classes.startAdornment} htmlFor=\"topic-filter\">\n                <SearchIcon fontSize=\"small\" />\n              </label>\n            ),\n            endAdornment: filterText && (\n              <IconButton\n                size=\"small\"\n                title=\"Clear search\"\n                onClick={() => setFilterText(\"\")}\n                edge=\"end\"\n              >\n                <ClearIcon fontSize=\"small\" />\n              </IconButton>\n            ),\n          }}\n        />\n      </header>\n\n      {filteredTopics.length > 0 ? (\n        <List key=\"topics\" dense disablePadding>\n          {filteredTopics.map(({ item: topic, positions }) => {\n            return <MemoTopicListItem key={topic.name} topic={topic} positions={positions} />;\n          })}\n        </List>\n      ) : (\n        <EmptyState>\n          {playerPresence === PlayerPresence.PRESENT && filterText\n            ? `No topics or datatypes matching \\n “${filterText}”`\n            : \"No topics available. \"}\n          {playerPresence === PlayerPresence.RECONNECTING && \"Waiting for connection\"}\n        </EmptyState>\n      )}\n      <DirectTopicStatsUpdater interval={6} />\n    </>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport ArrowDropDownIcon from \"@mui/icons-material/ArrowDropDown\";\nimport ErrorIcon from \"@mui/icons-material/Error\";\nimport MoreVertIcon from \"@mui/icons-material/MoreVert\";\nimport {\n  Divider,\n  IconButton,\n  Menu,\n  MenuItem,\n  ListItem,\n  ListItemButton,\n  ListItemButtonProps,\n  ListItemText,\n  Typography,\n  Tooltip,\n  InputBase,\n} from \"@mui/material\";\nimport { pick } from \"lodash\";\nimport { useMemo, useCallback, useState, useRef } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { VariableValue } from \"@foxglove/studio\";\nimport CopyButton from \"@foxglove/studio-base/components/CopyButton\";\nimport JsonInput from \"@foxglove/studio-base/components/JsonInput\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { useAnalytics } from \"@foxglove/studio-base/context/AnalyticsContext\";\nimport useGlobalVariables, {\n  GlobalVariables,\n} from \"@foxglove/studio-base/hooks/useGlobalVariables\";\nimport { AppEvent } from \"@foxglove/studio-base/services/IAnalytics\";\n\nconst useStyles = makeStyles<void, \"copyButton\">()((theme, _params, classes) => ({\n  root: {\n    \"@media (pointer: fine)\": {\n      [`&:not(:hover) .${classes.copyButton}`]: {\n        visibility: \"hidden\",\n      },\n    },\n  },\n  copyButton: {\n    top: 0,\n    right: 0,\n    zIndex: theme.zIndex.mobileStepper,\n\n    \"&.MuiButton-root\": {\n      position: \"absolute\",\n      paddingLeft: theme.spacing(1),\n      paddingRight: theme.spacing(1),\n      margin: theme.spacing(0.75),\n      minWidth: \"auto\",\n    },\n  },\n  input: {\n    font: \"inherit\",\n    flex: \"auto\",\n\n    \".MuiInputBase-input\": {\n      padding: 0,\n    },\n    \"&.Mui-error\": {\n      color: theme.palette.error.main,\n    },\n  },\n  edgeEnd: {\n    marginRight: theme.spacing(-1.625),\n  },\n  editorWrapper: {\n    position: \"relative\",\n    backgroundColor: theme.palette.grey[50],\n  },\n  listItemButton: {\n    \"&:focus-within\": {\n      backgroundColor: \"transparent\",\n    },\n    \"&.Mui-selected\": {\n      color: theme.palette.primary.main,\n      transition: `background-color 300ms ease-in-out`,\n    },\n  },\n  listItemText: {\n    marginTop: theme.spacing(0.125),\n    marginBottom: theme.spacing(0.125),\n  },\n}));\n\nconst changeGlobalKey = (\n  newKey: string,\n  oldKey: string,\n  globalVariables: GlobalVariables,\n  idx: number,\n  overwriteGlobalVariables: (_: GlobalVariables) => void,\n) => {\n  const keys = Object.keys(globalVariables);\n  overwriteGlobalVariables({\n    ...pick(globalVariables, keys.slice(0, idx)),\n    [newKey]: globalVariables[oldKey],\n    ...pick(globalVariables, keys.slice(idx + 1)),\n  });\n};\n\nexport default function Variable(props: {\n  name: string;\n  selected?: ListItemButtonProps[\"selected\"];\n  index: number;\n}): JSX.Element {\n  const { name, selected = false, index } = props;\n\n  const { classes } = useStyles();\n\n  // When editing the variable name, the new name might collide with an existing variable name\n  // If the name matches an existing name, we set the edited name and show an error to the user\n  // indicating there is a name conflict. The user must resolve the name conflict or their edited\n  // name will be reset on blur.\n  const [editedName, setEditedName] = useState<string | undefined>();\n\n  const [expanded, setExpanded] = useState<boolean>(true);\n  const [anchorEl, setAnchorEl] = React.useState<undefined | HTMLElement>(undefined);\n  const [copied, setCopied] = useState(false);\n  const menuOpen = Boolean(anchorEl);\n\n  const { globalVariables, setGlobalVariables, overwriteGlobalVariables } = useGlobalVariables();\n\n  const handleClick = (event: React.MouseEvent<HTMLButtonElement>) => {\n    setAnchorEl(event.currentTarget);\n  };\n  const handleClose = () => {\n    setAnchorEl(undefined);\n  };\n\n  const analytics = useAnalytics();\n\n  const deleteVariable = useCallback(() => {\n    setGlobalVariables({ [name]: undefined });\n    void analytics.logEvent(AppEvent.VARIABLE_DELETE);\n    handleClose();\n  }, [analytics, name, setGlobalVariables]);\n\n  const value = useMemo(() => globalVariables[name], [globalVariables, name]);\n\n  const onChangeValue = useCallback(\n    (newVal: unknown) => {\n      setGlobalVariables({ [name]: newVal as VariableValue });\n      setCopied(false);\n    },\n    [name, setGlobalVariables],\n  );\n\n  const onBlur = () => {\n    if (\n      editedName != undefined &&\n      globalVariables[editedName] == undefined &&\n      name !== editedName\n    ) {\n      changeGlobalKey(editedName, name, globalVariables, index, overwriteGlobalVariables);\n    }\n    setEditedName(undefined);\n  };\n\n  const rootRef = useRef<HTMLDivElement>(ReactNull);\n\n  const activeElementIsChild = rootRef.current?.contains(document.activeElement) === true;\n\n  const isSelected = selected && !activeElementIsChild;\n  const isDuplicate =\n    editedName != undefined && editedName !== name && globalVariables[editedName] != undefined;\n\n  const getText = useCallback(() => JSON.stringify(value, undefined, 2) ?? \"\", [value]);\n\n  return (\n    <Stack className={classes.root} ref={rootRef}>\n      <ListItem\n        dense\n        disablePadding\n        secondaryAction={\n          <Stack className={classes.edgeEnd} direction=\"row\" alignItems=\"center\" gap={0.25}>\n            <IconButton\n              size=\"small\"\n              id=\"variable-action-button\"\n              data-testid=\"variable-action-button\"\n              aria-controls={expanded ? \"variable-action-menu\" : undefined}\n              aria-haspopup=\"true\"\n              aria-expanded={expanded ? \"true\" : undefined}\n              onClick={handleClick}\n            >\n              <MoreVertIcon fontSize=\"small\" />\n            </IconButton>\n            <Menu\n              id=\"variable-action-menu\"\n              anchorEl={anchorEl}\n              open={menuOpen}\n              onClose={handleClose}\n              MenuListProps={{\n                \"aria-labelledby\": \"variable-action-button\",\n                dense: true,\n              }}\n            >\n              <MenuItem onClick={deleteVariable}>\n                <Typography color=\"error.main\" variant=\"inherit\">\n                  Delete variable\n                </Typography>\n              </MenuItem>\n            </Menu>\n          </Stack>\n        }\n      >\n        <ListItemButton\n          className={classes.listItemButton}\n          selected={isSelected}\n          onClick={() => setExpanded(!expanded)}\n        >\n          <ListItemText\n            className={classes.listItemText}\n            primary={\n              <Stack direction=\"row\" alignItems=\"center\" style={{ marginLeft: -12 }}>\n                <ArrowDropDownIcon\n                  style={{ transform: !expanded ? \"rotate(-90deg)\" : undefined }}\n                />\n                <InputBase\n                  className={classes.input}\n                  autoFocus={name === \"\"}\n                  error={isDuplicate}\n                  value={editedName ?? name}\n                  placeholder=\"variable_name\"\n                  data-testid={`global-variable-key-input-${name}`}\n                  onClick={(e) => e.stopPropagation()}\n                  onFocus={() => editedName === \"\" && setExpanded(true)}\n                  onChange={(event) => setEditedName(event.target.value)}\n                  onBlur={onBlur}\n                  endAdornment={\n                    isDuplicate && (\n                      <Tooltip\n                        arrow\n                        title=\"A variable with this name already exists. Please select a unique variable name to save changes.\"\n                      >\n                        <ErrorIcon className={classes.edgeEnd} fontSize=\"small\" color=\"error\" />\n                      </Tooltip>\n                    )\n                  }\n                />\n              </Stack>\n            }\n            primaryTypographyProps={{\n              component: \"div\",\n              fontWeight: 600,\n              variant: \"body2\",\n            }}\n          />\n        </ListItemButton>\n      </ListItem>\n      {expanded && (\n        <div className={classes.editorWrapper}>\n          <Divider />\n          <CopyButton\n            className={classes.copyButton}\n            size=\"small\"\n            color={copied ? \"primary\" : \"inherit\"}\n            getText={getText}\n          >\n            {copied ? \"Copied\" : \"Copy\"}\n          </CopyButton>\n          <JsonInput value={value} onChange={onChangeValue} />\n        </div>\n      )}\n      <Divider />\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Button } from \"@mui/material\";\nimport { union } from \"lodash\";\nimport { useMemo, useRef, useState, ReactElement, useEffect } from \"react\";\n\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { useAnalytics } from \"@foxglove/studio-base/context/AnalyticsContext\";\nimport useGlobalVariables, {\n  GlobalVariables,\n} from \"@foxglove/studio-base/hooks/useGlobalVariables\";\nimport { AppEvent } from \"@foxglove/studio-base/services/IAnalytics\";\n\nimport Variable from \"./Variable\";\n\nconst ANIMATION_RESET_DELAY_MS = 1500;\n\nexport default function VariablesList(): ReactElement {\n  const { globalVariables, setGlobalVariables } = useGlobalVariables();\n  const globalVariableNames = useMemo(() => Object.keys(globalVariables), [globalVariables]);\n\n  // Don't run the animation when the sidebar first renders\n  const skipAnimation = useRef<boolean>(true);\n\n  const analytics = useAnalytics();\n\n  useEffect(() => {\n    const timeoutId = setTimeout(() => (skipAnimation.current = false), ANIMATION_RESET_DELAY_MS);\n    return () => clearTimeout(timeoutId);\n  }, []);\n\n  const previousGlobalVariablesRef = useRef<GlobalVariables | undefined>(globalVariables);\n  const [changedVariables, setChangedVariables] = useState<string[]>([]);\n\n  useEffect(() => {\n    if (skipAnimation.current) {\n      previousGlobalVariablesRef.current = globalVariables;\n      return;\n    }\n    const newChangedVariables = union(\n      Object.keys(globalVariables),\n      Object.keys(previousGlobalVariablesRef.current ?? {}),\n    ).filter((name) => {\n      const previousValue = previousGlobalVariablesRef.current?.[name];\n      return previousValue !== globalVariables[name];\n    });\n\n    setChangedVariables(newChangedVariables);\n    previousGlobalVariablesRef.current = globalVariables;\n    const timerId = setTimeout(() => setChangedVariables([]), ANIMATION_RESET_DELAY_MS);\n    return () => clearTimeout(timerId);\n  }, [globalVariables, skipAnimation]);\n\n  return (\n    <Stack flex=\"auto\" fullWidth overflowX=\"auto\">\n      {globalVariableNames.map((name, idx) => (\n        <Variable\n          key={name}\n          name={name}\n          selected={!skipAnimation.current && changedVariables.includes(name)}\n          index={idx}\n        />\n      ))}\n      <Stack direction=\"row\" padding={1}>\n        <Button\n          color=\"inherit\"\n          fullWidth\n          data-testid=\"add-variable-button\"\n          variant=\"contained\"\n          key=\"add-global-variable\"\n          disabled={globalVariables[\"\"] != undefined}\n          onClick={() => {\n            setGlobalVariables({ \"\": '\"\"' });\n            void analytics.logEvent(AppEvent.VARIABLE_ADD);\n          }}\n        >\n          Add variable\n        </Button>\n      </Stack>\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport type { OsContext } from \"@foxglove/studio-base/OsContext\";\n\ntype GlobalWithCtx = typeof global & {\n  ctxbridge?: OsContext;\n};\n\n/** Global singleton of the OsContext provided by the bridge */\nconst OsContextSingleton = (global as GlobalWithCtx).ctxbridge;\nexport default OsContextSingleton;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { Checkbox, FormControlLabel, Typography } from \"@mui/material\";\nimport { useTranslation } from \"react-i18next\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { AppSetting } from \"@foxglove/studio-base/AppSetting\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { useAnalytics } from \"@foxglove/studio-base/context/AnalyticsContext\";\nimport { useAppConfigurationValue } from \"@foxglove/studio-base/hooks/useAppConfigurationValue\";\nimport { AppEvent } from \"@foxglove/studio-base/services/IAnalytics\";\n\nconst useStyles = makeStyles()({\n  checkbox: {\n    \"&.MuiCheckbox-root\": {\n      paddingTop: 0,\n    },\n  },\n  formControlLabel: {\n    \"&.MuiFormControlLabel-root\": {\n      alignItems: \"start\",\n    },\n  },\n});\n\ntype Feature = {\n  key: AppSetting;\n  name: string;\n  description: JSX.Element;\n};\n\nfunction useFeatures(): Feature[] {\n  const { t } = useTranslation(\"appSettings\");\n\n  const features: Feature[] = [\n    {\n      key: AppSetting.SHOW_DEBUG_PANELS,\n      name: t(\"studioDebugPanels\"),\n      description: <>{t(\"studioDebugPanelsDescription\")}</>,\n    },\n    {\n      key: AppSetting.ENABLE_MEMORY_USE_INDICATOR,\n      name: t(\"memoryUseIndicator\"),\n      description: <>{t(\"memoryUseIndicatorDescription\")}</>,\n    },\n  ];\n\n  if (process.env.NODE_ENV === \"development\") {\n    features.push({\n      key: AppSetting.ENABLE_LAYOUT_DEBUGGING,\n      name: t(\"layoutDebugging\"),\n      description: <>{t(\"layoutDebuggingDescription\")}</>,\n    });\n  }\n\n  return features;\n}\n\nfunction ExperimentalFeatureItem(props: { feature: Feature }) {\n  const { feature } = props;\n  const { classes } = useStyles();\n  const analytics = useAnalytics();\n\n  const [enabled, setEnabled] = useAppConfigurationValue<boolean>(feature.key);\n  return (\n    <FormControlLabel\n      className={classes.formControlLabel}\n      control={\n        <Checkbox\n          className={classes.checkbox}\n          checked={enabled ?? false}\n          onChange={(_, checked) => {\n            void setEnabled(checked);\n            void analytics.logEvent(AppEvent.EXPERIMENTAL_FEATURE_TOGGLE, {\n              feature: feature.key,\n              checked,\n            });\n          }}\n        />\n      }\n      label={\n        <Stack gap={0.25} paddingLeft={0.5}>\n          <Typography fontWeight={600}>{feature.name}</Typography>\n          <Typography variant=\"body2\" color=\"text.secondary\">\n            {feature.description}\n          </Typography>\n        </Stack>\n      }\n    />\n  );\n}\n\nexport const ExperimentalFeatureSettings = (): React.ReactElement => {\n  const features = useFeatures();\n  const { t } = useTranslation(\"appSettings\");\n  return (\n    <Stack gap={2}>\n      {features.length === 0 && (\n        <Typography fontStyle=\"italic\">{t(\"noExperimentalFeatures\")}</Typography>\n      )}\n      {features.map((feature) => (\n        <ExperimentalFeatureItem key={feature.key} feature={feature} />\n      ))}\n    </Stack>\n  );\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\nimport { createContext } from \"react\";\n\n// This context provides a function that handles link clicks, for example to handle app-internal\n// links by showing a modal dialog rather than actualy navigating.\nconst LinkHandlerContext = createContext<(event: React.MouseEvent, href: string) => void>(() => {});\nLinkHandlerContext.displayName = \"LinkHandlerContext\";\n\nexport default LinkHandlerContext;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { Link } from \"@mui/material\";\nimport { PropsWithChildren, CSSProperties, useCallback, useContext } from \"react\";\nimport Markdown from \"react-markdown\";\nimport rehypeRaw from \"rehype-raw\";\nimport { withStyles } from \"tss-react/mui\";\n\nimport LinkHandlerContext from \"@foxglove/studio-base/context/LinkHandlerContext\";\nimport { fonts } from \"@foxglove/studio-base/util/sharedStyleConstants\";\n\nconst TextContentRoot = withStyles(\"div\", (theme) => {\n  const { palette, shape, spacing, typography, shadows } = theme;\n  return {\n    root: {\n      fontFamily: typography.body2.fontFamily,\n      fontSize: typography.body2.fontSize,\n      fontWeight: typography.body2.fontWeight,\n      lineHeight: typography.body2.lineHeight,\n      backgroundColor: \"transparent\",\n      color: palette.text.secondary,\n\n      \"h1, h2, h3, h4, h5, h6\": {\n        color: palette.text.primary,\n\n        \"&:first-child\": { marginTop: 0 },\n      },\n      h1: {\n        fontFamily: typography.h4.fontFamily,\n        fontSize: typography.h4.fontSize,\n        lineHeight: typography.h4.lineHeight,\n        marginBottom: spacing(1),\n        fontWeight: 500,\n      },\n      h2: {\n        fontFamily: typography.h5.fontFamily,\n        fontSize: typography.h5.fontSize,\n        lineHeight: typography.h5.lineHeight,\n        marginBottom: spacing(1),\n        fontWeight: 500,\n      },\n      h3: {\n        fontFamily: typography.h6.fontFamily,\n        fontSize: typography.h6.fontSize,\n        lineHeight: typography.h6.lineHeight,\n        marginBottom: spacing(1),\n        color: palette.text.secondary,\n        fontWeight: 500,\n      },\n      h4: {\n        fontFamily: typography.subtitle1.fontFamily,\n        fontSize: typography.subtitle1.fontSize,\n        lineHeight: typography.subtitle1.lineHeight,\n        marginBottom: spacing(0.5),\n        color: palette.text.secondary,\n        fontWeight: 500,\n      },\n      \"h5, h6\": {\n        fontFamily: typography.body1.fontFamily,\n        fontSize: typography.body1.fontSize,\n        lineHeight: typography.body1.lineHeight,\n        marginBottom: spacing(0.5),\n        color: palette.text.secondary,\n        fontWeight: 500,\n      },\n      \"ol, ul\": {\n        paddingLeft: spacing(2.5),\n        marginBottom: spacing(2.5),\n      },\n      li: {\n        margin: spacing(0.5, 0),\n      },\n      \"b, strong\": {\n        fontWeight: \"700 !important\",\n      },\n      \"p, ul\": {\n        margin: spacing(1, 0),\n\n        \"&:only-child\": {\n          margin: spacing(0.5, 0),\n        },\n      },\n      img: {\n        maxWidth: \"100%\",\n      },\n      pre: {\n        whiteSpace: \"pre-wrap\",\n        fontFamily: fonts.MONOSPACE,\n        backgroundColor: palette.action.hover,\n        padding: spacing(0, 0.5),\n        borderRadius: shadows[2],\n\n        code: {\n          backgroundColor: \"transparent\",\n          padding: 0,\n        },\n      },\n      code: {\n        fontFamily: fonts.MONOSPACE,\n        backgroundColor: palette.action.hover,\n        borderRadius: \"0.2em\",\n        padding: spacing(0, 0.5),\n      },\n      kbd: {\n        display: \"inline-flex\",\n        flex: \"none\",\n        fontFamily: fonts.MONOSPACE,\n        color: palette.text.secondary,\n        backgroundColor: palette.background.default,\n        boxShadow: `inset 0 1px 0 ${palette.action.hover}`,\n        borderRadius: shape.borderRadius,\n        fontSize: typography.body2.fontSize,\n        padding: spacing(0, 0.5),\n        fontWeight: 500,\n        minWidth: 20,\n        alignItems: \"center\",\n        justifyContent: \"center\",\n      },\n      table: {\n        borderCollapse: \"collapse\",\n        borderSpacing: 0,\n        margin: spacing(1, -0.5),\n        border: `1px solid ${palette.divider}`,\n      },\n      \"td, th\": {\n        padding: spacing(0.5),\n        borderBottom: `1px solid ${palette.divider}`,\n        borderRight: `1px solid ${palette.divider}`,\n\n        \"&:last-child\": {\n          borderRight: \"none\",\n        },\n      },\n      th: {\n        whiteSpace: \"nowrap\",\n      },\n      tr: {\n        \"&:last-child\": {\n          \"td, th\": { borderBottom: \"none\" },\n        },\n      },\n    },\n  };\n});\n\ntype Props = {\n  style?: CSSProperties;\n  allowMarkdownHtml?: boolean;\n};\n\nexport default function TextContent(\n  props: PropsWithChildren<Props>,\n): React.ReactElement | ReactNull {\n  const { children, style, allowMarkdownHtml } = props;\n\n  const handleLink = useContext(LinkHandlerContext);\n\n  const linkRenderer = useCallback(\n    (linkProps: { href?: string; children: React.ReactNode }) => {\n      return (\n        <Link\n          color=\"primary\"\n          underline=\"hover\"\n          variant=\"inherit\"\n          href={linkProps.href}\n          rel=\"noopener noreferrer\"\n          onClick={(event) => handleLink(event, linkProps.href ?? \"\")}\n          target=\"_blank\"\n        >\n          {linkProps.children}\n        </Link>\n      );\n    },\n    [handleLink],\n  );\n\n  return (\n    <TextContentRoot style={style}>\n      {typeof children === \"string\" ? (\n        <Markdown\n          rehypePlugins={allowMarkdownHtml === true ? [rehypeRaw] : []}\n          components={{ a: linkRenderer }}\n        >\n          {children}\n        </Markdown>\n      ) : (\n        children\n      )}\n    </TextContentRoot>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext, useContext } from \"react\";\n\nimport { ExtensionNamespace } from \"@foxglove/studio-base/types/Extensions\";\n\nexport type ExtensionMarketplaceDetail = {\n  id: string;\n  name: string;\n  qualifiedName: string;\n  namespace?: ExtensionNamespace;\n  description: string;\n  publisher: string;\n  homepage: string;\n  license: string;\n  version: string;\n  readme?: string;\n  changelog?: string;\n  sha256sum?: string;\n  foxe?: string;\n  keywords?: string[];\n  time?: Record<string, string>;\n};\n\nexport interface ExtensionMarketplace {\n  getAvailableExtensions(): Promise<ExtensionMarketplaceDetail[]>;\n  getMarkdown(url: string): Promise<string>;\n}\n\nconst ExtensionMarketplaceContext = createContext<ExtensionMarketplace | undefined>(undefined);\nExtensionMarketplaceContext.displayName = \"ExtensionMarketplaceContext\";\n\nexport function useExtensionMarketplace(): ExtensionMarketplace {\n  const extensionMarketplace = useContext(ExtensionMarketplaceContext);\n  if (extensionMarketplace == undefined) {\n    throw new Error(\n      \"An ExtensionMarketplaceContext provider is required to useExtensionMarketplace\",\n    );\n  }\n  return extensionMarketplace;\n}\n\nexport default ExtensionMarketplaceContext;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport ChevronLeftIcon from \"@mui/icons-material/ChevronLeft\";\nimport { Button, Link, Tab, Tabs, Typography, Divider } from \"@mui/material\";\nimport { useSnackbar } from \"notistack\";\nimport { useCallback, useState } from \"react\";\nimport { useAsync, useMountedState } from \"react-use\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { Immutable } from \"@foxglove/studio\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport TextContent from \"@foxglove/studio-base/components/TextContent\";\nimport { useAnalytics } from \"@foxglove/studio-base/context/AnalyticsContext\";\nimport { useExtensionCatalog } from \"@foxglove/studio-base/context/ExtensionCatalogContext\";\nimport {\n  ExtensionMarketplaceDetail,\n  useExtensionMarketplace,\n} from \"@foxglove/studio-base/context/ExtensionMarketplaceContext\";\nimport { AppEvent } from \"@foxglove/studio-base/services/IAnalytics\";\nimport isDesktopApp from \"@foxglove/studio-base/util/isDesktopApp\";\n\ntype Props = {\n  installed: boolean;\n  extension: Immutable<ExtensionMarketplaceDetail>;\n  onClose: () => void;\n};\n\nconst useStyles = makeStyles()((theme) => ({\n  backButton: {\n    marginLeft: theme.spacing(-1.5),\n    marginBottom: theme.spacing(1),\n  },\n  installButton: {\n    minWidth: 100,\n  },\n}));\n\nexport function ExtensionDetails({ extension, onClose, installed }: Props): React.ReactElement {\n  const { classes } = useStyles();\n  const [isInstalled, setIsInstalled] = useState(installed);\n  const [activeTab, setActiveTab] = useState<number>(0);\n  const isMounted = useMountedState();\n  const downloadExtension = useExtensionCatalog((state) => state.downloadExtension);\n  const installExtension = useExtensionCatalog((state) => state.installExtension);\n  const uninstallExtension = useExtensionCatalog((state) => state.uninstallExtension);\n  const marketplace = useExtensionMarketplace();\n  const { enqueueSnackbar } = useSnackbar();\n  const readmeUrl = extension.readme;\n  const changelogUrl = extension.changelog;\n  const canInstall = extension.foxe != undefined;\n  const canUninstall = extension.namespace !== \"org\";\n\n  const { value: readmeContent } = useAsync(\n    async () => (readmeUrl != undefined ? await marketplace.getMarkdown(readmeUrl) : \"\"),\n    [marketplace, readmeUrl],\n  );\n  const { value: changelogContent } = useAsync(\n    async () => (changelogUrl != undefined ? await marketplace.getMarkdown(changelogUrl) : \"\"),\n    [marketplace, changelogUrl],\n  );\n\n  const analytics = useAnalytics();\n\n  const install = useCallback(async () => {\n    if (!isDesktopApp()) {\n      enqueueSnackbar(\"Download the desktop app to use marketplace extensions.\", {\n        variant: \"error\",\n      });\n      return;\n    }\n\n    const url = extension.foxe;\n    try {\n      if (url == undefined) {\n        throw new Error(`Cannot install extension ${extension.id}, \"foxe\" URL is missing`);\n      }\n      const data = await downloadExtension(url);\n      await installExtension(\"local\", data);\n      if (isMounted()) {\n        setIsInstalled(true);\n        void analytics.logEvent(AppEvent.EXTENSION_INSTALL, { type: extension.id });\n      }\n    } catch (err) {\n      enqueueSnackbar(`Failed to download extension ${extension.id}. ${err.message}`, {\n        variant: \"error\",\n      });\n    }\n  }, [\n    analytics,\n    downloadExtension,\n    enqueueSnackbar,\n    extension.foxe,\n    extension.id,\n    installExtension,\n    isMounted,\n  ]);\n\n  const uninstall = useCallback(async () => {\n    await uninstallExtension(extension.namespace ?? \"local\", extension.id);\n    if (isMounted()) {\n      setIsInstalled(false);\n      void analytics.logEvent(AppEvent.EXTENSION_UNINSTALL, { type: extension.id });\n    }\n  }, [analytics, extension.id, extension.namespace, isMounted, uninstallExtension]);\n\n  return (\n    <Stack fullHeight flex=\"auto\" gap={1}>\n      <div>\n        <Button\n          className={classes.backButton}\n          onClick={onClose}\n          size=\"small\"\n          startIcon={<ChevronLeftIcon />}\n        >\n          Back\n        </Button>\n        <Typography variant=\"h3\" fontWeight={500}>\n          {extension.name}\n        </Typography>\n      </div>\n\n      <Stack gap={1} alignItems=\"flex-start\">\n        <Stack gap={0.5} paddingBottom={1}>\n          <Stack direction=\"row\" gap={1} alignItems=\"baseline\">\n            <Link\n              variant=\"body2\"\n              color=\"primary\"\n              href={extension.homepage}\n              target=\"_blank\"\n              underline=\"hover\"\n            >\n              {extension.id}\n            </Link>\n            <Typography\n              variant=\"caption\"\n              color=\"text.secondary\"\n            >{`v${extension.version}`}</Typography>\n            <Typography variant=\"caption\" color=\"text.secondary\">\n              {extension.license}\n            </Typography>\n          </Stack>\n          <Typography variant=\"subtitle2\" gutterBottom>\n            {extension.publisher}\n          </Typography>\n          <Typography variant=\"body2\" gutterBottom>\n            {extension.description}\n          </Typography>\n        </Stack>\n        {isInstalled && canUninstall ? (\n          <Button\n            className={classes.installButton}\n            size=\"small\"\n            key=\"uninstall\"\n            color=\"inherit\"\n            variant=\"contained\"\n            onClick={uninstall}\n          >\n            Uninstall\n          </Button>\n        ) : (\n          canInstall && (\n            <Button\n              className={classes.installButton}\n              size=\"small\"\n              key=\"install\"\n              color=\"inherit\"\n              variant=\"contained\"\n              onClick={install}\n            >\n              Install\n            </Button>\n          )\n        )}\n      </Stack>\n\n      <Stack paddingTop={2} style={{ marginLeft: -16, marginRight: -16 }}>\n        <Tabs\n          textColor=\"inherit\"\n          value={activeTab}\n          onChange={(_event, newValue: number) => setActiveTab(newValue)}\n        >\n          <Tab disableRipple label=\"README\" value={0} />\n          <Tab disableRipple label=\"CHANGELOG\" value={1} />\n        </Tabs>\n        <Divider />\n      </Stack>\n\n      <Stack flex=\"auto\" paddingY={2}>\n        {activeTab === 0 && <TextContent>{readmeContent}</TextContent>}\n        {activeTab === 1 && <TextContent>{changelogContent}</TextContent>}\n      </Stack>\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Button, List, ListItem, ListItemButton, ListItemText, Typography } from \"@mui/material\";\nimport { differenceWith, groupBy, isEmpty, keyBy } from \"lodash\";\nimport { useEffect, useMemo, useState } from \"react\";\nimport { useAsyncFn } from \"react-use\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport Log from \"@foxglove/log\";\nimport { Immutable } from \"@foxglove/studio\";\nimport { ExtensionDetails } from \"@foxglove/studio-base/components/ExtensionDetails\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { useExtensionCatalog } from \"@foxglove/studio-base/context/ExtensionCatalogContext\";\nimport {\n  ExtensionMarketplaceDetail,\n  useExtensionMarketplace,\n} from \"@foxglove/studio-base/context/ExtensionMarketplaceContext\";\n\nconst log = Log.getLogger(__filename);\n\nconst useStyles = makeStyles()((theme) => ({\n  listItemButton: {\n    \"&:hover\": { color: theme.palette.primary.main },\n  },\n}));\n\nfunction displayNameForNamespace(namespace: string): string {\n  switch (namespace) {\n    case \"org\":\n      return \"Organization\";\n    default:\n      return namespace;\n  }\n}\n\nfunction ExtensionListEntry(props: {\n  entry: Immutable<ExtensionMarketplaceDetail>;\n  onClick: () => void;\n}): JSX.Element {\n  const {\n    entry: { id, description, name, publisher, version },\n    onClick,\n  } = props;\n  const { classes } = useStyles();\n  return (\n    <ListItem disablePadding key={id}>\n      <ListItemButton className={classes.listItemButton} onClick={onClick}>\n        <ListItemText\n          disableTypography\n          primary={\n            <Stack direction=\"row\" alignItems=\"baseline\" gap={0.5}>\n              <Typography variant=\"subtitle2\" fontWeight={600}>\n                {name}\n              </Typography>\n              <Typography variant=\"caption\" color=\"text.secondary\">\n                {version}\n              </Typography>\n            </Stack>\n          }\n          secondary={\n            <Stack gap={0.5}>\n              <Typography variant=\"body2\" color=\"text.secondary\">\n                {description}\n              </Typography>\n              <Typography color=\"text.primary\" variant=\"body2\">\n                {publisher}\n              </Typography>\n            </Stack>\n          }\n        />\n      </ListItemButton>\n    </ListItem>\n  );\n}\n\nexport default function ExtensionsSettings(): React.ReactElement {\n  const [focusedExtension, setFocusedExtension] = useState<\n    | {\n        installed: boolean;\n        entry: Immutable<ExtensionMarketplaceDetail>;\n      }\n    | undefined\n  >(undefined);\n  const installed = useExtensionCatalog((state) => state.installedExtensions);\n  const marketplace = useExtensionMarketplace();\n\n  const [marketplaceEntries, refreshMarketplaceEntries] = useAsyncFn(\n    async () => await marketplace.getAvailableExtensions(),\n    [marketplace],\n  );\n\n  const marketplaceMap = useMemo(\n    () => keyBy(marketplaceEntries.value ?? [], (entry) => entry.id),\n    [marketplaceEntries],\n  );\n\n  const installedEntries = useMemo(\n    () =>\n      (installed ?? []).map((entry) => {\n        const marketplaceEntry = marketplaceMap[entry.id];\n        if (marketplaceEntry != undefined) {\n          return { ...marketplaceEntry, namespace: entry.namespace };\n        }\n\n        return {\n          id: entry.id,\n          installed: true,\n          name: entry.displayName,\n          displayName: entry.displayName,\n          description: entry.description,\n          publisher: entry.publisher,\n          homepage: entry.homepage,\n          license: entry.license,\n          version: entry.version,\n          keywords: entry.keywords,\n          namespace: entry.namespace,\n          qualifiedName: entry.qualifiedName,\n        };\n      }),\n    [installed, marketplaceMap],\n  );\n\n  const namespacedEntries = useMemo(\n    () => groupBy(installedEntries, (entry) => entry.namespace),\n    [installedEntries],\n  );\n\n  // Hide installed extensions from the list of available extensions\n  const filteredMarketplaceEntries = useMemo(\n    () =>\n      differenceWith(\n        marketplaceEntries.value ?? [],\n        installed ?? [],\n        (a, b) => a.id === b.id && a.namespace === b.namespace,\n      ),\n    [marketplaceEntries, installed],\n  );\n\n  useEffect(() => {\n    refreshMarketplaceEntries().catch((error) => log.error(error));\n  }, [refreshMarketplaceEntries]);\n\n  if (focusedExtension != undefined) {\n    return (\n      <ExtensionDetails\n        installed={focusedExtension.installed}\n        extension={focusedExtension.entry}\n        onClose={() => setFocusedExtension(undefined)}\n      />\n    );\n  }\n\n  if (marketplaceEntries.error) {\n    return (\n      <Stack gap={1} alignItems=\"center\" justifyContent=\"center\" fullHeight>\n        <Typography align=\"center\" variant=\"body2\" color=\"text.secondary\">\n          Failed to fetch the list of available extensions. Check your Internet connection and try\n          again.\n        </Typography>\n        <Button onClick={async () => await refreshMarketplaceEntries()}>\n          Retry Fetching Extensions\n        </Button>\n      </Stack>\n    );\n  }\n\n  return (\n    <Stack gap={1}>\n      {!isEmpty(namespacedEntries) ? (\n        Object.entries(namespacedEntries).map(([namespace, entries]) => (\n          <List key={namespace}>\n            <Stack paddingY={0.25} paddingX={2}>\n              <Typography component=\"li\" variant=\"overline\" color=\"text.secondary\">\n                {displayNameForNamespace(namespace)}\n              </Typography>\n            </Stack>\n            {entries.map((entry) => (\n              <ExtensionListEntry\n                key={`${entry.id}`}\n                entry={entry}\n                onClick={() => setFocusedExtension({ installed: true, entry })}\n              />\n            ))}\n          </List>\n        ))\n      ) : (\n        <List>\n          <ListItem>\n            <ListItemText primary=\"No installed extensions\" />\n          </ListItem>\n        </List>\n      )}\n      <List>\n        <Stack paddingY={0.25} paddingX={2}>\n          <Typography component=\"li\" variant=\"overline\" color=\"text.secondary\">\n            Available\n          </Typography>\n        </Stack>\n        {filteredMarketplaceEntries.map((entry) => (\n          <ExtensionListEntry\n            key={`${entry.id}_${entry.namespace}`}\n            entry={entry}\n            onClick={() => setFocusedExtension({ installed: false, entry })}\n          />\n        ))}\n      </List>\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\n/** Whether links should open in the web app or desktop app */\nexport enum LaunchPreferenceValue {\n  ASK = \"ask\",\n  WEB = \"web\",\n  DESKTOP = \"desktop\",\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport Brightness5Icon from \"@mui/icons-material/Brightness5\";\nimport ComputerIcon from \"@mui/icons-material/Computer\";\nimport DarkModeIcon from \"@mui/icons-material/DarkMode\";\nimport QuestionAnswerOutlinedIcon from \"@mui/icons-material/QuestionAnswerOutlined\";\nimport WebIcon from \"@mui/icons-material/Web\";\nimport {\n  Autocomplete,\n  Checkbox,\n  Divider,\n  FormControl,\n  FormControlLabel,\n  FormLabel,\n  MenuItem,\n  Select,\n  SelectChangeEvent,\n  TextField,\n  ToggleButton,\n  ToggleButtonGroup,\n  ToggleButtonGroupProps,\n  Typography,\n} from \"@mui/material\";\nimport moment from \"moment-timezone\";\nimport { MouseEvent, useCallback, useMemo } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { filterMap } from \"@foxglove/den/collection\";\nimport { AppSetting } from \"@foxglove/studio-base/AppSetting\";\nimport OsContextSingleton from \"@foxglove/studio-base/OsContextSingleton\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { useAppTimeFormat } from \"@foxglove/studio-base/hooks\";\nimport { useAppConfigurationValue } from \"@foxglove/studio-base/hooks/useAppConfigurationValue\";\nimport { Language } from \"@foxglove/studio-base/i18n\";\nimport { reportError } from \"@foxglove/studio-base/reportError\";\nimport { LaunchPreferenceValue } from \"@foxglove/studio-base/types/LaunchPreferenceValue\";\nimport { TimeDisplayMethod } from \"@foxglove/studio-base/types/panels\";\nimport { formatTime } from \"@foxglove/studio-base/util/formatTime\";\nimport { formatTimeRaw } from \"@foxglove/studio-base/util/time\";\n\nconst MESSAGE_RATES = [1, 3, 5, 10, 15, 20, 30, 60];\nconst LANGUAGE_OPTIONS: { key: Language; value: string }[] = [\n  { key: \"en\", value: \"English\" },\n  { key: \"zh\", value: \"中文\" },\n  { key: \"ja\", value: \"日本語\" },\n];\n\nconst useStyles = makeStyles()((theme) => ({\n  autocompleteInput: {\n    \"&.MuiOutlinedInput-input\": {\n      padding: 0,\n    },\n  },\n  checkbox: {\n    \"&.MuiCheckbox-root\": {\n      paddingTop: 0,\n    },\n  },\n  formControlLabel: {\n    \"&.MuiFormControlLabel-root\": {\n      alignItems: \"start\",\n    },\n  },\n  toggleButton: {\n    display: \"flex !important\",\n    flexDirection: \"column\",\n    gap: theme.spacing(0.75),\n    lineHeight: \"1 !important\",\n  },\n}));\n\nfunction formatTimezone(name: string) {\n  const tz = moment.tz(name);\n  const zoneAbbr = tz.zoneAbbr();\n  const offset = tz.utcOffset();\n  const offsetStr =\n    (offset >= 0 ? \"+\" : \"\") + moment.duration(offset, \"minutes\").format(\"hh:mm\", { trim: false });\n  if (name === zoneAbbr) {\n    return `${zoneAbbr} (${offsetStr})`;\n  }\n  return `${name} (${zoneAbbr}, ${offsetStr})`;\n}\n\nexport function ColorSchemeSettings(): JSX.Element {\n  const { classes } = useStyles();\n  const [colorScheme = \"system\", setColorScheme] = useAppConfigurationValue<string>(\n    AppSetting.COLOR_SCHEME,\n  );\n  const { t } = useTranslation(\"appSettings\");\n\n  const handleChange = useCallback(\n    (_event: MouseEvent<HTMLElement>, value?: string) => {\n      if (value != undefined) {\n        void setColorScheme(value);\n      }\n    },\n    [setColorScheme],\n  );\n\n  return (\n    <Stack>\n      <FormLabel>{t(\"colorScheme\")}:</FormLabel>\n      <ToggleButtonGroup\n        color=\"primary\"\n        size=\"small\"\n        fullWidth\n        exclusive\n        value={colorScheme}\n        onChange={handleChange}\n      >\n        <ToggleButton className={classes.toggleButton} value=\"dark\">\n          <DarkModeIcon /> {t(\"dark\")}\n        </ToggleButton>\n        <ToggleButton className={classes.toggleButton} value=\"light\">\n          <Brightness5Icon /> {t(\"light\")}\n        </ToggleButton>\n        <ToggleButton className={classes.toggleButton} value=\"system\">\n          <ComputerIcon /> {t(\"followSystem\")}\n        </ToggleButton>\n      </ToggleButtonGroup>\n    </Stack>\n  );\n}\n\nexport function TimezoneSettings(): React.ReactElement {\n  type Option = { key: string; label: string; data?: string; divider?: boolean };\n\n  const { classes } = useStyles();\n\n  const { t } = useTranslation(\"appSettings\");\n  const [timezone, setTimezone] = useAppConfigurationValue<string>(AppSetting.TIMEZONE);\n  const detectItem: Option = useMemo(\n    () => ({\n      key: \"detect\",\n      label: `Detect from system: ${formatTimezone(moment.tz.guess())}`,\n      data: undefined,\n    }),\n    [],\n  );\n  const fixedItems: Option[] = useMemo(\n    () => [\n      detectItem,\n      { key: \"zone:UTC\", label: `${formatTimezone(\"UTC\")}`, data: \"UTC\" },\n      {\n        key: \"sep\",\n        label: \"\",\n        divider: true,\n      },\n    ],\n    [detectItem],\n  );\n\n  const timezoneItems: Option[] = useMemo(\n    () =>\n      filterMap(moment.tz.names(), (name) => {\n        // UTC is always hoisted to the top in fixedItems\n        if (name === \"UTC\") {\n          return undefined;\n        }\n        return { key: `zone:${name}`, label: formatTimezone(name), data: name };\n      }),\n    [],\n  );\n\n  const allItems = useMemo(() => [...fixedItems, ...timezoneItems], [fixedItems, timezoneItems]);\n\n  const selectedItem = useMemo(\n    () => (timezone != undefined && allItems.find((item) => item.data === timezone)) || detectItem,\n    [allItems, detectItem, timezone],\n  );\n\n  return (\n    <FormControl fullWidth>\n      <Typography color=\"text.secondary\" marginBottom={0.5}>\n        {t(\"displayTimestampsIn\")}:\n      </Typography>\n      <Autocomplete\n        options={[...fixedItems, ...timezoneItems]}\n        value={selectedItem}\n        renderOption={(props, option: Option) =>\n          option.divider === true ? (\n            <Divider key={option.key} />\n          ) : (\n            <li {...props} key={option.key}>\n              {option.label}\n            </li>\n          )\n        }\n        renderInput={(params) => (\n          <TextField\n            {...params}\n            inputProps={{ ...params.inputProps, className: classes.autocompleteInput }}\n          />\n        )}\n        onChange={(_event, value) => void setTimezone(value?.data)}\n      />\n    </FormControl>\n  );\n}\n\nexport function TimeFormat({\n  orientation = \"vertical\",\n}: {\n  orientation?: ToggleButtonGroupProps[\"orientation\"];\n}): React.ReactElement {\n  const { timeFormat, setTimeFormat } = useAppTimeFormat();\n\n  const { t } = useTranslation(\"appSettings\");\n\n  const [timezone] = useAppConfigurationValue<string>(AppSetting.TIMEZONE);\n\n  const exampleTime = { sec: 946713600, nsec: 0 };\n\n  return (\n    <Stack>\n      <FormLabel>{t(\"timestampFormat\")}:</FormLabel>\n      <ToggleButtonGroup\n        color=\"primary\"\n        size=\"small\"\n        orientation={orientation}\n        fullWidth\n        exclusive\n        value={timeFormat}\n        onChange={(_, value?: TimeDisplayMethod) => value != undefined && void setTimeFormat(value)}\n      >\n        <ToggleButton value=\"SEC\" data-testid=\"timeformat-seconds\">\n          {formatTimeRaw(exampleTime)}\n        </ToggleButton>\n        <ToggleButton value=\"TOD\" data-testid=\"timeformat-local\">\n          {formatTime(exampleTime, timezone)}\n        </ToggleButton>\n      </ToggleButtonGroup>\n    </Stack>\n  );\n}\n\nexport function LaunchDefault(): React.ReactElement {\n  const { classes } = useStyles();\n  const { t } = useTranslation(\"appSettings\");\n  const [preference, setPreference] = useAppConfigurationValue<string | undefined>(\n    AppSetting.LAUNCH_PREFERENCE,\n  );\n  let sanitizedPreference: LaunchPreferenceValue;\n  switch (preference) {\n    case LaunchPreferenceValue.WEB:\n    case LaunchPreferenceValue.DESKTOP:\n    case LaunchPreferenceValue.ASK:\n      sanitizedPreference = preference;\n      break;\n    default:\n      sanitizedPreference = LaunchPreferenceValue.WEB;\n  }\n\n  return (\n    <Stack>\n      <FormLabel>{t(\"openLinksIn\")}:</FormLabel>\n      <ToggleButtonGroup\n        color=\"primary\"\n        size=\"small\"\n        fullWidth\n        exclusive\n        value={sanitizedPreference}\n        onChange={(_, value?: string) => value != undefined && void setPreference(value)}\n      >\n        <ToggleButton value={LaunchPreferenceValue.WEB} className={classes.toggleButton}>\n          <WebIcon /> {t(\"webApp\")}\n        </ToggleButton>\n        <ToggleButton value={LaunchPreferenceValue.DESKTOP} className={classes.toggleButton}>\n          <ComputerIcon /> {t(\"desktopApp\")}\n        </ToggleButton>\n        <ToggleButton value={LaunchPreferenceValue.ASK} className={classes.toggleButton}>\n          <QuestionAnswerOutlinedIcon /> {t(\"askEachTime\")}\n        </ToggleButton>\n      </ToggleButtonGroup>\n    </Stack>\n  );\n}\n\nexport function MessageFramerate(): React.ReactElement {\n  const { t } = useTranslation(\"appSettings\");\n  const [messageRate, setMessageRate] = useAppConfigurationValue<number>(AppSetting.MESSAGE_RATE);\n  const options = useMemo(\n    () => MESSAGE_RATES.map((rate) => ({ key: rate, text: `${rate}`, data: rate })),\n    [],\n  );\n\n  return (\n    <Stack>\n      <FormLabel>{t(\"messageRate\")} (Hz):</FormLabel>\n      <Select\n        value={messageRate ?? 60}\n        fullWidth\n        onChange={(event) => void setMessageRate(event.target.value as number)}\n      >\n        {options.map((option) => (\n          <MenuItem key={option.key} value={option.key}>\n            {option.text}\n          </MenuItem>\n        ))}\n      </Select>\n    </Stack>\n  );\n}\n\nexport function AutoUpdate(): React.ReactElement {\n  const [updatesEnabled = true, setUpdatedEnabled] = useAppConfigurationValue<boolean>(\n    AppSetting.UPDATES_ENABLED,\n  );\n\n  const { classes } = useStyles();\n\n  return (\n    <>\n      <Typography color=\"text.secondary\" marginBottom={0.5}>\n        Updates:\n      </Typography>\n      <FormControlLabel\n        className={classes.formControlLabel}\n        control={\n          <Checkbox\n            className={classes.checkbox}\n            checked={updatesEnabled}\n            onChange={(_event, checked) => void setUpdatedEnabled(checked)}\n          />\n        }\n        label=\"Automatically install updates\"\n      />\n    </>\n  );\n}\n\nexport function RosPackagePath(): React.ReactElement {\n  const [rosPackagePath, setRosPackagePath] = useAppConfigurationValue<string>(\n    AppSetting.ROS_PACKAGE_PATH,\n  );\n\n  const rosPackagePathPlaceholder = useMemo(\n    () => OsContextSingleton?.getEnvVar(\"ROS_PACKAGE_PATH\"),\n    [],\n  );\n\n  return (\n    <TextField\n      fullWidth\n      label=\"ROS_PACKAGE_PATH\"\n      placeholder={rosPackagePathPlaceholder}\n      value={rosPackagePath ?? \"\"}\n      onChange={(event) => void setRosPackagePath(event.target.value)}\n    />\n  );\n}\n\nexport function LanguageSettings(): React.ReactElement {\n  const { t, i18n } = useTranslation(\"appSettings\");\n  const [selectedLanguage = \"en\", setSelectedLanguage] = useAppConfigurationValue<Language>(\n    AppSetting.LANGUAGE,\n  );\n  const onChangeLanguage = useCallback(\n    (event: SelectChangeEvent<Language>) => {\n      const lang = event.target.value as Language;\n      void setSelectedLanguage(lang);\n      i18n.changeLanguage(lang).catch((error) => {\n        console.error(\"Failed to switch languages\", error);\n        reportError(error as Error);\n      });\n    },\n    [i18n, setSelectedLanguage],\n  );\n  const options: { key: string; text: string; data: string }[] = useMemo(\n    () =>\n      LANGUAGE_OPTIONS.map((language) => ({\n        key: language.key,\n        text: `${language.value}`,\n        data: language.key,\n      })),\n    [],\n  );\n\n  return (\n    <Stack>\n      <FormLabel>{t(\"language\")}:</FormLabel>\n      <Select<Language> value={selectedLanguage} fullWidth onChange={onChangeLanguage}>\n        {options.map((option) => (\n          <MenuItem key={option.key} value={option.key}>\n            {option.text}\n          </MenuItem>\n        ))}\n      </Select>\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport CloseIcon from \"@mui/icons-material/Close\";\nimport InfoOutlinedIcon from \"@mui/icons-material/InfoOutlined\";\nimport WarningAmberIcon from \"@mui/icons-material/WarningAmber\";\nimport {\n  Alert,\n  Button,\n  Checkbox,\n  Dialog,\n  DialogActions,\n  DialogProps,\n  FormControlLabel,\n  IconButton,\n  Link,\n  Tab,\n  Tabs,\n  Typography,\n  useMediaQuery,\n} from \"@mui/material\";\nimport { MouseEvent, SyntheticEvent, useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { AppSetting } from \"@foxglove/studio-base/AppSetting\";\nimport OsContextSingleton from \"@foxglove/studio-base/OsContextSingleton\";\nimport CopyButton from \"@foxglove/studio-base/components/CopyButton\";\nimport { ExperimentalFeatureSettings } from \"@foxglove/studio-base/components/ExperimentalFeatureSettings\";\nimport ExtensionsSettings from \"@foxglove/studio-base/components/ExtensionsSettings\";\nimport FoxgloveLogoText from \"@foxglove/studio-base/components/FoxgloveLogoText\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport {\n  useWorkspaceStore,\n  WorkspaceContextStore,\n} from \"@foxglove/studio-base/context/Workspace/WorkspaceContext\";\nimport { useAppConfigurationValue } from \"@foxglove/studio-base/hooks\";\nimport isDesktopApp from \"@foxglove/studio-base/util/isDesktopApp\";\n\nimport {\n  AutoUpdate,\n  ColorSchemeSettings,\n  LanguageSettings,\n  LaunchDefault,\n  MessageFramerate,\n  RosPackagePath,\n  TimeFormat,\n  TimezoneSettings,\n} from \"./settings\";\n\nconst useStyles = makeStyles()((theme) => ({\n  layoutGrid: {\n    display: \"grid\",\n    gap: theme.spacing(2),\n    height: \"70vh\",\n    paddingLeft: theme.spacing(1),\n    overflowY: \"hidden\",\n    [theme.breakpoints.up(\"sm\")]: {\n      gridTemplateColumns: \"auto minmax(0, 1fr)\",\n    },\n  },\n  logo: {\n    width: 212,\n    height: \"auto\",\n    marginLeft: theme.spacing(-1),\n  },\n  tabPanel: {\n    display: \"none\",\n    marginRight: \"-100%\",\n    width: \"100%\",\n    padding: theme.spacing(0, 4, 4),\n  },\n  tabPanelActive: {\n    display: \"block\",\n  },\n  checkbox: {\n    \"&.MuiCheckbox-root\": {\n      paddingTop: 0,\n    },\n  },\n  dialogActions: {\n    position: \"sticky\",\n    backgroundColor: theme.palette.background.paper,\n    borderTop: `${theme.palette.divider} 1px solid`,\n    padding: theme.spacing(1),\n    bottom: 0,\n  },\n  formControlLabel: {\n    \"&.MuiFormControlLabel-root\": {\n      alignItems: \"start\",\n    },\n  },\n  tab: {\n    svg: {\n      fontSize: \"inherit\",\n    },\n    \"> span, > .MuiSvgIcon-root\": {\n      display: \"flex\",\n      color: theme.palette.primary.main,\n      marginRight: theme.spacing(1.5),\n      height: theme.typography.pxToRem(21),\n      width: theme.typography.pxToRem(21),\n    },\n    [theme.breakpoints.up(\"sm\")]: {\n      textAlign: \"right\",\n      flexDirection: \"row\",\n      justifyContent: \"flex-start\",\n      alignItems: \"center\",\n      minHeight: \"auto\",\n      paddingTop: theme.spacing(1.5),\n      paddingBottom: theme.spacing(1.5),\n    },\n  },\n  indicator: {\n    [theme.breakpoints.up(\"sm\")]: {\n      right: 0,\n      width: \"100%\",\n      backgroundColor: theme.palette.action.hover,\n      borderRadius: theme.shape.borderRadius,\n    },\n  },\n}));\n\ntype SectionKey = \"resources\" | \"products\" | \"contact\" | \"legal\";\n\nexport const aboutItems: Map<\n  SectionKey,\n  {\n    subheader: string;\n    links: { title: string; url?: string }[];\n  }\n> = new Map([\n  [\n    \"resources\",\n    {\n      subheader: \"External resources\",\n      links: [\n        ...(isDesktopApp() ? [] : [{ title: \"Desktop app\", url: \"https://foxglove.dev/download\" }]),\n        { title: \"Browse docs\", url: \"https://foxglove.dev/docs\" },\n        { title: \"Join our community\", url: \"https://foxglove.dev/community\" },\n      ],\n    },\n  ],\n  [\n    \"products\",\n    {\n      subheader: \"Products\",\n      links: [\n        { title: \"Foxglove Studio\", url: \"https://foxglove.dev/studio\" },\n        { title: \"Foxglove Data Platform\", url: \"https://foxglove.dev/data-platform\" },\n      ],\n    },\n  ],\n  [\n    \"contact\",\n    {\n      subheader: \"Contact\",\n      links: [\n        { title: \"Give feedback\", url: \"https://foxglove.dev/contact\" },\n        { title: \"Schedule a demo\", url: \"https://foxglove.dev/demo\" },\n      ],\n    },\n  ],\n  [\n    \"legal\",\n    {\n      subheader: \"Legal\",\n      links: [\n        { title: \"License terms\", url: \"https://foxglove.dev/legal/studio-license\" },\n        { title: \"Privacy policy\", url: \"https://foxglove.dev/legal/privacy\" },\n      ],\n    },\n  ],\n]);\n\nexport type AppSettingsTab =\n  | \"general\"\n  | \"privacy\"\n  | \"extensions\"\n  | \"experimental-features\"\n  | \"about\";\n\nconst selectWorkspaceInitialActiveTab = (store: WorkspaceContextStore) =>\n  store.dialogs.preferences.initialTab;\n\nexport function AppSettingsDialog(\n  props: DialogProps & { activeTab?: AppSettingsTab },\n): JSX.Element {\n  const { t } = useTranslation(\"appSettings\");\n  const { activeTab: _activeTab } = props;\n  const initialActiveTab = useWorkspaceStore(selectWorkspaceInitialActiveTab);\n  const [activeTab, setActiveTab] = useState<AppSettingsTab>(\n    _activeTab ?? initialActiveTab ?? \"general\",\n  );\n  const [crashReportingEnabled, setCrashReportingEnabled] = useAppConfigurationValue<boolean>(\n    AppSetting.CRASH_REPORTING_ENABLED,\n  );\n  const [telemetryEnabled, setTelemetryEnabled] = useAppConfigurationValue<boolean>(\n    AppSetting.TELEMETRY_ENABLED,\n  );\n  const { classes, cx, theme } = useStyles();\n  const smUp = useMediaQuery(theme.breakpoints.up(\"sm\"));\n\n  // automatic updates are a desktop-only setting\n  //\n  // electron-updater does not provide a way to detect if we are on a supported update platform\n  // so we hard-code linux as an _unsupported_ auto-update platform since we cannot auto-update\n  // with our .deb package install method on linux.\n  const supportsAppUpdates = isDesktopApp() && OsContextSingleton?.platform !== \"linux\";\n\n  const handleTabChange = (_event: SyntheticEvent, newValue: AppSettingsTab) => {\n    setActiveTab(newValue);\n  };\n\n  const handleClose = (event: MouseEvent<HTMLElement>) => {\n    if (props.onClose != undefined) {\n      props.onClose(event, \"backdropClick\");\n    }\n  };\n\n  return (\n    <Dialog {...props} fullWidth maxWidth=\"md\">\n      <Stack\n        direction=\"row\"\n        justifyContent=\"space-between\"\n        alignItems=\"center\"\n        paddingX={3}\n        paddingY={2}\n      >\n        <Typography variant=\"h3\" fontWeight={600}>\n          {t(\"settings\")}\n        </Typography>\n        <IconButton edge=\"end\" onClick={handleClose}>\n          <CloseIcon />\n        </IconButton>\n      </Stack>\n      <div className={classes.layoutGrid}>\n        <Tabs\n          classes={{ indicator: classes.indicator }}\n          value={activeTab}\n          orientation={smUp ? \"vertical\" : \"horizontal\"}\n          onChange={handleTabChange}\n        >\n          <Tab className={classes.tab} label={t(\"general\")} value=\"general\" />\n          <Tab className={classes.tab} label={t(\"privacy\")} value=\"privacy\" />\n          <Tab className={classes.tab} label={t(\"extensions\")} value=\"extensions\" />\n          <Tab\n            className={classes.tab}\n            label={t(\"experimentalFeatures\")}\n            value=\"experimental-features\"\n          />\n          <Tab className={classes.tab} label={t(\"about\")} value=\"about\" />\n        </Tabs>\n        <Stack direction=\"row\" fullHeight overflowY=\"auto\">\n          <section\n            className={cx(classes.tabPanel, {\n              [classes.tabPanelActive]: activeTab === \"general\",\n            })}\n          >\n            <Stack gap={2}>\n              <ColorSchemeSettings />\n              <TimezoneSettings />\n              <TimeFormat orientation={smUp ? \"horizontal\" : \"vertical\"} />\n              <MessageFramerate />\n              <LanguageSettings />\n              {supportsAppUpdates && <AutoUpdate />}\n              {!isDesktopApp() && <LaunchDefault />}\n              {isDesktopApp() && <RosPackagePath />}\n            </Stack>\n          </section>\n\n          <section\n            className={cx(classes.tabPanel, {\n              [classes.tabPanelActive]: activeTab === \"privacy\",\n            })}\n          >\n            <Stack gap={2}>\n              <Alert color=\"info\" icon={<InfoOutlinedIcon />}>\n                {t(\"privacyDescription\")}\n              </Alert>\n              <Stack gap={0.5} paddingLeft={2}>\n                <FormControlLabel\n                  className={classes.formControlLabel}\n                  control={\n                    <Checkbox\n                      className={classes.checkbox}\n                      checked={telemetryEnabled ?? true}\n                      onChange={(_event, checked) => void setTelemetryEnabled(checked)}\n                    />\n                  }\n                  label={t(\"sendAnonymizedUsageData\")}\n                />\n                <FormControlLabel\n                  className={classes.formControlLabel}\n                  control={\n                    <Checkbox\n                      className={classes.checkbox}\n                      checked={crashReportingEnabled ?? true}\n                      onChange={(_event, checked) => void setCrashReportingEnabled(checked)}\n                    />\n                  }\n                  label={t(\"sendAnonymizedCrashReports\")}\n                />\n              </Stack>\n            </Stack>\n          </section>\n\n          <section\n            className={cx(classes.tabPanel, {\n              [classes.tabPanelActive]: activeTab === \"extensions\",\n            })}\n          >\n            <Stack gap={2}>\n              <ExtensionsSettings />\n            </Stack>\n          </section>\n\n          <section\n            className={cx(classes.tabPanel, {\n              [classes.tabPanelActive]: activeTab === \"experimental-features\",\n            })}\n          >\n            <Stack gap={2}>\n              <Alert color=\"warning\" icon={<WarningAmberIcon />}>\n                {t(\"experimentalFeaturesDescription\")}\n              </Alert>\n              <Stack paddingLeft={2}>\n                <ExperimentalFeatureSettings />\n              </Stack>\n            </Stack>\n          </section>\n\n          <section\n            className={cx(classes.tabPanel, { [classes.tabPanelActive]: activeTab === \"about\" })}\n          >\n            <Stack gap={2} alignItems=\"flex-start\">\n              <header>\n                <FoxgloveLogoText color=\"primary\" className={classes.logo} />\n              </header>\n              <Stack direction=\"row\" alignItems=\"center\" gap={1}>\n                <Typography variant=\"body2\">\n                  Foxglove Studio version {FOXGLOVE_STUDIO_VERSION}\n                </Typography>\n                <CopyButton\n                  size=\"small\"\n                  getText={() => FOXGLOVE_STUDIO_VERSION?.toString() ?? \"\"}\n                />\n              </Stack>\n              {[\n                aboutItems.get(\"resources\"),\n                aboutItems.get(\"products\"),\n                aboutItems.get(\"contact\"),\n                aboutItems.get(\"legal\"),\n              ].map((item) => {\n                return (\n                  <Stack key={item?.subheader} gap={1}>\n                    {item?.subheader && <Typography>{item.subheader}</Typography>}\n                    {item?.links.map((link) => (\n                      <Link\n                        variant=\"body2\"\n                        underline=\"hover\"\n                        key={link.title}\n                        data-testid={link.title}\n                        href={link.url}\n                        target=\"_blank\"\n                      >\n                        {link.title}\n                      </Link>\n                    ))}\n                  </Stack>\n                );\n              })}\n            </Stack>\n          </section>\n        </Stack>\n      </div>\n      <DialogActions className={classes.dialogActions}>\n        <Button onClick={handleClose}>Done</Button>\n      </DialogActions>\n    </Dialog>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { AppSettingsDialog } from \"@foxglove/studio-base/components/AppSettingsDialog\";\nimport {\n  useWorkspaceStore,\n  WorkspaceContextStore,\n} from \"@foxglove/studio-base/context/Workspace/WorkspaceContext\";\n\nimport { useWorkspaceActions } from \"../context/Workspace/useWorkspaceActions\";\n\nconst selectWorkspacePrefsDialogOpen = (store: WorkspaceContextStore) =>\n  store.dialogs.preferences.open;\n\n/**\n * Encapsulates dialogs shown and controlled at workspace level.\n */\nexport function WorkspaceDialogs(): JSX.Element {\n  const prefsDialogOpen = useWorkspaceStore(selectWorkspacePrefsDialogOpen);\n  const { dialogActions } = useWorkspaceActions();\n\n  return (\n    <>\n      {prefsDialogOpen && (\n        <AppSettingsDialog\n          id=\"app-settings-dialog\"\n          open\n          onClose={() => dialogActions.preferences.close()}\n        />\n      )}\n    </>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext, useContext } from \"react\";\n\nexport type NativeAppMenuEvent =\n  | \"open\"\n  | \"open-file\"\n  | \"open-connection\"\n  | \"open-demo\"\n  | \"open-help-about\"\n  | \"open-help-docs\"\n  | \"open-help-general\"\n  | \"open-help-slack\";\n\ntype Handler = () => void;\n\nexport interface INativeAppMenu {\n  addFileEntry(name: string, handler: Handler): void;\n  removeFileEntry(name: string): void;\n\n  on(name: NativeAppMenuEvent, handler: Handler): void;\n  off(name: NativeAppMenuEvent, handler: Handler): void;\n}\n\nconst NativeAppMenuContext = createContext<INativeAppMenu | undefined>(undefined);\nNativeAppMenuContext.displayName = \"NativeAppMenuContext\";\n\nexport function useNativeAppMenu(): INativeAppMenu | undefined {\n  return useContext(NativeAppMenuContext);\n}\n\nexport default NativeAppMenuContext;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useEffect } from \"react\";\n\nimport { useSessionStorageValue } from \"@foxglove/hooks\";\nimport { AppSetting } from \"@foxglove/studio-base/AppSetting\";\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport { LaunchPreferenceValue } from \"@foxglove/studio-base/types/LaunchPreferenceValue\";\nimport isDesktopApp from \"@foxglove/studio-base/util/isDesktopApp\";\n\nconst selectHasUrlState = (ctx: MessagePipelineContext) => ctx.playerState.urlState != undefined;\n\nexport function useDefaultWebLaunchPreference(): void {\n  const hasUrlState = useMessagePipeline(selectHasUrlState);\n  const [launchPreference, setLaunchPreference] = useSessionStorageValue(\n    AppSetting.LAUNCH_PREFERENCE,\n  );\n\n  // Set a sessionStorage preference for web if we have a stable URL state.\n  // This allows us to avoid asking for the preference immediately on\n  // launch of an empty session and makes refreshes do the right thing.\n  useEffect(() => {\n    if (isDesktopApp()) {\n      return;\n    }\n\n    if (hasUrlState && !launchPreference) {\n      setLaunchPreference(LaunchPreferenceValue.WEB);\n    }\n  }, [launchPreference, setLaunchPreference, hasUrlState]);\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useEffect, useState } from \"react\";\n\nimport Logger from \"@foxglove/log\";\n\nconst log = Logger.getLogger(__filename);\n\n// Hook to get any files the main thread has told us to open\n// See the comments in main thread implementation on how the files are injected into this input\nexport default function useElectronFilesToOpen(): FileList | undefined {\n  const [input] = useState(() =>\n    document.querySelector<HTMLInputElement>(\"#electron-open-file-input\"),\n  );\n\n  const [fileList, setFileList] = useState<FileList | undefined>(input?.files ?? undefined);\n\n  useEffect(() => {\n    if (!input) {\n      log.info(\n        \"#electron-open-file-input not found - native open-file support will not be available\",\n      );\n      return;\n    }\n\n    const update = () => {\n      setFileList(input.files ?? undefined);\n    };\n\n    // handle any new file open requests\n    input.addEventListener(\"change\", update);\n    return () => {\n      input.removeEventListener(\"change\", update);\n    };\n  }, [input]);\n\n  return fileList;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useEffect, useMemo, useState } from \"react\";\n\nimport Log from \"@foxglove/log\";\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport { useCurrentLayoutActions } from \"@foxglove/studio-base/context/CurrentLayoutContext\";\nimport { useCurrentUser } from \"@foxglove/studio-base/context/CurrentUserContext\";\nimport { EventsStore, useEvents } from \"@foxglove/studio-base/context/EventsContext\";\nimport { usePlayerSelection } from \"@foxglove/studio-base/context/PlayerSelectionContext\";\nimport { PlayerPresence } from \"@foxglove/studio-base/players/types\";\nimport { AppURLState, parseAppURLState } from \"@foxglove/studio-base/util/appURLState\";\n\nconst selectPlayerPresence = (ctx: MessagePipelineContext) => ctx.playerState.presence;\nconst selectSeek = (ctx: MessagePipelineContext) => ctx.seekPlayback;\nconst selectSelectEvent = (store: EventsStore) => store.selectEvent;\n\nconst log = Log.getLogger(__filename);\n\n/*\n * Separation of sync functions is necessary to prevent memory leak from context kept in\n * useEffect closures. Notably `seekPlayback` being attached to the context of the `useEffect`\n * closures that don't use it and aren't updated when it changes. Otherwise the old memoized callbacks\n * of these functions are kept in React state with the context that includes the old player, preventing\n * garbage collection of the old player.\n */\n\nfunction useSyncSourceFromUrl(\n  targetUrlState: AppURLState | undefined,\n  { currentUserRequired }: { currentUserRequired: boolean },\n) {\n  const [unappliedSourceArgs, setUnappliedSourceArgs] = useState(\n    targetUrlState ? { ds: targetUrlState.ds, dsParams: targetUrlState.dsParams } : undefined,\n  );\n  const { selectSource } = usePlayerSelection();\n  const selectEvent = useEvents(selectSelectEvent);\n  const { currentUser } = useCurrentUser();\n  // Load data source from URL.\n  useEffect(() => {\n    if (!unappliedSourceArgs) {\n      return;\n    }\n\n    // Wait for current user session if one is required for this source.\n    if (currentUserRequired && !currentUser) {\n      return;\n    }\n\n    // Apply any available datasource args\n    if (unappliedSourceArgs.ds) {\n      log.debug(\"Initialising source from url\", unappliedSourceArgs);\n      selectSource(unappliedSourceArgs.ds, {\n        type: \"connection\",\n        params: unappliedSourceArgs.dsParams,\n      });\n      selectEvent(unappliedSourceArgs.dsParams?.eventId);\n      setUnappliedSourceArgs({ ds: undefined, dsParams: undefined });\n    }\n  }, [\n    currentUser,\n    currentUserRequired,\n    selectEvent,\n    selectSource,\n    unappliedSourceArgs,\n    setUnappliedSourceArgs,\n  ]);\n}\nfunction useSyncLayoutFromUrl(\n  targetUrlState: AppURLState | undefined,\n  { currentUserRequired }: { currentUserRequired: boolean },\n) {\n  const { setSelectedLayoutId } = useCurrentLayoutActions();\n  const playerPresence = useMessagePipeline(selectPlayerPresence);\n  const [unappliedLayoutArgs, setUnappliedLayoutArgs] = useState(\n    targetUrlState ? { layoutId: targetUrlState.layoutId } : undefined,\n  );\n  // Select layout from URL.\n  useEffect(() => {\n    if (!unappliedLayoutArgs?.layoutId) {\n      return;\n    }\n\n    // If our datasource requires a current user then wait until the player is\n    // available to load the layout since we may need to sync layouts first and\n    // that's only possible after the user has logged in.\n    if (currentUserRequired && playerPresence !== PlayerPresence.PRESENT) {\n      return;\n    }\n\n    log.debug(`Initializing layout from url: ${unappliedLayoutArgs.layoutId}`);\n    setSelectedLayoutId(unappliedLayoutArgs.layoutId);\n    setUnappliedLayoutArgs({ layoutId: undefined });\n  }, [currentUserRequired, playerPresence, setSelectedLayoutId, unappliedLayoutArgs?.layoutId]);\n}\n\nfunction useSyncTimeFromUrl(targetUrlState: AppURLState | undefined) {\n  const seekPlayback = useMessagePipeline(selectSeek);\n  const playerPresence = useMessagePipeline(selectPlayerPresence);\n  const [unappliedTime, setUnappliedTime] = useState(\n    targetUrlState ? { time: targetUrlState.time } : undefined,\n  );\n  // Seek to time in URL.\n  useEffect(() => {\n    if (unappliedTime?.time == undefined || !seekPlayback) {\n      return;\n    }\n\n    // Wait until player is ready before we try to seek.\n    if (playerPresence !== PlayerPresence.PRESENT) {\n      return;\n    }\n\n    log.debug(`Seeking to url time:`, unappliedTime.time);\n    seekPlayback(unappliedTime.time);\n    setUnappliedTime({ time: undefined });\n  }, [playerPresence, seekPlayback, unappliedTime]);\n}\n\n/**\n * Ensure only one copy of the hook is mounted so we don't trigger side effects like selectSource\n * more than once.\n */\nlet useInitialDeepLinkStateMounted = false;\n/**\n * Restores our session state from any deep link we were passed on startup.\n */\nexport function useInitialDeepLinkState(deepLinks: readonly string[]): {\n  currentUserRequired: boolean;\n} {\n  useEffect(() => {\n    if (useInitialDeepLinkStateMounted) {\n      throw new Error(\"Invariant: only one copy of useInitialDeepLinkState may be mounted\");\n    }\n    useInitialDeepLinkStateMounted = true;\n    return () => {\n      useInitialDeepLinkStateMounted = false;\n    };\n  }, []);\n\n  const { availableSources } = usePlayerSelection();\n  const targetUrlState = useMemo(\n    () => (deepLinks[0] ? parseAppURLState(new URL(deepLinks[0])) : undefined),\n    [deepLinks],\n  );\n\n  // Maybe this should be abstracted somewhere but that would require a\n  // more intimate interface with this hook and the player selection logic.\n  const currentUserRequiredParam = useMemo(() => {\n    let currentUserRequired = false;\n    const ds = targetUrlState?.ds;\n    const foundSource =\n      ds == undefined\n        ? undefined\n        : availableSources.find((source) => source.id === ds || source.legacyIds?.includes(ds));\n    if (foundSource) {\n      currentUserRequired = foundSource.currentUserRequired ?? false;\n    }\n\n    return { currentUserRequired };\n  }, [targetUrlState?.ds, availableSources]);\n  useSyncSourceFromUrl(targetUrlState, currentUserRequiredParam);\n  useSyncLayoutFromUrl(targetUrlState, currentUserRequiredParam);\n  useSyncTimeFromUrl(targetUrlState);\n  return currentUserRequiredParam;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useEffect } from \"react\";\n\nimport {\n  NativeAppMenuEvent,\n  useNativeAppMenu,\n} from \"@foxglove/studio-base/context/NativeAppMenuContext\";\n\ntype EventHandler = () => void;\n\nexport default function useNativeAppMenuEvent(\n  eventName: NativeAppMenuEvent,\n  handler: EventHandler,\n): void {\n  const nativeAppMenu = useNativeAppMenu();\n\n  useEffect(() => {\n    if (!nativeAppMenu) {\n      return;\n    }\n\n    const fn = handler;\n    nativeAppMenu.on(eventName, fn);\n\n    return () => {\n      nativeAppMenu.off(eventName, fn);\n    };\n  }, [eventName, handler, nativeAppMenu]);\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { AppSettingsTab } from \"@foxglove/studio-base/components/AppSettingsDialog/AppSettingsDialog\";\nimport { DataSourceDialogItem } from \"@foxglove/studio-base/components/DataSourceDialog\";\nimport { IDataSourceFactory } from \"@foxglove/studio-base/context/PlayerSelectionContext\";\nimport {\n  LeftSidebarItemKey,\n  RightSidebarItemKey,\n  SidebarItemKey,\n  WorkspaceContextStore,\n} from \"@foxglove/studio-base/context/Workspace/WorkspaceContext\";\n\n// Type of version 0 store, used for migration.\ntype WorkspaceContextStoreV0 = {\n  dataSourceDialog: {\n    activeDataSource: undefined | IDataSourceFactory;\n    item: undefined | DataSourceDialogItem;\n    open: boolean;\n  };\n  featureTours: {\n    active: undefined | string;\n    shown: string[];\n  };\n  leftSidebarOpen: boolean;\n  rightSidebarOpen: boolean;\n  leftSidebarItem: undefined | LeftSidebarItemKey;\n  leftSidebarSize: undefined | number;\n  rightSidebarItem: undefined | RightSidebarItemKey;\n  rightSidebarSize: undefined | number;\n  playbackControls: {\n    repeat: boolean;\n  };\n  prefsDialogState: {\n    initialTab: undefined | AppSettingsTab;\n    open: boolean;\n  };\n  sidebarItem: undefined | SidebarItemKey;\n};\n\nexport function migrateV0WorkspaceState(\n  oldState: unknown,\n  _version: number,\n): WorkspaceContextStore {\n  // Currently v0 is the only obsolete state. If we do more migrations this\n  // needs to consider the version number.\n  const v0State = oldState as WorkspaceContextStoreV0;\n  const migrated: WorkspaceContextStore = {\n    dialogs: {\n      dataSource: {\n        activeDataSource: undefined,\n        item: undefined,\n        open: false,\n      },\n      preferences: {\n        initialTab: undefined,\n        open: false,\n      },\n    },\n    featureTours: {\n      active: undefined,\n      shown: v0State.featureTours.shown,\n    },\n    sidebars: {\n      legacy: {\n        item: v0State.sidebarItem,\n      },\n      left: {\n        item: v0State.leftSidebarItem,\n        open: v0State.leftSidebarOpen,\n        size: v0State.leftSidebarSize,\n      },\n      right: {\n        item: v0State.rightSidebarItem,\n        open: v0State.rightSidebarOpen,\n        size: v0State.rightSidebarSize,\n      },\n    },\n    playbackControls: {\n      repeat: v0State.playbackControls.repeat,\n    },\n  };\n  return migrated;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { pick } from \"lodash\";\nimport { ReactNode, useState } from \"react\";\nimport { StoreApi, createStore } from \"zustand\";\nimport { persist } from \"zustand/middleware\";\n\nimport {\n  WorkspaceContext,\n  WorkspaceContextStore,\n} from \"@foxglove/studio-base/context/Workspace/WorkspaceContext\";\nimport { migrateV0WorkspaceState } from \"@foxglove/studio-base/context/Workspace/migrations\";\n\nfunction createWorkspaceContextStore(\n  initialState?: Partial<WorkspaceContextStore>,\n): StoreApi<WorkspaceContextStore> {\n  return createStore<WorkspaceContextStore>()(\n    persist(\n      () => {\n        const store: WorkspaceContextStore = {\n          dialogs: {\n            dataSource: {\n              activeDataSource: undefined,\n              item: undefined,\n              open: false,\n            },\n            preferences: {\n              initialTab: undefined,\n              open: false,\n            },\n          },\n          featureTours: {\n            active: undefined,\n            shown: [],\n          },\n          sidebars: {\n            legacy: {\n              item: \"connection\",\n            },\n            left: {\n              item: \"panel-settings\",\n              open: true,\n              size: undefined,\n            },\n            right: {\n              item: undefined,\n              open: false,\n              size: undefined,\n            },\n          },\n          playbackControls: {\n            repeat: false,\n          },\n\n          ...initialState,\n        };\n        return store;\n      },\n      {\n        name: \"fox.workspace\",\n        version: 1,\n        migrate: migrateV0WorkspaceState,\n        partialize: (value) => {\n          // Note that this is an opt-in list of keys from the store that we\n          // include and restore when persisting to and from localStorage.\n          return pick(value, [\"featureTours\", \"playbackControls\", \"sidebars\"]);\n        },\n      },\n    ),\n  );\n}\n\nexport default function WorkspaceContextProvider({\n  children,\n  initialState,\n}: {\n  children?: ReactNode;\n  initialState?: Partial<WorkspaceContextStore>;\n}): JSX.Element {\n  const [store] = useState(() => createWorkspaceContextStore(initialState));\n\n  return <WorkspaceContext.Provider value={store}>{children}</WorkspaceContext.Provider>;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { useSnackbar } from \"notistack\";\nimport { extname } from \"path\";\nimport { useCallback, useEffect, useLayoutEffect, useMemo, useRef } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport Logger from \"@foxglove/log\";\nimport { AppSetting } from \"@foxglove/studio-base/AppSetting\";\nimport { AppBar } from \"@foxglove/studio-base/components/AppBar\";\nimport { CustomWindowControlsProps } from \"@foxglove/studio-base/components/AppBar/CustomWindowControls\";\nimport {\n  DataSourceDialog,\n  DataSourceDialogItem,\n} from \"@foxglove/studio-base/components/DataSourceDialog\";\nimport DocumentDropListener from \"@foxglove/studio-base/components/DocumentDropListener\";\nimport { EventsList } from \"@foxglove/studio-base/components/EventsList\";\nimport KeyListener from \"@foxglove/studio-base/components/KeyListener\";\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n  useMessagePipelineGetter,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\nimport MultiProvider from \"@foxglove/studio-base/components/MultiProvider\";\nimport PanelLayout from \"@foxglove/studio-base/components/PanelLayout\";\nimport PanelSettings from \"@foxglove/studio-base/components/PanelSettings\";\nimport PlaybackControls from \"@foxglove/studio-base/components/PlaybackControls\";\nimport { ProblemsList } from \"@foxglove/studio-base/components/ProblemsList\";\nimport RemountOnValueChange from \"@foxglove/studio-base/components/RemountOnValueChange\";\nimport { Sidebars, SidebarItem } from \"@foxglove/studio-base/components/Sidebars\";\nimport { SignInFormModal } from \"@foxglove/studio-base/components/SignInFormModal\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { StudioLogsSettings } from \"@foxglove/studio-base/components/StudioLogsSettings\";\nimport { SyncAdapters } from \"@foxglove/studio-base/components/SyncAdapters\";\nimport { TopicList } from \"@foxglove/studio-base/components/TopicList\";\nimport VariablesList from \"@foxglove/studio-base/components/VariablesList\";\nimport { WorkspaceDialogs } from \"@foxglove/studio-base/components/WorkspaceDialogs\";\nimport { useAppContext } from \"@foxglove/studio-base/context/AppContext\";\nimport { useCurrentUser } from \"@foxglove/studio-base/context/CurrentUserContext\";\nimport { EventsStore, useEvents } from \"@foxglove/studio-base/context/EventsContext\";\nimport { useExtensionCatalog } from \"@foxglove/studio-base/context/ExtensionCatalogContext\";\nimport { useNativeAppMenu } from \"@foxglove/studio-base/context/NativeAppMenuContext\";\nimport { usePlayerSelection } from \"@foxglove/studio-base/context/PlayerSelectionContext\";\nimport {\n  LeftSidebarItemKey,\n  RightSidebarItemKey,\n  WorkspaceContextStore,\n  useWorkspaceStore,\n} from \"@foxglove/studio-base/context/Workspace/WorkspaceContext\";\nimport { useAppConfigurationValue } from \"@foxglove/studio-base/hooks\";\nimport { useDefaultWebLaunchPreference } from \"@foxglove/studio-base/hooks/useDefaultWebLaunchPreference\";\nimport useElectronFilesToOpen from \"@foxglove/studio-base/hooks/useElectronFilesToOpen\";\nimport { useInitialDeepLinkState } from \"@foxglove/studio-base/hooks/useInitialDeepLinkState\";\nimport useNativeAppMenuEvent from \"@foxglove/studio-base/hooks/useNativeAppMenuEvent\";\nimport { PlayerPresence } from \"@foxglove/studio-base/players/types\";\nimport { PanelStateContextProvider } from \"@foxglove/studio-base/providers/PanelStateContextProvider\";\nimport WorkspaceContextProvider from \"@foxglove/studio-base/providers/WorkspaceContextProvider\";\n\nimport { useWorkspaceActions } from \"./context/Workspace/useWorkspaceActions\";\n\nconst log = Logger.getLogger(__filename);\n\nconst useStyles = makeStyles()({\n  container: {\n    width: \"100%\",\n    height: \"100%\",\n    display: \"flex\",\n    flexDirection: \"column\",\n    position: \"relative\",\n    flex: \"1 1 100%\",\n    outline: \"none\",\n    overflow: \"hidden\",\n  },\n});\n\nfunction activeElementIsInput() {\n  return (\n    document.activeElement instanceof HTMLInputElement ||\n    document.activeElement instanceof HTMLTextAreaElement\n  );\n}\n\nfunction keyboardEventHasModifier(event: KeyboardEvent) {\n  if (navigator.userAgent.includes(\"Mac\")) {\n    return event.metaKey;\n  } else {\n    return event.ctrlKey;\n  }\n}\n\ntype WorkspaceProps = CustomWindowControlsProps & {\n  deepLinks?: string[]; // eslint-disable-line react/no-unused-prop-types\n  appBarLeftInset?: number;\n  onAppBarDoubleClick?: () => void;\n};\n\nconst DEFAULT_DEEPLINKS = Object.freeze([]);\n\nconst selectPlayerPresence = ({ playerState }: MessagePipelineContext) => playerState.presence;\nconst selectPlayerIsPresent = ({ playerState }: MessagePipelineContext) =>\n  playerState.presence !== PlayerPresence.NOT_PRESENT;\nconst selectPlayerProblems = ({ playerState }: MessagePipelineContext) => playerState.problems;\nconst selectIsPlaying = (ctx: MessagePipelineContext) =>\n  ctx.playerState.activeData?.isPlaying === true;\nconst selectPause = (ctx: MessagePipelineContext) => ctx.pausePlayback;\nconst selectPlay = (ctx: MessagePipelineContext) => ctx.startPlayback;\nconst selectSeek = (ctx: MessagePipelineContext) => ctx.seekPlayback;\nconst selectPlayUntil = (ctx: MessagePipelineContext) => ctx.playUntil;\nconst selectPlayerId = (ctx: MessagePipelineContext) => ctx.playerState.playerId;\nconst selectEventsSupported = (store: EventsStore) => store.eventsSupported;\n\nconst selectWorkspaceDataSourceDialog = (store: WorkspaceContextStore) => store.dialogs.dataSource;\nconst selectWorkspaceSidebarItem = (store: WorkspaceContextStore) => store.sidebars.legacy.item;\nconst selectWorkspaceLeftSidebarItem = (store: WorkspaceContextStore) => store.sidebars.left.item;\nconst selectWorkspaceLeftSidebarOpen = (store: WorkspaceContextStore) => store.sidebars.left.open;\nconst selectWorkspaceLeftSidebarSize = (store: WorkspaceContextStore) => store.sidebars.left.size;\nconst selectWorkspaceRightSidebarItem = (store: WorkspaceContextStore) => store.sidebars.right.item;\nconst selectWorkspaceRightSidebarOpen = (store: WorkspaceContextStore) => store.sidebars.right.open;\nconst selectWorkspaceRightSidebarSize = (store: WorkspaceContextStore) => store.sidebars.right.size;\n\ntype WorkspaceContentProps = WorkspaceProps & { showSignInForm: boolean };\n\nfunction WorkspaceContent(props: WorkspaceContentProps): JSX.Element {\n  const { classes } = useStyles();\n  const containerRef = useRef<HTMLDivElement>(ReactNull);\n  const { availableSources, selectSource } = usePlayerSelection();\n  const playerPresence = useMessagePipeline(selectPlayerPresence);\n  const playerProblems = useMessagePipeline(selectPlayerProblems);\n\n  const sidebarItem = useWorkspaceStore(selectWorkspaceSidebarItem);\n  const dataSourceDialog = useWorkspaceStore(selectWorkspaceDataSourceDialog);\n  const leftSidebarItem = useWorkspaceStore(selectWorkspaceLeftSidebarItem);\n  const leftSidebarOpen = useWorkspaceStore(selectWorkspaceLeftSidebarOpen);\n  const leftSidebarSize = useWorkspaceStore(selectWorkspaceLeftSidebarSize);\n  const rightSidebarItem = useWorkspaceStore(selectWorkspaceRightSidebarItem);\n  const rightSidebarOpen = useWorkspaceStore(selectWorkspaceRightSidebarOpen);\n  const rightSidebarSize = useWorkspaceStore(selectWorkspaceRightSidebarSize);\n\n  const { dialogActions, sidebarActions } = useWorkspaceActions();\n\n  // file types we support for drag/drop\n  const allowedDropExtensions = useMemo(() => {\n    const extensions = [\".foxe\"];\n    for (const source of availableSources) {\n      if (source.type === \"file\" && source.supportedFileTypes) {\n        extensions.push(...source.supportedFileTypes);\n      }\n    }\n    return extensions;\n  }, [availableSources]);\n\n  // We use playerId to detect when a player changes for RemountOnValueChange below\n  // see comment below above the RemountOnValueChange component\n  const playerId = useMessagePipeline(selectPlayerId);\n\n  const { currentUser } = useCurrentUser();\n\n  useDefaultWebLaunchPreference();\n\n  const [enableStudioLogsSidebar = false] = useAppConfigurationValue<boolean>(\n    AppSetting.SHOW_DEBUG_PANELS,\n  );\n\n  const { workspaceExtensions } = useAppContext();\n\n  // When a player is activated, hide the open dialog.\n  useLayoutEffect(() => {\n    if (\n      playerPresence === PlayerPresence.PRESENT ||\n      playerPresence === PlayerPresence.INITIALIZING\n    ) {\n      dialogActions.dataSource.close();\n    }\n  }, [dialogActions.dataSource, playerPresence]);\n\n  useEffect(() => {\n    // Focus on page load to enable keyboard interaction.\n    if (containerRef.current) {\n      containerRef.current.focus();\n    }\n  }, []);\n\n  useNativeAppMenuEvent(\n    \"open\",\n    useCallback(async () => dialogActions.dataSource.open(\"start\"), [dialogActions.dataSource]),\n  );\n\n  useNativeAppMenuEvent(\n    \"open-file\",\n    useCallback(async () => await dialogActions.openFile.open(), [dialogActions.openFile]),\n  );\n\n  useNativeAppMenuEvent(\n    \"open-connection\",\n    useCallback(() => dialogActions.dataSource.open(\"connection\"), [dialogActions.dataSource]),\n  );\n\n  useNativeAppMenuEvent(\n    \"open-demo\",\n    useCallback(() => dialogActions.dataSource.open(\"demo\"), [dialogActions.dataSource]),\n  );\n\n  useNativeAppMenuEvent(\n    \"open-help-about\",\n    useCallback(() => dialogActions.preferences.open(\"about\"), [dialogActions.preferences]),\n  );\n\n  useNativeAppMenuEvent(\n    \"open-help-general\",\n    useCallback(() => dialogActions.preferences.open(\"general\"), [dialogActions.preferences]),\n  );\n\n  useNativeAppMenuEvent(\"open-help-docs\", () => window.open(\"https://foxglove.dev/docs\", \"_blank\"));\n\n  useNativeAppMenuEvent(\"open-help-slack\", () =>\n    window.open(\"https://foxglove.dev/slack\", \"_blank\"),\n  );\n\n  const nativeAppMenu = useNativeAppMenu();\n\n  const connectionSources = useMemo(() => {\n    return availableSources.filter((source) => source.type === \"connection\");\n  }, [availableSources]);\n\n  useEffect(() => {\n    if (!nativeAppMenu) {\n      return;\n    }\n\n    for (const item of connectionSources) {\n      nativeAppMenu.addFileEntry(item.displayName, () => {\n        dialogActions.dataSource.open(\"connection\", item);\n      });\n    }\n\n    return () => {\n      for (const item of connectionSources) {\n        nativeAppMenu.removeFileEntry(item.displayName);\n      }\n    };\n  }, [connectionSources, dialogActions.dataSource, nativeAppMenu]);\n\n  const { enqueueSnackbar } = useSnackbar();\n\n  const installExtension = useExtensionCatalog((state) => state.installExtension);\n\n  const openHandle = useCallback(\n    async (\n      handle: FileSystemFileHandle /* foxglove-depcheck-used: @types/wicg-file-system-access */,\n    ) => {\n      log.debug(\"open handle\", handle);\n      const file = await handle.getFile();\n\n      if (file.name.endsWith(\".foxe\")) {\n        // Extension installation\n        try {\n          const arrayBuffer = await file.arrayBuffer();\n          const data = new Uint8Array(arrayBuffer);\n          const extension = await installExtension(\"local\", data);\n          enqueueSnackbar(`Installed extension ${extension.id}`, { variant: \"success\" });\n        } catch (err) {\n          log.error(err);\n          enqueueSnackbar(`Failed to install extension ${file.name}: ${err.message}`, {\n            variant: \"error\",\n          });\n        }\n      }\n\n      // Look for a source that supports the file extensions\n      const matchedSource = availableSources.find((source) => {\n        const ext = extname(file.name);\n        return source.supportedFileTypes?.includes(ext);\n      });\n      if (matchedSource) {\n        selectSource(matchedSource.id, { type: \"file\", handle });\n      }\n    },\n    [availableSources, enqueueSnackbar, installExtension, selectSource],\n  );\n\n  const openFiles = useCallback(\n    async (files: File[]) => {\n      const otherFiles: File[] = [];\n      log.debug(\"open files\", files);\n\n      for (const file of files) {\n        if (file.name.endsWith(\".foxe\")) {\n          // Extension installation\n          try {\n            const arrayBuffer = await file.arrayBuffer();\n            const data = new Uint8Array(arrayBuffer);\n            const extension = await installExtension(\"local\", data);\n            enqueueSnackbar(`Installed extension ${extension.id}`, { variant: \"success\" });\n          } catch (err) {\n            log.error(err);\n            enqueueSnackbar(`Failed to install extension ${file.name}: ${err.message}`, {\n              variant: \"error\",\n            });\n          }\n        } else {\n          otherFiles.push(file);\n        }\n      }\n\n      if (otherFiles.length > 0) {\n        // Look for a source that supports the dragged file extensions\n        for (const source of availableSources) {\n          const filteredFiles = otherFiles.filter((file) => {\n            const ext = extname(file.name);\n            return source.supportedFileTypes?.includes(ext);\n          });\n\n          // select the first source that has files that match the supported extensions\n          if (filteredFiles.length > 0) {\n            selectSource(source.id, { type: \"file\", files: otherFiles });\n            break;\n          }\n        }\n      }\n    },\n    [availableSources, enqueueSnackbar, installExtension, selectSource],\n  );\n\n  // files the main thread told us to open\n  const filesToOpen = useElectronFilesToOpen();\n  useEffect(() => {\n    if (filesToOpen) {\n      void openFiles(Array.from(filesToOpen));\n    }\n  }, [filesToOpen, openFiles]);\n\n  const dropHandler = useCallback(\n    (event: { files?: File[]; handles?: FileSystemFileHandle[] }) => {\n      const handle = event.handles?.[0];\n      // When selecting sources with handles we can only select with a single handle since we haven't\n      // written the code to store multiple handles for recents. When there are multiple handles, we\n      // fall back to opening regular files.\n      if (handle && event.handles?.length === 1) {\n        void openHandle(handle);\n      } else if (event.files) {\n        void openFiles(event.files);\n      }\n    },\n    [openFiles, openHandle],\n  );\n\n  const eventsSupported = useEvents(selectEventsSupported);\n  const showEventsTab = currentUser != undefined && eventsSupported;\n\n  const leftSidebarItems = useMemo(() => {\n    const items = new Map<LeftSidebarItemKey, SidebarItem>([\n      [\"panel-settings\", { title: \"Panel\", component: PanelSettings }],\n      [\"topics\", { title: \"Topics\", component: TopicList }],\n      [\n        \"problems\",\n        {\n          title: \"Problems\",\n          component: ProblemsList,\n          badge:\n            playerProblems && playerProblems.length > 0\n              ? {\n                  count: playerProblems.length,\n                  color: \"error\",\n                }\n              : undefined,\n        },\n      ],\n    ]);\n    return items;\n  }, [playerProblems]);\n\n  const rightSidebarItems = useMemo(() => {\n    const items = new Map<RightSidebarItemKey, SidebarItem>([\n      [\"variables\", { title: \"Variables\", component: VariablesList }],\n    ]);\n    if (enableStudioLogsSidebar) {\n      items.set(\"studio-logs-settings\", { title: \"Studio Logs\", component: StudioLogsSettings });\n    }\n    if (showEventsTab) {\n      items.set(\"events\", { title: \"Events\", component: EventsList });\n    }\n    return items;\n  }, [enableStudioLogsSidebar, showEventsTab]);\n\n  const keyDownHandlers = useMemo(() => {\n    return {\n      b: (ev: KeyboardEvent) => {\n        if (!keyboardEventHasModifier(ev) || activeElementIsInput() || sidebarItem == undefined) {\n          return;\n        }\n\n        ev.preventDefault();\n        sidebarActions.legacy.selectItem(undefined);\n      },\n      \"[\": () => sidebarActions.left.setOpen((oldValue) => !oldValue),\n      \"]\": () => sidebarActions.right.setOpen((oldValue) => !oldValue),\n    };\n  }, [sidebarActions.left, sidebarActions.legacy, sidebarActions.right, sidebarItem]);\n\n  const play = useMessagePipeline(selectPlay);\n  const playUntil = useMessagePipeline(selectPlayUntil);\n  const pause = useMessagePipeline(selectPause);\n  const seek = useMessagePipeline(selectSeek);\n  const isPlaying = useMessagePipeline(selectIsPlaying);\n  const getMessagePipeline = useMessagePipelineGetter();\n  const getTimeInfo = useCallback(\n    () => getMessagePipeline().playerState.activeData ?? {},\n    [getMessagePipeline],\n  );\n\n  return (\n    <MultiProvider\n      providers={[\n        /* eslint-disable react/jsx-key */\n        <PanelStateContextProvider />,\n        /* eslint-enable react/jsx-key */\n      ]}\n    >\n      {props.showSignInForm && <SignInFormModal />}\n      {dataSourceDialog.open && <DataSourceDialog />}\n      <DocumentDropListener onDrop={dropHandler} allowedExtensions={allowedDropExtensions} />\n      <SyncAdapters />\n      <KeyListener global keyDownHandlers={keyDownHandlers} />\n      <div className={classes.container} ref={containerRef} tabIndex={0}>\n        <AppBar\n          leftInset={props.appBarLeftInset}\n          onDoubleClick={props.onAppBarDoubleClick}\n          showCustomWindowControls={props.showCustomWindowControls}\n          isMaximized={props.isMaximized}\n          onMinimizeWindow={props.onMinimizeWindow}\n          onMaximizeWindow={props.onMaximizeWindow}\n          onUnmaximizeWindow={props.onUnmaximizeWindow}\n          onCloseWindow={props.onCloseWindow}\n        />\n        <Sidebars\n          leftItems={leftSidebarItems}\n          selectedLeftKey={leftSidebarOpen ? leftSidebarItem : undefined}\n          onSelectLeftKey={sidebarActions.left.selectItem}\n          leftSidebarSize={leftSidebarSize}\n          setLeftSidebarSize={sidebarActions.left.setSize}\n          rightItems={rightSidebarItems}\n          selectedRightKey={rightSidebarOpen ? rightSidebarItem : undefined}\n          onSelectRightKey={sidebarActions.right.selectItem}\n          rightSidebarSize={rightSidebarSize}\n          setRightSidebarSize={sidebarActions.right.setSize}\n        >\n          {/* To ensure no stale player state remains, we unmount all panels when players change */}\n          <RemountOnValueChange value={playerId}>\n            <Stack>\n              <PanelLayout />\n            </Stack>\n          </RemountOnValueChange>\n        </Sidebars>\n        {play && pause && seek && (\n          <div style={{ flexShrink: 0 }}>\n            <PlaybackControls\n              play={play}\n              pause={pause}\n              seek={seek}\n              playUntil={playUntil}\n              isPlaying={isPlaying}\n              getTimeInfo={getTimeInfo}\n            />\n          </div>\n        )}\n      </div>\n      {!props.showSignInForm && workspaceExtensions}\n      <WorkspaceDialogs />\n    </MultiProvider>\n  );\n}\n\nexport default function Workspace(props: WorkspaceProps): JSX.Element {\n  // const [showOpenDialogOnStartup = true] = useAppConfigurationValue<boolean>(\n  //   AppSetting.SHOW_OPEN_DIALOG_ON_STARTUP,\n  // );\n\n  // SIM2REAL MODIFICATION\n  let showOpenDialogOnStartup = false;\n\n  const { currentUser } = useCurrentUser();\n\n  const { currentUserRequired } = useInitialDeepLinkState(props.deepLinks ?? DEFAULT_DEEPLINKS);\n\n  const isPlayerPresent = useMessagePipeline(selectPlayerIsPresent);\n\n  const showSignInForm = currentUserRequired && currentUser == undefined;\n\n  const initialItem: undefined | DataSourceDialogItem =\n    isPlayerPresent || !showOpenDialogOnStartup || showSignInForm ? undefined : \"start\";\n\n  const initialState: Pick<WorkspaceContextStore, \"dialogs\"> = {\n    dialogs: {\n      dataSource: {\n        activeDataSource: undefined,\n        open: initialItem != undefined,\n        item: initialItem,\n      },\n      preferences: {\n        initialTab: undefined,\n        open: false,\n      },\n    },\n  };\n\n  return (\n    <WorkspaceContextProvider initialState={initialState}>\n      <WorkspaceContent showSignInForm={showSignInForm} {...props} />\n    </WorkspaceContextProvider>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useMedia } from \"react-use\";\n\nimport { AppSetting } from \"@foxglove/studio-base/AppSetting\";\nimport { useAppConfigurationValue } from \"@foxglove/studio-base/hooks\";\nimport ThemeProvider from \"@foxglove/studio-base/theme/ThemeProvider\";\n\nexport function ColorSchemeThemeProvider({\n  children,\n}: React.PropsWithChildren<unknown>): JSX.Element {\n  const [colorScheme = \"system\"] = useAppConfigurationValue<string>(AppSetting.COLOR_SCHEME);\n  const systemSetting = useMedia(\"(prefers-color-scheme: light)\");\n  const isDark = colorScheme === \"dark\" || (colorScheme === \"system\" && systemSetting);\n  return <ThemeProvider isDark={isDark}>{children}</ThemeProvider>;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useEffect } from \"react\";\n\nimport {\n  MessagePipelineContext,\n  useMessagePipeline,\n} from \"@foxglove/studio-base/components/MessagePipeline\";\n\nconst selectPlayerName = (ctx: MessagePipelineContext) => ctx.playerState.name;\n\n/**\n * DocumentTitleAdapter sets the document title based on the currently selected player\n */\nexport default function DocumentTitleAdapter(): JSX.Element {\n  const playerName = useMessagePipeline(selectPlayerName);\n\n  useEffect(() => {\n    if (!playerName) {\n      window.document.title = \"Foxglove Studio\";\n      return;\n    }\n    window.document.title = navigator.userAgent.includes(\"Mac\")\n      ? playerName\n      : `${playerName} – Foxglove Studio`;\n  }, [playerName]);\n\n  return <></>;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext, useContext } from \"react\";\n\nexport type NativeWindowEvent = \"enter-full-screen\" | \"leave-full-screen\";\n\ntype Handler = () => void;\nexport interface INativeWindow {\n  /** https://www.electronjs.org/docs/tutorial/represented-file */\n  setRepresentedFilename(filename: string | undefined): Promise<void>;\n\n  on(name: NativeWindowEvent, handler: Handler): void;\n  off(name: NativeWindowEvent, handler: Handler): void;\n}\n\nconst NativeWindowContext = createContext<INativeWindow | undefined>(undefined);\nNativeWindowContext.displayName = \"NativeWindowContext\";\n\nexport function useNativeWindow(): INativeWindow | undefined {\n  return useContext(NativeWindowContext);\n}\n\nexport default NativeWindowContext;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { set as idbSet, get as idbGet, createStore as idbCreateStore } from \"idb-keyval\";\nimport { isEqual } from \"lodash\";\nimport { useCallback, useLayoutEffect, useMemo, useRef, useState } from \"react\";\nimport { useAsync } from \"react-use\";\nimport { v4 as uuid } from \"uuid\";\n\nimport Logger from \"@foxglove/log\";\n\nconst log = Logger.getLogger(__filename);\n\nconst IDB_KEY = \"recents\";\nconst IDB_STORE = idbCreateStore(\"foxglove-recents\", \"recents\");\n\ntype RecentRecordCommon = {\n  // Record id - use IndexedDbRecentsStore.GenerateRecordId() to generate\n  id: string;\n\n  // The source id\n  sourceId: string;\n\n  // The primary text for the recent record\n  title: string;\n\n  // Optional label for the recent record\n  label?: string;\n};\n\ntype RecentConnectionRecord = RecentRecordCommon & {\n  type: \"connection\";\n  // Optional arguments stored with the recent entry\n  extra?: Record<string, string | undefined>;\n};\n\ntype RecentFileRecord = RecentRecordCommon & {\n  type: \"file\";\n  handle: FileSystemFileHandle; // foxglove-depcheck-used: @types/wicg-file-system-access\n};\n\ntype UnsavedRecentRecord = Omit<RecentConnectionRecord, \"id\"> | Omit<RecentFileRecord, \"id\">;\n\nexport type RecentRecord = RecentConnectionRecord | RecentFileRecord;\n\ninterface IRecentsStore {\n  // Recent records\n  recents: RecentRecord[];\n\n  // Add a new recent\n  addRecent: (newRecent: UnsavedRecentRecord) => void;\n\n  // Save changes\n  save: () => Promise<void>;\n}\n\nfunction useIndexedDbRecents(): IRecentsStore {\n  const { value: initialRecents, loading } = useAsync(\n    async () => await idbGet<RecentRecord[] | undefined>(IDB_KEY, IDB_STORE),\n    [],\n  );\n\n  const [recents, setRecents] = useState<RecentRecord[]>([]);\n\n  // Track new recents in a ref and update the state after persisting\n  const newRecentsRef = useRef<RecentRecord[]>([]);\n\n  const save = useCallback(async () => {\n    // We don't save until we've loaded our existing recents. This ensures we include stored recents when we save\n    if (loading) {\n      return;\n    }\n\n    // The new recent appears at the start of the list\n    const recentsToSave: RecentRecord[] = [];\n\n    // For every ref in newRecentsRef, we need to eliminate any potential duplicates already in\n    // recentsToSave\n    for (const newRecent of newRecentsRef.current) {\n      let exists = false;\n      for (const savedRecent of recentsToSave) {\n        if (exists) {\n          continue;\n        }\n\n        // Filter file recents to ignore any previous recent that match this record.\n        // This happens if we want to add a file to recents that we already have\n        if (\n          savedRecent.type === \"file\" &&\n          newRecent.type === savedRecent.type &&\n          (await savedRecent.handle.isSameEntry(newRecent.handle))\n        ) {\n          exists = true;\n        }\n\n        // Filter connection recents which match the same sourceId and extra args\n        if (\n          savedRecent.type === \"connection\" &&\n          newRecent.type === savedRecent.type &&\n          savedRecent.sourceId === newRecent.sourceId &&\n          isEqual(newRecent.extra, savedRecent.extra)\n        ) {\n          exists = true;\n        }\n      }\n\n      // Max 5 entries\n      if (!exists && recentsToSave.length < 5) {\n        recentsToSave.push(newRecent);\n      }\n    }\n\n    setRecents(recentsToSave);\n    idbSet(IDB_KEY, recentsToSave, IDB_STORE).catch((err) => {\n      log.error(err);\n    });\n  }, [loading]);\n\n  // Set the first load records from the store to the state\n  useLayoutEffect(() => {\n    if (loading) {\n      return;\n    }\n\n    const haveUnsavedRecents = newRecentsRef.current.length > 0;\n\n    if (initialRecents) {\n      newRecentsRef.current.push(...initialRecents);\n    }\n\n    if (haveUnsavedRecents) {\n      void save();\n    } else {\n      // No new recents by the time we loaded our initial recents so we don't need to save\n      // Normally a save invokes set - but since we don't need to save we set here\n      setRecents(newRecentsRef.current);\n    }\n  }, [loading, initialRecents, save]);\n\n  const addRecent = useCallback(\n    (record: UnsavedRecentRecord) => {\n      const fullRecord: RecentRecord = {\n        id: uuid(),\n        ...record,\n      };\n      newRecentsRef.current.unshift(fullRecord);\n      void save();\n    },\n    [save],\n  );\n\n  return useMemo<IRecentsStore>(() => {\n    return {\n      recents,\n      addRecent,\n      save,\n    };\n  }, [addRecent, recents, save]);\n}\n\nexport default useIndexedDbRecents;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport Log from \"@foxglove/log\";\nimport { Time } from \"@foxglove/rostime\";\nimport {\n  PlayerMetricsCollectorInterface,\n  SubscribePayload,\n} from \"@foxglove/studio-base/players/types\";\nimport IAnalytics, { AppEvent } from \"@foxglove/studio-base/services/IAnalytics\";\n\nconst log = Log.getLogger(__filename);\n\ntype EventData = { [key: string]: string | number | boolean };\n\nexport default class AnalyticsMetricsCollector implements PlayerMetricsCollectorInterface {\n  #metadata: EventData = {};\n  #analytics: IAnalytics;\n\n  public constructor(analytics: IAnalytics) {\n    log.debug(\"New AnalyticsMetricsCollector\");\n    this.#analytics = analytics;\n  }\n\n  public setProperty(key: string, value: string | number | boolean): void {\n    this.#metadata[key] = value;\n  }\n\n  public logEvent(event: AppEvent, data?: EventData): void {\n    void this.#analytics.logEvent(event, { ...this.#metadata, ...data });\n  }\n\n  public playerConstructed(): void {\n    this.logEvent(AppEvent.PLAYER_CONSTRUCTED);\n  }\n\n  public play(speed: number): void {\n    this.logEvent(AppEvent.PLAYER_PLAY, { speed });\n  }\n\n  public seek(_time: Time): void {\n    // NOTE: This event fires in more cases than user interaction\n  }\n\n  public setSpeed(_speed: number): void {\n    // NOTE: This event fires in more cases than user interaction\n  }\n\n  public pause(): void {\n    this.logEvent(AppEvent.PLAYER_PAUSE);\n  }\n\n  public close(): void {\n    this.logEvent(AppEvent.PLAYER_CLOSE);\n  }\n\n  public setSubscriptions(_subscriptions: SubscribePayload[]): void {}\n\n  public recordBytesReceived(_bytes: number): void {}\n\n  public recordPlaybackTime(_time: Time, _params: { stillLoadingData: boolean }): void {}\n\n  public recordDataProviderPerformance(\n    _metadata: Readonly<{\n      type: \"average_throughput\";\n      totalSizeOfMessages: number;\n      numberOfMessages: number;\n      requestedRangeDuration: Time;\n      receivedRangeDuration: Time;\n      topics: readonly string[];\n      totalTransferTime: Time;\n    }>,\n  ): void {}\n\n  public recordUncachedRangeRequest(): void {}\n\n  public recordTimeToFirstMsgs(): void {}\n\n  public recordDataProviderInitializePerformance(\n    _metadata: Readonly<{\n      type: \"initializationPerformance\";\n      dataProviderType: string;\n      metrics: { [metricName: string]: string | number };\n    }>,\n  ): void {}\n\n  public recordDataProviderStall(\n    _metadata: Readonly<{\n      type: \"data_provider_stall\";\n      stallDuration: Time;\n      requestTimeUntilStall: Time;\n      transferTimeUntilStall: Time;\n      bytesReceivedBeforeStall: number;\n    }>,\n  ): void {}\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { groupBy, transform, uniq } from \"lodash\";\nimport memoizeWeak from \"memoize-weak\";\n\nimport { TopicAliasFunction, Immutable as Im, MessageEvent } from \"@foxglove/studio\";\nimport { GlobalVariables } from \"@foxglove/studio-base/hooks/useGlobalVariables\";\nimport {\n  MessageBlock,\n  PlayerProblem,\n  PlayerState,\n  Progress,\n  SubscribePayload,\n  Topic,\n  TopicStats,\n} from \"@foxglove/studio-base/players/types\";\n\ntype TopicAliasMap = Map<string, string[]>;\ntype MessageBlocks = readonly (undefined | MessageBlock)[];\nconst EmptyAliasMap: Im<TopicAliasMap> = new Map();\n\nexport type TopicAliasFunctions = Array<{ extensionId: string; aliasFunction: TopicAliasFunction }>;\n\nexport type AliasingInputs = {\n  aliasFunctions: TopicAliasFunctions;\n  topics: undefined | Topic[];\n  variables: GlobalVariables;\n};\n\nfunction aliasBlocks(blocks: MessageBlocks, mapping: Im<TopicAliasMap>): MessageBlocks {\n  if (mapping === EmptyAliasMap) {\n    return blocks;\n  }\n\n  return blocks.map((block) => {\n    if (block == undefined) {\n      return undefined;\n    }\n\n    return {\n      ...block,\n      messagesByTopic: transform(\n        block.messagesByTopic,\n        (acc, messages, topic) => {\n          const mappings = mapping.get(topic);\n          if (mappings) {\n            for (const mappedTopic of mappings) {\n              acc[mappedTopic] = messages.map((msg) => ({\n                ...msg,\n                topic: mappedTopic,\n              }));\n            }\n          }\n          acc[topic] = messages;\n        },\n        {} as Record<string, MessageEvent<unknown>[]>,\n      ),\n    };\n  });\n}\n\nfunction aliasMessages(\n  messages: Im<MessageEvent[]>,\n  mapping: Im<TopicAliasMap>,\n): Im<MessageEvent[]> {\n  if (mapping === EmptyAliasMap) {\n    return messages;\n  }\n\n  const mappedMessages: MessageEvent[] = [];\n\n  for (const msg of messages) {\n    mappedMessages.push(msg);\n    const mappings = mapping.get(msg.topic);\n    if (mappings) {\n      for (const topic of mappings) {\n        mappedMessages.push({ ...msg, topic });\n      }\n    }\n  }\n\n  return mappedMessages;\n}\n\nfunction aliasPublishedTopics(\n  topics: Map<string, Set<string>>,\n  mapping: Im<TopicAliasMap>,\n): Map<string, Set<string>> {\n  if (mapping === EmptyAliasMap) {\n    return topics;\n  }\n\n  const mappedTopics = new Map<string, Set<string>>();\n  for (const [key, values] of topics) {\n    const mappedValues = [...values].flatMap((value) => mapping.get(value) ?? value);\n    mappedTopics.set(key, new Set([...values, ...mappedValues]));\n  }\n  return mappedTopics;\n}\n\nfunction aliasSubscribedTopics(\n  topics: Map<string, Set<string>>,\n  mapping: Im<TopicAliasMap>,\n  subcriptions: Im<SubscribePayload[]>,\n): Map<string, Set<string>> {\n  if (mapping === EmptyAliasMap) {\n    return topics;\n  }\n\n  const subscriptionsByTopic = groupBy(subcriptions, (sub) => sub.topic);\n  const mappedTopics = new Map<string, Set<string>>();\n  for (const [id, values] of topics) {\n    const mappedValues = [...values].flatMap((value) => {\n      // If we have a subscription to the unmapped topic, include that, otherwise include\n      // the mapped topics.\n      const mapped = mapping.get(value);\n      if (subscriptionsByTopic[value]) {\n        return [value, ...(mapped ?? [])];\n      } else if (mapped) {\n        return mapped;\n      } else {\n        return value;\n      }\n    });\n    mappedTopics.set(id, new Set(mappedValues));\n  }\n  return mappedTopics;\n}\n\nfunction aliasProgress(progress: Progress, mapping: Im<TopicAliasMap>): Progress {\n  if (mapping === EmptyAliasMap || progress.messageCache == undefined) {\n    return progress;\n  }\n  const newProgress: Progress = {\n    ...progress,\n    messageCache: {\n      ...progress.messageCache,\n      blocks: memos.aliasBlocks(progress.messageCache.blocks, mapping),\n    },\n  };\n  return newProgress;\n}\n\nfunction aliasTopics(topics: Topic[], mapping: Im<TopicAliasMap>): Topic[] {\n  if (mapping === EmptyAliasMap) {\n    return topics;\n  }\n\n  return topics.flatMap((topic) => {\n    const mappings = mapping.get(topic.name);\n    if (mappings) {\n      return [\n        topic,\n        ...mappings.map((name) => ({\n          ...topic,\n          name,\n          aliasedFromName: topic.name,\n        })),\n      ];\n    } else {\n      return topic;\n    }\n  });\n}\n\nfunction aliasTopicStats(\n  stats: Map<string, TopicStats>,\n  mapping: Im<TopicAliasMap>,\n): Map<string, TopicStats> {\n  if (mapping === EmptyAliasMap) {\n    return stats;\n  }\n\n  const mappedStats: Map<string, TopicStats> = new Map();\n\n  for (const [topic, stat] of stats) {\n    mappedStats.set(topic, stat);\n    const mappings = mapping.get(topic);\n    if (mappings) {\n      for (const mappedTopic of mappings) {\n        mappedStats.set(mappedTopic, stat);\n      }\n    }\n  }\n\n  return mappedStats;\n}\n\n// Inverts a mapping, used to reverse map incoming subscriptions to subscriptions we pass\n// through to the wrapped player.\nfunction invertAliasMap(aliasMap: Im<TopicAliasMap>): Im<TopicAliasMap> {\n  if (aliasMap === EmptyAliasMap) {\n    return EmptyAliasMap;\n  }\n\n  const inverted: TopicAliasMap = new Map();\n  for (const [key, values] of aliasMap.entries()) {\n    for (const value of values) {\n      const newValues = inverted.get(value) ?? [];\n      newValues.push(key);\n      inverted.set(value, newValues);\n    }\n  }\n  return inverted;\n}\n\n// Merges multiple aliases into a single unified alias map. Note that a single topic name\n// can alias to more than one renamed topic if multiple extensions provide an alias for it.\n// Also returns any problems caused by disallowed aliases.\nfunction mergeAliases(\n  maps: Im<{ extensionId: string; aliases: ReturnType<TopicAliasFunction> }[]>,\n  inputs: Im<AliasingInputs>,\n): {\n  aliasMap: TopicAliasMap;\n  problems: undefined | PlayerProblem[];\n} {\n  const inverseMapping = new Map<string, string>();\n  const problems: PlayerProblem[] = [];\n  const merged: TopicAliasMap = new Map();\n  const topics = inputs.topics ?? [];\n  for (const { extensionId, aliases } of maps) {\n    for (const { name, sourceTopicName } of aliases) {\n      const existingMapping = inverseMapping.get(name);\n      if (topics.some((topic) => topic.name === name)) {\n        problems.push({\n          severity: \"error\",\n          message: `Disallowed topic alias`,\n          tip: `Extension ${extensionId} aliased topic ${name} is already present in the data source.`,\n        });\n      } else if (existingMapping != undefined && existingMapping !== sourceTopicName) {\n        problems.push({\n          severity: \"error\",\n          message: `Disallowed topic alias`,\n          tip: `Extension ${extensionId} requested duplicate alias from topic ${sourceTopicName} to topic ${name}.`,\n        });\n      } else {\n        inverseMapping.set(name, sourceTopicName);\n        const mergedValues = uniq(merged.get(sourceTopicName) ?? []).concat(name);\n        merged.set(sourceTopicName, mergedValues);\n      }\n    }\n  }\n  return { aliasMap: merged, problems: problems.length > 0 ? problems : undefined };\n}\n\n// Applies our topic mappers to the input topics to generate an active set of name =>\n// renamed topic mappings.\nfunction buildAliases(inputs: Im<AliasingInputs>): {\n  aliasMap: Im<TopicAliasMap>;\n  problems: undefined | PlayerProblem[];\n} {\n  const mappings = inputs.aliasFunctions.map((mapper) => ({\n    extensionId: mapper.extensionId,\n    aliases: mapper.aliasFunction({\n      topics: inputs.topics ?? [],\n      globalVariables: inputs.variables,\n    }),\n  }));\n  const anyMappings = mappings.some((map) => [...map.aliases].length > 0);\n  return anyMappings\n    ? mergeAliases(mappings, inputs)\n    : { aliasMap: EmptyAliasMap, problems: undefined };\n}\n\n// Memoize our mapping functions to avoid redundant work and also to preserve downstream\n// referential transparency for React components.\nconst memos = {\n  buildAliases: memoizeWeak(buildAliases),\n  aliasBlocks: memoizeWeak(aliasBlocks),\n  aliasMessages: memoizeWeak(aliasMessages),\n  aliasProgress: memoizeWeak(aliasProgress),\n  aliasPublishedTopics: memoizeWeak(aliasPublishedTopics),\n  aliasSubscribedTopics: memoizeWeak(aliasSubscribedTopics),\n  aliasTopics: memoizeWeak(aliasTopics),\n  aliasTopicStats: memoizeWeak(aliasTopicStats),\n};\n\n/**\n * Aliases topics in a player state to a new player state with all topic name aliases\n * applied.\n *\n * @param inputs the inputs to the alias function\n * @param playerState the player state containing topics to alias\n * @returns a player state with all aliased topic names replaced with their aliased value.\n */\nexport function aliasPlayerState(\n  inputs: Im<AliasingInputs>,\n  subscriptions: Im<SubscribePayload[]>,\n  playerState: PlayerState,\n): PlayerState {\n  const newState = {\n    ...playerState,\n    activeData: playerState.activeData ? { ...playerState.activeData } : undefined,\n  };\n\n  const { aliasMap: mapping, problems } = memos.buildAliases(inputs);\n\n  if (newState.activeData) {\n    newState.activeData.topics = memos.aliasTopics(newState.activeData.topics, mapping);\n    newState.activeData.messages = memos.aliasMessages(newState.activeData.messages, mapping);\n    if (newState.activeData.publishedTopics) {\n      newState.activeData.publishedTopics = memos.aliasPublishedTopics(\n        newState.activeData.publishedTopics,\n        mapping,\n      );\n    }\n    if (newState.activeData.subscribedTopics) {\n      newState.activeData.subscribedTopics = memos.aliasSubscribedTopics(\n        newState.activeData.subscribedTopics,\n        mapping,\n        subscriptions,\n      );\n    }\n\n    newState.activeData.topicStats = memos.aliasTopicStats(newState.activeData.topicStats, mapping);\n  }\n\n  if (newState.progress.messageCache) {\n    newState.progress = memos.aliasProgress(newState.progress, mapping);\n  }\n\n  if (problems != undefined) {\n    newState.problems = (newState.problems ?? []).concat(problems);\n  }\n\n  return newState;\n}\n\n/**\n * Maps an array of subscriptions to a new array with all topic aliases applied.\n *\n * @param inputs the inputs to the mapping function\n * @param subscriptions the subscription payloads to map\n * @returns a new array of subscription payloads with mapped topic names\n */\nexport const aliasSubscriptions = memoizeWeak(\n  (inputs: Im<AliasingInputs>, subcriptions: SubscribePayload[]): SubscribePayload[] => {\n    const { aliasMap: mapping } = memos.buildAliases(inputs);\n\n    if (mapping === EmptyAliasMap) {\n      return subcriptions;\n    }\n\n    const inverseMapping = invertAliasMap(mapping);\n\n    return subcriptions.flatMap((sub) => {\n      const mappings = inverseMapping.get(sub.topic);\n      if (mappings) {\n        return mappings.map((topic) => ({\n          ...sub,\n          topic,\n        }));\n      } else {\n        return sub;\n      }\n    });\n  },\n);\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Time } from \"@foxglove/rostime\";\nimport { Immutable, ParameterValue } from \"@foxglove/studio\";\nimport { GlobalVariables } from \"@foxglove/studio-base/hooks/useGlobalVariables\";\nimport {\n  AdvertiseOptions,\n  Player,\n  PlayerState,\n  PublishPayload,\n  SubscribePayload,\n} from \"@foxglove/studio-base/players/types\";\n\nimport {\n  AliasingInputs,\n  TopicAliasFunctions,\n  aliasPlayerState,\n  aliasSubscriptions,\n} from \"./aliasing\";\n\n/**\n * This is a player that wraps an underlying player and applies aliases to all topic names\n * in data emitted from the player. It is inserted into the player chain before\n * UserNodePlayer so that UserNodePlayer can use the aliased topics.\n *\n * Aliases that alias input topics to other input topics or that request conflicting\n * aliases from multiple input topics to the same output topic are disallowed and flagged\n * as player problems\n */\nexport class TopicAliasingPlayer implements Player {\n  readonly #player: Player;\n\n  #inputs: Immutable<AliasingInputs>;\n  #pendingSubscriptions: undefined | SubscribePayload[];\n  #subscriptions: SubscribePayload[] = [];\n\n  // True if no aliases are active and we can pass calls directly through to the\n  // underlying player.\n  #skipAliasing: boolean;\n\n  #listener?: (state: PlayerState) => Promise<void>;\n\n  public constructor(\n    player: Player,\n    aliasFunctions: Immutable<TopicAliasFunctions>,\n    variables: Immutable<GlobalVariables>,\n  ) {\n    this.#player = player;\n    this.#skipAliasing = aliasFunctions.length === 0;\n    this.#inputs = {\n      aliasFunctions,\n      topics: undefined,\n      variables,\n    };\n  }\n\n  public setListener(listener: (playerState: PlayerState) => Promise<void>): void {\n    this.#listener = listener;\n\n    this.#player.setListener(async (state) => await this.#onPlayerState(state));\n  }\n\n  public setAliasFunctions(aliasFunctions: Immutable<TopicAliasFunctions>): void {\n    this.#inputs = { ...this.#inputs, aliasFunctions };\n    this.#skipAliasing = aliasFunctions.length === 0;\n  }\n\n  public close(): void {\n    this.#player.close();\n  }\n\n  public setSubscriptions(subscriptions: SubscribePayload[]): void {\n    this.#subscriptions = subscriptions;\n\n    if (this.#skipAliasing) {\n      this.#player.setSubscriptions(subscriptions);\n    } else {\n      // If we have aliases but haven't recieved a topic list from an active state from\n      // the wrapped player yet we have to delay setSubscriptions until we have the topic\n      // list to set up the aliases.\n      if (this.#inputs.topics != undefined) {\n        const aliasedSubscriptions = aliasSubscriptions(this.#inputs, subscriptions);\n        this.#player.setSubscriptions(aliasedSubscriptions);\n        this.#pendingSubscriptions = undefined;\n      } else {\n        this.#pendingSubscriptions = subscriptions;\n      }\n    }\n  }\n\n  public setPublishers(publishers: AdvertiseOptions[]): void {\n    this.#player.setPublishers(publishers);\n  }\n\n  public setParameter(key: string, value: ParameterValue): void {\n    this.#player.setParameter(key, value);\n  }\n\n  public publish(request: PublishPayload): void {\n    this.#player.publish(request);\n  }\n\n  public async callService(service: string, request: unknown): Promise<unknown> {\n    return await this.#player.callService(service, request);\n  }\n\n  public startPlayback?(): void {\n    this.#player.startPlayback?.();\n  }\n\n  public pausePlayback?(): void {\n    this.#player.pausePlayback?.();\n  }\n\n  public seekPlayback?(time: Time): void {\n    this.#player.seekPlayback?.(time);\n  }\n\n  public playUntil?(time: Time): void {\n    this.#player.playUntil?.(time);\n  }\n\n  public setPlaybackSpeed?(speedFraction: number): void {\n    this.#player.setPlaybackSpeed?.(speedFraction);\n  }\n\n  public setGlobalVariables(globalVariables: GlobalVariables): void {\n    this.#player.setGlobalVariables(globalVariables);\n    this.#inputs = { ...this.#inputs, variables: globalVariables };\n  }\n\n  async #onPlayerState(playerState: PlayerState) {\n    if (this.#skipAliasing) {\n      await this.#listener?.(playerState);\n      return;\n    }\n\n    if (playerState.activeData?.topics !== this.#inputs.topics) {\n      this.#inputs = { ...this.#inputs, topics: playerState.activeData?.topics };\n    }\n\n    const newState = aliasPlayerState(this.#inputs, this.#subscriptions, playerState);\n    await this.#listener?.(newState);\n\n    if (this.#pendingSubscriptions && this.#inputs.topics) {\n      this.setSubscriptions(this.#pendingSubscriptions);\n    }\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Topic } from \"@foxglove/studio-base/players/types\";\nimport { RosDatatypes } from \"@foxglove/studio-base/types/RosDatatypes\";\n\ntype Args = { topics: Topic[]; datatypes: RosDatatypes };\ntype LibGeneratorFn = (args: Args) => Promise<string>;\n\n/**\n * LibGenerator memoizes generating a library from topics and datatypes.\n *\n * Calling `update` returns a boolean to indicate if the library was re-generated and the\n * library source code.\n *\n * If the args to update are unchanged (same topics and datatyes), then the previously\n * generated value from `fn` is returned.\n */\nclass MemoizedLibGenerator {\n  #datatypes?: RosDatatypes;\n  #topics?: Topic[];\n  #fn: LibGeneratorFn;\n  #cached?: string;\n\n  public constructor(fn: LibGeneratorFn) {\n    this.#fn = fn;\n  }\n\n  /**\n   * Update the library with new args.\n   * If the arg fields have changed, the generator function is run to make a new library.\n   *\n   * Return whether the cached value was updated and the cached value.\n   */\n  public async update(args: Args): Promise<{ didUpdate: boolean; lib: string }> {\n    if (\n      args.topics === this.#topics &&\n      args.datatypes === this.#datatypes &&\n      this.#cached != undefined\n    ) {\n      return { didUpdate: false, lib: this.#cached };\n    }\n\n    const lib = await this.#fn(args);\n    this.#topics = args.topics;\n    this.#datatypes = args.datatypes;\n    this.#cached = lib;\n    return { didUpdate: true, lib };\n  }\n}\n\nexport { MemoizedLibGenerator };\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2020-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\nimport { DiagnosticSeverity, NodeData } from \"@foxglove/studio-base/players/UserNodePlayer/types\";\n\nexport const hasTransformerErrors = (nodeData: NodeData): boolean =>\n  nodeData.diagnostics.some(({ severity }) => severity === DiagnosticSeverity.Error);\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { ros1, ros2galactic } from \"@foxglove/rosmsg-msgs-common\";\nimport { foxgloveMessageSchemas, generateRosMsgDefinition } from \"@foxglove/schemas/internal\";\nimport { RosDatatypes } from \"@foxglove/studio-base/types/RosDatatypes\";\n\n/**\n * basicDatatypes is a map containing definitions for ROS common datatypes and foxglove datatypes\n * from the following packages:\n *\n * - @foxglove/rosmsgs-msg-common\n * - @foxglove/schemas\n */\nexport const basicDatatypes: RosDatatypes = new Map();\n\n// Add ROS2 message schemas\nfor (const [name, def] of Object.entries(ros2galactic)) {\n  basicDatatypes.set(name, def);\n}\n\n// Add ROS1 message schemas\nfor (const [name, def] of Object.entries(ros1)) {\n  basicDatatypes.set(name, def);\n}\n\n// Add foxglove message schemas\nfor (const schema of Object.values(foxgloveMessageSchemas)) {\n  const definition = generateRosMsgDefinition(schema, { rosVersion: 1 });\n  basicDatatypes.set(definition.rosMsgInterfaceName, {\n    name: definition.rosMsgInterfaceName,\n    definitions: definition.fields,\n  });\n  basicDatatypes.set(`foxglove.${schema.name}`, {\n    name: `foxglove.${schema.name}`,\n    definitions: definition.fields,\n  });\n}\n\n// Add the legacy foxglove_msgs/ImageMarkerArray message definition\nbasicDatatypes.set(\"foxglove_msgs/ImageMarkerArray\", {\n  definitions: [\n    { name: \"markers\", type: \"visualization_msgs/ImageMarker\", isComplex: true, isArray: true },\n  ],\n});\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { Mutex } from \"async-mutex\";\nimport { isEqual, unionBy, uniq } from \"lodash\";\nimport memoizeWeak from \"memoize-weak\";\nimport ReactDOM from \"react-dom\";\nimport shallowequal from \"shallowequal\";\nimport { v4 as uuidv4 } from \"uuid\";\n\nimport { MutexLocked } from \"@foxglove/den/async\";\nimport { filterMap } from \"@foxglove/den/collection\";\nimport Log from \"@foxglove/log\";\nimport { Time, compare } from \"@foxglove/rostime\";\nimport { ParameterValue } from \"@foxglove/studio\";\nimport { GlobalVariables } from \"@foxglove/studio-base/hooks/useGlobalVariables\";\nimport { MemoizedLibGenerator } from \"@foxglove/studio-base/players/UserNodePlayer/MemoizedLibGenerator\";\nimport { generateTypesLib } from \"@foxglove/studio-base/players/UserNodePlayer/nodeTransformerWorker/generateTypesLib\";\nimport { TransformArgs } from \"@foxglove/studio-base/players/UserNodePlayer/nodeTransformerWorker/types\";\nimport {\n  Diagnostic,\n  DiagnosticSeverity,\n  ErrorCodes,\n  NodeData,\n  NodeRegistration,\n  ProcessMessageOutput,\n  RegistrationOutput,\n  Sources,\n  UserNodeLog,\n} from \"@foxglove/studio-base/players/UserNodePlayer/types\";\nimport { hasTransformerErrors } from \"@foxglove/studio-base/players/UserNodePlayer/utils\";\nimport {\n  AdvertiseOptions,\n  Player,\n  PlayerState,\n  PlayerStateActiveData,\n  PublishPayload,\n  SubscribePayload,\n  Topic,\n  MessageEvent,\n  PlayerProblem,\n  MessageBlock,\n} from \"@foxglove/studio-base/players/types\";\nimport { reportError } from \"@foxglove/studio-base/reportError\";\nimport { RosDatatypes } from \"@foxglove/studio-base/types/RosDatatypes\";\nimport { UserNode, UserNodes } from \"@foxglove/studio-base/types/panels\";\nimport Rpc from \"@foxglove/studio-base/util/Rpc\";\nimport { basicDatatypes } from \"@foxglove/studio-base/util/basicDatatypes\";\n\nconst log = Log.getLogger(__filename);\n\n// TypeScript's built-in lib only accepts strings for the scriptURL. However, webpack only\n// understands `new URL()` to properly build the worker entry point:\n// https://github.com/webpack/webpack/issues/13043\ndeclare let SharedWorker: {\n  prototype: SharedWorker;\n  new (scriptURL: URL, options?: string | WorkerOptions): SharedWorker;\n};\n\ntype UserNodeActions = {\n  setUserNodeDiagnostics: (nodeId: string, diagnostics: readonly Diagnostic[]) => void;\n  addUserNodeLogs: (nodeId: string, logs: readonly UserNodeLog[]) => void;\n  setUserNodeRosLib: (rosLib: string) => void;\n  setUserNodeTypesLib: (lib: string) => void;\n};\n\ntype NodeRegistrationCacheItem = {\n  nodeId: string;\n  userNode: UserNode;\n  result: NodeRegistration;\n};\n\nfunction maybePlainObject(rawVal: unknown) {\n  if (typeof rawVal === \"object\" && rawVal && \"toJSON\" in rawVal) {\n    return (rawVal as { toJSON: () => unknown }).toJSON();\n  }\n  return rawVal;\n}\n\n/** Mutable state protected by a mutex lock */\ntype ProtectedState = {\n  nodeRegistrationCache: NodeRegistrationCacheItem[];\n  nodeRegistrations: readonly NodeRegistration[];\n  lastPlayerStateActiveData?: PlayerStateActiveData;\n  userNodes: UserNodes;\n\n  /**\n   * Map of output topics to input topics. To produce an output we need to know the input topics\n   * that a script requires. When subscribers subscribe to the output topic, the user node player\n   * subscribes to the underlying input topics.\n   */\n  inputsByOutputTopic: Map<string, readonly string[]>;\n};\n\nexport default class UserNodePlayer implements Player {\n  #player: Player;\n\n  // Datatypes and topics are derived from nodeRegistrations, but memoized so they only change when needed\n  #memoizedNodeDatatypes: readonly RosDatatypes[] = [];\n  #memoizedNodeTopics: readonly Topic[] = [];\n\n  #subscriptions: SubscribePayload[] = [];\n  #nodeSubscriptions: Record<string, SubscribePayload> = {};\n\n  // listener for state updates\n  #listener?: (arg0: PlayerState) => Promise<void>;\n\n  // Not sure if there is perf issue with unused workers (may just go idle) - requires more research\n  #unusedNodeRuntimeWorkers: Rpc[] = [];\n  #setUserNodeDiagnostics: (nodeId: string, diagnostics: readonly Diagnostic[]) => void;\n  #addUserNodeLogs: (nodeId: string, logs: UserNodeLog[]) => void;\n  #nodeTransformRpc?: Rpc;\n  #globalVariables: GlobalVariables = {};\n  #userNodeActions: UserNodeActions;\n  #rosLibGenerator: MemoizedLibGenerator;\n  #typesLibGenerator: MemoizedLibGenerator;\n\n  // Player state changes when the child player invokes our player state listener\n  // we may also emit state changes on internal errors\n  #playerState?: PlayerState;\n\n  // The store tracks problems for individual userspace nodes\n  // a node may set its own problem or clear its problem\n  #problemStore = new Map<string, PlayerProblem>();\n\n  // keep track of last message on all topics to recompute output topic messages when user nodes change\n  #lastMessageByInputTopic = new Map<string, MessageEvent>();\n  #userNodeIdsNeedUpdate = new Set<string>();\n  #globalVariablesChanged = false;\n\n  #protectedState = new MutexLocked<ProtectedState>({\n    userNodes: {},\n    nodeRegistrations: [],\n    nodeRegistrationCache: [],\n    lastPlayerStateActiveData: undefined,\n    inputsByOutputTopic: new Map(),\n  });\n\n  readonly #emitLock = new Mutex();\n\n  // exposed as a static to allow testing to mock/replace\n  public static CreateNodeTransformWorker = (): SharedWorker => {\n    // foxglove-depcheck-used: babel-plugin-transform-import-meta\n    return new SharedWorker(new URL(\"./nodeTransformerWorker/index\", import.meta.url), {\n      // Although we are using SharedWorkers, we do not actually want to share worker instances\n      // between tabs. We achieve this by passing in a unique name.\n      name: uuidv4(),\n    });\n  };\n\n  // exposed as a static to allow testing to mock/replace\n  public static CreateNodeRuntimeWorker = (): SharedWorker => {\n    // foxglove-depcheck-used: babel-plugin-transform-import-meta\n    return new SharedWorker(new URL(\"./nodeRuntimeWorker/index\", import.meta.url), {\n      // Although we are using SharedWorkers, we do not actually want to share worker instances\n      // between tabs. We achieve this by passing in a unique name.\n      name: uuidv4(),\n    });\n  };\n\n  public constructor(player: Player, userNodeActions: UserNodeActions) {\n    this.#player = player;\n    this.#userNodeActions = userNodeActions;\n    const { setUserNodeDiagnostics, addUserNodeLogs } = userNodeActions;\n\n    this.#setUserNodeDiagnostics = (nodeId: string, diagnostics: readonly Diagnostic[]) => {\n      setUserNodeDiagnostics(nodeId, diagnostics);\n    };\n    this.#addUserNodeLogs = (nodeId: string, logs: UserNodeLog[]) => {\n      if (logs.length > 0) {\n        addUserNodeLogs(nodeId, logs);\n      }\n    };\n\n    this.#typesLibGenerator = new MemoizedLibGenerator(async (args) => {\n      const lib = generateTypesLib({\n        topics: args.topics,\n        datatypes: new Map([...basicDatatypes, ...args.datatypes]),\n      });\n\n      // Do not prettify the types library as it can cause severe performance\n      // degradations. This is OK because the generated types library is\n      // read-only and should be rarely read by a human. Further, the\n      // not-prettified code is not that bad either. It just lacks the\n      // appropriate indentations.\n      return lib;\n    });\n\n    this.#rosLibGenerator = new MemoizedLibGenerator(async (args) => {\n      const transformWorker = this.#getTransformWorker();\n      return await transformWorker.send(\"generateRosLib\", {\n        topics: args.topics,\n        // Include basic datatypes along with any custom datatypes.\n        // Custom datatypes appear as the second array items to override any basicDatatype items\n        datatypes: new Map([...basicDatatypes, ...args.datatypes]),\n      });\n    });\n  }\n\n  #getTopics = memoizeWeak((topics: readonly Topic[], nodeTopics: readonly Topic[]): Topic[] => [\n    ...topics,\n    ...nodeTopics,\n  ]);\n\n  #getDatatypes = memoizeWeak(\n    (datatypes: RosDatatypes, nodeDatatypes: readonly RosDatatypes[]): RosDatatypes => {\n      return nodeDatatypes.reduce(\n        (allDatatypes, userNodeDatatypes) => new Map([...allDatatypes, ...userNodeDatatypes]),\n        new Map([...basicDatatypes, ...datatypes]),\n      );\n    },\n  );\n\n  #lastBlockRequest: {\n    input?: {\n      blocks: readonly (MessageBlock | undefined)[];\n      globalVariables: GlobalVariables;\n      nodeRegistrations: readonly NodeRegistration[];\n    };\n    result: (MessageBlock | undefined)[];\n  } = { result: [] };\n\n  // Processes input messages through nodes to create messages on output topics\n  async #getMessages(\n    inputMessages: readonly MessageEvent[],\n    globalVariables: GlobalVariables,\n    nodeRegistrations: readonly NodeRegistration[],\n  ): Promise<readonly MessageEvent[]> {\n    // fast-track if there's no input and return empty output\n    if (inputMessages.length === 0) {\n      return [];\n    }\n\n    const identity = <T>(item: T) => item;\n\n    const outputMessages: MessageEvent[] = [];\n    for (const message of inputMessages) {\n      const messagePromises = [];\n      for (const nodeRegistration of nodeRegistrations) {\n        if (\n          this.#nodeSubscriptions[nodeRegistration.output.name] &&\n          nodeRegistration.inputs.includes(message.topic)\n        ) {\n          const messagePromise = nodeRegistration.processMessage(message, globalVariables);\n          messagePromises.push(messagePromise);\n        }\n      }\n      const output = await Promise.all(messagePromises);\n      outputMessages.push(...filterMap(output, identity));\n    }\n\n    return outputMessages;\n  }\n\n  async #getBlocks(\n    blocks: readonly (MessageBlock | undefined)[],\n    globalVariables: GlobalVariables,\n    nodeRegistrations: readonly NodeRegistration[],\n  ): Promise<readonly (MessageBlock | undefined)[]> {\n    if (\n      shallowequal(this.#lastBlockRequest.input, {\n        blocks,\n        globalVariables,\n        nodeRegistrations,\n      })\n    ) {\n      return this.#lastBlockRequest.result;\n    }\n\n    // If no downstream subscriptions want blocks for our output topics we can just pass through\n    // the blocks from the underlying player.\n    const fullRegistrations = nodeRegistrations.filter(\n      (reg) => this.#nodeSubscriptions[reg.output.name]?.preloadType === \"full\",\n    );\n    if (fullRegistrations.length === 0) {\n      return blocks;\n    }\n\n    const allInputTopics = uniq(fullRegistrations.flatMap((reg) => reg.inputs));\n\n    const outputBlocks: (MessageBlock | undefined)[] = [];\n    for (const block of blocks) {\n      if (!block) {\n        outputBlocks.push(block);\n        continue;\n      }\n\n      // Flatten and re-sort block messages so that nodes see them in the same order\n      // as the non-block nodes.\n      const messagesByTopic = { ...block.messagesByTopic };\n      const blockMessages = allInputTopics\n        .flatMap((topic) => messagesByTopic[topic] ?? [])\n        .sort((a, b) => compare(a.receiveTime, b.receiveTime));\n      for (const nodeRegistration of fullRegistrations) {\n        const outTopic = nodeRegistration.output.name;\n        // Clear out any previously processed messages that were previously in the output topic.\n        // otherwise it will contain duplicates.\n        if (messagesByTopic[outTopic] != undefined) {\n          messagesByTopic[outTopic] = [];\n        }\n\n        for (const message of blockMessages) {\n          if (nodeRegistration.inputs.includes(message.topic)) {\n            const outputMessage = await nodeRegistration.processBlockMessage(\n              message,\n              globalVariables,\n            );\n            if (outputMessage) {\n              // https://github.com/typescript-eslint/typescript-eslint/issues/6632\n              if (!messagesByTopic[outTopic]) {\n                messagesByTopic[outTopic] = [];\n              }\n              messagesByTopic[outTopic]?.push(outputMessage);\n            }\n          }\n        }\n      }\n\n      // Note that this size doesn't include the new processed messqges. We may need\n      // to recalculate this if it turns out to be important for good cache eviction\n      // behavior.\n      outputBlocks.push({\n        messagesByTopic,\n        sizeInBytes: block.sizeInBytes,\n      });\n    }\n\n    this.#lastBlockRequest = {\n      input: { blocks, globalVariables, nodeRegistrations },\n      result: outputBlocks,\n    };\n\n    return outputBlocks;\n  }\n\n  public setGlobalVariables(globalVariables: GlobalVariables): void {\n    this.#globalVariables = globalVariables;\n    this.#globalVariablesChanged = true;\n  }\n\n  // Called when userNode state is updated (i.e. scripts are saved)\n  public async setUserNodes(userNodes: UserNodes): Promise<void> {\n    const newPlayerState = await this.#protectedState.runExclusive(async (state) => {\n      for (const nodeId of Object.keys(userNodes)) {\n        const prevNode = state.userNodes[nodeId];\n        const newNode = userNodes[nodeId];\n        if (prevNode && newNode && prevNode.sourceCode !== newNode.sourceCode) {\n          // if source code of a userNode changed then we need to mark it for re-processing input messages\n          this.#userNodeIdsNeedUpdate.add(nodeId);\n        }\n      }\n      state.userNodes = userNodes;\n\n      // Prune the node registration cache so it doesn't grow forever.\n      // We add one to the count so we don't have to recompile nodes if users undo/redo node changes.\n      const maxNodeRegistrationCacheCount = Object.keys(userNodes).length + 1;\n      state.nodeRegistrationCache.splice(maxNodeRegistrationCacheCount);\n      // This code causes us to reset workers twice because the seeking resets the workers too\n      await this.#resetWorkersUnlocked(state);\n      this.#setSubscriptionsUnlocked(this.#subscriptions, state);\n\n      const playerState = this.#playerState;\n      const lastActive = state.lastPlayerStateActiveData;\n      // If we have previous player state and are paused, then we re-emit the last active data so\n      // any panels that want our output topic get the updated message.\n      //\n      // Note: Until we learn otherwise, we assume that if a player is playing, it will emit new\n      // player state that will output new messages so we don't emit here while playing.\n      if (playerState && lastActive?.isPlaying === false) {\n        return {\n          ...playerState,\n          activeData: {\n            ...lastActive,\n            // We want to avoid re-emitting upstream data source messages into panels to maintain\n            // the invariant that the player emits a data-source message into \"currentFrame\" only once.\n            //\n            // Using an empty messages array will make user node player only emit the script output\n            // messages as a result of the updated script.\n            messages: [],\n          },\n        };\n      }\n\n      return undefined;\n    });\n\n    if (newPlayerState) {\n      await this.#onPlayerState(newPlayerState);\n    }\n  }\n\n  // Defines the inputs/outputs and worker interface of a user node.\n  async #createNodeRegistration(\n    nodeId: string,\n    userNode: UserNode,\n    state: ProtectedState,\n    rosLib: string,\n    typesLib: string,\n  ): Promise<NodeRegistration> {\n    for (const cacheEntry of state.nodeRegistrationCache) {\n      if (nodeId === cacheEntry.nodeId && isEqual(userNode, cacheEntry.userNode)) {\n        return cacheEntry.result;\n      }\n    }\n    // Pass all the nodes a set of basic datatypes that we know how to render.\n    // These could be overwritten later by bag datatypes, but these datatype definitions should be very stable.\n    const { topics = [], datatypes = new Map() } = state.lastPlayerStateActiveData ?? {};\n    const nodeDatatypes: RosDatatypes = new Map([...basicDatatypes, ...datatypes]);\n\n    const { name, sourceCode } = userNode;\n    const transformMessage: TransformArgs = {\n      name,\n      sourceCode,\n      topics,\n      rosLib,\n      typesLib,\n      datatypes: nodeDatatypes,\n    };\n    const transformWorker = this.#getTransformWorker();\n    const nodeData = await transformWorker.send<NodeData>(\"transform\", transformMessage);\n    const { inputTopics, outputTopic, transpiledCode, projectCode, outputDatatype } = nodeData;\n\n    // problemKey is a unique identifier for each userspace node so we can manage problems from\n    // a specific node. A node may have a problem that may later clear. Using the key we can add/remove\n    // problems for specific userspace nodes independently of other userspace nodes.\n    const problemKey = `node-id-${nodeId}`;\n    const buildMessageProcessor = (): {\n      registration: NodeRegistration[\"processMessage\"];\n      terminate: () => void;\n    } => {\n      // rpc channel for this processor. Lazily created on each message if an unused\n      // channel isn't available.\n      let rpc: undefined | Rpc;\n\n      const registration = async (msgEvent: MessageEvent, globalVariables: GlobalVariables) => {\n        // Register the node within a web worker to be executed.\n        if (!rpc) {\n          rpc = this.#unusedNodeRuntimeWorkers.pop();\n\n          // initialize a new worker since no unused one is available\n          if (!rpc) {\n            const worker = UserNodePlayer.CreateNodeRuntimeWorker();\n\n            worker.onerror = (event) => {\n              log.error(event);\n\n              this.#problemStore.set(problemKey, {\n                message: `User script runtime error: ${event.message}`,\n                severity: \"error\",\n              });\n\n              // trigger listener updates\n              void this.#queueEmitState();\n            };\n\n            const port: MessagePort = worker.port;\n            port.onmessageerror = (event) => {\n              log.error(event);\n\n              this.#problemStore.set(problemKey, {\n                severity: \"error\",\n                message: `User script runtime error: ${String(event.data)}`,\n              });\n\n              void this.#queueEmitState();\n            };\n            port.start();\n            rpc = new Rpc(port);\n\n            rpc.receive(\"error\", (msg) => {\n              log.error(msg);\n\n              this.#problemStore.set(problemKey, {\n                severity: \"error\",\n                message: `User script runtime error: ${msg}`,\n              });\n\n              void this.#queueEmitState();\n            });\n          }\n\n          const { error, userNodeDiagnostics, userNodeLogs } = await rpc.send<RegistrationOutput>(\n            \"registerNode\",\n            {\n              projectCode,\n              nodeCode: transpiledCode,\n            },\n          );\n          if (error != undefined) {\n            this.#setUserNodeDiagnostics(nodeId, [\n              ...userNodeDiagnostics,\n              {\n                source: Sources.Runtime,\n                severity: DiagnosticSeverity.Error,\n                message: error,\n                code: ErrorCodes.RUNTIME,\n              },\n            ]);\n            return;\n          }\n          this.#addUserNodeLogs(nodeId, userNodeLogs);\n        }\n\n        // To send the message over RPC we need to send a plain JS object. We invoke\n        // maybePlainObject which calls toJSON on the message and builds a plain js object of the\n        // entire message.\n        const result = await rpc.send<ProcessMessageOutput>(\"processMessage\", {\n          message: {\n            topic: msgEvent.topic,\n            receiveTime: msgEvent.receiveTime,\n            message: maybePlainObject(msgEvent.message),\n            datatype: msgEvent.schemaName,\n          },\n          globalVariables,\n        });\n\n        const allDiagnostics = result.userNodeDiagnostics;\n        if (result.error) {\n          allDiagnostics.push({\n            source: Sources.Runtime,\n            severity: DiagnosticSeverity.Error,\n            message: result.error,\n            code: ErrorCodes.RUNTIME,\n          });\n        }\n\n        this.#addUserNodeLogs(nodeId, result.userNodeLogs);\n\n        if (allDiagnostics.length > 0) {\n          this.#problemStore.set(problemKey, {\n            severity: \"error\",\n            message: `User Script ${nodeId} encountered an error.`,\n            tip: \"Open the User Scripts panel and check the Problems tab for errors.\",\n          });\n\n          this.#setUserNodeDiagnostics(nodeId, allDiagnostics);\n          return;\n        }\n\n        if (!result.message) {\n          this.#problemStore.set(problemKey, {\n            severity: \"warn\",\n            message: `User Script ${nodeId} did not produce a message.`,\n            tip: \"Check that all code paths in the user script return a message.\",\n          });\n          return;\n        }\n\n        // At this point we've received a message successfully from the userspace node, therefore\n        // we clear any previous problem from this node.\n        this.#problemStore.delete(problemKey);\n\n        return {\n          topic: outputTopic,\n          receiveTime: msgEvent.receiveTime,\n          message: result.message,\n          sizeInBytes: msgEvent.sizeInBytes,\n          schemaName: outputDatatype,\n        };\n      };\n\n      const terminate = () => {\n        this.#problemStore.delete(problemKey);\n\n        if (rpc) {\n          this.#unusedNodeRuntimeWorkers.push(rpc);\n          rpc = undefined;\n        }\n      };\n\n      return { registration, terminate };\n    };\n\n    const messageProcessor = buildMessageProcessor();\n    const blockProcessor = buildMessageProcessor();\n\n    const result: NodeRegistration = {\n      nodeId,\n      nodeData,\n      inputs: inputTopics,\n      output: { name: outputTopic, schemaName: outputDatatype },\n      processMessage: messageProcessor.registration,\n      processBlockMessage: blockProcessor.registration,\n      terminate: () => {\n        messageProcessor.terminate();\n        blockProcessor.terminate();\n      },\n    };\n    state.nodeRegistrationCache.push({ nodeId, userNode, result });\n    return result;\n  }\n\n  #getTransformWorker(): Rpc {\n    if (!this.#nodeTransformRpc) {\n      const worker = UserNodePlayer.CreateNodeTransformWorker();\n\n      // The errors below persist for the lifetime of the player.\n      // They are not cleared because they are irrecoverable.\n\n      worker.onerror = (event) => {\n        log.error(event);\n\n        this.#problemStore.set(\"worker-error\", {\n          severity: \"error\",\n          message: `User Script error: ${event.message}`,\n        });\n\n        void this.#queueEmitState();\n      };\n\n      const port: MessagePort = worker.port;\n      port.onmessageerror = (event) => {\n        log.error(event);\n\n        this.#problemStore.set(\"worker-error\", {\n          severity: \"error\",\n          message: `User Script error: ${String(event.data)}`,\n        });\n\n        void this.#queueEmitState();\n      };\n      port.start();\n      const rpc = new Rpc(port);\n\n      rpc.receive(\"error\", (msg) => {\n        log.error(msg);\n\n        this.#problemStore.set(\"worker-error\", {\n          severity: \"error\",\n          message: `User Script error: ${msg}`,\n        });\n\n        void this.#queueEmitState();\n      });\n\n      this.#nodeTransformRpc = rpc;\n    }\n    return this.#nodeTransformRpc;\n  }\n\n  // We need to reset workers in a variety of circumstances:\n  // - When a user node is updated, added or deleted\n  // - When we seek (in order to reset state)\n  // - When a new child player is added\n  async #resetWorkersUnlocked(state: ProtectedState): Promise<void> {\n    if (!state.lastPlayerStateActiveData) {\n      return;\n    }\n\n    // This early return is an optimization measure so that the\n    // `nodeRegistrations` array is not re-defined, which will invalidate\n    // downstream caches. (i.e. `this._getTopics`)\n    if (state.nodeRegistrations.length === 0 && Object.entries(state.userNodes).length === 0) {\n      return;\n    }\n\n    // teardown and cleanup any existing node registrations\n    for (const nodeRegistration of state.nodeRegistrations) {\n      nodeRegistration.terminate();\n    }\n    state.nodeRegistrations = [];\n\n    const rosLib = await this.#getRosLib(state);\n    const typesLib = await this.#getTypesLib(state);\n\n    const allNodeRegistrations = await Promise.all(\n      Object.entries(state.userNodes).map(\n        async ([nodeId, userNode]) =>\n          await this.#createNodeRegistration(nodeId, userNode, state, rosLib, typesLib),\n      ),\n    );\n\n    const validNodeRegistrations: NodeRegistration[] = [];\n    const playerTopics = new Set(state.lastPlayerStateActiveData.topics.map((topic) => topic.name));\n    const allNodeOutputs = new Set(\n      allNodeRegistrations.map(({ nodeData }) => nodeData.outputTopic),\n    );\n\n    // Clear the output -> input map and re-populate it again with with all the node registrations\n    state.inputsByOutputTopic.clear();\n\n    for (const nodeRegistration of allNodeRegistrations) {\n      const { nodeData, nodeId } = nodeRegistration;\n\n      if (!nodeData.outputTopic) {\n        this.#setUserNodeDiagnostics(nodeId, [\n          ...nodeData.diagnostics,\n          {\n            severity: DiagnosticSeverity.Error,\n            message: `Output topic cannot be an empty string.`,\n            source: Sources.OutputTopicChecker,\n            code: ErrorCodes.OutputTopicChecker.NOT_UNIQUE,\n          },\n        ]);\n        continue;\n      }\n\n      // Create diagnostic errors if more than one node outputs to the same topic\n      if (state.inputsByOutputTopic.has(nodeData.outputTopic)) {\n        this.#setUserNodeDiagnostics(nodeId, [\n          ...nodeData.diagnostics,\n          {\n            severity: DiagnosticSeverity.Error,\n            message: `Output \"${nodeData.outputTopic}\" must be unique`,\n            source: Sources.OutputTopicChecker,\n            code: ErrorCodes.OutputTopicChecker.NOT_UNIQUE,\n          },\n        ]);\n        continue;\n      }\n\n      // Record the required input topics to service this output topic\n      state.inputsByOutputTopic.set(nodeData.outputTopic, nodeData.inputTopics);\n\n      // Create diagnostic errors if node outputs overlap with real topics\n      if (playerTopics.has(nodeData.outputTopic)) {\n        this.#setUserNodeDiagnostics(nodeId, [\n          ...nodeData.diagnostics,\n          {\n            severity: DiagnosticSeverity.Error,\n            message: `Output topic \"${nodeData.outputTopic}\" is already present in the data source`,\n            source: Sources.OutputTopicChecker,\n            code: ErrorCodes.OutputTopicChecker.EXISTING_TOPIC,\n          },\n        ]);\n        continue;\n      }\n\n      // Filter out nodes with compilation errors\n      if (hasTransformerErrors(nodeData)) {\n        this.#setUserNodeDiagnostics(nodeId, nodeData.diagnostics);\n        continue;\n      }\n\n      // Throw if nodes use other nodes' outputs as inputs. We should never get here because we\n      // already prevent outputs from being the same as real topics in the data source, and we\n      // already filter out input topics that aren't present in the data source.\n      for (const input of nodeData.inputTopics) {\n        if (allNodeOutputs.has(input)) {\n          throw new Error(`Input \"${input}\" cannot equal another node's output`);\n        }\n      }\n\n      validNodeRegistrations.push(nodeRegistration);\n    }\n\n    let changedTopicsRequireEmitState = false;\n    state.nodeRegistrations = validNodeRegistrations;\n    const nodeTopics = state.nodeRegistrations.map(({ output }) => output);\n    if (!isEqual(nodeTopics, this.#memoizedNodeTopics)) {\n      this.#memoizedNodeTopics = nodeTopics;\n      changedTopicsRequireEmitState = true;\n    }\n    const nodeDatatypes = state.nodeRegistrations.map(({ nodeData: { datatypes } }) => datatypes);\n    if (!isEqual(nodeDatatypes, this.#memoizedNodeDatatypes)) {\n      this.#memoizedNodeDatatypes = nodeDatatypes;\n      changedTopicsRequireEmitState = true;\n    }\n\n    // We need to set the user node diagnostics, which is a react set state\n    // function. This is called once per user script. Since this is in an async\n    // function, the state updates will not be batched below React 18 and React\n    // will update components synchronously during the set state. In a complex\n    // layout, each of the following _setUserNodeDiagnostics call result in\n    // ~100ms of latency. With many scripts, this can turn into a multi-second\n    // stall during layout switching.\n    //\n    // By batching the state update, unnecessary component updates are avoided\n    // and performance is improved for layout switching and initial loading.\n    //\n    // Moving to React 18 should remove the need for this call.\n    ReactDOM.unstable_batchedUpdates(() => {\n      for (const nodeRegistration of state.nodeRegistrations) {\n        this.#setUserNodeDiagnostics(nodeRegistration.nodeId, []);\n      }\n    });\n\n    // If we have new topics after processing the node registrations we need to emit a new\n    // state to let downstream clients subscribe to newly available topics. This is\n    // necessary because we won't emit a new state otherwise if there are no other active\n    // subscriptions.\n    if (changedTopicsRequireEmitState && this.#playerState?.activeData) {\n      const newTopics = unionBy(\n        this.#playerState.activeData.topics,\n        this.#memoizedNodeTopics,\n        (top) => top.name,\n      );\n      const newDatatypes = this.#getDatatypes(\n        this.#playerState.activeData.datatypes,\n        this.#memoizedNodeDatatypes,\n      );\n      this.#playerState = {\n        ...this.#playerState,\n        activeData: {\n          ...this.#playerState.activeData,\n          datatypes: newDatatypes,\n          topics: newTopics,\n        },\n      };\n      await this.#queueEmitState();\n    }\n  }\n\n  async #getRosLib(state: ProtectedState): Promise<string> {\n    if (!state.lastPlayerStateActiveData) {\n      throw new Error(\"_getRosLib was called before `_lastPlayerStateActiveData` set\");\n    }\n\n    const { topics, datatypes } = state.lastPlayerStateActiveData;\n    const { didUpdate, lib } = await this.#rosLibGenerator.update({ topics, datatypes });\n    if (didUpdate) {\n      this.#userNodeActions.setUserNodeRosLib(lib);\n    }\n\n    return lib;\n  }\n\n  async #getTypesLib(state: ProtectedState): Promise<string> {\n    if (!state.lastPlayerStateActiveData) {\n      throw new Error(\"_getTypesLib was called before `_lastPlayerStateActiveData` set\");\n    }\n\n    const { topics, datatypes } = state.lastPlayerStateActiveData;\n    const { didUpdate, lib } = await this.#typesLibGenerator.update({ topics, datatypes });\n    if (didUpdate) {\n      this.#userNodeActions.setUserNodeTypesLib(lib);\n    }\n\n    return lib;\n  }\n\n  // invoked when our child player state changes\n  async #onPlayerState(playerState: PlayerState) {\n    try {\n      const globalVariables = this.#globalVariables;\n      const { activeData } = playerState;\n      if (!activeData) {\n        this.#playerState = playerState;\n        await this.#queueEmitState();\n        return;\n      }\n\n      const { messages, topics, datatypes } = activeData;\n\n      // If we do not have active player data from a previous call, then our\n      // player just spun up, meaning we should re-run our user nodes in case\n      // they have inputs that now exist in the current player context.\n      const newPlayerState = await this.#protectedState.runExclusive(async (state) => {\n        if (!state.lastPlayerStateActiveData) {\n          state.lastPlayerStateActiveData = activeData;\n          await this.#resetWorkersUnlocked(state);\n          this.#setSubscriptionsUnlocked(this.#subscriptions, state);\n        } else {\n          // Reset node state after seeking\n          let shouldReset =\n            activeData.lastSeekTime !== state.lastPlayerStateActiveData.lastSeekTime;\n\n          // When topics or datatypes change we also need to re-build the nodes so we clear the cache\n          if (\n            activeData.topics !== state.lastPlayerStateActiveData.topics ||\n            activeData.datatypes !== state.lastPlayerStateActiveData.datatypes\n          ) {\n            shouldReset = true;\n            state.nodeRegistrationCache = [];\n          }\n\n          state.lastPlayerStateActiveData = activeData;\n          if (shouldReset) {\n            await this.#resetWorkersUnlocked(state);\n          }\n        }\n\n        const allDatatypes = this.#getDatatypes(datatypes, this.#memoizedNodeDatatypes);\n\n        /**\n         * if nodes have been updated we need to add their previous input messages\n         * to our list of messages to be parsed so that subscribers can refresh with\n         * the new output topic messages\n         */\n        const inputTopicsForRecompute = new Set<string>();\n\n        for (const userNodeId of this.#userNodeIdsNeedUpdate) {\n          const nodeRegistration = state.nodeRegistrations.find(\n            ({ nodeId }) => nodeId === userNodeId,\n          );\n          if (!nodeRegistration) {\n            continue;\n          }\n          const inputTopics = nodeRegistration.inputs;\n\n          for (const topic of inputTopics) {\n            inputTopicsForRecompute.add(topic);\n          }\n        }\n\n        // if the globalVariables have changed recompute all last messages for the current frame\n        // there's no way to know which nodes are affected by the globalVariables change to make this more specific\n        if (this.#globalVariablesChanged) {\n          this.#globalVariablesChanged = false;\n          for (const inputTopic of this.#lastMessageByInputTopic.keys()) {\n            inputTopicsForRecompute.add(inputTopic);\n          }\n        }\n\n        // remove topics that already have messages in state, because we won't need to take their last message to process\n        // this also removes possible duplicate messages to be parsed\n        for (const message of messages) {\n          inputTopicsForRecompute.delete(message.topic);\n        }\n\n        const messagesForRecompute: MessageEvent[] = [];\n        for (const topic of inputTopicsForRecompute) {\n          const messageForRecompute = this.#lastMessageByInputTopic.get(topic);\n          if (messageForRecompute) {\n            messagesForRecompute.push(messageForRecompute);\n          }\n        }\n\n        this.#userNodeIdsNeedUpdate.clear();\n\n        for (const message of messages) {\n          this.#lastMessageByInputTopic.set(message.topic, message);\n        }\n\n        const messagesRecomputed = messagesForRecompute.length > 0;\n\n        // These are new messages generated from input messages\n        const computed = await this.#getMessages(\n          messages,\n          globalVariables,\n          state.nodeRegistrations,\n        );\n\n        // These are messages generated from previously saved messages on input topics\n        const recomputed = await this.#getMessages(\n          messagesForRecompute,\n          globalVariables,\n          state.nodeRegistrations,\n        );\n\n        // The current frame messages are the input messages + recomputed + computed sorted by\n        // receive time\n        const currentFrameMessages = messages\n          .concat(recomputed)\n          .concat(computed)\n          .sort((a, b) => compare(a.receiveTime, b.receiveTime));\n\n        const playerProgress = {\n          ...playerState.progress,\n        };\n\n        if (playerProgress.messageCache) {\n          const newBlocks = await this.#getBlocks(\n            playerProgress.messageCache.blocks,\n            globalVariables,\n            state.nodeRegistrations,\n          );\n\n          playerProgress.messageCache = {\n            startTime: playerProgress.messageCache.startTime,\n            blocks: newBlocks,\n          };\n        }\n\n        return {\n          ...playerState,\n          progress: playerProgress,\n          activeData: {\n            ...activeData,\n            messages: currentFrameMessages,\n            topics: this.#getTopics(topics, this.#memoizedNodeTopics),\n            datatypes: allDatatypes,\n            messagesRecomputed,\n          },\n        };\n      });\n\n      this.#playerState = newPlayerState;\n\n      // clear any previous problem we had from making a new player state\n      this.#problemStore.delete(\"player-state-update\");\n    } catch (err) {\n      this.#problemStore.set(\"player-state-update\", {\n        severity: \"error\",\n        message: err.message,\n        error: err,\n      });\n\n      this.#playerState = playerState;\n    } finally {\n      await this.#queueEmitState();\n    }\n  }\n\n  async #queueEmitState() {\n    // Wrap in mutex in case the emitState triggered by changed node registrations happens\n    // to run at the same time as an emitstate triggered by the underlying player.\n    await this.#emitLock.runExclusive(async () => {\n      if (!this.#playerState) {\n        return;\n      }\n\n      // only augment child problems if we have our own problems\n      // if neither child or parent have problems we do nothing\n      let problems = this.#playerState.problems;\n      if (this.#problemStore.size > 0) {\n        problems = (problems ?? []).concat(Array.from(this.#problemStore.values()));\n      }\n\n      const playerState: PlayerState = {\n        ...this.#playerState,\n        problems,\n      };\n\n      if (this.#listener) {\n        await this.#listener(playerState);\n      }\n    });\n  }\n\n  public setListener(listener: (_: PlayerState) => Promise<void>): void {\n    this.#listener = listener;\n\n    // Delay _player.setListener until our setListener is called because setListener in some cases\n    // triggers initialization logic and remote requests. This is an unfortunate API behavior and\n    // naming choice, but it's better for us not to do trigger this logic in the constructor.\n    this.#player.setListener(async (state) => await this.#onPlayerState(state));\n  }\n\n  public setSubscriptions(subscriptions: SubscribePayload[]): void {\n    this.#subscriptions = subscriptions;\n    this.#protectedState\n      .runExclusive(async (state) => {\n        this.#setSubscriptionsUnlocked(subscriptions, state);\n      })\n      .catch((err) => {\n        log.error(err);\n        reportError(err as Error);\n      });\n  }\n\n  #setSubscriptionsUnlocked(subscriptions: SubscribePayload[], state: ProtectedState): void {\n    const nodeSubscriptions: Record<string, SubscribePayload> = {};\n    const realTopicSubscriptions: SubscribePayload[] = [];\n\n    // For each subscription, identify required input topics by looking up the subscribed topic in\n    // the map of output topics -> inputs. Add these required input topics to the set of topic\n    // subscriptions to the underlying player.\n    for (const subscription of subscriptions) {\n      const inputs = state.inputsByOutputTopic.get(subscription.topic);\n      if (!inputs) {\n        nodeSubscriptions[subscription.topic] = subscription;\n        realTopicSubscriptions.push(subscription);\n        continue;\n      }\n\n      // If the inputs array is empty then we don't have anything to subscribe to for this output\n      if (inputs.length === 0) {\n        continue;\n      }\n\n      nodeSubscriptions[subscription.topic] = subscription;\n      for (const inputTopic of inputs) {\n        realTopicSubscriptions.push({\n          topic: inputTopic,\n          preloadType: subscription.preloadType ?? \"partial\",\n        });\n      }\n    }\n\n    this.#nodeSubscriptions = nodeSubscriptions;\n    this.#player.setSubscriptions(realTopicSubscriptions);\n  }\n\n  public close = (): void => {\n    void this.#protectedState.runExclusive(async (state) => {\n      for (const nodeRegistration of state.nodeRegistrations) {\n        nodeRegistration.terminate();\n      }\n    });\n    this.#player.close();\n    if (this.#nodeTransformRpc) {\n      void this.#nodeTransformRpc.send(\"close\");\n    }\n  };\n\n  public setPublishers(publishers: AdvertiseOptions[]): void {\n    this.#player.setPublishers(publishers);\n  }\n\n  public setParameter(key: string, value: ParameterValue): void {\n    this.#player.setParameter(key, value);\n  }\n\n  public publish(request: PublishPayload): void {\n    this.#player.publish(request);\n  }\n\n  public async callService(service: string, request: unknown): Promise<unknown> {\n    return await this.#player.callService(service, request);\n  }\n\n  public startPlayback(): void {\n    this.#player.startPlayback?.();\n  }\n\n  public pausePlayback(): void {\n    this.#player.pausePlayback?.();\n  }\n\n  public playUntil(time: Time): void {\n    if (this.#player.playUntil) {\n      this.#player.playUntil(time);\n      return;\n    }\n    this.#player.seekPlayback?.(time);\n  }\n\n  public setPlaybackSpeed(speed: number): void {\n    this.#player.setPlaybackSpeed?.(speed);\n  }\n\n  public seekPlayback(time: Time): void {\n    this.#player.seekPlayback?.(time);\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { useSnackbar } from \"notistack\";\nimport {\n  PropsWithChildren,\n  useCallback,\n  useEffect,\n  useLayoutEffect,\n  useMemo,\n  useState,\n} from \"react\";\nimport { useLatest, useMountedState } from \"react-use\";\n\nimport { useShallowMemo, useWarnImmediateReRender } from \"@foxglove/hooks\";\nimport Logger from \"@foxglove/log\";\nimport { MessagePipelineProvider } from \"@foxglove/studio-base/components/MessagePipeline\";\nimport { useAnalytics } from \"@foxglove/studio-base/context/AnalyticsContext\";\nimport {\n  LayoutState,\n  useCurrentLayoutActions,\n  useCurrentLayoutSelector,\n} from \"@foxglove/studio-base/context/CurrentLayoutContext\";\nimport {\n  ExtensionCatalog,\n  useExtensionCatalog,\n} from \"@foxglove/studio-base/context/ExtensionCatalogContext\";\nimport { useLayoutManager } from \"@foxglove/studio-base/context/LayoutManagerContext\";\nimport { useNativeWindow } from \"@foxglove/studio-base/context/NativeWindowContext\";\nimport PlayerSelectionContext, {\n  DataSourceArgs,\n  IDataSourceFactory,\n  PlayerSelection,\n} from \"@foxglove/studio-base/context/PlayerSelectionContext\";\nimport { useUserNodeState } from \"@foxglove/studio-base/context/UserNodeStateContext\";\nimport { GlobalVariables } from \"@foxglove/studio-base/hooks/useGlobalVariables\";\nimport useIndexedDbRecents, { RecentRecord } from \"@foxglove/studio-base/hooks/useIndexedDbRecents\";\nimport AnalyticsMetricsCollector from \"@foxglove/studio-base/players/AnalyticsMetricsCollector\";\nimport { TopicAliasingPlayer } from \"@foxglove/studio-base/players/TopicAliasingPlayer/TopicAliasingPlayer\";\nimport UserNodePlayer from \"@foxglove/studio-base/players/UserNodePlayer\";\nimport { Player } from \"@foxglove/studio-base/players/types\";\nimport { UserNodes } from \"@foxglove/studio-base/types/panels\";\n\nconst log = Logger.getLogger(__filename);\n\nconst EMPTY_USER_NODES: UserNodes = Object.freeze({});\nconst EMPTY_GLOBAL_VARIABLES: GlobalVariables = Object.freeze({});\n\ntype PlayerManagerProps = {\n  playerSources: IDataSourceFactory[];\n};\n\nconst userNodesSelector = (state: LayoutState) =>\n  state.selectedLayout?.data?.userNodes ?? EMPTY_USER_NODES;\nconst globalVariablesSelector = (state: LayoutState) =>\n  state.selectedLayout?.data?.globalVariables ?? EMPTY_GLOBAL_VARIABLES;\nconst selectTopicAliasFunctions = (catalog: ExtensionCatalog) =>\n  catalog.installedTopicAliasFunctions;\n\nexport default function PlayerManager(props: PropsWithChildren<PlayerManagerProps>): JSX.Element {\n  const { children, playerSources } = props;\n\n  useWarnImmediateReRender();\n\n  const { setUserNodeDiagnostics, addUserNodeLogs, setUserNodeRosLib, setUserNodeTypesLib } =\n    useUserNodeState();\n  const userNodeActions = useShallowMemo({\n    setUserNodeDiagnostics,\n    addUserNodeLogs,\n    setUserNodeRosLib,\n    setUserNodeTypesLib,\n  });\n\n  const nativeWindow = useNativeWindow();\n\n  const isMounted = useMountedState();\n\n  const analytics = useAnalytics();\n  const metricsCollector = useMemo(() => new AnalyticsMetricsCollector(analytics), [analytics]);\n\n  const layoutStorage = useLayoutManager();\n  const { setSelectedLayoutId } = useCurrentLayoutActions();\n\n  const [basePlayer, setBasePlayer] = useState<Player | undefined>();\n  const [selectedSource, setSelectedSource] = useState<IDataSourceFactory | undefined>();\n\n  const userNodes = useCurrentLayoutSelector(userNodesSelector);\n  const globalVariables = useCurrentLayoutSelector(globalVariablesSelector);\n\n  const topicAliasFunctions = useExtensionCatalog(selectTopicAliasFunctions);\n\n  const { recents, addRecent } = useIndexedDbRecents();\n\n  // We don't want to recreate the player when the these variables change, but we do want to\n  // initialize it with the right order, so make a variable for its initial value we can use in the\n  // dependency array to the player useMemo.\n  //\n  // Updating the player with new values in handled by effects below the player useMemo or within\n  // the message pipeline\n  const globalVariablesRef = useLatest(globalVariables);\n\n  // Initialize the topic aliasing player with the alias functions and global variables we\n  // have at first load. Any changes in alias functions caused by dynamically loaded\n  // extensions or new variables have to be set separately because we can only construct\n  // the wrapping player once since the underlying player doesn't allow us set a new\n  // listener after the initial listener is set.\n  const [initialTopicAliasFunctions] = useState(topicAliasFunctions);\n  const [initialGlobalVariables] = useState(globalVariables);\n  const topicAliasPlayer = useMemo(() => {\n    if (!basePlayer) {\n      return undefined;\n    }\n\n    return new TopicAliasingPlayer(\n      basePlayer,\n      initialTopicAliasFunctions ?? [],\n      initialGlobalVariables,\n    );\n  }, [basePlayer, initialGlobalVariables, initialTopicAliasFunctions]);\n\n  // Topic aliases can change if we hot load a new extension with new alias functions.\n  useEffect(() => {\n    if (topicAliasFunctions !== initialTopicAliasFunctions) {\n      topicAliasPlayer?.setAliasFunctions(topicAliasFunctions ?? []);\n    }\n  }, [initialTopicAliasFunctions, topicAliasPlayer, topicAliasFunctions]);\n\n  // Topic alias player needs updated global variables.\n  useEffect(() => {\n    if (globalVariables !== initialGlobalVariables) {\n      topicAliasPlayer?.setGlobalVariables(globalVariables);\n    }\n  }, [globalVariables, initialGlobalVariables, topicAliasPlayer]);\n\n  const player = useMemo(() => {\n    if (!topicAliasPlayer) {\n      return undefined;\n    }\n\n    const userNodePlayer = new UserNodePlayer(topicAliasPlayer, userNodeActions);\n    userNodePlayer.setGlobalVariables(globalVariablesRef.current);\n    return userNodePlayer;\n  }, [globalVariablesRef, topicAliasPlayer, userNodeActions]);\n\n  useLayoutEffect(() => void player?.setUserNodes(userNodes), [player, userNodes]);\n\n  const { enqueueSnackbar } = useSnackbar();\n\n  const selectSource = useCallback(\n    async (sourceId: string, args?: DataSourceArgs) => {\n      log.debug(`Select Source: ${sourceId}`);\n\n      // Clear any previous represented filename\n      void nativeWindow?.setRepresentedFilename(undefined);\n\n      const foundSource = playerSources.find(\n        (source) => source.id === sourceId || source.legacyIds?.includes(sourceId),\n      );\n      if (!foundSource) {\n        enqueueSnackbar(`Unknown data source: ${sourceId}`, { variant: \"warning\" });\n        return;\n      }\n      setSelectedSource(foundSource);\n\n      metricsCollector.setProperty(\"player\", sourceId);\n\n      // Sample sources don't need args or prompts to initialize\n      if (foundSource.type === \"sample\") {\n        const newPlayer = foundSource.initialize({\n          metricsCollector,\n        });\n\n        setBasePlayer(newPlayer);\n\n        if (foundSource.sampleLayout) {\n          try {\n            const layouts = await layoutStorage.getLayouts();\n            let sourceLayout = layouts.find((layout) => layout.name === foundSource.displayName);\n            if (sourceLayout == undefined) {\n              sourceLayout = await layoutStorage.saveNewLayout({\n                name: foundSource.displayName,\n                data: foundSource.sampleLayout,\n                permission: \"CREATOR_WRITE\",\n              });\n            }\n\n            if (isMounted()) {\n              setSelectedLayoutId(sourceLayout.id);\n            }\n          } catch (err) {\n            enqueueSnackbar((err as Error).message, { variant: \"error\" });\n          }\n        }\n\n        return;\n      }\n\n      if (!args) {\n        enqueueSnackbar(\"Unable to initialize player: no args\", { variant: \"error\" });\n        return;\n      }\n\n      try {\n        switch (args.type) {\n          case \"connection\": {\n            const newPlayer = foundSource.initialize({\n              metricsCollector,\n              params: args.params,\n            });\n            setBasePlayer(newPlayer);\n\n            if (args.params?.url) {\n              addRecent({\n                type: \"connection\",\n                sourceId: foundSource.id,\n                title: args.params.url,\n                label: foundSource.displayName,\n                extra: args.params,\n              });\n            }\n\n            return;\n          }\n          case \"file\": {\n            const handle = args.handle;\n            const files = args.files;\n\n            // files we can try loading immediately\n            // We do not add these to recents entries because putting File in indexedb results in\n            // the entire file being stored in the database.\n            if (files) {\n              let file = files[0];\n              const fileList: File[] = [];\n\n              for (const curFile of files) {\n                file ??= curFile;\n                fileList.push(curFile);\n              }\n              const multiFile = foundSource.supportsMultiFile === true && fileList.length > 1;\n\n              const newPlayer = foundSource.initialize({\n                file: multiFile ? undefined : file,\n                files: multiFile ? fileList : undefined,\n                metricsCollector,\n              });\n\n              // If we are selecting a single file, the desktop environment might have features to\n              // show the user which file they've selected (i.e. macOS proxy icon)\n              if (file) {\n                void nativeWindow?.setRepresentedFilename((file as { path?: string }).path); // File.path is added by Electron\n              }\n\n              setBasePlayer(newPlayer);\n              return;\n            } else if (handle) {\n              const permission = await handle.queryPermission({ mode: \"read\" });\n              if (!isMounted()) {\n                return;\n              }\n\n              if (permission !== \"granted\") {\n                const newPerm = await handle.requestPermission({ mode: \"read\" });\n                if (newPerm !== \"granted\") {\n                  throw new Error(`Permission denied: ${handle.name}`);\n                }\n              }\n\n              const file = await handle.getFile();\n              if (!isMounted()) {\n                return;\n              }\n\n              // If we are selecting a single file, the desktop environment might have features to\n              // show the user which file they've selected (i.e. macOS proxy icon)\n              void nativeWindow?.setRepresentedFilename((file as { path?: string }).path); // File.path is added by Electron\n\n              const newPlayer = foundSource.initialize({\n                file,\n                metricsCollector,\n              });\n\n              setBasePlayer(newPlayer);\n              // addRecent({\n              //   type: \"file\",\n              //   title: handle.name,\n              //   sourceId: foundSource.id,\n              //   handle,\n              // });\n\n              return;\n            }\n          }\n        }\n\n        enqueueSnackbar(\"Unable to initialize player\", { variant: \"error\" });\n      } catch (error) {\n        enqueueSnackbar((error as Error).message, { variant: \"error\" });\n      }\n    },\n    [\n      playerSources,\n      metricsCollector,\n      enqueueSnackbar,\n      layoutStorage,\n      isMounted,\n      setSelectedLayoutId,\n      addRecent,\n      nativeWindow,\n    ],\n  );\n\n  // Select a recent entry by id\n  // necessary to pull out callback creation to avoid capturing the initial player in closure context\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const selectRecent = useCallback(\n    createSelectRecentCallback(recents, selectSource, enqueueSnackbar),\n    [recents, enqueueSnackbar, selectSource],\n  );\n\n  // Make a RecentSources array for the PlayerSelectionContext\n  const recentSources = useMemo(() => {\n    return recents.map((item) => {\n      return { id: item.id, title: item.title, label: item.label };\n    });\n  }, [recents]);\n\n  const value: PlayerSelection = {\n    selectSource,\n    selectRecent,\n    selectedSource: selectedSource,\n    availableSources: playerSources,\n    recentSources,\n  };\n\n  return (\n    <>\n      <PlayerSelectionContext.Provider value={value}>\n        <MessagePipelineProvider player={player} globalVariables={globalVariablesRef.current}>\n          {children}\n        </MessagePipelineProvider>\n      </PlayerSelectionContext.Provider>\n    </>\n  );\n}\n\n/**\n * This was moved out of the PlayerManager function due to a memory leak occurring in memoized state of Start.tsx\n * that was retaining old player instances. Having this callback be defined within the PlayerManager makes it store the\n * player at instantiation within the closure context. That callback is then stored in the memoized state with its closure context.\n * The callback is updated when the player changes but part of the `Start.tsx` holds onto the formerly memoized state for an\n * unknown reason.\n * To make this function safe from storing old closure contexts in old memoized state in components where it\n * is used, it has been moved out of the PlayerManager function.\n */\nfunction createSelectRecentCallback(\n  recents: RecentRecord[],\n  selectSource: (sourceId: string, dataSourceArgs: DataSourceArgs) => Promise<void>,\n  enqueueSnackbar: ReturnType<typeof useSnackbar>[\"enqueueSnackbar\"],\n) {\n  return (recentId: string) => {\n    // find the recent from the list and initialize\n    const foundRecent = recents.find((value) => value.id === recentId);\n    if (!foundRecent) {\n      enqueueSnackbar(`Failed to restore recent: ${recentId}`, { variant: \"error\" });\n      return;\n    }\n\n    switch (foundRecent.type) {\n      case \"connection\": {\n        void selectSource(foundRecent.sourceId, {\n          type: \"connection\",\n          params: foundRecent.extra,\n        });\n        break;\n      }\n      case \"file\": {\n        void selectSource(foundRecent.sourceId, {\n          type: \"file\",\n          handle: foundRecent.handle,\n        });\n      }\n    }\n  };\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport CloseIcon from \"@mui/icons-material/Close\";\nimport { Dialog, DialogTitle, IconButton, Typography } from \"@mui/material\";\nimport { useMemo } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { NotificationMessage } from \"@foxglove/studio-base/util/sendNotification\";\n\nconst useStyles = makeStyles()((theme) => ({\n  container: {\n    alignItems: \"stretch\",\n    display: \"flex\",\n    flexDirection: \"column\",\n    maxHeight: \"50vw\",\n    marginBlockEnd: theme.spacing(3),\n    marginInline: theme.spacing(3),\n  },\n  paper: {\n    maxWidth: 700,\n    width: \"70%\",\n  },\n  text: {\n    backgroundColor: theme.palette.background.default,\n    color: theme.palette.text.primary,\n    fontSize: theme.typography.body1.fontSize,\n    flex: 1,\n    padding: theme.spacing(1),\n    overflowY: \"auto\",\n    whiteSpace: \"pre-wrap\",\n  },\n  iconButton: {\n    position: \"absolute\",\n    right: theme.spacing(1),\n    top: theme.spacing(1),\n  },\n}));\n\nexport default function NotificationModal({\n  notification: { details, message, severity, subText },\n  onRequestClose,\n}: {\n  notification: NotificationMessage;\n  onRequestClose?: () => void;\n}): React.ReactElement {\n  const { classes, theme } = useStyles();\n\n  const displayPropsBySeverity = {\n    error: theme.palette.error.main,\n    warn: theme.palette.warning.main,\n    info: theme.palette.info.main,\n  };\n\n  const detailsElement = useMemo(() => {\n    if (details instanceof Error) {\n      return <div className={classes.text}>{details.stack}</div>;\n    } else if (details != undefined && details !== \"\") {\n      return (\n        <Typography style={{ whiteSpace: \"pre-line\" /* allow newlines in the details message */ }}>\n          {details}\n        </Typography>\n      );\n    } else if (subText) {\n      return undefined;\n    }\n\n    return \"No details provided\";\n  }, [classes, details, subText]);\n\n  return (\n    <Dialog classes={{ paper: classes.paper }} fullWidth open onClose={() => onRequestClose?.()}>\n      <DialogTitle color={displayPropsBySeverity[severity]}>{message}</DialogTitle>\n      <div className={classes.container}>\n        {subText && <Typography mb={3}>{subText}</Typography>}\n        {detailsElement}\n      </div>\n      <IconButton\n        aria-label=\"close\"\n        onClick={() => onRequestClose?.()}\n        className={classes.iconButton}\n      >\n        <CloseIcon />\n      </IconButton>\n    </Dialog>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Link } from \"@mui/material\";\nimport { useSnackbar, VariantType } from \"notistack\";\nimport { useLayoutEffect, useState } from \"react\";\n\nimport NotificationModal from \"@foxglove/studio-base/components/NotificationModal\";\nimport {\n  DetailsType,\n  NotificationType,\n  setNotificationHandler,\n  unsetNotificationHandler,\n  NotificationSeverity,\n  NotificationMessage,\n} from \"@foxglove/studio-base/util/sendNotification\";\n\nconst severityToToastAppearance = (severity: NotificationSeverity): VariantType => {\n  switch (severity) {\n    case \"error\":\n      return \"error\";\n    case \"warn\":\n      return \"warning\";\n    case \"info\":\n      return \"default\";\n    default:\n      return \"default\";\n  }\n};\n\nexport default function SendNotificationToastAdapter(): JSX.Element {\n  const { enqueueSnackbar } = useSnackbar();\n  const [notificationDetails, setNotificationDetails] = useState<NotificationMessage | undefined>(\n    undefined,\n  );\n\n  useLayoutEffect(() => {\n    setNotificationHandler(\n      (\n        message: string,\n        details: DetailsType,\n        _type: NotificationType,\n        severity: NotificationSeverity,\n      ): void => {\n        enqueueSnackbar(\n          <div>\n            {message}{\" \"}\n            <Link\n              onClick={() => setNotificationDetails({ message, details, severity })}\n              variant=\"inherit\"\n              fontStyle=\"italic\"\n              color=\"inherit\"\n              underline=\"hover\"\n            >\n              (see details)\n            </Link>\n          </div>,\n          {\n            variant: severityToToastAppearance(severity),\n            persist: severity === \"error\",\n          },\n        );\n      },\n    );\n\n    return () => {\n      unsetNotificationHandler();\n    };\n  }, [enqueueSnackbar]);\n\n  if (notificationDetails == undefined) {\n    return <></>;\n  }\n\n  return (\n    <NotificationModal\n      notification={notificationDetails}\n      onRequestClose={() => setNotificationDetails(undefined)}\n    />\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport {\n  CheckmarkCircle20Regular,\n  DismissCircle20Regular,\n  Dismiss16Filled,\n  Info20Regular,\n  Warning20Regular,\n} from \"@fluentui/react-icons\";\nimport { Grow, IconButton } from \"@mui/material\";\nimport {\n  SnackbarProvider,\n  SnackbarKey,\n  useSnackbar,\n  MaterialDesignContent,\n  CustomContentProps,\n} from \"notistack\";\nimport { PropsWithChildren, forwardRef } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { APP_BAR_HEIGHT } from \"@foxglove/studio-base/components/AppBar/constants\";\n\nconst anchorWithOffset = (origin: \"top\" | \"bottom\") => ({\n  \"&.notistack-SnackbarContainer\": {\n    top: origin === \"top\" ? APP_BAR_HEIGHT : undefined,\n  },\n});\n\nconst useStyles = makeStyles<void, \"icon\" | \"dismissButton\">()((theme, _params, classes) => ({\n  icon: {},\n  dismissButton: {\n    color: theme.palette.common.white,\n\n    \"svg:not(.MuiSvgIcon-root)\": {\n      fontSize: 16,\n    },\n  },\n  root: {\n    \"#notistack-snackbar\": {\n      padding: 0,\n      gap: theme.spacing(0.75),\n    },\n    \"&.notistack-MuiContent\": {\n      padding: theme.spacing(0.5, 1.5, 0.5, 1),\n      fontSize: theme.typography.body2.fontSize,\n    },\n    \"&.notistack-MuiContent-default\": {\n      backgroundColor: theme.palette.background.paper,\n      color: theme.palette.text.primary,\n\n      [`.${classes.icon}`]: { color: theme.palette.primary.main },\n      [`.${classes.dismissButton}`]: { color: theme.palette.text.primary },\n    },\n    \"&.notistack-MuiContent-success\": {\n      backgroundColor: theme.palette.success.main,\n    },\n    \"&.notistack-MuiContent-error\": {\n      backgroundColor: theme.palette.error.main,\n    },\n    \"&.notistack-MuiContent-info\": {\n      backgroundColor: theme.palette.info.main,\n    },\n    \"&.notistack-MuiContent-warning\": {\n      backgroundColor: theme.palette.warning.main,\n    },\n  },\n}));\n\nconst useContainerStyles = makeStyles()({\n  /* eslint-disable tss-unused-classes/unused-classes */\n  containerAnchorOriginBottomCenter: anchorWithOffset(\"bottom\"),\n  containerAnchorOriginBottomRight: anchorWithOffset(\"bottom\"),\n  containerAnchorOriginBottomLeft: anchorWithOffset(\"bottom\"),\n  containerAnchorOriginTopCenter: anchorWithOffset(\"top\"),\n  containerAnchorOriginTopRight: anchorWithOffset(\"top\"),\n  containerAnchorOriginTopLeft: anchorWithOffset(\"top\"),\n  /* eslint-enable tss-unused-classes/unused-classes */\n});\n\nconst CloseSnackbarAction = ({ id }: { id: SnackbarKey }) => {\n  const { closeSnackbar } = useSnackbar();\n  const { classes } = useStyles();\n  return (\n    <IconButton size=\"small\" className={classes.dismissButton} onClick={() => closeSnackbar(id)}>\n      <Dismiss16Filled />\n    </IconButton>\n  );\n};\n\nconst Snackbar = forwardRef<HTMLDivElement, CustomContentProps>((props, ref) => {\n  const { classes } = useStyles();\n  return <MaterialDesignContent ref={ref} {...props} className={classes.root} />;\n});\nSnackbar.displayName = \"Snackbar\";\n\nexport default function StudioToastProvider({ children }: PropsWithChildren<unknown>): JSX.Element {\n  const { classes: containerClasses } = useContainerStyles();\n  const { classes } = useStyles();\n  return (\n    <SnackbarProvider\n      Components={{\n        default: Snackbar,\n        error: Snackbar,\n        success: Snackbar,\n        warning: Snackbar,\n        info: Snackbar,\n      }}\n      action={(id) => <CloseSnackbarAction id={id} />}\n      iconVariant={{\n        default: <Info20Regular className={classes.icon} />,\n        info: <Info20Regular className={classes.icon} />,\n        error: <DismissCircle20Regular className={classes.icon} />,\n        warning: <Warning20Regular className={classes.icon} />,\n        success: <CheckmarkCircle20Regular className={classes.icon} />,\n      }}\n      anchorOrigin={{\n        vertical: \"top\",\n        horizontal: \"center\",\n      }}\n      maxSnack={5}\n      preventDuplicate\n      TransitionComponent={Grow}\n      classes={containerClasses}\n    >\n      {children}\n    </SnackbarProvider>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext, useContext } from \"react\";\n\nimport { ILayoutStorage } from \"@foxglove/studio-base/services/ILayoutStorage\";\n\nconst LayoutStorageContext = createContext<ILayoutStorage | undefined>(undefined);\nLayoutStorageContext.displayName = \"LayoutStorageContext\";\n\nexport function useLayoutStorage(): ILayoutStorage {\n  const ctx = useContext(LayoutStorageContext);\n  if (ctx == undefined) {\n    throw new Error(\"A LayoutStorage provider is required to useLayoutStorage\");\n  }\n  return ctx;\n}\n\nexport default LayoutStorageContext;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext, useContext } from \"react\";\n\nimport { LayoutID } from \"@foxglove/studio-base/context/CurrentLayoutContext\";\n\nexport type UserProfile = {\n  /** The id of the layout the user is currently working with. */\n  currentLayoutId?: LayoutID;\n\n  /** Timestamp of the first time the user loaded the app. */\n  firstSeenTime?: string;\n\n  /**\n   * True if the at the time we assigned firstSeenTime it appeared to be the\n   * user's first load of the app.\n   */\n  firstSeenTimeIsFirstLoad?: boolean;\n\n  /** Onboarding flow status */\n  onboarding?: {\n    /** List of panel types for which the settings tooltip has been shown */\n    settingsTooltipShownForPanelTypes?: string[];\n  };\n};\n\nexport type UserProfileStorage = {\n  getUserProfile: () => Promise<UserProfile>;\n  setUserProfile: (data: UserProfile | ((profile: UserProfile) => UserProfile)) => Promise<void>;\n};\n\nexport const UserProfileStorageContext = createContext<UserProfileStorage | undefined>(undefined);\nUserProfileStorageContext.displayName = \"UserProfileStorageContext\";\n\nexport function useUserProfileStorage(): UserProfileStorage {\n  const storage = useContext(UserProfileStorageContext);\n  if (storage == undefined) {\n    throw new Error(\"A UserProfileStorage provider is required to useUserProfileStorage\");\n  }\n\n  return storage;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { isEmpty, isEqual, pick } from \"lodash\";\nimport {\n  updateTree,\n  createDragToUpdates,\n  createRemoveUpdate,\n  createHideUpdate,\n  getNodeAtPath,\n  MosaicPath,\n  getLeaves,\n  MosaicNode,\n} from \"react-mosaic-component\";\nimport { MarkOptional } from \"ts-essentials\";\n\nimport { filterMap } from \"@foxglove/den/collection\";\nimport {\n  StartDragPayload,\n  EndDragPayload,\n  SplitPanelPayload,\n  DropPanelPayload,\n  SwapPanelPayload,\n  AddPanelPayload,\n  ClosePanelPayload,\n  MoveTabPayload,\n  PanelsActions,\n  LayoutData,\n  ConfigsPayload,\n  CreateTabPanelPayload,\n  ChangePanelLayoutPayload,\n  SaveConfigsPayload,\n  SaveFullConfigPayload,\n} from \"@foxglove/studio-base/context/CurrentLayoutContext/actions\";\nimport { TabPanelConfig } from \"@foxglove/studio-base/types/layouts\";\nimport {\n  SavedProps,\n  PlaybackConfig,\n  MosaicDropTargetPosition,\n} from \"@foxglove/studio-base/types/panels\";\nimport { TAB_PANEL_TYPE } from \"@foxglove/studio-base/util/globalConstants\";\nimport {\n  updateTabPanelLayout,\n  replaceAndRemovePanels,\n  getPanelIdForType,\n  getPanelTypeFromId,\n  getPanelIdsInsideTabPanels,\n  DEFAULT_TAB_PANEL_CONFIG,\n  getConfigsForNestedPanelsInsideTab,\n  getAllPanelIds,\n  inlineTabPanelLayouts,\n  getSaveConfigsPayloadForAddedPanel,\n  addPanelToTab,\n  reorderTabWithinTabPanel,\n  moveTabBetweenTabPanels,\n  createAddUpdates,\n  removePanelFromTabPanel,\n  getPathFromNode,\n} from \"@foxglove/studio-base/util/layout\";\n\nimport { isTabPanelConfig } from \"../../util/layout\";\n\nexport const defaultPlaybackConfig: PlaybackConfig = {\n  speed: 1.0,\n};\n\nfunction changePanelLayout(\n  state: LayoutData,\n  { layout, trimConfigById = true }: ChangePanelLayoutPayload,\n): LayoutData {\n  const panelIds: string[] = getLeaves(layout ?? ReactNull).filter((panelId) => !isEmpty(panelId));\n  const panelIdsInsideTabPanels = getPanelIdsInsideTabPanels(panelIds, state.configById);\n  // Filter configById in case a panel was removed from the layout\n  // We don't want its configById hanging around forever\n  const configById = trimConfigById\n    ? pick(state.configById, [...panelIdsInsideTabPanels, ...panelIds])\n    : state.configById;\n  return { ...state, configById, layout };\n}\n\nfunction savePanelConfigs(state: LayoutData, payload: SaveConfigsPayload): LayoutData {\n  const { configs } = payload;\n  const prevConfigById = state.configById;\n\n  // create a configById object with new configs merged on top of previous configs\n  //\n  // Note: If no configs are changed, the return value of newConfigById is the same as the state input\n  //       This keeps the state object unchagned if the configs values did not change.\n  const newConfigById = configs.reduce(\n    (currentSavedProps, { id, config, defaultConfig = {}, override = false }) => {\n      if (override) {\n        return { ...currentSavedProps, [id]: config };\n      }\n\n      const oldConfig = currentSavedProps[id];\n      const newConfig = {\n        // merge the partial new config with the default config and the old config\n        // any entries in the new config can override default config and previous config entries\n        ...defaultConfig,\n        ...currentSavedProps[id],\n        ...config,\n      };\n\n      // if the new config is unchanged, return currentSavedProps to keep same object\n      // keeping the same object around is useful for upstream consumers of state which look at changes\n      // in object reference to mean the object changed\n      if (isEqual(oldConfig, newConfig)) {\n        return currentSavedProps;\n      }\n\n      return { ...currentSavedProps, [id]: newConfig };\n    },\n    state.configById,\n  );\n  const tabPanelConfigSaved = configs.find(({ id }) => getPanelTypeFromId(id) === TAB_PANEL_TYPE);\n  if (tabPanelConfigSaved) {\n    // eslint-disable-next-line no-restricted-syntax\n    const panelIds = getLeaves(state.layout ?? null);\n    const panelIdsInsideTabPanels = getPanelIdsInsideTabPanels(panelIds, newConfigById);\n    // Filter savedProps in case a panel was removed from a Tab layout\n    // We don't want its savedProps hanging around forever\n    return { ...state, configById: pick(newConfigById, [...panelIdsInsideTabPanels, ...panelIds]) };\n  }\n\n  // if none of the configs changed, then we keep the same state object\n  if (prevConfigById === newConfigById) {\n    return state;\n  }\n  return { ...state, configById: newConfigById };\n}\n\nfunction saveFullPanelConfig(state: LayoutData, payload: SaveFullConfigPayload): LayoutData {\n  const { panelType, perPanelFunc } = payload;\n  const newProps = { ...state.configById };\n  const fullConfig = state.configById;\n  for (const [panelId, panelConfig] of Object.entries(fullConfig)) {\n    if (getPanelTypeFromId(panelId) === panelType) {\n      newProps[panelId] = perPanelFunc(panelConfig);\n    }\n  }\n\n  return { ...state, configById: newProps };\n}\n\nconst closePanel = (\n  panelsState: LayoutData,\n  { tabId, root, path }: ClosePanelPayload,\n): LayoutData => {\n  if (tabId != undefined) {\n    const config = panelsState.configById[tabId] as TabPanelConfig;\n    const saveConfigsPayload = removePanelFromTabPanel(path, config, tabId);\n    return savePanelConfigs(panelsState, saveConfigsPayload);\n  } else if (typeof root === \"string\") {\n    // When layout consists of 1 panel, clear the layout\n    return changePanelLayout(panelsState, { layout: undefined });\n  }\n  const update = createRemoveUpdate(root, path);\n  const newLayout = updateTree(root, [update]);\n  return changePanelLayout(panelsState, { layout: newLayout });\n};\n\nconst splitPanel = (\n  panelsState: LayoutData,\n  { id, tabId, direction, config, root, path }: SplitPanelPayload,\n): LayoutData => {\n  const type = getPanelTypeFromId(id);\n  const newId = getPanelIdForType(type);\n  let newPanelsState = { ...panelsState };\n  const { configById: savedProps } = newPanelsState;\n  if (tabId != undefined) {\n    const prevConfig = savedProps[tabId] as TabPanelConfig;\n    const activeTabLayout = prevConfig.tabs[prevConfig.activeTabIdx]?.layout;\n    if (activeTabLayout != undefined) {\n      const newTabLayout = updateTree(activeTabLayout, [\n        {\n          path: getPathFromNode(id, activeTabLayout),\n          spec: { $set: { first: id, second: newId, direction } },\n        },\n      ]);\n      const newTabConfig = updateTabPanelLayout(newTabLayout, prevConfig);\n      newPanelsState = savePanelConfigs(newPanelsState, {\n        configs: [\n          { id: tabId, config: newTabConfig },\n          { id: newId, config },\n        ],\n      });\n    }\n  } else {\n    newPanelsState = changePanelLayout(newPanelsState, {\n      layout: updateTree(root, [{ path, spec: { $set: { first: id, second: newId, direction } } }]),\n      trimConfigById: type !== TAB_PANEL_TYPE,\n    });\n\n    const relatedConfigs =\n      type === TAB_PANEL_TYPE\n        ? (getPanelIdsInsideTabPanels([id], savedProps).reduce(\n            (res: Record<string, unknown>, panelId: string) => ({\n              ...res,\n              [panelId]: savedProps[panelId],\n            }),\n            {},\n          ) as SavedProps)\n        : undefined;\n    newPanelsState = savePanelConfigs(\n      newPanelsState,\n      getSaveConfigsPayloadForAddedPanel({ id: newId, config, relatedConfigs }),\n    );\n  }\n  return newPanelsState;\n};\n\nconst swapPanel = (\n  panelsState: LayoutData,\n  {\n    tabId,\n    originalId,\n    type,\n    config,\n    relatedConfigs,\n    root,\n    path,\n  }: MarkOptional<SwapPanelPayload, \"originalId\">,\n): LayoutData => {\n  const newId = getPanelIdForType(type);\n  let newPanelsState = { ...panelsState };\n  // For a panel inside a Tab panel, update the Tab panel's tab layouts via savedProps\n  if (tabId != undefined && originalId != undefined) {\n    const tabSavedProps = newPanelsState.configById[tabId] as TabPanelConfig | undefined;\n    if (tabSavedProps) {\n      const activeTabLayout = tabSavedProps.tabs[tabSavedProps.activeTabIdx]?.layout;\n      if (activeTabLayout != undefined) {\n        const newTabLayout = replaceAndRemovePanels({ originalId, newId }, activeTabLayout);\n\n        const newTabConfig = updateTabPanelLayout(newTabLayout, tabSavedProps);\n        newPanelsState = savePanelConfigs(newPanelsState, {\n          configs: [{ id: tabId, config: newTabConfig }],\n        });\n      }\n    }\n  } else {\n    newPanelsState = changePanelLayout(newPanelsState, {\n      layout: updateTree(root, [{ path, spec: { $set: newId } }]),\n      trimConfigById: type !== TAB_PANEL_TYPE,\n    });\n  }\n\n  newPanelsState = savePanelConfigs(\n    newPanelsState,\n    getSaveConfigsPayloadForAddedPanel({ id: newId, config, relatedConfigs }),\n  );\n  return newPanelsState;\n};\n\nconst createTabPanelWithSingleTab = (\n  panelsState: LayoutData,\n  { idToReplace, layout, idsToRemove }: CreateTabPanelPayload,\n): LayoutData => {\n  const newId = getPanelIdForType(TAB_PANEL_TYPE);\n  const { configById: savedProps } = panelsState;\n  // Build the layout for the new tab\n  const layoutWithInlinedTabs = inlineTabPanelLayouts(layout, savedProps, idsToRemove);\n  const panelIdsNotInNewTab = getAllPanelIds(layout, savedProps).filter(\n    (leaf: string) => !idsToRemove.includes(leaf),\n  );\n  const tabLayout = replaceAndRemovePanels(\n    { idsToRemove: panelIdsNotInNewTab },\n    layoutWithInlinedTabs,\n  );\n\n  const newLayout = replaceAndRemovePanels({ originalId: idToReplace, newId, idsToRemove }, layout);\n  let newPanelsState = changePanelLayout(panelsState, {\n    layout: newLayout ?? \"\",\n    trimConfigById: false,\n  });\n\n  const tabPanelConfig = {\n    id: newId,\n    config: { ...DEFAULT_TAB_PANEL_CONFIG, tabs: [{ title: \"1\", layout: tabLayout }] },\n  };\n  const nestedPanelConfigs = getConfigsForNestedPanelsInsideTab(\n    idToReplace,\n    newId,\n    idsToRemove,\n    savedProps,\n  );\n  newPanelsState = savePanelConfigs(newPanelsState, {\n    configs: [tabPanelConfig, ...nestedPanelConfigs],\n  });\n  return newPanelsState;\n};\n\nconst createTabPanelWithMultipleTabs = (\n  panelsState: LayoutData,\n  { idToReplace, layout, idsToRemove }: CreateTabPanelPayload,\n): LayoutData => {\n  const { configById: savedProps } = panelsState;\n  const newId = getPanelIdForType(TAB_PANEL_TYPE);\n  const newLayout = replaceAndRemovePanels({ originalId: idToReplace, newId, idsToRemove }, layout);\n  let newPanelsState = changePanelLayout(\n    { ...panelsState },\n    { layout: newLayout ?? \"\", trimConfigById: false },\n  );\n\n  const tabs = idsToRemove.map((panelId) => ({\n    title: getPanelTypeFromId(panelId),\n    layout: panelId,\n  }));\n  const tabPanelConfig = { id: newId, config: { ...DEFAULT_TAB_PANEL_CONFIG, tabs } };\n  const nestedPanelConfigs = getConfigsForNestedPanelsInsideTab(\n    idToReplace,\n    newId,\n    idsToRemove,\n    savedProps,\n  );\n  newPanelsState = savePanelConfigs(newPanelsState, {\n    configs: [tabPanelConfig, ...nestedPanelConfigs],\n  });\n\n  return newPanelsState;\n};\n\nconst moveTab = (panelsState: LayoutData, { source, target }: MoveTabPayload): LayoutData => {\n  const saveConfigsPayload =\n    source.panelId === target.panelId\n      ? reorderTabWithinTabPanel({ source, target, savedProps: panelsState.configById })\n      : moveTabBetweenTabPanels({ source, target, savedProps: panelsState.configById });\n  return savePanelConfigs(panelsState, saveConfigsPayload);\n};\n\nconst addPanel = (\n  panelsState: LayoutData,\n  { tabId, id, config, relatedConfigs }: AddPanelPayload,\n) => {\n  let newPanelsState = { ...panelsState };\n  let saveConfigsPayload: { configs: ConfigsPayload[] } = { configs: [] };\n  if (config) {\n    saveConfigsPayload = getSaveConfigsPayloadForAddedPanel({ id, config, relatedConfigs });\n  }\n  let layout: MosaicNode<string> | undefined;\n  if (tabId != undefined) {\n    const tabPanelConfig = panelsState.configById[tabId];\n    if (isTabPanelConfig(tabPanelConfig)) {\n      layout = tabPanelConfig.tabs[tabPanelConfig.activeTabIdx]?.layout;\n    }\n  } else {\n    layout = panelsState.layout;\n  }\n  const fixedLayout: MosaicNode<string> = isEmpty(layout)\n    ? id\n    : { direction: \"row\", first: id, second: layout as MosaicNode<string> };\n  const changeLayoutPayload = {\n    layout: fixedLayout,\n    trimConfigById: !relatedConfigs,\n  };\n  if (tabId != undefined && typeof changeLayoutPayload.layout === \"string\") {\n    newPanelsState = savePanelConfigs(newPanelsState, {\n      configs: [\n        {\n          id: tabId,\n          config: updateTabPanelLayout(changeLayoutPayload.layout, {\n            ...DEFAULT_TAB_PANEL_CONFIG,\n            ...panelsState.configById[tabId],\n          }),\n        },\n      ],\n    });\n  } else {\n    newPanelsState = changePanelLayout(newPanelsState, changeLayoutPayload);\n  }\n  newPanelsState = savePanelConfigs(newPanelsState, saveConfigsPayload);\n  return newPanelsState;\n};\n\nconst dropPanel = (\n  panelsState: LayoutData,\n  { newPanelType, destinationPath = [], position, tabId, config, relatedConfigs }: DropPanelPayload,\n) => {\n  const id = getPanelIdForType(newPanelType);\n\n  const configs = [];\n  // This means we've dragged into a Tab panel\n  if (tabId != undefined) {\n    const { configs: newConfigs } = addPanelToTab(\n      id,\n      destinationPath,\n      position,\n      panelsState.configById[tabId],\n      tabId,\n    );\n    configs.push(...newConfigs);\n  }\n\n  const newLayout =\n    tabId != undefined\n      ? panelsState.layout\n      : updateTree<string>(\n          panelsState.layout as MosaicNode<string>,\n          createAddUpdates(panelsState.layout, id, destinationPath, position ?? \"left\"),\n        );\n\n  // 'relatedConfigs' are used in Tab panel presets, so that the panels'\n  // respective configs will be saved globally.\n  if (config) {\n    const { configs: newConfigs } = getSaveConfigsPayloadForAddedPanel({\n      id,\n      config,\n      relatedConfigs,\n    });\n    configs.push(...newConfigs);\n  }\n\n  let newPanelsState = changePanelLayout(panelsState, {\n    layout: newLayout,\n    trimConfigById: !relatedConfigs,\n  });\n  newPanelsState = savePanelConfigs(newPanelsState, { configs });\n  return newPanelsState;\n};\n\nconst dragWithinSameTab = (\n  panelsState: LayoutData,\n  {\n    originalLayout,\n    sourceTabId,\n    position,\n    destinationPath,\n    ownPath,\n    sourceTabConfig,\n    sourceTabChildConfigs,\n  }: {\n    originalLayout: MosaicNode<string>;\n    sourceTabId: string;\n    position: MosaicDropTargetPosition;\n    destinationPath: MosaicPath;\n    ownPath: MosaicPath;\n    sourceTabConfig: TabPanelConfig;\n    sourceTabChildConfigs: ConfigsPayload[];\n  },\n): LayoutData => {\n  const currentTabLayout = sourceTabConfig.tabs[sourceTabConfig.activeTabIdx]?.layout;\n  let newPanelsState = { ...panelsState };\n  if (typeof currentTabLayout === \"string\") {\n    newPanelsState = changePanelLayout(panelsState, {\n      layout: originalLayout,\n      trimConfigById: false,\n    });\n    // We assume `begin` handler already removed tab from config. Here it is replacing it, or keeping it as is\n    newPanelsState = savePanelConfigs(newPanelsState, {\n      configs: [\n        { id: sourceTabId, config: updateTabPanelLayout(currentTabLayout, sourceTabConfig) },\n        ...sourceTabChildConfigs,\n      ],\n    });\n  } else if (currentTabLayout != undefined) {\n    const updates = createDragToUpdates(currentTabLayout, ownPath, destinationPath, position);\n    const newTree = updateTree(currentTabLayout, updates);\n\n    newPanelsState = changePanelLayout(panelsState, {\n      layout: originalLayout,\n      trimConfigById: false,\n    });\n    newPanelsState = savePanelConfigs(newPanelsState, {\n      configs: [\n        {\n          id: sourceTabId,\n          config: updateTabPanelLayout(\n            newTree,\n            panelsState.configById[sourceTabId] as TabPanelConfig,\n          ),\n        },\n        ...sourceTabChildConfigs,\n      ],\n    });\n  }\n  return newPanelsState;\n};\n\nconst dragToMainFromTab = (\n  panelsState: LayoutData,\n  {\n    originalLayout,\n    sourceTabId,\n    position,\n    destinationPath,\n    ownPath,\n    sourceTabConfig,\n    sourceTabChildConfigs,\n  }: {\n    originalLayout: MosaicNode<string>;\n    sourceTabId: string;\n    position: MosaicDropTargetPosition;\n    destinationPath: MosaicPath;\n    ownPath: MosaicPath;\n    sourceTabConfig: TabPanelConfig;\n    sourceTabChildConfigs: ConfigsPayload[];\n  },\n): LayoutData => {\n  const currentTabLayout = sourceTabConfig.tabs[sourceTabConfig.activeTabIdx]?.layout;\n  if (currentTabLayout == undefined) {\n    return panelsState;\n  }\n  // Remove panel from tab layout\n  const saveConfigsPayload = removePanelFromTabPanel(\n    ownPath,\n    panelsState.configById[sourceTabId] as TabPanelConfig,\n    sourceTabId,\n  );\n  const panelConfigs = {\n    ...saveConfigsPayload,\n    configs: [...saveConfigsPayload.configs, ...sourceTabChildConfigs],\n  };\n\n  // Insert it into main layout\n  const currentNode = getNodeAtPath(currentTabLayout, ownPath);\n  if (typeof currentNode !== \"string\") {\n    return panelsState;\n  }\n  const newLayout = updateTree(\n    originalLayout,\n    createAddUpdates(originalLayout, currentNode, destinationPath, position),\n  );\n\n  let newPanelsState = changePanelLayout(panelsState, { layout: newLayout, trimConfigById: false });\n  newPanelsState = savePanelConfigs(newPanelsState, panelConfigs);\n  return newPanelsState;\n};\n\nconst dragToTabFromMain = (\n  panelsState: LayoutData,\n  {\n    originalLayout,\n    panelId,\n    targetTabId,\n    position,\n    destinationPath,\n    ownPath,\n    targetTabConfig,\n    sourceTabChildConfigs,\n  }: {\n    originalLayout: MosaicNode<string>;\n    panelId: string;\n    targetTabId: string;\n    position?: MosaicDropTargetPosition;\n    destinationPath?: MosaicPath;\n    ownPath: MosaicPath;\n    targetTabConfig?: TabPanelConfig;\n    sourceTabChildConfigs: ConfigsPayload[];\n  },\n): LayoutData => {\n  const saveConfigsPayload = addPanelToTab(\n    panelId,\n    destinationPath,\n    position,\n    targetTabConfig,\n    targetTabId,\n  );\n  const panelConfigs = {\n    ...saveConfigsPayload,\n    configs: [...saveConfigsPayload.configs, ...sourceTabChildConfigs],\n  };\n  const update = createRemoveUpdate(originalLayout, ownPath);\n  const newLayout = updateTree(originalLayout, [update]);\n  let newPanelsState = changePanelLayout(panelsState, { layout: newLayout, trimConfigById: false });\n  newPanelsState = savePanelConfigs(newPanelsState, { configs: panelConfigs.configs });\n  return newPanelsState;\n};\n\nconst dragToTabFromTab = (\n  panelsState: LayoutData,\n  {\n    originalLayout,\n    panelId,\n    sourceTabId,\n    targetTabId,\n    position,\n    destinationPath,\n    ownPath,\n    targetTabConfig,\n    sourceTabConfig,\n    sourceTabChildConfigs,\n  }: {\n    originalLayout: MosaicNode<string>;\n    panelId: string;\n    sourceTabId: string;\n    targetTabId: string;\n    position?: MosaicDropTargetPosition;\n    destinationPath?: MosaicPath;\n    ownPath: MosaicPath;\n    targetTabConfig?: TabPanelConfig;\n    sourceTabConfig: TabPanelConfig;\n    sourceTabChildConfigs: ConfigsPayload[];\n  },\n): LayoutData => {\n  // Remove panel from tab layout\n  const { configs: fromTabConfigs } = removePanelFromTabPanel(\n    ownPath,\n    sourceTabConfig,\n    sourceTabId,\n  );\n\n  // Insert it into another tab\n  const { configs: toTabConfigs } = addPanelToTab(\n    panelId,\n    destinationPath,\n    position,\n    targetTabConfig,\n    targetTabId,\n  );\n  let newPanelsState = changePanelLayout(panelsState, {\n    layout: originalLayout,\n    trimConfigById: false,\n  });\n  newPanelsState = savePanelConfigs(newPanelsState, {\n    configs: [\n      ...fromTabConfigs,\n      ...toTabConfigs,\n      // if the target tab is inside the source tab, make sure not to overwrite it with its old config\n      ...sourceTabChildConfigs.filter(({ id }) => id !== targetTabId),\n    ],\n  });\n  return newPanelsState;\n};\n\nconst startDrag = (\n  panelsState: LayoutData,\n  { path, sourceTabId }: StartDragPayload,\n): LayoutData => {\n  // Collapse or remove the panel being dragged so it's temporarily hidden from the layout.\n  if (path.length > 0) {\n    if (sourceTabId != undefined) {\n      const tabConfig = panelsState.configById[sourceTabId] as TabPanelConfig;\n      const activeLayout = tabConfig.tabs[tabConfig.activeTabIdx]?.layout;\n      if (activeLayout == undefined) {\n        return panelsState;\n      }\n      const newTabLayout = updateTree(activeLayout, [createHideUpdate(path)]);\n      const newTabConfig = updateTabPanelLayout(newTabLayout, tabConfig);\n      return savePanelConfigs(panelsState, {\n        configs: [{ id: sourceTabId, config: newTabConfig }],\n      });\n    }\n    return changePanelLayout(panelsState, {\n      layout: updateTree<string>(panelsState.layout ?? \"\", [createHideUpdate(path)]),\n      trimConfigById: false,\n    });\n  } else if (sourceTabId != undefined) {\n    // If we've dragged a panel from a single panel tab layout, remove that panel\n    const sourceTabConfig = panelsState.configById[sourceTabId] as TabPanelConfig;\n    return savePanelConfigs(panelsState, {\n      configs: [{ id: sourceTabId, config: updateTabPanelLayout(undefined, sourceTabConfig) }],\n    });\n  }\n  throw new Error(\"Can't drag the top-level panel of a layout\");\n};\n\nconst endDrag = (panelsState: LayoutData, dragPayload: EndDragPayload): LayoutData => {\n  const {\n    originalLayout,\n    originalSavedProps,\n    panelId,\n    sourceTabId,\n    targetTabId,\n    position,\n    destinationPath,\n    ownPath,\n  } = dragPayload;\n  const toMainFromTab = sourceTabId != undefined && targetTabId == undefined;\n  const toTabfromMain = sourceTabId == undefined && targetTabId != undefined;\n  const toTabfromTab = sourceTabId != undefined && targetTabId != undefined;\n  const withinSameTab = sourceTabId === targetTabId && toTabfromTab; // In case it's simply a drag within the main layout.\n\n  const sourceTabConfig =\n    sourceTabId != undefined ? (originalSavedProps[sourceTabId] as TabPanelConfig) : undefined;\n  const targetTabConfig =\n    targetTabId != undefined ? (originalSavedProps[targetTabId] as TabPanelConfig) : undefined;\n  const panelIdsInsideTabPanels =\n    sourceTabId != undefined ? getPanelIdsInsideTabPanels([sourceTabId], originalSavedProps) : [];\n\n  const sourceTabChildConfigs = filterMap(panelIdsInsideTabPanels, (id) => {\n    const config = originalSavedProps[id];\n    return config ? { id, config } : undefined;\n  });\n\n  // If dragging within the same tab without position & destination just cancel the drag.\n  if (withinSameTab && position == undefined && destinationPath == undefined) {\n    return { ...panelsState, layout: originalLayout, configById: originalSavedProps };\n  }\n\n  if (withinSameTab && sourceTabConfig && position != undefined && destinationPath != undefined) {\n    return dragWithinSameTab(panelsState, {\n      originalLayout,\n      sourceTabId,\n      position,\n      destinationPath,\n      ownPath,\n      sourceTabConfig,\n      sourceTabChildConfigs,\n    });\n  }\n\n  if (toMainFromTab && sourceTabConfig && position != undefined && destinationPath != undefined) {\n    return dragToMainFromTab(panelsState, {\n      originalLayout,\n      sourceTabId,\n      position,\n      destinationPath,\n      ownPath,\n      sourceTabConfig,\n      sourceTabChildConfigs,\n    });\n  }\n\n  if (toTabfromMain) {\n    return dragToTabFromMain(panelsState, {\n      originalLayout,\n      panelId,\n      targetTabId,\n      position,\n      destinationPath,\n      ownPath,\n      targetTabConfig,\n      sourceTabChildConfigs,\n    });\n  }\n\n  if (toTabfromTab && sourceTabConfig) {\n    return dragToTabFromTab(panelsState, {\n      originalLayout,\n      panelId,\n      sourceTabId,\n      targetTabId,\n      position,\n      destinationPath,\n      ownPath,\n      targetTabConfig,\n      sourceTabConfig,\n      sourceTabChildConfigs,\n    });\n  }\n\n  if (position != undefined && destinationPath != undefined && !isEqual(destinationPath, ownPath)) {\n    const updates = createDragToUpdates(originalLayout, ownPath, destinationPath, position);\n    const newLayout = updateTree(originalLayout, updates);\n    return changePanelLayout(panelsState, { layout: newLayout, trimConfigById: false });\n  }\n\n  // The drag was canceled; restore the original layout to re-show/re-add the dragged panel.\n  // This undoes the effects of startDrag().\n  return { ...panelsState, layout: originalLayout, configById: originalSavedProps };\n};\n\nexport default function (panelsState: Readonly<LayoutData>, action: PanelsActions): LayoutData {\n  // start the newPanelsState as the current panels state so if there are no changes the identity\n  // of the panels state object remains the same\n  switch (action.type) {\n    case \"CHANGE_PANEL_LAYOUT\":\n      return changePanelLayout(panelsState, action.payload);\n\n    case \"SAVE_PANEL_CONFIGS\":\n      return savePanelConfigs(panelsState, action.payload);\n\n    case \"SAVE_FULL_PANEL_CONFIG\":\n      return saveFullPanelConfig(panelsState, action.payload);\n\n    case \"CREATE_TAB_PANEL\":\n      return action.payload.singleTab\n        ? createTabPanelWithSingleTab(panelsState, action.payload)\n        : createTabPanelWithMultipleTabs(panelsState, action.payload);\n\n    case \"OVERWRITE_GLOBAL_DATA\":\n      return {\n        ...panelsState,\n        globalVariables: action.payload,\n      };\n\n    case \"SET_GLOBAL_DATA\": {\n      const globalVariables = {\n        ...panelsState.globalVariables,\n        ...action.payload,\n      };\n      Object.keys(globalVariables).forEach((key) => {\n        if (globalVariables[key] == undefined) {\n          delete globalVariables[key];\n        }\n      });\n      return {\n        ...panelsState,\n        globalVariables,\n      };\n    }\n\n    case \"SET_USER_NODES\": {\n      const userNodes = { ...panelsState.userNodes };\n      for (const [key, value] of Object.entries(action.payload)) {\n        if (value == undefined) {\n          delete userNodes[key];\n        } else {\n          userNodes[key] = value;\n        }\n      }\n      return {\n        ...panelsState,\n        userNodes,\n      };\n    }\n\n    case \"SET_PLAYBACK_CONFIG\":\n      return {\n        ...panelsState,\n        playbackConfig: {\n          ...panelsState.playbackConfig,\n          ...action.payload,\n        },\n      };\n    case \"CLOSE_PANEL\":\n      return closePanel(panelsState, action.payload);\n\n    case \"SPLIT_PANEL\":\n      return splitPanel(panelsState, action.payload);\n\n    case \"SWAP_PANEL\":\n      return swapPanel(panelsState, action.payload);\n\n    case \"MOVE_TAB\":\n      return moveTab(panelsState, action.payload);\n\n    case \"ADD_PANEL\":\n      return addPanel(panelsState, action.payload);\n\n    case \"DROP_PANEL\":\n      return dropPanel(panelsState, action.payload);\n\n    case \"START_DRAG\":\n      return startDrag(panelsState, action.payload);\n\n    case \"END_DRAG\":\n      return endDrag(panelsState, action.payload);\n\n    default:\n      throw new Error(\"This reducer should only be used for panel actions\");\n  }\n\n  return panelsState;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { LayoutData } from \"@foxglove/studio-base/context/CurrentLayoutContext/actions\";\nimport { defaultPlaybackConfig } from \"@foxglove/studio-base/providers/CurrentLayoutProvider/reducers\";\n\n/**\n * This is loaded when the user has no layout selected on application launch\n * to avoid presenting the user with a blank layout.\n */\nexport const defaultLayout: LayoutData = {\n  configById: {\n    \"3D!18i6zy7\": {\n      layers: {\n        \"845139cb-26bc-40b3-8161-8ab60af4baf5\": {\n          visible: true,\n          frameLocked: true,\n          label: \"Grid\",\n          instanceId: \"845139cb-26bc-40b3-8161-8ab60af4baf5\",\n          layerId: \"foxglove.Grid\",\n          size: 10,\n          divisions: 10,\n          lineWidth: 1,\n          color: \"#248eff\",\n          position: [0, 0, 0],\n          rotation: [0, 0, 0],\n          order: 1,\n        },\n      },\n    },\n    \"RawMessages!os6rgs\": {},\n    \"Image!3mnp456\": {},\n  },\n  globalVariables: {},\n  userNodes: {},\n  playbackConfig: { ...defaultPlaybackConfig },\n  layout: {\n    first: \"3D!18i6zy7\",\n    second: {\n      first: \"Image!3mnp456\",\n      second: \"RawMessages!os6rgs\",\n      direction: \"column\",\n      splitPercentage: 30,\n    },\n    direction: \"row\",\n    splitPercentage: 70,\n  },\n} as const;\n\n\nexport const sim2realLayout: LayoutData = {\n  \"configById\": {\n    \"3D!18i6zy7\": {\n      \"layers\": {\n        \"845139cb-26bc-40b3-8161-8ab60af4baf5\": {\n          \"visible\": true,\n          \"frameLocked\": true,\n          \"label\": \"Grid\",\n          \"instanceId\": \"845139cb-26bc-40b3-8161-8ab60af4baf5\",\n          \"layerId\": \"foxglove.Grid\",\n          \"size\": 10,\n          \"divisions\": 10,\n          \"lineWidth\": 1,\n          \"color\": \"#248eff\",\n          \"position\": [\n            0,\n            0,\n            0\n          ],\n          \"rotation\": [\n            0,\n            0,\n            0\n          ],\n          \"order\": 1\n        },\n        \"8f45cd38-5391-44c8-ac88-b7aed35cccc8\": {\n          \"visible\": true,\n          \"frameLocked\": true,\n          \"label\": \"URDF\",\n          \"instanceId\": \"8f45cd38-5391-44c8-ac88-b7aed35cccc8\",\n          \"layerId\": \"foxglove.Urdf\",\n          \"url\": \"http://localhost:8050/assets/urdf/ur5.urdf\",\n          \"order\": 2\n        }\n      },\n      \"cameraState\": {\n        \"perspective\": true,\n        \"distance\": 2.847914826858753,\n        \"phi\": 71.66371109252937,\n        \"thetaOffset\": 135.4790422047014,\n        \"targetOffset\": [\n          -0.20462355047924227,\n          0.08890785926927076,\n          2.2280064753084437e-17\n        ],\n        \"target\": [\n          0,\n          0,\n          0\n        ],\n        \"targetOrientation\": [\n          0,\n          0,\n          0,\n          1\n        ],\n        \"fovy\": 44,\n        \"near\": 0.7,\n        \"far\": 5000\n      },\n      \"followMode\": \"follow-pose\",\n      \"followTf\": \"base\",\n      \"scene\": {\n        \"labelScaleFactor\": 1,\n        \"ignoreColladaUpAxis\": false,\n        \"meshUpAxis\": \"y_up\",\n        \"syncCamera\": false,\n        \"transforms\": {\n          \"showLabel\": false,\n          \"enablePreloading\": true,\n          \"labelSize\": 0.19\n        }\n      },\n      \"transforms\": {\n        \"frame:base_link\": {\n          \"visible\": false\n        },\n        \"frame:base\": {\n          \"visible\": false\n        },\n        \"frame:base_link_inertia\": {\n          \"visible\": false\n        },\n        \"frame:shoulder_link\": {\n          \"visible\": false\n        },\n        \"frame:upper_arm_link\": {\n          \"visible\": false\n        },\n        \"frame:forearm_link\": {\n          \"visible\": false\n        },\n        \"frame:wrist_1_link\": {\n          \"visible\": false\n        },\n        \"frame:wrist_2_link\": {\n          \"visible\": false\n        },\n        \"frame:wrist_3_link\": {\n          \"visible\": false\n        },\n        \"frame:flange\": {\n          \"visible\": false\n        },\n        \"frame:tool0\": {\n          \"visible\": false\n        },\n        \"frame:tool0_controller\": {\n          \"visible\": false\n        },\n        \"frame:\": {\n          \"visible\": false\n        }\n      },\n      \"topics\": {\n        \"/move_group/display_grasp_markers\": {\n          \"visible\": false\n        },\n        \"/move_group/display_cost_sources\": {\n          \"visible\": false\n        },\n        \"/move_group/display_contacts\": {\n          \"visible\": false\n        },\n        \"/ur5_sim2real_bridge/camera1\": {\n          \"visible\": false\n        },\n        \"/initialpose\": {\n          \"visible\": false\n        },\n        \"/move_base_simple/goal\": {\n          \"visible\": false\n        }\n      },\n      \"publish\": {\n        \"type\": \"point\",\n        \"poseTopic\": \"/move_base_simple/goal\",\n        \"pointTopic\": \"/clicked_point\",\n        \"poseEstimateTopic\": \"/initialpose\",\n        \"poseEstimateXDeviation\": 0.5,\n        \"poseEstimateYDeviation\": 0.5,\n        \"poseEstimateThetaDeviation\": 0.26179939\n      },\n      \"imageMode\": {}\n    },\n    \"RawMessages!os6rgs\": {\n      \"diffEnabled\": false,\n      \"diffMethod\": \"custom\",\n      \"diffTopicPath\": \"\",\n      \"showFullMessageForDiff\": false,\n      \"topicPath\": \"\"\n    }\n  },\n  \"globalVariables\": {},\n  \"userNodes\": {},\n  playbackConfig: { ...defaultPlaybackConfig },\n  \"layout\": {\n    \"first\": \"3D!18i6zy7\",\n    \"second\": \"RawMessages!os6rgs\",\n    \"direction\": \"row\",\n    \"splitPercentage\": 70\n  },\n} as const;","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport {\n  Button,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogContentText,\n  DialogTitle,\n  Link,\n} from \"@mui/material\";\nimport { useTranslation } from \"react-i18next\";\n\nimport isDesktopApp from \"@foxglove/studio-base/util/isDesktopApp\";\n\ntype Props = {\n  isDesktop?: boolean;\n  onClose: () => void;\n};\n\nexport function IncompatibleLayoutVersionAlert(props: Props): JSX.Element {\n  const { isDesktop, onClose } = props;\n  const { t } = useTranslation(\"incompatibleLayoutVersion\");\n\n  const showDesktopText = isDesktop ?? isDesktopApp();\n\n  return (\n    <Dialog open onClose={onClose}>\n      <DialogTitle>{t(\"title\")}</DialogTitle>\n      <DialogContent>\n        {showDesktopText && (\n          <DialogContentText>\n            {t(\"desktopText\")}\n            <Link target=\"_blank\" href=\"https://foxglove.dev/download\">\n              https://foxglove.dev/download\n            </Link>\n            .\n          </DialogContentText>\n        )}\n        {!showDesktopText && <DialogContentText>{t(\"webText\")}</DialogContentText>}\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={onClose} variant=\"contained\">\n          OK\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { difference, isEqual } from \"lodash\";\nimport { useSnackbar } from \"notistack\";\nimport { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\nimport { getNodeAtPath } from \"react-mosaic-component\";\nimport { useAsync, useAsyncFn, useMountedState } from \"react-use\";\nimport shallowequal from \"shallowequal\";\nimport { v4 as uuidv4 } from \"uuid\";\n\nimport { useShallowMemo } from \"@foxglove/hooks\";\nimport Logger from \"@foxglove/log\";\nimport { VariableValue } from \"@foxglove/studio\";\nimport { useAnalytics } from \"@foxglove/studio-base/context/AnalyticsContext\";\nimport CurrentLayoutContext, {\n  ICurrentLayout,\n  LayoutID,\n  LayoutState,\n} from \"@foxglove/studio-base/context/CurrentLayoutContext\";\nimport {\n  AddPanelPayload,\n  ChangePanelLayoutPayload,\n  ClosePanelPayload,\n  CreateTabPanelPayload,\n  DropPanelPayload,\n  EndDragPayload,\n  MoveTabPayload,\n  PanelsActions,\n  SaveConfigsPayload,\n  SplitPanelPayload,\n  StartDragPayload,\n  SwapPanelPayload,\n} from \"@foxglove/studio-base/context/CurrentLayoutContext/actions\";\nimport { useLayoutManager } from \"@foxglove/studio-base/context/LayoutManagerContext\";\nimport { useUserProfileStorage } from \"@foxglove/studio-base/context/UserProfileStorageContext\";\nimport { sim2realLayout } from \"@foxglove/studio-base/providers/CurrentLayoutProvider/defaultLayout\";\nimport panelsReducer from \"@foxglove/studio-base/providers/CurrentLayoutProvider/reducers\";\nimport { AppEvent } from \"@foxglove/studio-base/services/IAnalytics\";\nimport { LayoutManagerEventTypes } from \"@foxglove/studio-base/services/ILayoutManager\";\nimport { PanelConfig, PlaybackConfig, UserNodes } from \"@foxglove/studio-base/types/panels\";\nimport { windowAppURLState } from \"@foxglove/studio-base/util/appURLState\";\nimport { getPanelTypeFromId } from \"@foxglove/studio-base/util/layout\";\n\nimport { IncompatibleLayoutVersionAlert } from \"./IncompatibleLayoutVersionAlert\";\n\nconst log = Logger.getLogger(__filename);\n\nexport const MAX_SUPPORTED_LAYOUT_VERSION = 1;\n\n/**\n * Concrete implementation of CurrentLayoutContext.Provider which handles\n * automatically restoring the current layout from LayoutStorage.\n */\nexport default function CurrentLayoutProvider({\n  children,\n}: React.PropsWithChildren<unknown>): JSX.Element {\n  const { enqueueSnackbar } = useSnackbar();\n  const { getUserProfile, setUserProfile } = useUserProfileStorage();\n  const layoutManager = useLayoutManager();\n  const analytics = useAnalytics();\n  const isMounted = useMountedState();\n\n  const [mosaicId] = useState(() => uuidv4());\n\n  const layoutStateListeners = useRef(new Set<(_: LayoutState) => void>());\n  const addLayoutStateListener = useCallback((listener: (_: LayoutState) => void) => {\n    layoutStateListeners.current.add(listener);\n  }, []);\n  const removeLayoutStateListener = useCallback((listener: (_: LayoutState) => void) => {\n    layoutStateListeners.current.delete(listener);\n  }, []);\n\n  const [layoutState, setLayoutStateInternal] = useState<LayoutState>({\n    selectedLayout: undefined,\n  });\n  const layoutStateRef = useRef(layoutState);\n  const [incompatibleLayoutVersionError, setIncompatibleLayoutVersionError] = useState(false);\n  const setLayoutState = useCallback((newState: LayoutState) => {\n    setLayoutStateInternal(newState);\n\n    // listeners rely on being able to getCurrentLayoutState() inside effects that may run before we re-render\n    layoutStateRef.current = newState;\n\n    for (const listener of [...layoutStateListeners.current]) {\n      listener(newState);\n    }\n  }, []);\n\n  const selectedPanelIds = useRef<readonly string[]>([]);\n  const selectedPanelIdsListeners = useRef(new Set<(_: readonly string[]) => void>());\n  const addSelectedPanelIdsListener = useCallback((listener: (_: readonly string[]) => void) => {\n    selectedPanelIdsListeners.current.add(listener);\n  }, []);\n  const removeSelectedPanelIdsListener = useCallback((listener: (_: readonly string[]) => void) => {\n    selectedPanelIdsListeners.current.delete(listener);\n  }, []);\n\n  const getSelectedPanelIds = useCallback(() => selectedPanelIds.current, []);\n  const setSelectedPanelIds = useCallback(\n    (value: readonly string[] | ((prevState: readonly string[]) => readonly string[])): void => {\n      const newValue = typeof value === \"function\" ? value(selectedPanelIds.current) : value;\n      if (!shallowequal(newValue, selectedPanelIds.current)) {\n        selectedPanelIds.current = newValue;\n        for (const listener of [...selectedPanelIdsListeners.current]) {\n          listener(selectedPanelIds.current);\n        }\n      }\n    },\n    [],\n  );\n\n  const [, setSelectedLayoutId] = useAsyncFn(\n    async (\n      id: LayoutID | undefined,\n      { saveToProfile = true }: { saveToProfile?: boolean } = {},\n    ) => {\n      if (id == undefined) {\n        setLayoutState({ selectedLayout: undefined });\n        return;\n      }\n      try {\n        setLayoutState({ selectedLayout: { id, loading: true, data: undefined } });\n        const layout = await layoutManager.getLayout(id);\n        const layoutVersion = layout?.baseline.data.version;\n        if (layoutVersion != undefined && layoutVersion > MAX_SUPPORTED_LAYOUT_VERSION) {\n          setIncompatibleLayoutVersionError(true);\n          setLayoutState({ selectedLayout: undefined });\n          return;\n        }\n        if (!isMounted()) {\n          return;\n        }\n        setIncompatibleLayoutVersionError(false);\n        if (layout == undefined) {\n          setLayoutState({ selectedLayout: undefined });\n        } else {\n          setLayoutState({\n            selectedLayout: {\n              loading: false,\n              id: layout.id,\n              data: layout.working?.data ?? layout.baseline.data,\n              name: layout.name,\n            },\n          });\n          if (saveToProfile) {\n            setUserProfile({ currentLayoutId: id }).catch((error) => {\n              console.error(error);\n              enqueueSnackbar(`The current layout could not be saved. ${error.toString()}`, {\n                variant: \"error\",\n              });\n            });\n          }\n        }\n      } catch (error) {\n        console.error(error);\n        enqueueSnackbar(`The layout could not be loaded. ${error.toString()}`, {\n          variant: \"error\",\n        });\n        setIncompatibleLayoutVersionError(false);\n        setLayoutState({ selectedLayout: undefined });\n      }\n    },\n    [enqueueSnackbar, isMounted, layoutManager, setLayoutState, setUserProfile],\n  );\n\n  const performAction = useCallback(\n    (action: PanelsActions) => {\n      if (\n        layoutStateRef.current.selectedLayout?.data == undefined ||\n        layoutStateRef.current.selectedLayout.loading === true\n      ) {\n        return;\n      }\n      const oldData = layoutStateRef.current.selectedLayout.data;\n      const newData = panelsReducer(oldData, action);\n\n      // The panel state did not change, so no need to perform layout state\n      // updates or layout manager updates.\n      if (isEqual(oldData, newData)) {\n        log.warn(\"Panel action resulted in identical config:\", action);\n        return;\n      }\n\n      setLayoutState({\n        selectedLayout: {\n          id: layoutStateRef.current.selectedLayout.id,\n          data: newData,\n          loading: false,\n          name: layoutStateRef.current.selectedLayout.name,\n          edited: true,\n        },\n      });\n    },\n    [setLayoutState],\n  );\n\n  // Changes to the layout storage from external user actions (such as resetting a layout to a\n  // previous saved state) need to trigger setLayoutState.\n  useEffect(() => {\n    const listener: LayoutManagerEventTypes[\"change\"] = ({ updatedLayout }) => {\n      if (\n        updatedLayout &&\n        layoutStateRef.current.selectedLayout &&\n        updatedLayout.id === layoutStateRef.current.selectedLayout.id\n      ) {\n        setLayoutState({\n          selectedLayout: {\n            loading: false,\n            id: updatedLayout.id,\n            data: updatedLayout.working?.data ?? updatedLayout.baseline.data,\n            name: updatedLayout.name,\n          },\n        });\n      }\n    };\n    layoutManager.on(\"change\", listener);\n    return () => {\n      layoutManager.off(\"change\", listener);\n    };\n  }, [layoutManager, setLayoutState]);\n\n  // Make sure our layout still exists after changes. If not deselect it.\n  useEffect(() => {\n    const listener: LayoutManagerEventTypes[\"change\"] = async (event) => {\n      if (event.type !== \"delete\" || !layoutStateRef.current.selectedLayout?.id) {\n        return;\n      }\n\n      if (event.layoutId === layoutStateRef.current.selectedLayout.id) {\n        const layouts = await layoutManager.getLayouts();\n        await setSelectedLayoutId(layouts[0]?.id);\n      }\n    };\n\n    layoutManager.on(\"change\", listener);\n    return () => layoutManager.off(\"change\", listener);\n  }, [enqueueSnackbar, layoutManager, setSelectedLayoutId]);\n\n  // Load initial state by re-selecting the last selected layout from the UserProfile.\n  useAsync(async () => {\n    // Don't restore the layout if there's one specified in the app state url.\n    if (windowAppURLState()?.layoutId) {\n      return;\n    }\n\n    // Retreive the selected layout id from the user's profile. If there's no layout specified\n    // or we can't load it then save and select a default layout.\n    const { currentLayoutId } = await getUserProfile();\n    const layout = currentLayoutId ? await layoutManager.getLayout(currentLayoutId) : undefined;\n    console.log(\"LAYOUT\", layout);\n    if (layout) {\n      await setSelectedLayoutId(currentLayoutId, { saveToProfile: false });\n    } else {\n      const newLayout = await layoutManager.saveNewLayout({\n        name: \"Default\",\n        data: sim2realLayout,\n        permission: \"CREATOR_WRITE\",\n      });\n      await setSelectedLayoutId(newLayout.id);\n    }\n  }, [getUserProfile, layoutManager, setSelectedLayoutId]);\n\n  const actions: ICurrentLayout[\"actions\"] = useMemo(\n    () => ({\n      setSelectedLayoutId,\n      getCurrentLayoutState: () => layoutStateRef.current,\n\n      savePanelConfigs: (payload: SaveConfigsPayload) =>\n        performAction({ type: \"SAVE_PANEL_CONFIGS\", payload }),\n      updatePanelConfigs: (panelType: string, perPanelFunc: (config: PanelConfig) => PanelConfig) =>\n        performAction({ type: \"SAVE_FULL_PANEL_CONFIG\", payload: { panelType, perPanelFunc } }),\n      createTabPanel: (payload: CreateTabPanelPayload) => {\n        performAction({ type: \"CREATE_TAB_PANEL\", payload });\n        setSelectedPanelIds([]);\n        void analytics.logEvent(AppEvent.PANEL_ADD, { type: \"Tab\" });\n      },\n      changePanelLayout: (payload: ChangePanelLayoutPayload) =>\n        performAction({ type: \"CHANGE_PANEL_LAYOUT\", payload }),\n      overwriteGlobalVariables: (payload: Record<string, VariableValue>) =>\n        performAction({ type: \"OVERWRITE_GLOBAL_DATA\", payload }),\n      setGlobalVariables: (payload: Record<string, VariableValue>) =>\n        performAction({ type: \"SET_GLOBAL_DATA\", payload }),\n      setUserNodes: (payload: Partial<UserNodes>) =>\n        performAction({ type: \"SET_USER_NODES\", payload }),\n      setPlaybackConfig: (payload: Partial<PlaybackConfig>) =>\n        performAction({ type: \"SET_PLAYBACK_CONFIG\", payload }),\n      closePanel: (payload: ClosePanelPayload) => {\n        performAction({ type: \"CLOSE_PANEL\", payload });\n\n        const closedId = getNodeAtPath(payload.root, payload.path);\n        // Deselect the removed panel\n        setSelectedPanelIds((ids) => ids.filter((id) => id !== closedId));\n\n        void analytics.logEvent(\n          AppEvent.PANEL_DELETE,\n          typeof closedId === \"string\" ? { type: getPanelTypeFromId(closedId) } : undefined,\n        );\n      },\n      splitPanel: (payload: SplitPanelPayload) => performAction({ type: \"SPLIT_PANEL\", payload }),\n      swapPanel: (payload: SwapPanelPayload) => {\n        // Select the new panel if the original panel was selected. We don't know what\n        // the new panel id will be so we diff the panelIds of the old and\n        // new layout so we can select the new panel.\n        const originalIsSelected = selectedPanelIds.current.includes(payload.originalId);\n        const beforePanelIds = Object.keys(\n          layoutStateRef.current.selectedLayout?.data?.configById ?? {},\n        );\n        performAction({ type: \"SWAP_PANEL\", payload });\n        if (originalIsSelected) {\n          const afterPanelIds = Object.keys(\n            layoutStateRef.current.selectedLayout?.data?.configById ?? {},\n          );\n          setSelectedPanelIds(difference(afterPanelIds, beforePanelIds));\n        }\n        void analytics.logEvent(AppEvent.PANEL_ADD, { type: payload.type, action: \"swap\" });\n        void analytics.logEvent(AppEvent.PANEL_DELETE, {\n          type: getPanelTypeFromId(payload.originalId),\n          action: \"swap\",\n        });\n      },\n      moveTab: (payload: MoveTabPayload) => performAction({ type: \"MOVE_TAB\", payload }),\n      addPanel: (payload: AddPanelPayload) => {\n        performAction({ type: \"ADD_PANEL\", payload });\n        void analytics.logEvent(AppEvent.PANEL_ADD, { type: getPanelTypeFromId(payload.id) });\n      },\n      dropPanel: (payload: DropPanelPayload) => {\n        performAction({ type: \"DROP_PANEL\", payload });\n        void analytics.logEvent(AppEvent.PANEL_ADD, {\n          type: payload.newPanelType,\n          action: \"drop\",\n        });\n      },\n      startDrag: (payload: StartDragPayload) => performAction({ type: \"START_DRAG\", payload }),\n      endDrag: (payload: EndDragPayload) => performAction({ type: \"END_DRAG\", payload }),\n    }),\n    [analytics, performAction, setSelectedLayoutId, setSelectedPanelIds],\n  );\n\n  const value: ICurrentLayout = useShallowMemo({\n    addLayoutStateListener,\n    removeLayoutStateListener,\n    addSelectedPanelIdsListener,\n    removeSelectedPanelIdsListener,\n    mosaicId,\n    getSelectedPanelIds,\n    setSelectedPanelIds,\n    actions,\n  });\n\n  return (\n    <CurrentLayoutContext.Provider value={value}>\n      {children}\n      {incompatibleLayoutVersionError && (\n        <IncompatibleLayoutVersionAlert onClose={() => setIncompatibleLayoutVersionError(false)} />\n      )}\n    </CurrentLayoutContext.Provider>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport React, { PropsWithChildren, useEffect, useState } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { StoreApi, createStore } from \"zustand\";\n\nimport Logger from \"@foxglove/log\";\nimport {\n  ExtensionContext,\n  ExtensionModule,\n  RegisterMessageConverterArgs,\n  TopicAliasFunction,\n} from \"@foxglove/studio\";\nimport {\n  ExtensionCatalog,\n  ExtensionCatalogContext,\n  RegisteredPanel,\n} from \"@foxglove/studio-base/context/ExtensionCatalogContext\";\nimport { TopicAliasFunctions } from \"@foxglove/studio-base/players/TopicAliasingPlayer/aliasing\";\nimport { ExtensionLoader } from \"@foxglove/studio-base/services/ExtensionLoader\";\nimport { ExtensionInfo, ExtensionNamespace } from \"@foxglove/studio-base/types/Extensions\";\n\nconst log = Logger.getLogger(__filename);\n\ntype ContributionPoints = {\n  panels: Record<string, RegisteredPanel>;\n  messageConverters: RegisterMessageConverterArgs<unknown>[];\n  topicAliasFunctions: TopicAliasFunctions;\n};\n\nfunction activateExtension(\n  extension: ExtensionInfo,\n  unwrappedExtensionSource: string,\n): ContributionPoints {\n  // registered panels stored by their fully qualified id\n  // the fully qualified id is the extension name + panel name\n  const panels: Record<string, RegisteredPanel> = {};\n\n  const messageConverters: RegisterMessageConverterArgs<unknown>[] = [];\n\n  const topicAliasFunctions: ContributionPoints[\"topicAliasFunctions\"] = [];\n\n  log.debug(`Activating extension ${extension.qualifiedName}`);\n\n  const module = { exports: {} };\n  const require = (name: string) => {\n    return { react: React, \"react-dom\": ReactDOM }[name];\n  };\n\n  const extensionMode =\n    process.env.NODE_ENV === \"production\"\n      ? \"production\"\n      : process.env.NODE_ENV === \"test\"\n      ? \"test\"\n      : \"development\";\n\n  const ctx: ExtensionContext = {\n    mode: extensionMode,\n\n    registerPanel: (params) => {\n      log.debug(`Extension ${extension.qualifiedName} registering panel: ${params.name}`);\n\n      const fullId = `${extension.qualifiedName}.${params.name}`;\n      if (panels[fullId]) {\n        log.warn(`Panel ${fullId} is already registered`);\n        return;\n      }\n\n      panels[fullId] = {\n        extensionName: extension.qualifiedName,\n        extensionNamespace: extension.namespace,\n        registration: params,\n      };\n    },\n\n    registerMessageConverter: <Src,>(args: RegisterMessageConverterArgs<Src>) => {\n      log.debug(\n        `Extension ${extension.qualifiedName} registering message converter from: ${args.fromSchemaName} to: ${args.toSchemaName}`,\n      );\n      messageConverters.push(args as RegisterMessageConverterArgs<unknown>);\n    },\n\n    registerTopicAliases: (aliasFunction: TopicAliasFunction) => {\n      topicAliasFunctions.push({ aliasFunction, extensionId: extension.id });\n    },\n  };\n\n  try {\n    // eslint-disable-next-line no-new-func\n    const fn = new Function(\"module\", \"require\", unwrappedExtensionSource);\n\n    // load the extension module exports\n    fn(module, require, {});\n    const wrappedExtensionModule = module.exports as ExtensionModule;\n\n    wrappedExtensionModule.activate(ctx);\n  } catch (err) {\n    log.error(err);\n  }\n\n  return {\n    panels,\n    messageConverters,\n    topicAliasFunctions,\n  };\n}\n\nexport function createExtensionRegistryStore(\n  loaders: readonly ExtensionLoader[],\n  mockMessageConverters: readonly RegisterMessageConverterArgs<unknown>[] | undefined,\n): StoreApi<ExtensionCatalog> {\n  return createStore((set, get) => ({\n    downloadExtension: async (url: string) => {\n      const res = await fetch(url);\n      return new Uint8Array(await res.arrayBuffer());\n    },\n\n    installExtension: async (namespace: ExtensionNamespace, foxeFileData: Uint8Array) => {\n      const namespacedLoader = loaders.find((loader) => loader.namespace === namespace);\n      if (namespacedLoader == undefined) {\n        throw new Error(\"No extension loader found for namespace \" + namespace);\n      }\n      const info = await namespacedLoader.installExtension(foxeFileData);\n      await get().refreshExtensions();\n      return info;\n    },\n\n    refreshExtensions: async () => {\n      if (loaders.length === 0) {\n        return;\n      }\n\n      const extensionList: ExtensionInfo[] = [];\n      const allContributionPoints: ContributionPoints = {\n        panels: {},\n        messageConverters: [],\n        topicAliasFunctions: [],\n      };\n      for (const loader of loaders) {\n        try {\n          for (const extension of await loader.getExtensions()) {\n            try {\n              extensionList.push(extension);\n              const unwrappedExtensionSource = await loader.loadExtension(extension.id);\n              const contributionPoints = activateExtension(extension, unwrappedExtensionSource);\n              Object.assign(allContributionPoints.panels, contributionPoints.panels);\n              allContributionPoints.messageConverters.push(...contributionPoints.messageConverters);\n              allContributionPoints.topicAliasFunctions.push(\n                ...contributionPoints.topicAliasFunctions,\n              );\n            } catch (err) {\n              log.error(\"Error loading extension\", err);\n            }\n          }\n        } catch (err) {\n          log.error(\"Error loading extension list\", err);\n        }\n      }\n      log.debug(`Found ${extensionList.length} extension(s)`);\n      set({\n        installedExtensions: extensionList,\n        installedPanels: allContributionPoints.panels,\n        installedMessageConverters: allContributionPoints.messageConverters,\n        installedTopicAliasFunctions: allContributionPoints.topicAliasFunctions,\n      });\n    },\n\n    // If there are no loaders then we know there will not be any installed extensions\n    installedExtensions: loaders.length === 0 ? [] : undefined,\n\n    installedPanels: {},\n\n    installedMessageConverters: mockMessageConverters ?? [],\n\n    installedTopicAliasFunctions: [],\n\n    uninstallExtension: async (namespace: ExtensionNamespace, id: string) => {\n      const namespacedLoader = loaders.find((loader) => loader.namespace === namespace);\n      if (namespacedLoader == undefined) {\n        throw new Error(\"No extension loader found for namespace \" + namespace);\n      }\n      await namespacedLoader.uninstallExtension(id);\n      await get().refreshExtensions();\n    },\n  }));\n}\n\nexport default function ExtensionCatalogProvider({\n  children,\n  loaders,\n  mockMessageConverters,\n}: PropsWithChildren<{\n  loaders: readonly ExtensionLoader[];\n  mockMessageConverters?: readonly RegisterMessageConverterArgs<unknown>[];\n}>): JSX.Element {\n  const [store] = useState(createExtensionRegistryStore(loaders, mockMessageConverters));\n\n  // Request an initial refresh on first mount\n  const refreshExtensions = store.getState().refreshExtensions;\n  useEffect(() => {\n    refreshExtensions().catch((err) => log.error(err));\n  }, [refreshExtensions]);\n\n  return (\n    <ExtensionCatalogContext.Provider value={store}>{children}</ExtensionCatalogContext.Provider>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useCallback } from \"react\";\n\nimport { useShallowMemo } from \"@foxglove/hooks\";\nimport ExtensionMarketplaceContext, {\n  ExtensionMarketplaceDetail,\n} from \"@foxglove/studio-base/context/ExtensionMarketplaceContext\";\n\nconst MARKETPLACE_URL =\n  \"https://raw.githubusercontent.com/foxglove/studio-extension-marketplace/main/extensions.json\";\n\nexport default function ExtensionMarketplaceProvider({\n  children,\n}: React.PropsWithChildren<unknown>): JSX.Element {\n  const getAvailableExtensions = useCallback(async (): Promise<ExtensionMarketplaceDetail[]> => {\n    const res = await fetch(MARKETPLACE_URL);\n    return (await res.json()) as ExtensionMarketplaceDetail[];\n  }, []);\n  const getMarkdown = useCallback(async (url: string): Promise<string> => {\n    const res = await fetch(url);\n    return await res.text();\n  }, []);\n  const marketplace = useShallowMemo({\n    getAvailableExtensions,\n    getMarkdown,\n  });\n  return (\n    <ExtensionMarketplaceContext.Provider value={marketplace}>\n      {children}\n    </ExtensionMarketplaceContext.Provider>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { createContext, useContext } from \"react\";\n\nimport { IRemoteLayoutStorage } from \"@foxglove/studio-base/services/IRemoteLayoutStorage\";\n\nconst RemoteLayoutStorageContext = createContext<IRemoteLayoutStorage | undefined>(undefined);\nRemoteLayoutStorageContext.displayName = \"RemoteLayoutStorageContext\";\n\nexport function useRemoteLayoutStorage(): IRemoteLayoutStorage | undefined {\n  return useContext(RemoteLayoutStorageContext);\n}\n\n// ts-prune-ignore-next\nexport default RemoteLayoutStorageContext;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { LayoutID } from \"@foxglove/studio-base/context/CurrentLayoutContext\";\nimport { LayoutData } from \"@foxglove/studio-base/context/CurrentLayoutContext/actions\";\n\n// We use \"brand\" tags to prevent confusion between string types with distinct meanings\n// https://github.com/microsoft/TypeScript/issues/4895\nexport type ISO8601Timestamp = string & { __brand: \"ISO8601Timestamp\" };\n\nexport type LayoutPermission = \"CREATOR_WRITE\" | \"ORG_READ\" | \"ORG_WRITE\";\n\nexport type LayoutSyncStatus =\n  | \"new\"\n  | \"updated\"\n  | \"tracked\"\n  | \"locally-deleted\"\n  | \"remotely-deleted\";\nexport type Layout = {\n  id: LayoutID;\n  name: string;\n  permission: LayoutPermission;\n\n  /** @deprecated old field name, migrated to working/baseline */\n  data?: LayoutData;\n  /** @deprecated old field name, migrated to working/baseline */\n  state?: LayoutData;\n\n  /** The last explicitly saved version of this layout. */\n  baseline: {\n    data: LayoutData;\n    savedAt: ISO8601Timestamp | undefined;\n  };\n\n  /**\n   * The working copy of this layout, if it has been edited since the last explicit save.\n   */\n  working:\n    | {\n        data: LayoutData;\n        savedAt: ISO8601Timestamp | undefined;\n      }\n    | undefined;\n\n  /** Info about this layout from remote storage. */\n  syncInfo:\n    | {\n        status: LayoutSyncStatus;\n        /** The last savedAt time returned by the server. */\n        lastRemoteSavedAt: ISO8601Timestamp | undefined;\n      }\n    | undefined;\n};\n\nexport interface ILayoutStorage {\n  list(namespace: string): Promise<readonly Layout[]>;\n  get(namespace: string, id: LayoutID): Promise<Layout | undefined>;\n  put(namespace: string, layout: Layout): Promise<Layout>;\n  delete(namespace: string, id: LayoutID): Promise<void>;\n\n  /**\n   * If applicable, the layout manager will call this method to migrate any old existing local\n   * layouts into the new namespace used for local layouts.\n   */\n  migrateUnnamespacedLayouts?(namespace: string): Promise<void>;\n\n  /**\n   * The layout manager will call this method to convert any local layouts to personal layouts when logging in.\n   */\n  importLayouts(params: { fromNamespace: string; toNamespace: string }): Promise<void>;\n}\n\nexport function layoutPermissionIsShared(\n  permission: LayoutPermission,\n): permission is Exclude<LayoutPermission, \"CREATOR_WRITE\"> {\n  return permission !== \"CREATOR_WRITE\";\n}\n\nexport function layoutIsShared(\n  layout: Layout,\n): layout is Layout & { permission: Exclude<LayoutPermission, \"CREATOR_WRITE\"> } {\n  return layoutPermissionIsShared(layout.permission);\n}\n\nexport function layoutAppearsDeleted(layout: Layout): boolean {\n  return (\n    layout.syncInfo?.status === \"locally-deleted\" ||\n    (layout.syncInfo?.status === \"remotely-deleted\" && layout.working == undefined)\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport Logger from \"@foxglove/log\";\nimport { LayoutID } from \"@foxglove/studio-base/context/CurrentLayoutContext\";\nimport { ILayoutStorage, Layout } from \"@foxglove/studio-base/services/ILayoutStorage\";\n\nconst log = Logger.getLogger(__filename);\n\n/**\n * A wrapper around ILayoutStorage for a particular namespace.\n */\nexport class NamespacedLayoutStorage {\n  #migration: Promise<void>;\n  public constructor(\n    private storage: ILayoutStorage,\n    private namespace: string,\n    {\n      migrateUnnamespacedLayouts,\n      importFromNamespace,\n    }: { migrateUnnamespacedLayouts: boolean; importFromNamespace: string | undefined },\n  ) {\n    this.#migration = (async function () {\n      if (migrateUnnamespacedLayouts) {\n        await storage\n          .migrateUnnamespacedLayouts?.(namespace)\n          .catch((error) => log.error(\"Migration failed:\", error));\n      }\n\n      if (importFromNamespace != undefined) {\n        await storage\n          .importLayouts({\n            fromNamespace: importFromNamespace,\n            toNamespace: namespace,\n          })\n          .catch((error) => log.error(\"Import failed:\", error));\n      }\n    })();\n  }\n\n  public async list(): Promise<readonly Layout[]> {\n    await this.#migration;\n    return await this.storage.list(this.namespace);\n  }\n  public async get(id: LayoutID): Promise<Layout | undefined> {\n    await this.#migration;\n    return await this.storage.get(this.namespace, id);\n  }\n  public async put(layout: Layout): Promise<Layout> {\n    await this.#migration;\n    return await this.storage.put(this.namespace, layout);\n  }\n  public async delete(id: LayoutID): Promise<void> {\n    await this.#migration;\n    await this.storage.delete(this.namespace, id);\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { LazilyInitialized } from \"@foxglove/den/async\";\nimport { LayoutID } from \"@foxglove/studio-base/context/CurrentLayoutContext\";\nimport { ILayoutStorage, Layout } from \"@foxglove/studio-base/services/ILayoutStorage\";\n\n/**\n * A view of ILayoutCache which only calls the underlying list() once per namespace, and implements\n * all operations on the cached data in memory as well as writing through to the underlying storage.\n *\n * For this to be useful, we must assume nothing else is accessing the same underlying storage.\n */\nexport default class WriteThroughLayoutCache implements ILayoutStorage {\n  #cacheByNamespace = new Map<string, LazilyInitialized<Map<string, Layout>>>();\n\n  public constructor(private storage: ILayoutStorage) {}\n\n  #getOrCreateCache(namespace: string): LazilyInitialized<Map<string, Layout>> {\n    let cache = this.#cacheByNamespace.get(namespace);\n    if (!cache) {\n      cache = new LazilyInitialized(\n        async () =>\n          await this.storage\n            .list(namespace)\n            .then((layouts) => new Map(layouts.map((layout) => [layout.id, layout]))),\n      );\n      this.#cacheByNamespace.set(namespace, cache);\n    }\n    return cache;\n  }\n\n  public async importLayouts(params: {\n    fromNamespace: string;\n    toNamespace: string;\n  }): Promise<void> {\n    return await this.storage.importLayouts(params);\n  }\n\n  public async migrateUnnamespacedLayouts(namespace: string): Promise<void> {\n    await this.storage.migrateUnnamespacedLayouts?.(namespace);\n  }\n\n  public async list(namespace: string): Promise<readonly Layout[]> {\n    return Array.from((await this.#getOrCreateCache(namespace).get()).values());\n  }\n\n  public async get(namespace: string, id: LayoutID): Promise<Layout | undefined> {\n    return (await this.#getOrCreateCache(namespace).get()).get(id);\n  }\n\n  public async put(namespace: string, layout: Layout): Promise<Layout> {\n    const result = await this.storage.put(namespace, layout);\n    (await this.#getOrCreateCache(namespace).get()).set(result.id, result);\n    return result;\n  }\n\n  public async delete(namespace: string, id: LayoutID): Promise<void> {\n    await this.storage.delete(namespace, id);\n    (await this.#getOrCreateCache(namespace).get()).delete(id);\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { diff } from \"just-diff\";\n\nimport { LayoutData } from \"@foxglove/studio-base/context/CurrentLayoutContext/actions\";\n\n/**\n * isLayoutEqual compares two LayoutData instances for \"equality\". If the two instances are\n * considered \"equal\" then the function returns true. If the two instances are not equal it returns\n * false.\n *\n * Layout instances are considered equal if they have all of the same fields and all of the same\n * values in those fields - recursively. An exception is made for where _b_ only differes from _a_\n * by introducing new fields which are _undefined_. If _b_ has an extra field with value undefined,\n * it will still be considered equal to _a_.\n */\nexport function isLayoutEqual(a: LayoutData, b: LayoutData): boolean {\n  const res = diff(a, b);\n  for (const item of res) {\n    // Any replace or remove is treated as a diff\n    if (item.op === \"replace\" || item.op === \"remove\") {\n      return false;\n    }\n\n    // If a field is added but the value is anything other than undefined, the layouts are not the same\n    if (item.value != undefined) {\n      return false;\n    }\n  }\n\n  // No actual diff, so the values are the same\n  return true;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport Logger from \"@foxglove/log\";\nimport { Layout, layoutIsShared } from \"@foxglove/studio-base/services/ILayoutStorage\";\nimport { RemoteLayout } from \"@foxglove/studio-base/services/IRemoteLayoutStorage\";\n\nconst log = Logger.getLogger(__filename);\n\nexport type SyncOperation =\n  | { local: true; type: \"add-to-cache\"; remoteLayout: RemoteLayout }\n  | { local: true; type: \"delete-local\"; localLayout: Layout }\n  | { local: true; type: \"mark-deleted\"; localLayout: Layout }\n  | { local: false; type: \"delete-remote\"; localLayout: Layout }\n  | { local: false; type: \"upload-new\"; localLayout: Layout }\n  | { local: false; type: \"upload-updated\"; localLayout: Layout }\n  | {\n      local: true;\n      type: \"update-baseline\";\n      localLayout: Layout & { syncInfo: NonNullable<Layout[\"syncInfo\"]> };\n      remoteLayout: RemoteLayout;\n    };\n\nexport default function computeLayoutSyncOperations(\n  localLayouts: readonly Layout[],\n  remoteLayouts: readonly RemoteLayout[],\n): SyncOperation[] {\n  const ops: SyncOperation[] = [];\n\n  const remoteLayoutsById = new Map(remoteLayouts.map((layout) => [layout.id, layout]));\n\n  for (const localLayout of localLayouts) {\n    const remoteLayout = remoteLayoutsById.get(localLayout.id);\n    if (remoteLayout) {\n      remoteLayoutsById.delete(localLayout.id);\n      switch (localLayout.syncInfo?.status) {\n        case undefined:\n        case \"new\":\n          log.warn(\n            `Remote layout is present but local has sync status: ${localLayout.syncInfo?.status}`,\n          );\n          if (layoutIsShared(localLayout)) {\n            log.warn(`Shared layout ${localLayout.id} shouldn't be untracked`);\n            continue;\n          }\n          ops.push({ local: false, type: \"upload-new\", localLayout });\n          break;\n        case \"updated\":\n          ops.push({ local: false, type: \"upload-updated\", localLayout });\n          break;\n        case \"tracked\":\n          // if the server doesn't provide a savedAt we consider the layout old and ignore it\n          if (!remoteLayout.savedAt) {\n            break;\n          }\n\n          if (localLayout.syncInfo.lastRemoteSavedAt !== remoteLayout.savedAt) {\n            ops.push({\n              local: true,\n              type: \"update-baseline\",\n              localLayout: { ...localLayout, syncInfo: localLayout.syncInfo },\n              remoteLayout,\n            });\n          }\n          break;\n        case \"locally-deleted\":\n          if (layoutIsShared(localLayout)) {\n            log.warn(`Shared layout ${localLayout.id} shouldn't be marked as locally deleted`);\n          }\n          ops.push({ local: false, type: \"delete-remote\", localLayout });\n          break;\n        case \"remotely-deleted\":\n          log.warn(\n            `Remote layout is present but cache is marked as remotely deleted: ${localLayout.id}`,\n          );\n          break;\n      }\n    } else {\n      switch (localLayout.syncInfo?.status) {\n        case undefined:\n        case \"new\":\n          if (layoutIsShared(localLayout)) {\n            log.warn(`Shared layout ${localLayout.id} should have been uploaded at creation`);\n            continue;\n          }\n          ops.push({ local: false, type: \"upload-new\", localLayout });\n          break;\n        case \"updated\":\n          if (!layoutIsShared(localLayout)) {\n            ops.push({ local: true, type: \"delete-local\", localLayout });\n          } else {\n            ops.push({ local: true, type: \"mark-deleted\", localLayout });\n          }\n          break;\n        case \"tracked\":\n          if (localLayout.working == undefined || !layoutIsShared(localLayout)) {\n            ops.push({ local: true, type: \"delete-local\", localLayout });\n          } else {\n            ops.push({ local: true, type: \"mark-deleted\", localLayout });\n          }\n          break;\n        case \"locally-deleted\":\n          if (layoutIsShared(localLayout)) {\n            log.warn(`Shared layout ${localLayout.id} shouldn't be marked as locally deleted`);\n          }\n          ops.push({ local: true, type: \"delete-local\", localLayout });\n          break;\n        case \"remotely-deleted\":\n          if (localLayout.working == undefined) {\n            ops.push({ local: true, type: \"delete-local\", localLayout });\n          }\n          break;\n      }\n    }\n  }\n\n  for (const remoteLayout of remoteLayoutsById.values()) {\n    ops.push({ local: true, type: \"add-to-cache\", remoteLayout });\n  }\n\n  return ops;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { MosaicNode } from \"react-mosaic-component\";\n\nimport { LayoutData } from \"@foxglove/studio-base/context/CurrentLayoutContext/actions\";\nimport { isTabPanel, isTabPanelConfig } from \"@foxglove/studio-base/util/layout\";\n\nfunction replacePanelInLayout(\n  layout: MosaicNode<string>,\n  oldId: string,\n  newId: string,\n): MosaicNode<string> {\n  if (typeof layout === \"string\") {\n    return layout === oldId ? newId : layout;\n  } else {\n    return {\n      ...layout,\n      first: replacePanelInLayout(layout.first, oldId, newId),\n      second: replacePanelInLayout(layout.second, oldId, newId),\n    };\n  }\n}\n\nexport function replacePanel(\n  panelsState: LayoutData,\n  oldId: string,\n  newId: string,\n  newConfig: Record<string, unknown>,\n): LayoutData {\n  const newPanelsState = {\n    ...panelsState,\n    configById: { ...panelsState.configById, [newId]: newConfig },\n  };\n  delete newPanelsState.configById[oldId];\n  if (newPanelsState.layout != undefined) {\n    newPanelsState.layout = replacePanelInLayout(newPanelsState.layout, oldId, newId);\n    const tabPanelIds = Object.keys(newPanelsState.configById).filter(isTabPanel);\n    for (const tabId of tabPanelIds) {\n      const tabConfig = newPanelsState.configById[tabId];\n      if (isTabPanelConfig(tabConfig)) {\n        newPanelsState.configById[tabId] = {\n          ...tabConfig,\n          tabs: tabConfig.tabs.map((tab) => ({\n            ...tab,\n            layout:\n              tab.layout != undefined ? replacePanelInLayout(tab.layout, oldId, newId) : undefined,\n          })),\n        };\n      }\n    }\n  }\n  return newPanelsState;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { round } from \"lodash\";\n\nimport { filterMap } from \"@foxglove/den/collection\";\nimport { LayoutData } from \"@foxglove/studio-base/context/CurrentLayoutContext/actions\";\nimport type { RendererConfig } from \"@foxglove/studio-base/panels/ThreeDeeRender/IRenderer\";\nimport { DEFAULT_CAMERA_STATE } from \"@foxglove/studio-base/panels/ThreeDeeRender/camera\";\nimport {\n  getAllPanelIds,\n  getPanelIdForType,\n  getPanelTypeFromId,\n} from \"@foxglove/studio-base/util/layout\";\n\nimport { replacePanel } from \"./replacePanel\";\n\nconst DEFAULT_PUBLISH_SETTINGS: RendererConfig[\"publish\"] = {\n  type: \"point\",\n  poseTopic: \"/move_base_simple/goal\",\n  pointTopic: \"/clicked_point\",\n  poseEstimateTopic: \"/initialpose\",\n  poseEstimateXDeviation: 0.5,\n  poseEstimateYDeviation: 0.5,\n  poseEstimateThetaDeviation: round(Math.PI / 12, 8),\n};\ntype LegacyCameraState = {\n  distance: number;\n  perspective: boolean;\n  phi: number;\n  target: readonly [number, number, number];\n  targetOffset: readonly [number, number, number];\n  targetOrientation: readonly [number, number, number, number];\n  thetaOffset: number;\n  fovy: number;\n  near: number;\n  far: number;\n};\ntype Legacy3DConfig = {\n  cameraState: Partial<LegacyCameraState>;\n  checkedKeys: string[];\n  clickToPublishPoseTopic: string;\n  clickToPublishPointTopic: string;\n  clickToPublishPoseEstimateTopic: string;\n  clickToPublishPoseEstimateXDeviation: number;\n  clickToPublishPoseEstimateYDeviation: number;\n  clickToPublishPoseEstimateThetaDeviation: number;\n  followMode?: \"follow\" | \"follow-orientation\" | \"no-follow\";\n  followTf?: string;\n};\n\nfunction migrateLegacyToNew3DConfig(legacyConfig: Partial<Legacy3DConfig>): RendererConfig {\n  return {\n    followTf: legacyConfig.followTf,\n    followMode:\n      legacyConfig.followMode === \"follow-orientation\"\n        ? \"follow-pose\"\n        : legacyConfig.followMode === \"follow\"\n        ? \"follow-position\"\n        : \"follow-none\",\n    cameraState: {\n      ...DEFAULT_CAMERA_STATE,\n      ...legacyConfig.cameraState,\n      phi: ((legacyConfig.cameraState?.phi ?? Math.PI / 3) * 180) / Math.PI,\n      thetaOffset: ((legacyConfig.cameraState?.thetaOffset ?? 0) * 180) / Math.PI,\n      fovy: ((legacyConfig.cameraState?.fovy ?? Math.PI / 4) * 180) / Math.PI,\n    },\n    publish: {\n      type: \"point\",\n      poseTopic: legacyConfig.clickToPublishPoseTopic ?? DEFAULT_PUBLISH_SETTINGS.poseTopic,\n      pointTopic: legacyConfig.clickToPublishPointTopic ?? DEFAULT_PUBLISH_SETTINGS.pointTopic,\n      poseEstimateTopic:\n        legacyConfig.clickToPublishPoseEstimateTopic ?? DEFAULT_PUBLISH_SETTINGS.poseEstimateTopic,\n      poseEstimateXDeviation:\n        legacyConfig.clickToPublishPoseEstimateXDeviation ??\n        DEFAULT_PUBLISH_SETTINGS.poseEstimateXDeviation,\n      poseEstimateYDeviation:\n        legacyConfig.clickToPublishPoseEstimateYDeviation ??\n        DEFAULT_PUBLISH_SETTINGS.poseEstimateYDeviation,\n      poseEstimateThetaDeviation:\n        legacyConfig.clickToPublishPoseEstimateThetaDeviation ??\n        DEFAULT_PUBLISH_SETTINGS.poseEstimateThetaDeviation,\n    },\n    topics: Object.fromEntries(\n      filterMap(legacyConfig.checkedKeys ?? [], (key) =>\n        key.startsWith(\"t:\") ? [key.substring(\"t:\".length), { visible: true }] : undefined,\n      ),\n    ),\n    scene: {},\n    transforms: {},\n    layers: {},\n    imageMode: {},\n  };\n}\n\nexport function migrateLegacyToNew3DPanels(layoutData: LayoutData): LayoutData {\n  if (layoutData.layout == undefined) {\n    return layoutData;\n  }\n\n  const legacy3DPanels = getAllPanelIds(layoutData.layout, layoutData.configById).filter(\n    (id) => getPanelTypeFromId(id) === \"3D Panel\",\n  );\n  let newState = layoutData;\n  for (const id of legacy3DPanels) {\n    const legacyConfig = layoutData.configById[id] as Legacy3DConfig | undefined;\n    if (legacyConfig != undefined) {\n      newState = replacePanel(\n        newState,\n        id,\n        getPanelIdForType(\"3D\"),\n        migrateLegacyToNew3DConfig(legacyConfig),\n      );\n    }\n  }\n  return newState;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { LayoutData } from \"@foxglove/studio-base/context/CurrentLayoutContext/actions\";\nimport type { RendererConfig } from \"@foxglove/studio-base/panels/ThreeDeeRender/IRenderer\";\nimport { DEFAULT_CAMERA_STATE } from \"@foxglove/studio-base/panels/ThreeDeeRender/camera\";\nimport { DEFAULT_PUBLISH_SETTINGS } from \"@foxglove/studio-base/panels/ThreeDeeRender/renderables/PublishSettings\";\nimport {\n  getAllPanelIds,\n  getPanelIdForType,\n  getPanelTypeFromId,\n} from \"@foxglove/studio-base/util/layout\";\n\nimport { replacePanel } from \"./replacePanel\";\n\ntype LegacyImageConfig = {\n  cameraTopic: string;\n  enabledMarkerTopics: string[];\n  synchronize: boolean;\n  flipHorizontal?: boolean;\n  flipVertical?: boolean;\n  maxValue?: number;\n  minValue?: number;\n  mode?: \"fit\" | \"fill\" | \"other\";\n  pan?: { x: number; y: number };\n  rotation?: number;\n  smooth?: boolean;\n  transformMarkers: boolean;\n  zoom?: number;\n  zoomPercentage?: number;\n};\n\nfunction migrateLegacyToNewImageConfig(legacyConfig: Partial<LegacyImageConfig>): RendererConfig {\n  return {\n    cameraState: DEFAULT_CAMERA_STATE,\n    followMode: \"follow-pose\",\n    followTf: undefined,\n    scene: {},\n    transforms: {},\n    topics: {},\n    layers: {},\n    publish: DEFAULT_PUBLISH_SETTINGS,\n    imageMode: {\n      imageTopic: legacyConfig.cameraTopic,\n      calibrationTopic: undefined,\n      synchronize: legacyConfig.synchronize,\n      rotation:\n        legacyConfig.rotation != undefined && [0, 90, 180, 270].includes(legacyConfig.rotation)\n          ? (legacyConfig.rotation as 0 | 90 | 180 | 270)\n          : 0,\n      flipHorizontal: legacyConfig.flipHorizontal,\n      flipVertical: legacyConfig.flipVertical,\n      minValue: legacyConfig.minValue,\n      maxValue: legacyConfig.maxValue,\n      annotations: Object.fromEntries(\n        (legacyConfig.enabledMarkerTopics ?? []).map((topicName) => [topicName, { visible: true }]),\n      ),\n    },\n  };\n}\n\nexport function migrateLegacyToNewImagePanels(layoutData: LayoutData): LayoutData {\n  if (layoutData.layout == undefined) {\n    return layoutData;\n  }\n\n  const legacyImagePanels = getAllPanelIds(layoutData.layout, layoutData.configById).filter(\n    (id) => getPanelTypeFromId(id) === \"ImageViewPanel\",\n  );\n  let newState = layoutData;\n  for (const id of legacyImagePanels) {\n    const legacyConfig = layoutData.configById[id] as LegacyImageConfig | undefined;\n    if (legacyConfig != undefined) {\n      newState = replacePanel(\n        newState,\n        id,\n        getPanelIdForType(\"Image\"),\n        migrateLegacyToNewImageConfig(legacyConfig),\n      );\n    }\n  }\n  return newState;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { MarkOptional } from \"ts-essentials\";\n\nimport { LayoutData } from \"@foxglove/studio-base/context/CurrentLayoutContext/actions\";\n\nimport { migrateLegacyToNew3DPanels } from \"./migrateLegacyToNew3DPanels\";\nimport { migrateLegacyToNewImagePanels } from \"./migrateLegacyToNewImagePanels\";\nimport { Layout, ISO8601Timestamp } from \"../ILayoutStorage\";\n\n/**\n * Perform any necessary migrations on old layout data.\n */\nexport function migratePanelsState(data: MarkOptional<LayoutData, \"configById\">): LayoutData {\n  let result: LayoutData = { ...data, configById: data.configById ?? data.savedProps ?? {} };\n  delete result.savedProps;\n\n  result = migrateLegacyToNew3DPanels(result);\n  result = migrateLegacyToNewImagePanels(result);\n\n  return result;\n}\n\n/**\n * Import a layout from storage, transferring old properties to the current expected format.\n *\n * Layouts created before we stored both working/baseline copies were stored with a \"data\" field;\n * migrate this to a baseline layout.\n */\n\nexport function migrateLayout(value: unknown): Layout {\n  if (typeof value !== \"object\" || value == undefined) {\n    throw new Error(\"Invariant violation - layout item is not an object\");\n  }\n  const layout = value as Partial<Layout>;\n  if (!(\"id\" in layout) || !layout.id) {\n    throw new Error(\"Invariant violation - layout item is missing an id\");\n  }\n\n  const now = new Date().toISOString() as ISO8601Timestamp;\n\n  let baseline = layout.baseline;\n  if (!baseline) {\n    if (layout.working) {\n      baseline = layout.working;\n    } else if (layout.data) {\n      baseline = { data: layout.data, savedAt: now };\n    } else if (layout.state) {\n      baseline = { data: layout.state, savedAt: now };\n    } else {\n      throw new Error(\"Invariant violation - layout item is missing data\");\n    }\n  }\n\n  return {\n    id: layout.id,\n    name: layout.name ?? `Unnamed (${now})`,\n    permission: layout.permission?.toUpperCase() ?? \"CREATOR_WRITE\",\n    working: layout.working\n      ? { ...layout.working, data: migratePanelsState(layout.working.data) }\n      : undefined,\n    baseline: { ...baseline, data: migratePanelsState(baseline.data) },\n    syncInfo: layout.syncInfo,\n  };\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport EventEmitter from \"eventemitter3\";\nimport { partition } from \"lodash\";\nimport { v4 as uuidv4 } from \"uuid\";\n\nimport { MutexLocked } from \"@foxglove/den/async\";\nimport Logger from \"@foxglove/log\";\nimport { LayoutID } from \"@foxglove/studio-base/context/CurrentLayoutContext\";\nimport { LayoutData } from \"@foxglove/studio-base/context/CurrentLayoutContext/actions\";\nimport {\n  ILayoutManager,\n  LayoutManagerChangeEvent,\n  LayoutManagerEventTypes,\n} from \"@foxglove/studio-base/services/ILayoutManager\";\nimport {\n  ILayoutStorage,\n  Layout,\n  layoutAppearsDeleted,\n  layoutIsShared,\n  LayoutPermission,\n  layoutPermissionIsShared,\n  ISO8601Timestamp,\n} from \"@foxglove/studio-base/services/ILayoutStorage\";\nimport {\n  IRemoteLayoutStorage,\n  RemoteLayout,\n} from \"@foxglove/studio-base/services/IRemoteLayoutStorage\";\n\nimport { NamespacedLayoutStorage } from \"./NamespacedLayoutStorage\";\nimport WriteThroughLayoutCache from \"./WriteThroughLayoutCache\";\nimport { isLayoutEqual } from \"./compareLayouts\";\nimport computeLayoutSyncOperations, { SyncOperation } from \"./computeLayoutSyncOperations\";\nimport { migratePanelsState } from \"../migrateLayout/migrateLayout\";\n\nconst log = Logger.getLogger(__filename);\n\n/**\n * Try to perform the given updateLayout operation on remote storage. If a conflict is returned,\n * fetch the most recent version of the layout and return that instead.\n */\nasync function updateOrFetchLayout(\n  remote: IRemoteLayoutStorage,\n  params: Parameters<IRemoteLayoutStorage[\"updateLayout\"]>[0],\n): Promise<RemoteLayout> {\n  const response = await remote.updateLayout(params);\n  switch (response.status) {\n    case \"success\":\n      return response.newLayout;\n    case \"conflict\": {\n      const remoteLayout = await remote.getLayout(params.id);\n      if (!remoteLayout) {\n        throw new Error(`Update rejected but layout is not present on server: ${params.id}`);\n      }\n      log.info(`Layout update rejected, using server version: ${params.id}`);\n      return remoteLayout;\n    }\n  }\n}\n\nexport default class LayoutManager implements ILayoutManager {\n  public static readonly LOCAL_STORAGE_NAMESPACE = \"local\";\n  public static readonly REMOTE_STORAGE_NAMESPACE_PREFIX = \"remote-\";\n\n  /**\n   * All access to storage is wrapped in a mutex to prevent multi-step operations (such as reading\n   * and then writing a single layout, or writing one and deleting another) from getting\n   * interleaved.\n   */\n  #local: MutexLocked<NamespacedLayoutStorage>;\n  #remote: IRemoteLayoutStorage | undefined;\n\n  public readonly supportsSharing: boolean;\n\n  #emitter = new EventEmitter<LayoutManagerEventTypes>();\n\n  #busyCount = 0;\n\n  /**\n   * A decorator to emit busy events before and after an async operation so the UI can show that the\n   * operation is in progress.\n   */\n  static #withBusyStatus<Args extends unknown[], Ret>(\n    _prototype: typeof LayoutManager.prototype,\n    _propertyKey: string,\n    descriptor: TypedPropertyDescriptor<(this: LayoutManager, ...args: Args) => Promise<Ret>>,\n  ) {\n    const method = descriptor.value!;\n    descriptor.value = async function (...args) {\n      try {\n        this.#busyCount++;\n        this.#emitter.emit(\"busychange\");\n        return await method.apply(this, args);\n      } finally {\n        this.#busyCount--;\n        this.#emitter.emit(\"busychange\");\n      }\n    };\n  }\n\n  // eslint-disable-next-line no-restricted-syntax\n  public get isBusy(): boolean {\n    return this.#busyCount > 0;\n  }\n\n  public isOnline = false;\n\n  public error: undefined | Error = undefined;\n\n  // eslint-disable-next-line @foxglove/no-boolean-parameters\n  public setOnline(online: boolean): void {\n    this.isOnline = online;\n    this.#emitter.emit(\"onlinechange\");\n  }\n\n  public setError(error: undefined | Error): void {\n    this.error = error;\n    this.#emitter.emit(\"errorchange\");\n  }\n\n  public constructor({\n    local,\n    remote,\n  }: {\n    local: ILayoutStorage;\n    remote: IRemoteLayoutStorage | undefined;\n  }) {\n    this.#local = new MutexLocked(\n      new NamespacedLayoutStorage(\n        new WriteThroughLayoutCache(local),\n        remote\n          ? LayoutManager.REMOTE_STORAGE_NAMESPACE_PREFIX + remote.namespace\n          : LayoutManager.LOCAL_STORAGE_NAMESPACE,\n        {\n          migrateUnnamespacedLayouts: true,\n\n          // Convert existing local layouts into cloud personal layouts\n          importFromNamespace: remote ? LayoutManager.LOCAL_STORAGE_NAMESPACE : undefined,\n        },\n      ),\n    );\n    this.#remote = remote;\n    this.supportsSharing = remote != undefined;\n  }\n\n  public on<E extends EventEmitter.EventNames<LayoutManagerEventTypes>>(\n    name: E,\n    listener: EventEmitter.EventListener<LayoutManagerEventTypes, E>,\n  ): void {\n    this.#emitter.on(name, listener);\n  }\n  public off<E extends EventEmitter.EventNames<LayoutManagerEventTypes>>(\n    name: E,\n    listener: EventEmitter.EventListener<LayoutManagerEventTypes, E>,\n  ): void {\n    this.#emitter.off(name, listener);\n  }\n\n  #notifyChangeListeners(event: LayoutManagerChangeEvent) {\n    queueMicrotask(() => this.#emitter.emit(\"change\", event));\n  }\n\n  public async getLayouts(): Promise<readonly Layout[]> {\n    return await this.#local.runExclusive(async (local) => {\n      const layouts = await local.list();\n      return layouts.filter((layout) => !layoutAppearsDeleted(layout));\n    });\n  }\n\n  public async getLayout(id: LayoutID): Promise<Layout | undefined> {\n    const existingLocal = await this.#local.runExclusive(async (local) => {\n      return await local.get(id);\n    });\n\n    if (existingLocal) {\n      return layoutAppearsDeleted(existingLocal) ? undefined : existingLocal;\n    }\n\n    log.debug(`No local layout id:${id}.`);\n\n    // If we are offline, there's nothing else we can do to load the layout\n    if (!this.isOnline) {\n      log.debug(\"LayoutManager offline\");\n      return undefined;\n    }\n\n    log.debug(`Attempting to fetch from remote id:${id}`);\n    // We couldn't find an existing local layout for our id, so we attempt to load the remote one\n    const remoteLayout = await this.#remote?.getLayout(id);\n    if (!remoteLayout) {\n      log.debug(`No remote layout with id:${id}`);\n      return undefined;\n    }\n\n    return await this.#local.runExclusive(async (local) => {\n      // Layout sync may have happened while we fetched the remote layout.\n      // We see if we have the layout locally and use that before caching the fetched remote layout.\n      const localLayout = await local.get(id);\n      if (localLayout) {\n        log.debug(`Local layout loaded while fetching remote id:${id}`);\n        return localLayout;\n      }\n\n      log.debug(`Adding layout to cache from getLayout: ${remoteLayout.id}`);\n      return await local.put({\n        id: remoteLayout.id,\n        name: remoteLayout.name,\n        permission: remoteLayout.permission,\n        baseline: { data: remoteLayout.data, savedAt: remoteLayout.savedAt },\n        working: undefined,\n        syncInfo: { status: \"tracked\", lastRemoteSavedAt: remoteLayout.savedAt },\n      });\n    });\n  }\n\n  @LayoutManager.#withBusyStatus\n  public async saveNewLayout({\n    name,\n    data: unmigratedData,\n    permission,\n  }: {\n    name: string;\n    data: LayoutData;\n    permission: LayoutPermission;\n  }): Promise<Layout> {\n    const data = migratePanelsState(unmigratedData);\n    if (layoutPermissionIsShared(permission)) {\n      if (!this.#remote) {\n        throw new Error(\"Shared layouts are not supported without remote layout storage\");\n      }\n      if (!this.isOnline) {\n        throw new Error(\"Cannot share a layout while offline\");\n      }\n      const newLayout = await this.#remote.saveNewLayout({\n        id: uuidv4() as LayoutID,\n        name,\n        data,\n        permission,\n        savedAt: new Date().toISOString() as ISO8601Timestamp,\n      });\n      const result = await this.#local.runExclusive(\n        async (local) =>\n          await local.put({\n            id: newLayout.id,\n            name: newLayout.name,\n            permission: newLayout.permission,\n            baseline: { data: newLayout.data, savedAt: newLayout.savedAt },\n            working: undefined,\n            syncInfo: { status: \"tracked\", lastRemoteSavedAt: newLayout.savedAt },\n          }),\n      );\n      this.#notifyChangeListeners({ type: \"change\", updatedLayout: undefined });\n      return result;\n    }\n\n    const newLayout = await this.#local.runExclusive(\n      async (local) =>\n        await local.put({\n          id: uuidv4() as LayoutID,\n          name,\n          permission,\n          baseline: { data, savedAt: new Date().toISOString() as ISO8601Timestamp },\n          working: undefined,\n          syncInfo: this.#remote ? { status: \"new\", lastRemoteSavedAt: undefined } : undefined,\n        }),\n    );\n    this.#notifyChangeListeners({ type: \"change\", updatedLayout: newLayout });\n    return newLayout;\n  }\n\n  @LayoutManager.#withBusyStatus\n  public async updateLayout({\n    id,\n    name,\n    data,\n  }: {\n    id: LayoutID;\n    name: string | undefined;\n    data: LayoutData | undefined;\n  }): Promise<Layout> {\n    const now = new Date().toISOString() as ISO8601Timestamp;\n    const localLayout = await this.#local.runExclusive(async (local) => await local.get(id));\n    if (!localLayout) {\n      throw new Error(`Cannot update layout ${id} because it does not exist`);\n    }\n\n    // If the modifications result in the same layout data, set the working copy to undefined so the\n    // layout appears unmodified.\n    const newWorking =\n      data == undefined\n        ? localLayout.working\n        : isLayoutEqual(localLayout.baseline.data, data)\n        ? undefined\n        : { data, savedAt: now };\n\n    // Renames of shared layouts go directly to the server\n    if (name != undefined && layoutIsShared(localLayout)) {\n      if (!this.#remote) {\n        throw new Error(\"Shared layouts are not supported without remote layout storage\");\n      }\n      if (!this.isOnline) {\n        throw new Error(\"Cannot update a shared layout while offline\");\n      }\n      const updatedBaseline = await updateOrFetchLayout(this.#remote, { id, name, savedAt: now });\n      const result = await this.#local.runExclusive(\n        async (local) =>\n          await local.put({\n            ...localLayout,\n            name: updatedBaseline.name,\n            baseline: { data: updatedBaseline.data, savedAt: updatedBaseline.savedAt },\n            working: newWorking,\n            syncInfo: { status: \"tracked\", lastRemoteSavedAt: updatedBaseline.savedAt },\n          }),\n      );\n      this.#notifyChangeListeners({ type: \"change\", updatedLayout: result });\n      return result;\n    } else {\n      const isRename =\n        this.#remote != undefined &&\n        name != undefined &&\n        localLayout.syncInfo != undefined &&\n        localLayout.syncInfo.status !== \"new\";\n      const result = await this.#local.runExclusive(\n        async (local) =>\n          await local.put({\n            ...localLayout,\n            name: name ?? localLayout.name,\n            working: newWorking,\n\n            // If the name is being changed, we will need to upload to the server with a new savedAt\n            baseline: isRename ? { ...localLayout.baseline, savedAt: now } : localLayout.baseline,\n            syncInfo: isRename\n              ? { status: \"updated\", lastRemoteSavedAt: localLayout.syncInfo?.lastRemoteSavedAt }\n              : localLayout.syncInfo,\n          }),\n      );\n      this.#notifyChangeListeners({ type: \"change\", updatedLayout: result });\n      return result;\n    }\n  }\n\n  @LayoutManager.#withBusyStatus\n  public async deleteLayout({ id }: { id: LayoutID }): Promise<void> {\n    const localLayout = await this.#local.runExclusive(async (local) => await local.get(id));\n    if (!localLayout) {\n      throw new Error(`Cannot update layout ${id} because it does not exist`);\n    }\n    if (layoutIsShared(localLayout)) {\n      if (!this.#remote) {\n        throw new Error(\"Shared layouts are not supported without remote layout storage\");\n      }\n      if (localLayout.syncInfo?.status !== \"remotely-deleted\") {\n        if (!this.isOnline) {\n          throw new Error(\"Cannot delete a shared layout while offline\");\n        }\n        await this.#remote.deleteLayout(id);\n      }\n    }\n    await this.#local.runExclusive(async (local) => {\n      if (this.#remote && !layoutIsShared(localLayout)) {\n        await local.put({\n          ...localLayout,\n          working: {\n            data: localLayout.working?.data ?? localLayout.baseline.data,\n            savedAt: new Date().toISOString() as ISO8601Timestamp,\n          },\n          syncInfo: {\n            status: \"locally-deleted\",\n            lastRemoteSavedAt: localLayout.syncInfo?.lastRemoteSavedAt,\n          },\n        });\n      } else {\n        // Don't have remote storage, or already deleted on remote\n        await local.delete(id);\n      }\n    });\n    this.#notifyChangeListeners({ type: \"delete\", layoutId: id });\n  }\n\n  @LayoutManager.#withBusyStatus\n  public async overwriteLayout({ id }: { id: LayoutID }): Promise<Layout> {\n    const localLayout = await this.#local.runExclusive(async (local) => await local.get(id));\n    if (!localLayout) {\n      throw new Error(`Cannot overwrite layout ${id} because it does not exist`);\n    }\n    const now = new Date().toISOString() as ISO8601Timestamp;\n    if (layoutIsShared(localLayout)) {\n      if (!this.#remote) {\n        throw new Error(\"Shared layouts are not supported without remote layout storage\");\n      }\n      if (!this.isOnline) {\n        throw new Error(\"Cannot save a shared layout while offline\");\n      }\n      const updatedBaseline = await updateOrFetchLayout(this.#remote, {\n        id,\n        data: localLayout.working?.data ?? localLayout.baseline.data,\n        savedAt: now,\n      });\n      const result = await this.#local.runExclusive(\n        async (local) =>\n          await local.put({\n            ...localLayout,\n            baseline: { data: updatedBaseline.data, savedAt: updatedBaseline.savedAt },\n            working: undefined,\n            syncInfo: { status: \"tracked\", lastRemoteSavedAt: updatedBaseline.savedAt },\n          }),\n      );\n      this.#notifyChangeListeners({ type: \"change\", updatedLayout: result });\n      return result;\n    } else {\n      const result = await this.#local.runExclusive(\n        async (local) =>\n          await local.put({\n            ...localLayout,\n            baseline: {\n              data: localLayout.working?.data ?? localLayout.baseline.data,\n              savedAt: now,\n            },\n            working: undefined,\n            syncInfo:\n              this.#remote && localLayout.syncInfo?.status !== \"new\"\n                ? { status: \"updated\", lastRemoteSavedAt: localLayout.syncInfo?.lastRemoteSavedAt }\n                : localLayout.syncInfo,\n          }),\n      );\n      this.#notifyChangeListeners({ type: \"change\", updatedLayout: result });\n      return result;\n    }\n  }\n\n  @LayoutManager.#withBusyStatus\n  public async revertLayout({ id }: { id: LayoutID }): Promise<Layout> {\n    const result = await this.#local.runExclusive(async (local) => {\n      const layout = await local.get(id);\n      if (!layout) {\n        throw new Error(`Cannot revert layout id ${id} because it does not exist`);\n      }\n      return await local.put({\n        ...layout,\n        working: undefined,\n      });\n    });\n    this.#notifyChangeListeners({ type: \"change\", updatedLayout: result });\n    return result;\n  }\n\n  @LayoutManager.#withBusyStatus\n  public async makePersonalCopy({ id, name }: { id: LayoutID; name: string }): Promise<Layout> {\n    const now = new Date().toISOString() as ISO8601Timestamp;\n    const result = await this.#local.runExclusive(async (local) => {\n      const layout = await local.get(id);\n      if (!layout) {\n        throw new Error(`Cannot make a personal copy of layout id ${id} because it does not exist`);\n      }\n      const newLayout = await local.put({\n        id: uuidv4() as LayoutID,\n        name,\n        permission: \"CREATOR_WRITE\",\n        baseline: { data: layout.working?.data ?? layout.baseline.data, savedAt: now },\n        working: undefined,\n        syncInfo: { status: \"new\", lastRemoteSavedAt: now },\n      });\n      await local.put({ ...layout, working: undefined });\n      return newLayout;\n    });\n    this.#notifyChangeListeners({ type: \"change\", updatedLayout: undefined });\n    return result;\n  }\n\n  /** Ensures at most one sync operation is in progress at a time */\n  #currentSync?: Promise<void>;\n\n  /**\n   * Attempt to synchronize the local cache with remote storage. At minimum this incurs a fetch of\n   * the cached and remote layout lists; it may also involve modifications to the cache, remote\n   * storage, or both.\n   */\n  @LayoutManager.#withBusyStatus\n  public async syncWithRemote(abortSignal: AbortSignal): Promise<void> {\n    if (this.#currentSync) {\n      log.debug(\"Layout sync is already in progress\");\n      return await this.#currentSync;\n    }\n    const start = performance.now();\n    try {\n      log.debug(\"Starting layout sync\");\n      this.#currentSync = this.#syncWithRemoteImpl(abortSignal);\n      await this.#currentSync;\n      this.#notifyChangeListeners({ type: \"change\", updatedLayout: undefined });\n      if (this.error) {\n        this.setError(undefined);\n      }\n    } catch (error) {\n      this.setError(error);\n      throw error;\n    } finally {\n      this.#currentSync = undefined;\n      log.debug(`Completed sync in ${((performance.now() - start) / 1000).toFixed(2)}s`);\n    }\n  }\n\n  async #syncWithRemoteImpl(abortSignal: AbortSignal): Promise<void> {\n    if (!this.#remote || !this.isOnline) {\n      return;\n    }\n\n    const [localLayouts, remoteLayouts] = await Promise.all([\n      this.#local.runExclusive(async (local) => await local.list()),\n      this.#remote.getLayouts(),\n    ]);\n    if (abortSignal.aborted) {\n      return;\n    }\n\n    const syncOperations = computeLayoutSyncOperations(localLayouts, remoteLayouts);\n    const [localOps, remoteOps] = partition(\n      syncOperations,\n      (op): op is typeof op & { local: true } => op.local,\n    );\n    await Promise.all([\n      this.#performLocalSyncOperations(localOps, abortSignal),\n      this.#performRemoteSyncOperations(remoteOps, abortSignal),\n    ]);\n  }\n\n  async #performLocalSyncOperations(\n    operations: readonly (SyncOperation & { local: true })[],\n    abortSignal: AbortSignal,\n  ): Promise<void> {\n    await this.#local.runExclusive(async (local) => {\n      for (const operation of operations) {\n        if (abortSignal.aborted) {\n          return;\n        }\n        switch (operation.type) {\n          case \"mark-deleted\": {\n            const { localLayout } = operation;\n            log.debug(`Marking layout as remotely deleted: ${localLayout.id}`);\n            await local.put({\n              ...localLayout,\n              syncInfo: { status: \"remotely-deleted\", lastRemoteSavedAt: undefined },\n            });\n            break;\n          }\n\n          case \"delete-local\":\n            log.debug(\n              `Deleting local layout ${operation.localLayout.id}, whose sync status was ${operation.localLayout.syncInfo?.status}`,\n            );\n            await local.delete(operation.localLayout.id);\n            this.#notifyChangeListeners({ type: \"delete\", layoutId: operation.localLayout.id });\n            break;\n\n          case \"add-to-cache\": {\n            const { remoteLayout } = operation;\n            log.debug(`Adding layout to cache: ${remoteLayout.id}`);\n            await local.put({\n              id: remoteLayout.id,\n              name: remoteLayout.name,\n              permission: remoteLayout.permission,\n              baseline: { data: remoteLayout.data, savedAt: remoteLayout.savedAt },\n              working: undefined,\n              syncInfo: { status: \"tracked\", lastRemoteSavedAt: remoteLayout.savedAt },\n            });\n            break;\n          }\n\n          case \"update-baseline\": {\n            const { localLayout, remoteLayout } = operation;\n            log.debug(`Updating baseline for ${localLayout.id}`);\n            await local.put({\n              id: remoteLayout.id,\n              name: remoteLayout.name,\n              permission: remoteLayout.permission,\n              baseline: { data: remoteLayout.data, savedAt: remoteLayout.savedAt },\n              working: localLayout.working,\n              syncInfo: {\n                status: localLayout.syncInfo.status,\n                lastRemoteSavedAt: remoteLayout.savedAt,\n              },\n            });\n            break;\n          }\n        }\n      }\n    });\n  }\n\n  async #performRemoteSyncOperations(\n    operations: readonly (SyncOperation & { local: false })[],\n    abortSignal: AbortSignal,\n  ): Promise<void> {\n    const remote = this.#remote;\n    if (!remote) {\n      return;\n    }\n\n    // Any necessary local cleanups are performed all at once after the server operations, so the\n    // server ops can be done without blocking other local sync operations.\n    type CleanupFunction = (local: NamespacedLayoutStorage) => Promise<void>;\n\n    const cleanups = await Promise.all(\n      operations.map(async (operation): Promise<CleanupFunction> => {\n        switch (operation.type) {\n          case \"delete-remote\": {\n            const { localLayout } = operation;\n            log.debug(`Deleting remote layout ${localLayout.id}`);\n            if (!(await remote.deleteLayout(localLayout.id))) {\n              log.warn(`Deleting layout ${localLayout.id} which was not present in remote storage`);\n            }\n            return async (local) => {\n              if (abortSignal.aborted) {\n                return;\n              }\n              await local.delete(localLayout.id);\n            };\n          }\n\n          case \"upload-new\": {\n            const { localLayout } = operation;\n            log.debug(`Uploading new layout ${localLayout.id}`);\n            const newBaseline = await remote.saveNewLayout({\n              id: localLayout.id,\n              name: localLayout.name,\n              data: localLayout.baseline.data,\n              permission: localLayout.permission,\n              savedAt:\n                localLayout.baseline.savedAt ?? (new Date().toISOString() as ISO8601Timestamp),\n            });\n            return async (local) => {\n              // Don't check abortSignal; we need the cache to be updated to show the layout is tracked\n              await local.put({\n                ...localLayout,\n                baseline: { ...localLayout.baseline, savedAt: newBaseline.savedAt },\n                syncInfo: { status: \"tracked\", lastRemoteSavedAt: newBaseline.savedAt },\n              });\n            };\n          }\n\n          case \"upload-updated\": {\n            const { localLayout } = operation;\n            log.debug(`Uploading updated layout ${localLayout.id}`);\n            const newBaseline = await updateOrFetchLayout(remote, {\n              id: localLayout.id,\n              name: localLayout.name,\n              data: localLayout.baseline.data,\n              savedAt:\n                localLayout.baseline.savedAt ?? (new Date().toISOString() as ISO8601Timestamp),\n            });\n            return async (local) => {\n              // Don't check abortSignal; we need the cache to be updated to show the layout is tracked\n              await local.put({\n                ...localLayout,\n                name: newBaseline.name,\n                baseline: { ...localLayout.baseline, savedAt: newBaseline.savedAt },\n                syncInfo: { status: \"tracked\", lastRemoteSavedAt: newBaseline.savedAt },\n              });\n            };\n          }\n        }\n      }),\n    );\n\n    await this.#local.runExclusive(async (local) => {\n      await Promise.all(cleanups.map(async (cleanup) => await cleanup(local)));\n    });\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\n/** Return a Promise resolved after @param ms milliseconds */\nexport default async function delay(ms: number): Promise<void> {\n  return await new Promise((resolve) => setTimeout(resolve, ms));\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { useEffect, useMemo } from \"react\";\nimport { useNetworkState } from \"react-use\";\n\nimport { useVisibilityState } from \"@foxglove/hooks\";\nimport Logger from \"@foxglove/log\";\nimport LayoutManagerContext from \"@foxglove/studio-base/context/LayoutManagerContext\";\nimport { useLayoutStorage } from \"@foxglove/studio-base/context/LayoutStorageContext\";\nimport { useRemoteLayoutStorage } from \"@foxglove/studio-base/context/RemoteLayoutStorageContext\";\nimport LayoutManager from \"@foxglove/studio-base/services/LayoutManager/LayoutManager\";\nimport delay from \"@foxglove/studio-base/util/delay\";\n\nconst log = Logger.getLogger(__filename);\n\nconst SYNC_INTERVAL_BASE_MS = 30_000;\nconst SYNC_INTERVAL_MAX_MS = 3 * 60_000;\n\nexport default function LayoutManagerProvider({\n  children,\n}: React.PropsWithChildren<unknown>): JSX.Element {\n  const layoutStorage = useLayoutStorage();\n  const remoteLayoutStorage = useRemoteLayoutStorage();\n\n  const layoutManager = useMemo(\n    () => new LayoutManager({ local: layoutStorage, remote: remoteLayoutStorage }),\n    [layoutStorage, remoteLayoutStorage],\n  );\n\n  const { online = false } = useNetworkState();\n  const visibilityState = useVisibilityState();\n  useEffect(() => {\n    layoutManager.setOnline(online);\n  }, [layoutManager, online]);\n\n  // Sync periodically when logged in, online, and the app is not hidden\n  const enableSyncing = remoteLayoutStorage != undefined && online && visibilityState === \"visible\";\n  useEffect(() => {\n    if (!enableSyncing) {\n      return;\n    }\n    const controller = new AbortController();\n    void (async () => {\n      let failures = 0;\n      while (!controller.signal.aborted) {\n        try {\n          await layoutManager.syncWithRemote(controller.signal);\n          failures = 0;\n        } catch (error) {\n          log.error(\"Sync failed:\", error);\n          failures++;\n        }\n        // Exponential backoff with jitter:\n        // https://aws.amazon.com/blogs/architecture/exponential-backoff-and-jitter/\n        const duration =\n          Math.random() * Math.min(SYNC_INTERVAL_MAX_MS, SYNC_INTERVAL_BASE_MS * 2 ** failures);\n        log.debug(\"Waiting\", (duration / 1000).toFixed(2), \"sec for next sync\", { failures });\n        await delay(duration);\n      }\n    })();\n    return () => {\n      log.debug(\"Canceling layout sync due to effect cleanup callback\");\n      controller.abort();\n    };\n  }, [enableSyncing, layoutManager]);\n\n  return (\n    <LayoutManagerContext.Provider value={layoutManager}>{children}</LayoutManagerContext.Provider>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\nimport { TFunction } from \"i18next\";\n\nimport { PanelInfo } from \"@foxglove/studio-base/context/PanelCatalogContext\";\nimport { TAB_PANEL_TYPE } from \"@foxglove/studio-base/util/globalConstants\";\n\nimport dataSourceInfoThumbnail from \"./DataSourceInfo/thumbnail.png\";\nimport gaugeThumbnail from \"./Gauge/thumbnail.png\";\nimport indicatorThumbnail from \"./Indicator/thumbnail.png\";\nimport logThumbnail from \"./Log/thumbnail.png\";\nimport mapThumbnail from \"./Map/thumbnail.png\";\nimport nodePlaygroundThumbnail from \"./NodePlayground/thumbnail.png\";\nimport parametersThumbnail from \"./Parameters/thumbnail.png\";\nimport plotThumbnail from \"./Plot/thumbnail.png\";\nimport publishThumbnail from \"./Publish/thumbnail.png\";\nimport rawMessagesThumbnail from \"./RawMessages/thumbnail.png\";\nimport stateTransitionsThumbnail from \"./StateTransitions/thumbnail.png\";\nimport tabThumbnail from \"./Tab/thumbnail.png\";\nimport tableThumbnail from \"./Table/thumbnail.png\";\nimport configEditorThumbnail from \"./ConfigEditor/thumbnail.png\";\nimport teleopThumbnail from \"./Teleop/thumbnail.png\";\nimport imageViewThumbnail from \"./ThreeDeeRender/imageThumbnail.png\";\nimport threeDeeRenderThumbnail from \"./ThreeDeeRender/thumbnail.png\";\nimport topicGraphThumbnail from \"./TopicGraph/thumbnail.png\";\nimport variableSliderThumbnail from \"./VariableSlider/thumbnail.png\";\nimport diagnosticStatusThumbnail from \"./diagnostics/thumbnails/diagnostic-status.png\";\nimport diagnosticSummaryThumbnail from \"./diagnostics/thumbnails/diagnostic-summary.png\";\n\nexport const getBuiltin: (t: TFunction<\"panels\">) => PanelInfo[] = (t) => [\n  {\n    title: t(\"3D\"),\n    type: \"3D\",\n    description: t(\"3DPanelDescription\"),\n    thumbnail: threeDeeRenderThumbnail,\n    module: async () => ({ default: (await import(\"./ThreeDeeRender\")).ThreeDeePanel }),\n  },\n  {\n    title: t(\"ROSDiagnosticsDetail\"),\n    type: \"DiagnosticStatusPanel\",\n    description: t(\"ROSDiagnosticsDetailDescription\"),\n    thumbnail: diagnosticStatusThumbnail,\n    module: async () => await import(\"./diagnostics/DiagnosticStatusPanel\"),\n    hasCustomToolbar: true,\n  },\n  {\n    title: t(\"ROSDiagnosticSummary\"),\n    type: \"DiagnosticSummary\",\n    description: t(\"ROSDiagnosticSummaryDescription\"),\n    thumbnail: diagnosticSummaryThumbnail,\n    module: async () => await import(\"./diagnostics/DiagnosticSummary\"),\n    hasCustomToolbar: true,\n  },\n  {\n    title: t(\"image\"),\n    type: \"Image\",\n    description: t(\"imageDescription\"),\n    thumbnail: imageViewThumbnail,\n    module: async () => ({ default: (await import(\"./ThreeDeeRender\")).ImagePanel }),\n  },\n  {\n    title: t(\"ConfigEditor\"),\n    type: \"ConfigEditor\",\n    description: t(\"ConfigEditorDescription\"),\n    thumbnail: configEditorThumbnail,\n    module: async () => await import(\"./ConfigEditor\"),\n  },\n  {\n    title: t(\"indicator\"),\n    type: \"Indicator\",\n    description: t(\"indicatorDescription\"),\n    thumbnail: indicatorThumbnail,\n    module: async () => await import(\"./Indicator\"),\n  },\n  {\n    title: t(\"gauge\"),\n    type: \"Gauge\",\n    description: t(\"gaugeDescription\"),\n    thumbnail: gaugeThumbnail,\n    module: async () => await import(\"./Gauge\"),\n  },\n  {\n    title: t(\"teleop\"),\n    type: \"Teleop\",\n    description: t(\"teleopDescription\"),\n    thumbnail: teleopThumbnail,\n    module: async () => await import(\"./Teleop\"),\n  },\n  {\n    title: t(\"map\"),\n    type: \"map\",\n    description: t(\"mapDescription\"),\n    thumbnail: mapThumbnail,\n    module: async () => await import(\"./Map\"),\n  },\n  {\n    title: t(\"parameters\"),\n    type: \"Parameters\",\n    description: t(\"parametersDescription\"),\n    thumbnail: parametersThumbnail,\n    module: async () => await import(\"./Parameters\"),\n  },\n  {\n    title: t(\"plot\"),\n    type: \"Plot\",\n    description: t(\"plotDescription\"),\n    thumbnail: plotThumbnail,\n    module: async () => await import(\"./Plot\"),\n  },\n  {\n    title: t(\"publish\"),\n    type: \"Publish\",\n    description: t(\"publishDescription\"),\n    thumbnail: publishThumbnail,\n    module: async () => await import(\"./Publish\"),\n  },\n  {\n    title: t(\"rawMessages\"),\n    type: \"RawMessages\",\n    description: t(\"rawMessagesDescription\"),\n    thumbnail: rawMessagesThumbnail,\n    module: async () => await import(\"./RawMessages\"),\n    hasCustomToolbar: true,\n  },\n  {\n    title: t(\"log\"),\n    type: \"RosOut\",\n    description: t(\"logDescription\"),\n    thumbnail: logThumbnail,\n    module: async () => await import(\"./Log\"),\n    hasCustomToolbar: true,\n  },\n  {\n    title: t(\"stateTransitions\"),\n    type: \"StateTransitions\",\n    description: t(\"stateTransitionsDescription\"),\n    thumbnail: stateTransitionsThumbnail,\n    module: async () => await import(\"./StateTransitions\"),\n  },\n  {\n    title: t(\"table\"),\n    type: \"Table\",\n    description: t(\"tableDescription\"),\n    thumbnail: tableThumbnail,\n    module: async () => await import(\"./Table\"),\n    hasCustomToolbar: true,\n  },\n  {\n    title: t(\"topicGraph\"),\n    type: \"TopicGraph\",\n    description: t(\"topicGraphDescription\"),\n    thumbnail: topicGraphThumbnail,\n    module: async () => await import(\"./TopicGraph\"),\n  },\n  {\n    title: t(\"dataSourceInfo\"),\n    type: \"SourceInfo\",\n    description: t(\"dataSourceInfoDescription\"),\n    thumbnail: dataSourceInfoThumbnail,\n    module: async () => await import(\"./DataSourceInfo\"),\n  },\n  {\n    title: t(\"variableSlider\"),\n    type: \"GlobalVariableSliderPanel\",\n    description: t(\"variableSliderDescription\"),\n    thumbnail: variableSliderThumbnail,\n    module: async () => await import(\"./VariableSlider\"),\n  },\n  {\n    title: t(\"userScripts\"),\n    type: \"NodePlayground\",\n    description: t(\"userScriptsDescription\"),\n    thumbnail: nodePlaygroundThumbnail,\n    module: async () => await import(\"./NodePlayground\"),\n  },\n  {\n    title: t(\"tab\"),\n    type: TAB_PANEL_TYPE,\n    description: t(\"tabDescription\"),\n    thumbnail: tabThumbnail,\n    module: async () => await import(\"./Tab\"),\n    hasCustomToolbar: true,\n  },\n];\n\nexport const getDebug: (t: TFunction<\"panels\">) => PanelInfo[] = (t) => [\n  {\n    title: t(\"studioPlaybackPerformance\"),\n    type: \"PlaybackPerformance\",\n    description: t(\"studioPlaybackPerformanceDescription\"),\n    module: async () => await import(\"./PlaybackPerformance\"),\n  },\n];\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { PropsWithChildren, useMemo } from \"react\";\nimport { useTranslation } from \"react-i18next\";\n\nimport { AppSetting } from \"@foxglove/studio-base/AppSetting\";\nimport Panel from \"@foxglove/studio-base/components/Panel\";\nimport { PanelExtensionAdapter } from \"@foxglove/studio-base/components/PanelExtensionAdapter\";\nimport { useExtensionCatalog } from \"@foxglove/studio-base/context/ExtensionCatalogContext\";\nimport PanelCatalogContext, {\n  PanelCatalog,\n  PanelInfo,\n} from \"@foxglove/studio-base/context/PanelCatalogContext\";\nimport { useAppConfigurationValue } from \"@foxglove/studio-base/hooks/useAppConfigurationValue\";\nimport * as panels from \"@foxglove/studio-base/panels\";\nimport { SaveConfig } from \"@foxglove/studio-base/types/panels\";\n\ntype PanelProps = {\n  config: unknown;\n  saveConfig: SaveConfig<unknown>;\n};\n\nexport default function PanelCatalogProvider(\n  props: PropsWithChildren<unknown>,\n): React.ReactElement {\n  const [showDebugPanels = false] = useAppConfigurationValue<boolean>(AppSetting.SHOW_DEBUG_PANELS);\n  const { t } = useTranslation(\"panels\");\n\n  const extensionPanels = useExtensionCatalog((state) => state.installedPanels);\n\n  const wrappedExtensionPanels = useMemo<PanelInfo[]>(() => {\n    return Object.values(extensionPanels ?? {}).map((panel) => {\n      const panelType = `${panel.extensionName}.${panel.registration.name}`;\n      const PanelWrapper = (panelProps: PanelProps) => {\n        return (\n          <>\n            <PanelExtensionAdapter\n              config={panelProps.config}\n              saveConfig={panelProps.saveConfig}\n              initPanel={panel.registration.initPanel}\n            />\n          </>\n        );\n      };\n      PanelWrapper.panelType = panelType;\n      PanelWrapper.defaultConfig = {};\n      return {\n        category: \"misc\",\n        title: panel.registration.name,\n        type: panelType,\n        module: async () => ({ default: Panel(PanelWrapper) }),\n        extensionNamespace: panel.extensionNamespace,\n      };\n    });\n  }, [extensionPanels]);\n\n  // Re-call the function when the language changes to ensure that the panel's information is successfully translated\n  const allPanelsInfo = useMemo(() => {\n    return {\n      builtin: panels.getBuiltin(t),\n      debug: panels.getDebug(t),\n    };\n  }, [t]);\n\n  const allPanels = useMemo(() => {\n    return [...allPanelsInfo.builtin, ...allPanelsInfo.debug, ...wrappedExtensionPanels];\n  }, [wrappedExtensionPanels, allPanelsInfo]);\n\n  const visiblePanels = useMemo(() => {\n    const panelList = [...allPanelsInfo.builtin];\n    if (showDebugPanels) {\n      panelList.push(...allPanelsInfo.debug);\n    }\n    panelList.push(...wrappedExtensionPanels);\n    return panelList;\n  }, [showDebugPanels, wrappedExtensionPanels, allPanelsInfo]);\n\n  const panelsByType = useMemo(() => {\n    const byType = new Map<string, PanelInfo>();\n\n    for (const panel of allPanels) {\n      const type = panel.type;\n      byType.set(type, panel);\n    }\n    return byType;\n  }, [allPanels]);\n\n  const provider = useMemo<PanelCatalog>(() => {\n    return {\n      getPanels() {\n        return visiblePanels;\n      },\n      getPanelByType(type: string) {\n        return panelsByType.get(type);\n      },\n    };\n  }, [panelsByType, visiblePanels]);\n\n  return (\n    <PanelCatalogContext.Provider value={provider}>{props.children}</PanelCatalogContext.Provider>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { merge } from \"lodash\";\nimport { useCallback, useEffect } from \"react\";\n\nimport { useShallowMemo } from \"@foxglove/hooks\";\nimport {\n  UserProfile,\n  UserProfileStorageContext,\n} from \"@foxglove/studio-base/context/UserProfileStorageContext\";\n\nconst DEFAULT_PROFILE: UserProfile = {};\nconst LOCAL_STORAGE_KEY = \"studio.profile-data\";\n\n/**\n * A provider for UserProfileStorage that stores data in localStorage.\n */\nexport default function UserProfileLocalStorageProvider({\n  children,\n}: React.PropsWithChildren<unknown>): JSX.Element {\n  const getUserProfile = useCallback(async (): Promise<UserProfile> => {\n    const item = localStorage.getItem(LOCAL_STORAGE_KEY);\n    return item != undefined ? (JSON.parse(item) as UserProfile) : DEFAULT_PROFILE;\n  }, []);\n\n  const setUserProfile = useCallback(\n    async (value: UserProfile | ((prev: UserProfile) => UserProfile)) => {\n      const item = localStorage.getItem(LOCAL_STORAGE_KEY);\n      const prev = item != undefined ? (JSON.parse(item) as UserProfile) : DEFAULT_PROFILE;\n      const newProfile = typeof value === \"function\" ? value(prev) : merge(prev, value);\n      localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(newProfile) ?? \"\");\n    },\n    [],\n  );\n\n  // On first load stamp firstSeenTime timestamp. We consider the time at which\n  // we stamp firstTime as the first time the user has opened the app if at that\n  // time there is no currentLayoutId already set in the profile.\n  useEffect(() => {\n    setUserProfile((old) => ({\n      ...old,\n      firstSeenTime: old.firstSeenTime ?? new Date().toISOString(),\n      firstSeenTimeIsFirstLoad: old.firstSeenTimeIsFirstLoad ?? old.currentLayoutId == undefined,\n    })).catch(console.error);\n  }, [setUserProfile]);\n\n  const storage = useShallowMemo({\n    getUserProfile,\n    setUserProfile,\n  });\n\n  return (\n    <UserProfileStorageContext.Provider value={storage}>\n      {children}\n    </UserProfileStorageContext.Provider>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport {\n  Button,\n  Checkbox,\n  Dialog,\n  DialogContent,\n  FormControlLabel,\n  Grid,\n  Typography,\n} from \"@mui/material\";\nimport { ReactElement, useState } from \"react\";\nimport { makeStyles } from \"tss-react/mui\";\n\nimport { useSessionStorageValue } from \"@foxglove/hooks\";\nimport { AppSetting } from \"@foxglove/studio-base/AppSetting\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { useAppConfigurationValue } from \"@foxglove/studio-base/hooks\";\nimport { LaunchPreferenceValue } from \"@foxglove/studio-base/types/LaunchPreferenceValue\";\n\nconst useStyles = makeStyles()((theme) => ({\n  button: {\n    textAlign: \"left\",\n    justifyContent: \"flex-start\",\n    padding: theme.spacing(2),\n    gap: theme.spacing(1.5),\n    borderColor: theme.palette.divider,\n    height: \"100%\",\n  },\n  paper: {\n    maxWidth: 480,\n  },\n}));\n\nexport function LaunchPreferenceScreen(): ReactElement {\n  const { classes } = useStyles();\n  const [globalPreference, setGlobalPreference] = useAppConfigurationValue<string | undefined>(\n    AppSetting.LAUNCH_PREFERENCE,\n  );\n  const [_, setSessionPreference] = useSessionStorageValue(AppSetting.LAUNCH_PREFERENCE);\n  const [rememberPreference, setRememberPreference] = useState(globalPreference != undefined);\n\n  async function launchInWeb() {\n    setSessionPreference(LaunchPreferenceValue.WEB); // always set session preference to allow overriding the URL param\n    if (rememberPreference) {\n      await setGlobalPreference(LaunchPreferenceValue.WEB);\n    }\n  }\n\n  async function launchInDesktop() {\n    setSessionPreference(LaunchPreferenceValue.DESKTOP); // always set session preference to allow overriding the URL param\n    if (rememberPreference) {\n      await setGlobalPreference(LaunchPreferenceValue.DESKTOP);\n    }\n  }\n\n  async function toggleRememberPreference() {\n    if (rememberPreference) {\n      await setGlobalPreference(undefined);\n    }\n    setRememberPreference(!rememberPreference);\n  }\n\n  const actions = [\n    {\n      key: LaunchPreferenceValue.WEB,\n      primary: \"Web\",\n      secondary: \"Requires Chrome v76+\",\n      onClick: () => void launchInWeb(),\n    },\n    {\n      key: LaunchPreferenceValue.DESKTOP,\n      primary: \"Desktop App\",\n      secondary: \"For Linux, Windows, and macOS\",\n      onClick: () => void launchInDesktop(),\n    },\n  ];\n\n  return (\n    <Dialog open classes={{ paper: classes.paper }}>\n      <Stack paddingX={2} paddingTop={3}>\n        <Typography align=\"center\" variant=\"h2\" fontWeight={600}>\n          Launch Foxglove Studio\n        </Typography>\n      </Stack>\n      <DialogContent>\n        <Grid container spacing={1}>\n          {actions.map((action) => (\n            <Grid key={action.key} item xs={12} sm={6}>\n              <Button\n                className={classes.button}\n                fullWidth\n                color=\"inherit\"\n                variant=\"outlined\"\n                size=\"large\"\n                onClick={action.onClick}\n              >\n                <Stack flex=\"auto\" zeroMinWidth>\n                  <Typography variant=\"subtitle1\" color=\"text.primary\">\n                    {action.primary}\n                  </Typography>\n                  <Typography variant=\"body2\" color=\"text.secondary\">\n                    {action.secondary}\n                  </Typography>\n                </Stack>\n              </Button>\n            </Grid>\n          ))}\n          <Grid item xs={12}>\n            <FormControlLabel\n              label=\"Remember my preference\"\n              control={\n                <Checkbox\n                  color=\"primary\"\n                  checked={rememberPreference}\n                  onChange={toggleRememberPreference}\n                />\n              }\n            />\n          </Grid>\n        </Grid>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Link, Typography } from \"@mui/material\";\nimport { ReactElement, useEffect } from \"react\";\n\nimport { useSessionStorageValue } from \"@foxglove/hooks\";\nimport { AppSetting } from \"@foxglove/studio-base/AppSetting\";\nimport Stack from \"@foxglove/studio-base/components/Stack\";\nimport { LaunchPreferenceValue } from \"@foxglove/studio-base/types/LaunchPreferenceValue\";\n\nexport function LaunchingInDesktopScreen(): ReactElement {\n  const [, setLaunchPreference] = useSessionStorageValue(AppSetting.LAUNCH_PREFERENCE);\n\n  const cleanWebURL = new URL(window.location.href);\n  cleanWebURL.searchParams.delete(\"openIn\");\n\n  function openWeb() {\n    setLaunchPreference(LaunchPreferenceValue.WEB);\n    window.location.href = cleanWebURL.href;\n  }\n\n  useEffect(() => {\n    const desktopURL = new URL(\"foxglove://open\");\n    cleanWebURL.searchParams.forEach((v, k) => {\n      if (k && v) {\n        desktopURL.searchParams.set(k, v);\n\n        // Temporarily send both sets of params until desktop app is updated to\n        // use new ds.* parameters.\n        switch (k) {\n          case \"ds\":\n            desktopURL.searchParams.set(\"type\", v);\n            break;\n          case \"ds.deviceId\":\n            desktopURL.searchParams.set(\"deviceId\", v);\n            break;\n          case \"ds.importId\":\n            desktopURL.searchParams.set(\"importId\", v);\n            break;\n          case \"ds.end\":\n            desktopURL.searchParams.set(\"end\", v);\n            break;\n          case \"ds.start\":\n            desktopURL.searchParams.set(\"start\", v);\n            break;\n          case \"ds.url\":\n            desktopURL.searchParams.set(\"url\", v);\n            break;\n          case \"time\":\n            desktopURL.searchParams.set(\"seekTo\", v);\n            break;\n        }\n      }\n    });\n\n    window.location.href = desktopURL.href;\n  });\n\n  return (\n    <Stack alignItems=\"center\" justifyContent=\"center\" fullHeight>\n      <Stack\n        alignItems=\"center\"\n        justifyContent=\"center\"\n        fullHeight\n        gap={2.5}\n        style={{ maxWidth: 480 }}\n      >\n        <Typography align=\"center\" variant=\"h2\" fontWeight={600}>\n          Launching Foxglove Studio…\n        </Typography>\n        <Typography align=\"center\" fontWeight={600}>\n          We’ve directed you to the desktop app.\n        </Typography>\n        <Stack gap={0.5}>\n          <Typography align=\"center\">\n            You can also{\" \"}\n            <Link color=\"primary\" underline=\"hover\" onClick={openWeb}>\n              open this link in your browser\n            </Link>\n            .\n          </Typography>\n          <Typography align=\"center\">\n            Don’t have the app installed?&nbsp;\n            <Link\n              color=\"primary\"\n              underline=\"hover\"\n              href=\"https://foxglove.dev/download\"\n              target=\"_blank\"\n            >\n              Download Foxglove Studio\n            </Link>\n          </Typography>\n        </Stack>\n      </Stack>\n    </Stack>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { PropsWithChildren } from \"react\";\n\nimport { useSessionStorageValue } from \"@foxglove/hooks\";\nimport { LaunchPreferenceValue } from \"@foxglove/studio-base/types/LaunchPreferenceValue\";\n\nimport { LaunchPreferenceScreen } from \"./LaunchPreferenceScreen\";\nimport { LaunchingInDesktopScreen } from \"./LaunchingInDesktopScreen\";\nimport { AppSetting } from \"../AppSetting\";\nimport { useAppConfigurationValue } from \"../hooks\";\n\nexport function LaunchPreference(props: PropsWithChildren<unknown>): JSX.Element {\n  const [globalLaunchPreference] = useAppConfigurationValue<string>(AppSetting.LAUNCH_PREFERENCE);\n  const [sessionLaunchPreference] = useSessionStorageValue(AppSetting.LAUNCH_PREFERENCE);\n\n  const url = new URL(window.location.href);\n\n  // Session preferences take priority over URL and global preferences. This allows the button in\n  // LaunchPreferenceScreen to override the url when clicked.\n  let activePreference =\n    sessionLaunchPreference ?? url.searchParams.get(\"openIn\") ?? globalLaunchPreference;\n  switch (activePreference) {\n    case LaunchPreferenceValue.WEB:\n    case LaunchPreferenceValue.DESKTOP:\n    case LaunchPreferenceValue.ASK:\n      break;\n    default:\n      activePreference = LaunchPreferenceValue.WEB;\n  }\n\n  const hasParams = Array.from(url.searchParams.entries()).length > 0;\n  // Ask the user in which environment they want to open this session.\n  if (activePreference === LaunchPreferenceValue.ASK && hasParams) {\n    return <LaunchPreferenceScreen />;\n  } else if (activePreference === LaunchPreferenceValue.DESKTOP && hasParams) {\n    return <LaunchingInDesktopScreen />;\n  } else {\n    return <>{props.children}</>;\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Fragment, Suspense, useEffect } from \"react\";\nimport { DndProvider } from \"react-dnd\";\nimport { HTML5Backend } from \"react-dnd-html5-backend\";\n\nimport GlobalCss from \"@foxglove/studio-base/components/GlobalCss\";\nimport EventsProvider from \"@foxglove/studio-base/providers/EventsProvider\";\nimport { StudioLogsSettingsProvider } from \"@foxglove/studio-base/providers/StudioLogsSettingsProvider\";\nimport TimelineInteractionStateProvider from \"@foxglove/studio-base/providers/TimelineInteractionStateProvider\";\n\nimport Workspace from \"./Workspace\";\nimport { CustomWindowControlsProps } from \"./components/AppBar/CustomWindowControls\";\nimport { ColorSchemeThemeProvider } from \"./components/ColorSchemeThemeProvider\";\nimport CssBaseline from \"./components/CssBaseline\";\nimport DocumentTitleAdapter from \"./components/DocumentTitleAdapter\";\nimport ErrorBoundary from \"./components/ErrorBoundary\";\nimport MultiProvider from \"./components/MultiProvider\";\nimport PlayerManager from \"./components/PlayerManager\";\nimport SendNotificationToastAdapter from \"./components/SendNotificationToastAdapter\";\nimport StudioToastProvider from \"./components/StudioToastProvider\";\nimport AppConfigurationContext, { IAppConfiguration } from \"./context/AppConfigurationContext\";\nimport LayoutStorageContext from \"./context/LayoutStorageContext\";\nimport NativeAppMenuContext, { INativeAppMenu } from \"./context/NativeAppMenuContext\";\nimport NativeWindowContext, { INativeWindow } from \"./context/NativeWindowContext\";\nimport { IDataSourceFactory } from \"./context/PlayerSelectionContext\";\nimport { UserNodeStateProvider } from \"./context/UserNodeStateContext\";\nimport CurrentLayoutProvider from \"./providers/CurrentLayoutProvider\";\nimport ExtensionCatalogProvider from \"./providers/ExtensionCatalogProvider\";\nimport ExtensionMarketplaceProvider from \"./providers/ExtensionMarketplaceProvider\";\nimport LayoutManagerProvider from \"./providers/LayoutManagerProvider\";\nimport PanelCatalogProvider from \"./providers/PanelCatalogProvider\";\nimport UserProfileLocalStorageProvider from \"./providers/UserProfileLocalStorageProvider\";\nimport { LaunchPreference } from \"./screens/LaunchPreference\";\nimport { ExtensionLoader } from \"./services/ExtensionLoader\";\nimport { ILayoutStorage } from \"./services/ILayoutStorage\";\n\ntype AppProps = CustomWindowControlsProps & {\n  deepLinks: string[];\n  appConfiguration: IAppConfiguration;\n  dataSources: IDataSourceFactory[];\n  layoutStorage: ILayoutStorage;\n  extensionLoaders: readonly ExtensionLoader[];\n  nativeAppMenu?: INativeAppMenu;\n  nativeWindow?: INativeWindow;\n  enableLaunchPreferenceScreen?: boolean;\n  enableGlobalCss?: boolean;\n  appBarLeftInset?: number;\n  extraProviders?: JSX.Element[];\n  onAppBarDoubleClick?: () => void;\n};\n\n// Suppress context menu for the entire app except on inputs & textareas.\nfunction contextMenuHandler(event: MouseEvent) {\n  if (event.target instanceof HTMLInputElement || event.target instanceof HTMLTextAreaElement) {\n    return;\n  }\n\n  event.preventDefault();\n  return false;\n}\n\nexport function App(props: AppProps): JSX.Element {\n  const {\n    appConfiguration,\n    dataSources,\n    layoutStorage,\n    extensionLoaders,\n    nativeAppMenu,\n    nativeWindow,\n    deepLinks,\n    enableLaunchPreferenceScreen,\n    enableGlobalCss = false,\n    extraProviders,\n  } = props;\n\n  const providers = [\n    /* eslint-disable react/jsx-key */\n    <UserProfileLocalStorageProvider />,\n    <TimelineInteractionStateProvider />,\n    <UserNodeStateProvider />,\n    <CurrentLayoutProvider />,\n    <ExtensionMarketplaceProvider />,\n    <ExtensionCatalogProvider loaders={extensionLoaders} />,\n    <PlayerManager playerSources={dataSources} />,\n    <EventsProvider />,\n    /* eslint-enable react/jsx-key */\n  ];\n\n  if (nativeAppMenu) {\n    providers.push(<NativeAppMenuContext.Provider value={nativeAppMenu} />);\n  }\n\n  if (nativeWindow) {\n    providers.push(<NativeWindowContext.Provider value={nativeWindow} />);\n  }\n\n  if (extraProviders) {\n    providers.unshift(...extraProviders);\n  } else {\n    // Extra providers have their own layout providers\n    providers.unshift(<LayoutManagerProvider />);\n    providers.unshift(<LayoutStorageContext.Provider value={layoutStorage} />);\n  }\n\n  // The toast and logs provider comes first so they are available to all downstream providers\n  providers.unshift(<StudioToastProvider />);\n  providers.unshift(<StudioLogsSettingsProvider />);\n\n  const MaybeLaunchPreference = enableLaunchPreferenceScreen === true ? LaunchPreference : Fragment;\n\n  useEffect(() => {\n    document.addEventListener(\"contextmenu\", contextMenuHandler);\n    return () => document.removeEventListener(\"contextmenu\", contextMenuHandler);\n  }, []);\n\n  return (\n    <AppConfigurationContext.Provider value={appConfiguration}>\n      <ColorSchemeThemeProvider>\n        {enableGlobalCss && <GlobalCss />}\n        <CssBaseline>\n          <ErrorBoundary>\n            <MaybeLaunchPreference>\n              <MultiProvider providers={providers}>\n                <DocumentTitleAdapter />\n                <SendNotificationToastAdapter />\n                <DndProvider backend={HTML5Backend}>\n                  <Suspense fallback={<></>}>\n                    <PanelCatalogProvider>\n                      <Workspace\n                        deepLinks={deepLinks}\n                        appBarLeftInset={props.appBarLeftInset}\n                        onAppBarDoubleClick={props.onAppBarDoubleClick}\n                        showCustomWindowControls={props.showCustomWindowControls}\n                        isMaximized={props.isMaximized}\n                        onMinimizeWindow={props.onMinimizeWindow}\n                        onMaximizeWindow={props.onMaximizeWindow}\n                        onUnmaximizeWindow={props.onUnmaximizeWindow}\n                        onCloseWindow={props.onCloseWindow}\n                      />\n                    </PanelCatalogProvider>\n                  </Suspense>\n                </DndProvider>\n              </MultiProvider>\n            </MaybeLaunchPreference>\n          </ErrorBoundary>\n        </CssBaseline>\n      </ColorSchemeThemeProvider>\n    </AppConfigurationContext.Provider>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\n// Custom formatters for Chrome dev tools. See documentation: http://bit.ly/object-formatters\n// Note that the \"Enable custom formatters\" setting must be turned on in order to use these formatters.\n\nimport seedrandom from \"seedrandom\";\n\nimport { isTime } from \"@foxglove/rostime\";\nimport { mightActuallyBePartial } from \"@foxglove/studio-base/util/mightActuallyBePartial\";\n\ntype HtmlTemplate = unknown;\ntype DevtoolFormatterConfig = {\n  key: unknown;\n};\n\ninterface DevtoolFormatter {\n  header: (object: Record<string, unknown>, config: DevtoolFormatterConfig) => HtmlTemplate;\n  hasBody: (object: unknown) => boolean;\n  body?: (object: Record<string, unknown>) => HtmlTemplate;\n}\n\ndeclare global {\n  interface Window {\n    devtoolsFormatters: DevtoolFormatter[];\n  }\n}\n\n// eslint-disable-next-line no-restricted-syntax\nconst USE_DEFAULT_FORMATTER = null;\n\nconst timeFormatter: DevtoolFormatter = (() => {\n  function groupDigits(str: string) {\n    const result = [\"span\", {}];\n    let start = 0;\n    let end = str.length % 3;\n    if (end === 0) {\n      end = 3;\n    }\n    while (start < str.length) {\n      result.push([\n        \"span\",\n        { style: end < str.length ? \"margin-right: 2px;\" : \"\" },\n        str.substring(start, end),\n      ]);\n      start = end;\n      end += 3;\n    }\n    return result;\n  }\n\n  const formatter: DevtoolFormatter = {\n    header(obj) {\n      const maybeTime = obj as {\n        sec: number;\n        nsec: number;\n      };\n      if (\n        !isTime(obj) ||\n        maybeTime.sec < 0 ||\n        maybeTime.nsec < 0 ||\n        maybeTime.nsec >= 1e9 ||\n        !Number.isInteger(maybeTime.sec) ||\n        !Number.isInteger(maybeTime.nsec)\n      ) {\n        return USE_DEFAULT_FORMATTER;\n      }\n      const nsec = maybeTime.nsec.toFixed().padStart(9, \"0\");\n      const rng = seedrandom(`${maybeTime.sec}.${nsec}`);\n      return [\n        \"span\",\n        { style: `color: hsl(${rng() * 360}deg, ${40 + rng() * 60}%, ${20 + rng() * 40}%);` },\n        groupDigits(String(maybeTime.sec)),\n        \".\",\n        groupDigits(nsec),\n      ];\n    },\n    hasBody() {\n      return false;\n    },\n  };\n\n  return formatter;\n})();\n\nexport default function installDevtoolsFormatters(): void {\n  window.devtoolsFormatters = mightActuallyBePartial(window).devtoolsFormatters ?? [];\n  window.devtoolsFormatters.push(timeFormatter);\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\n/**\n * Wait for the browser to load custom fonts that have already been added to the document (via CSS\n * or the FontFace API) and generic font families.\n */\nexport default async function waitForFonts(): Promise<unknown> {\n  return await Promise.all([...document.fonts].map(async (font) => await font.load()));\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nexport const addPanel = {\n  addPanel: \"Add panel\",\n  noLayoutSelected: \"<selectLayoutLink>Select a layout</selectLayoutLink> to get started!\",\n  noPanelsMatchSearchCriteria: \"No panels match search criteria.\",\n  searchPanels: \"Search panels\",\n  selectPanelToAddToLayout: \"Select a panel below to add it to your layout.\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nexport const appBar = {\n  about: \"About\",\n  exploreSampleData: \"Explore sample data\",\n  open: \"Open…\",\n  openLocalFile: \"Open local file…\",\n  openConnection: \"Open connection…\",\n  noDataSource: \"No data source\",\n  joinOurSlack: \"Join our Slack\",\n  recentDataSources: \"Recent data sources\",\n  hideLeftSidebar: \"Hide left sidebar\",\n  showLeftSidebar: \"Show left sidebar\",\n  hideRightSidebar: \"Hide right sidebar\",\n  showRightSidebar: \"Show right sidebar\",\n  viewOurDocs: \"View our docs\",\n  file: \"File\",\n  view: \"View\",\n  help: \"Help\",\n  signIn: \"Sign in\",\n  unknown: \"unknown\",\n  selectSource: \"Select source\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nexport const appSettings = {\n  settings: \"Settings\",\n  colorScheme: \"Color scheme\",\n  dark: \"Dark\",\n  light: \"Light\",\n  followSystem: \"Follow system\",\n  language: \"Language\",\n  displayTimestampsIn: \"Display timestamps in\",\n  timestampFormat: \"Timestamp format\",\n  messageRate: \"Message rate\",\n  openLinksIn: \"Open links in\",\n  webApp: \"Web app\",\n  desktopApp: \"Desktop app\",\n  askEachTime: \"Ask each time\",\n  general: \"General\",\n  ros: \"ROS\",\n  privacy: \"Privacy\",\n  privacyDescription: \"Changes will take effect the next time Foxglove Studio is launched.\",\n  extensions: \"Extensions\",\n  about: \"About\",\n  sendAnonymizedUsageData: \"Send anonymized usage data to help us improve Foxglove Studio\",\n  sendAnonymizedCrashReports: \"Send anonymized crash reports\",\n  experimentalFeatures: \"Experimental features\",\n  experimentalFeaturesDescription: \"These features are unstable and not recommended for daily use.\",\n  noExperimentalFeatures: \"Currently there are no experimental features.\",\n  studioDebugPanels: \"Studio debug panels\",\n  studioDebugPanelsDescription: \"Show Foxglove Studio debug panels in the “Add panel” list.\",\n  memoryUseIndicator: \"Memory use indicator\",\n  memoryUseIndicatorDescription: \"Show the app memory use in the sidebar.\",\n  newNavigation: \"New navigation\",\n  newNavigationDescription: \"New top navigation bar.\",\n  restartTheAppForChangesToTakeEffect: \" Restart the app for changes to take effect.\",\n  layoutDebugging: \"Layout debugging\",\n  layoutDebuggingDescription: \"Show extra controls for developing and debugging layout storage.\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nexport const dataSourceInfo = {\n  dataSource: \"Data source\",\n  currentSource: \"Current source\",\n  waitingForConnection: \"Waiting for connection…\",\n  startTime: \"Start time\",\n  endTime: \"End time\",\n  duration: \"Duration\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\n// Generic global translation\nexport const general = {\n  foxglove: \"Foxglove\",\n  learnMore: \"Learn more\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nexport const incompatibleLayoutVersion = {\n  title: \"Incompatible layout version\",\n  desktopText:\n    \"This layout was created with a newer version of Foxglove Studio. Please update to the latest version at \",\n  webText:\n    \"This layout was created with a newer version of Foxglove Studio. Please refresh your browser.\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nexport const log = {\n  topicError: \"Topic {{topic}} is not available\",\n  topic: \"Topic\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nexport const openDialog = {\n  // Start\n  newToFoxgloveStudio: \"New to Foxglove Studio?\",\n  newToFoxgloveStudioDescription:\n    \"Start by exploring a sample dataset or checking out our documentation.\",\n  exploreSampleData: \"Explore sample data\",\n  viewOurDocs: \"View our docs\",\n  joinOurCommunity: \"Join our community\",\n  joinOurCommunityDescription:\n    \"Join us on Slack or GitHub to get help, make feature requests, and report bugs.\",\n  joinOurSlack: \"Join our Slack\",\n  openAGitHubIssue: \"Open a GitHub issue\",\n  needHelp: \"Need help?\",\n  needHelpDescription: \"View our documentation, or check out the tutorials on the Foxglove blog.\",\n  seeTutorials: \"See tutorials\",\n  collaborateTitle: \"Accelerate development with Foxglove Data Platform\",\n  secureStorageOfData: \"Securely store petabytes of ROS or custom data\",\n  convenientWebInterface:\n    \"Use a convenient web interface to tag, search, and retrieve data at lightning speed\",\n  canBeShared: \"Share data files, visualization layouts, and custom extensions with teammates\",\n  createAFreeAccount: \"Create a free account\",\n  signIn: \"Sign in\",\n  learnMore: \"Learn more\",\n  startCollaborating: \"Start collaborating with your Foxglove organization\",\n  startCollaboratingDescription:\n    \"Make the most of your Foxglove account – whether you want to dive deep on your data or share tools with your teammates.\",\n  uploadToDataPlatform: \"Upload to Data Platform\",\n  shareLayouts: \"Share layouts\",\n  openLocalFile: \"Open local file\",\n  openLocalFileDescription: \"Visualize data directly from your local filesystem.\",\n  openUrl: \"Upload and share data\",\n  openUrlDescription: \"Use Foxglove Data Platform to share data with your team.\",\n  openConnection: \"Open connection\",\n  openConnectionDescription: \"Connect to a live robot or server.\",\n  openDataSource: \"Open data source\",\n  recentDataSources: \"Recent data sources\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nexport const panelConfigVersionGuard = {\n  instructions: \"Please update to the latest version of the app.\",\n  warning: \"This layout requires a more recent version of this panel.\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nexport const panels = {\n  \"3D\": \"3D\",\n  \"3DPanelDescription\": \"Display markers, camera images, meshes, URDFs, and more in a 3D scene.\",\n  dataSourceInfo: \"Data Source Info\",\n  dataSourceInfoDescription: \"View details like topics and timestamps for the current data source.\",\n  gauge: \"Gauge\",\n  gaugeDescription: \"Display a colored gauge based on a continuous value.\",\n  image: \"Image\",\n  ConfigEditor: \"Config Editor\",\n  ConfigEditorDescription: \"Edit configuration files.\",\n  imageLegacy: \"Image (Legacy)\",\n  imageDescription: \"Display annotated images.\",\n  indicator: \"Indicator\",\n  indicatorDescription: \"Display a colored and/or textual indicator based on a threshold value.\",\n  log: \"Log\",\n  logDescription: \"Display logs by node and severity level.\",\n  map: \"Map\",\n  mapDescription: \"Display points on a map.\",\n  parameters: \"Parameters\",\n  parametersDescription: \"Read and set parameters for a data source.\",\n  plot: \"Plot\",\n  plotDescription: \"Plot numerical values over time or other values.\",\n  publish: \"Publish\",\n  publishDescription: \"Publish messages to the data source (live connections only).\",\n  rawMessages: \"Raw Messages\",\n  rawMessagesDescription: \"Inspect topic messages.\",\n  ROSDiagnosticsDetail: \"Diagnostics – Detail (ROS)\",\n  ROSDiagnosticsDetailDescription:\n    \"Display ROS DiagnosticArray messages for a specific hardware_id.\",\n  ROSDiagnosticSummary: \"Diagnostics – Summary (ROS)\",\n  ROSDiagnosticSummaryDescription: \"Display a summary of all ROS DiagnosticArray messages.\",\n  stateTransitions: \"State Transitions\",\n  stateTransitionsDescription: \"Track when values change over time.\",\n  studioPlaybackPerformance: \"Studio - Playback Performance\",\n  studioPlaybackPerformanceDescription:\n    \"Display playback and data-streaming performance statistics.\",\n  tab: \"Tab\",\n  tabDescription: \"Group panels together in a tabbed interface.\",\n  table: \"Table\",\n  tableDescription: \"Display topic messages in a tabular format.\",\n  teleop: \"Teleop\",\n  teleopDescription: \"Teleoperate a robot over a live connection.\",\n  topicGraph: \"Topic Graph\",\n  topicGraphDescription: \"Display a graph of active nodes, topics, and services.\",\n  userScripts: \"User Scripts\",\n  userScriptsDescription:\n    \"Write custom data transformations in TypeScript. Previously known as Node Playground.\",\n  variableSlider: \"Variable Slider\",\n  variableSliderDescription: \"Update numerical variable values for a layout.\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nexport const panelSettings = {\n  importOrExportSettings: \"Import/export settings\",\n  importOrExportSettingsWithEllipsis: \"Import/export settings...\",\n  resetToDefaults: \"Reset to defaults\",\n  panelSettings: \"Panel settings\",\n  selectAPanelToEditItsSettings: \"Select a panel to edit its settings.\",\n  loadingPanelSettings: \"Loading panel settings...\",\n  currentSettingsPanelName: \"{{title}} panel settings\",\n  panelName: \"{{title}} panel\",\n  panelDoesNotHaveSettings: \"This panel does not have any settings\",\n  unknown: \"Unknown\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nexport const plot = {\n  deleteSeries: \"Delete series\",\n  messagePath: \"Message path\",\n  label: \"Label\",\n  color: \"Color\",\n  timestamp: \"Timestamp\",\n  receiveTime: \"Receive Time\",\n  headerStamp: \"Header Stamp\",\n  series: \"Series\",\n  addSeries: \"Add series\",\n  maxYError: \"Y max must be greater than Y min.\",\n  maxXError: \"X max must be greater than X min.\",\n  general: \"General\",\n  syncWithOtherPlots: \"Sync with other plots\",\n  legend: \"Legend\",\n  position: \"Position\",\n  floating: \"Floating\",\n  left: \"Left\",\n  top: \"Top\",\n  hidden: \"Hidden\",\n  showValues: \"Show values\",\n  yAxis: \"Y Axis\",\n  showLabels: \"Show labels\",\n  showLine: \"Show lines\",\n  min: \"Min\",\n  max: \"Max\",\n  xAxis: \"X Axis\",\n  value: \"Value\",\n  index: \"Index\",\n  currentPath: \"Path (current)\",\n  accumulatedPath: \"Path (accumulated)\",\n  secondsRange: \"Range (seconds)\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nexport const settingsEditor = {\n  searchPanelSettings: \"Search panel settings…\",\n  title: \"Title\",\n  clearSearch: \"Clear search\",\n  labels: \"Labels\",\n  showAll: \"Show All\",\n  hideAll: \"Hide All\",\n  filterList: \"Filter list\",\n  filterListHelp: \"Filter list by visibility\",\n  listAll: \"List all\",\n  listVisible: \"List visible\",\n  listInvisible: \"List invisible\",\n  general: \"General\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nexport const threeDee = {\n  frame: \"Frame\",\n  color: \"Color\",\n  position: \"Position\",\n  lineWidth: \"Line width\",\n  rotation: \"Rotation\",\n  reset: \"Reset\",\n\n  // Frame\n  displayFrame: \"Display frame\",\n  displayFrameHelp:\n    \"The coordinate frame to place the camera in. The camera position and orientation will be relative to the origin of this frame.\",\n  followMode: \"Follow mode\",\n  followModeHelp: \"Change the camera behavior during playback to follow the display frame or not.\",\n  pose: \"Pose\",\n  fixed: \"Fixed\",\n  frameNotFound: \"Frame {{frameId}} not found\",\n  noCoordinateFramesFound: \"No coordinate frames found\",\n  enablePreloading: \"Enable preloading\",\n  lineColor: \"Line color\",\n  axisScale: \"Axis scale\",\n  labelSize: \"Label size\",\n  labels: \"Labels\",\n  editable: \"Editable\",\n  settings: \"Settings\",\n  transforms: \"Transforms\",\n  showAll: \"Show All\",\n  hideAll: \"Hide All\",\n\n  // Scene\n  scene: \"Scene\",\n  renderStats: \"Render stats\",\n  debugPicking: \"Debug picking\",\n  background: \"Background\",\n  labelScale: \"Label scale\",\n  labelScaleHelp: \"Scale factor to apply to all labels\",\n  ignoreColladaUpAxis: \"Ignore COLLADA <up_axis>\",\n  ignoreColladaUpAxisHelp:\n    \"Match the behavior of rviz by ignoring the <up_axis> tag in COLLADA files\",\n  takeEffectAfterReboot: \"This setting requires a restart to take effect\",\n  meshUpAxis: \"Mesh up axis\",\n  meshUpAxisHelp:\n    \"The direction to use as “up” when loading meshes without orientation info (STL and OBJ)\",\n  YUp: \"Y-up\",\n  ZUp: \"Z-up\",\n\n  // Camera\n  view: \"View\",\n  distance: \"Distance\",\n  perspective: \"Perspective\",\n  target: \"Target\",\n  theta: \"Theta\",\n  phi: \"Phi\",\n  fovy: \"Y-Axis FOV\",\n  near: \"Near\",\n  far: \"Far\",\n  syncCamera: \"Sync camera\",\n  syncCameraHelp: \"Sync the camera with other panels that also have this setting enabled.\",\n\n  // Topics\n  topics: \"Topics\",\n\n  // Custom layers\n  customLayers: \"Custom layers\",\n  addURDF: \"Add URDF\",\n  size: \"Size\",\n  divisions: \"Divisions\",\n  grid: \"Grid\",\n  delete: \"Delete\",\n  addGrid: \"Add Grid\",\n\n  // Image annotations\n  imageAnnotations: \"Image annotations\",\n  resetView: \"Reset view\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { TypeOptions } from \"i18next\";\n\nexport const appSettings: Partial<TypeOptions[\"resources\"][\"appSettings\"]> = {\n  settings: \"設定\",\n  colorScheme: \"カラースキーム\",\n  dark: \"ダーク\",\n  light: \"ライト\",\n  followSystem: \"システムに従う\",\n  language: \"言語\",\n  displayTimestampsIn: \"タイムスタンプを表示\",\n  timestampFormat: \"タイムスタンプ形式\",\n  messageRate: \"メッセージレート\",\n  openLinksIn: \"リンクを開く\",\n  webApp: \"ウェブアプリ\",\n  desktopApp: \"デスクトップアプリ\",\n  askEachTime: \"毎回確認する\",\n  general: \"一般\",\n  ros: \"ROS\",\n  privacy: \"プライバシー\",\n  privacyDescription: \"変更は次回のFoxglove Studio起動時に有効になります。\",\n  extensions: \"拡張機能\",\n  about: \"情報\",\n  sendAnonymizedUsageData: \"匿名化された使用データを送信して、Foxglove Studioの改善に役立てる\",\n  sendAnonymizedCrashReports: \"匿名化されたクラッシュレポートを送信\",\n  experimentalFeatures: \"実験的機能\",\n  experimentalFeaturesDescription: \"これらの機能は挙動が不安定なため、日々の利用は推奨されません。\",\n  noExperimentalFeatures: \"現在、実験的機能はありません。\",\n  studioDebugPanels: \"Studioデバッグパネル\",\n  studioDebugPanelsDescription: \"「パネルを追加」リストにFoxglove Studioデバッグパネルを表示する。\",\n  memoryUseIndicator: \"メモリ使用インジケータ\",\n  memoryUseIndicatorDescription: \"サイドバーにアプリのメモリ使用量を表示する。\",\n  newNavigation: \"新しいナビゲーション\",\n  newNavigationDescription: \"新しいトップナビゲーションバー。\",\n  restartTheAppForChangesToTakeEffect: \"変更を反映するには、アプリを再起動してください。\",\n  layoutDebugging: \"レイアウトデバッグ\",\n  layoutDebuggingDescription:\n    \"レイアウトストレージの開発およびデバッグ用の追加コントロールを表示する。\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { TypeOptions } from \"i18next\";\n\n// Generic global translation\nexport const general: Partial<TypeOptions[\"resources\"][\"general\"]> = {\n  // Note that we use the term `Foxglove` as an English word rather than a Japanese\n  // word since it would sound very different - フォックスグローブ (Fokusugorobu).\n  foxglove: \"Foxglove\",\n  learnMore: \"もっと学ぶ\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { TypeOptions } from \"i18next\";\n\nexport const panels: Partial<TypeOptions[\"resources\"][\"panels\"]> = {\n  \"3D\": \"3D\",\n  \"3DPanelDescription\": \"マーカーやカメラ映像、メッシュ、URDFなどを3Dシーンで表示します。\",\n  dataSourceInfo: \"データソース情報\",\n  dataSourceInfoDescription:\n    \"現在のデータソースに関するトピックやタイムスタンプなどの詳細を表示します。\",\n  gauge: \"ゲージ\",\n  gaugeDescription: \"連続値に基づく色付きのゲージを表示します。\",\n  image: \"画像\",\n  imageLegacy: \"画像 (Legacy)\",\n  imageDescription: \"注釈付きの画像を表示します。\",\n  indicator: \"インジケーター\",\n  indicatorDescription: \"閾値に基づいた色やテキストで表示されるインジケーターを表示します。\",\n  log: \"ログ\",\n  logDescription: \"ノードと重要度レベル別にログを表示します。\",\n  map: \"地図\",\n  mapDescription: \"地図上に点を表示します。\",\n  parameters: \"パラメーター\",\n  parametersDescription: \"データソースのパラメーターを読み取り、設定します。\",\n  plot: \"プロット\",\n  plotDescription: \"時間または他の値に対する数値をプロットします。\",\n  publish: \"パブリッシュ\",\n  publishDescription: \"データソースにメッセージをパブリッシュします（ライブ接続のみ）。 \",\n  rawMessages: \"生データのメッセージ\",\n  rawMessagesDescription: \"トピックメッセージを検査します。\",\n  ROSDiagnosticsDetail: \"診断 - 詳細 (ROS)\",\n  ROSDiagnosticsDetailDescription: \"特定のhardware_idのROS DiagnosticArrayメッセージを表示します。\",\n  ROSDiagnosticSummary: \"診断 - 概要 (ROS)\",\n  ROSDiagnosticSummaryDescription: \"すべてのROS DiagnosticArrayメッセージの概要を表示します。\",\n  stateTransitions: \"ステートトランジション\",\n  stateTransitionsDescription: \"時間とともに値が変化するときを追跡します。\",\n  studioPlaybackPerformance: \"Studio - 再生パフォーマンス\",\n  studioPlaybackPerformanceDescription:\n    \"再生およびデータストリーミングのパフォーマンス統計情報を表示します。\",\n  tab: \"タブ\",\n  tabDescription: \"複数のパネルをタブでグループ化して表示します。\",\n  table: \"テーブル\",\n  tableDescription: \"トピックメッセージを表形式で表示します。\",\n  teleop: \"Teleop\",\n  teleopDescription: \"ライブ接続でロボットを操作します。\",\n  topicGraph: \"トピックグラフ\",\n  topicGraphDescription: \"アクティブなノード、トピック、サービスのグラフを表示します。\",\n  userScripts: \"ユーザースクリプト\",\n  userScriptsDescription:\n    \"TypeScriptでカスタムデータ変換を記述します。以前はNode Playgroundとして知られていました。\",\n  variableSlider: \"変数スライダー\",\n  variableSliderDescription: \"レイアウトの数値変数を更新します。\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { TypeOptions } from \"i18next\";\n\nexport const addPanel: Partial<TypeOptions[\"resources\"][\"addPanel\"]> = {\n  addPanel: \"パネルを追加\",\n  noLayoutSelected: \"<selectLayoutLink>レイアウトを選択</selectLayoutLink>して始めましょう！\",\n  noPanelsMatchSearchCriteria: \"検索条件に一致するパネルがありません。\",\n  searchPanels: \"パネルを検索\",\n  selectPanelToAddToLayout: \"下のパネルを選択してレイアウトに追加してください。\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { TypeOptions } from \"i18next\";\n\nexport const panelSettings: Partial<TypeOptions[\"resources\"][\"panelSettings\"]> = {\n  importOrExportSettings: \"設定のインポート/エクスポート\",\n  importOrExportSettingsWithEllipsis: \"設定のインポート/エクスポート...\",\n  resetToDefaults: \"デフォルトにリセット\",\n  panelSettings: \"パネル設定\",\n  selectAPanelToEditItsSettings: \"編集するパネルを選択してください。\",\n  loadingPanelSettings: \"パネル設定を読み込んでいます...\",\n  currentSettingsPanelName: \"{{title}}パネルの設定\",\n  panelName: \"{{title}}パネル\",\n  panelDoesNotHaveSettings: \"このパネルには設定がありません。\",\n  unknown: \"不明\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { TypeOptions } from \"i18next\";\n\nexport const log: Partial<TypeOptions[\"resources\"][\"log\"]> = {\n  topicError: \"{{topic}}というトピックは利用できません。\",\n  topic: \"トピック\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { TypeOptions } from \"i18next\";\n\nexport const plot: Partial<TypeOptions[\"resources\"][\"plot\"]> = {\n  deleteSeries: \"シリーズを削除する\",\n  messagePath: \"メッセージパス\",\n  label: \"ラベル\",\n  color: \"カラー\",\n  timestamp: \"タイムスタンプ\",\n  receiveTime: \"受信時間\",\n  headerStamp: \"ヘッダースタンプ\",\n  series: \"シリーズ\",\n  addSeries: \"シリーズを追加する\",\n  maxYError: \"Y最大値は、Y最小値より大きくなければなりません。\",\n  maxXError: \"X最大値は、X最小値より大きくなければなりません。\",\n  general: \"一般的な\",\n  syncWithOtherPlots: \"他のプロットと同期する\",\n  legend: \"凡例\",\n  position: \"ポジション\",\n  floating: \"フローティング\",\n  left: \"左\",\n  top: \"上\",\n  hidden: \"隠す\",\n  showValues: \"値を表示する\",\n  yAxis: \"Y軸\",\n  showLabels: \"ラベルを表示する\",\n  min: \"最小\",\n  max: \"最大\",\n  xAxis: \"X軸\",\n  value: \"値\",\n  index: \"インデックス\",\n  currentPath: \"パス（現在）\",\n  accumulatedPath: \"パス（累積）\",\n  secondsRange: \"範囲（秒数）\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { TypeOptions } from \"i18next\";\n\nexport const dataSourceInfo: Partial<TypeOptions[\"resources\"][\"dataSourceInfo\"]> = {\n  dataSource: \"データソース\",\n  currentSource: \"現在のデータソース\",\n  waitingForConnection: \"接続待機中…\",\n  startTime: \"開始時刻\",\n  endTime: \"終了時刻\",\n  duration: \"所要時間\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { TypeOptions } from \"i18next\";\n\nexport const openDialog: Partial<TypeOptions[\"resources\"][\"openDialog\"]> = {\n  // Start\n  newToFoxgloveStudio: \"Foxglove Studioを初めてご利用ですか？\",\n  newToFoxgloveStudioDescription:\n    \"サンプルデータセットを探索したり、ドキュメンテーションをチェックして開始してください。\",\n  exploreSampleData: \"サンプルデータを探索する\",\n  viewOurDocs: \"ドキュメンテーションを見る\",\n  joinOurCommunity: \"コミュニティに参加する\",\n  joinOurCommunityDescription:\n    \"SlackやGitHubに参加して、ヘルプを得たり、機能リクエストを行ったり、バグを報告しましょう。\",\n  joinOurSlack: \"Slackに参加する\",\n  openAGitHubIssue: \"GitHubの問題を開く\",\n  needHelp: \"ヘルプが必要ですか？\",\n  needHelpDescription:\n    \"ドキュメンテーションを見たり、Foxgloveブログのチュートリアルをチェックしてみましょう。\",\n  seeTutorials: \"チュートリアルを見る\",\n  collaborateTitle: \"Foxglove Data Platformで開発を加速する\",\n  secureStorageOfData: \"ROSまたはカスタムデータをペタバイト単位で安全に保存\",\n  convenientWebInterface:\n    \"便利なWebインターフェースを使用して、データをタグ付け、検索、および高速に取得\",\n  canBeShared: \"チームメイトとデータファイル、可視化レイアウト、およびカスタム拡張子を共有できます\",\n  createAFreeAccount: \"無料のアカウントを作成する\",\n  signIn: \"ログイン\",\n  learnMore: \"詳細を見る\",\n  startCollaborating: \"Foxgloveの組織とコラボレーションを開始する\",\n  startCollaboratingDescription:\n    \"Foxgloveアカウントを最大限に活用しましょう。たとえば、データを詳細に分析したり、チームメイトとツールを共有したりすることができます。\",\n  uploadToDataPlatform: \"Data Platformにアップロードする\",\n  shareLayouts: \"レイアウトを共有する\",\n  openLocalFile: \"ローカルファイルを開く\",\n  openLocalFileDescription: \"ローカルファイルシステムから直接データを可視化します。\",\n  openUrl: \"データをアップロードして共有する\",\n  openUrlDescription: \"Foxglove Data Platformを使用して、チームとデータを共有します。\",\n  openConnection: \"接続を開く\",\n  openConnectionDescription: \"ライブロボットまたはサーバーに接続します。\",\n  openDataSource: \"データソースを開く\",\n  recentDataSources: \"最近のデータソース\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { TypeOptions } from \"i18next\";\n\nexport const settingsEditor: Partial<TypeOptions[\"resources\"][\"settingsEditor\"]> = {\n  searchPanelSettings: \"検索パネルの設定...\",\n  title: \"タイトル\",\n  clearSearch: \"検索をクリアする\",\n  labels: \"ラベル\",\n  showAll: \"すべて表示\",\n  hideAll: \"すべて非表示\",\n  filterList: \"リストをフィルタリングする\",\n  filterListHelp: \"可視性でリストをフィルタリングする\",\n  listAll: \"すべてのリスト\",\n  listVisible: \"表示されているリスト\",\n  listInvisible: \"非表示のリスト\",\n  general: \"一般的な\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { TypeOptions } from \"i18next\";\n\nexport const threeDee: Partial<TypeOptions[\"resources\"][\"threeDee\"]> = {\n  frame: \"フレーム\",\n  color: \"色\",\n  position: \"位置\",\n  lineWidth: \"ライン幅\",\n  rotation: \"回転\",\n  reset: \"リセット\",\n\n  // Frame\n  displayFrame: \"フレームを表示する\",\n  displayFrameHelp:\n    \"カメラを配置するための座標フレームです。カメラの位置と向きは、このフレームの原点を基準とした相対的なものとなります。\",\n  followMode: \"フォローモード\",\n  followModeHelp:\n    \"再生中のカメラの動作を変更し、表示フレームをフォローするかどうかを選択できます。\",\n  pose: \"ポーズ\",\n  fixed: \"固定\",\n  frameNotFound: \"フレーム {{frameId}} が見つかりません\",\n  noCoordinateFramesFound: \"座標フレームが見つかりません\",\n  enablePreloading: \"事前の読み込みを有効にする\",\n  lineColor: \"ラインの色\",\n  axisScale: \"軸のスケール\",\n  labelSize: \"ラベルのサイズ\",\n  labels: \"ラベル\",\n  editable: \"編集可能\",\n  settings: \"設定\",\n  transforms: \"変換\",\n  showAll: \"すべて表示\",\n  hideAll: \"すべて非表示\",\n\n  // Scene\n  scene: \"シーン\",\n  renderStats: \"レンダリングの統計情報\",\n  background: \"背景\",\n  labelScale: \"ラベルのスケール\",\n  labelScaleHelp: \"すべてのラベルに適用するスケールファクター\",\n  ignoreColladaUpAxis: \"COLLADA <up_axis> を無視\",\n  ignoreColladaUpAxisHelp:\n    \"COLLADA ファイル内の <up_axis> タグを無視することで、rviz の動作に合わせます。\",\n  takeEffectAfterReboot: \"この設定は再起動後に有効になります。\",\n  meshUpAxis: \"メッシュの上軸\",\n  meshUpAxisHelp:\n    \"方向を使用してメッシュを読み込むときに '上' として使用する方向（STL および OBJ）\",\n  YUp: \"Y-up\",\n  ZUp: \"Z-up\",\n\n  // Camera\n  view: \"ビュー\",\n  distance: \"距離\",\n  perspective: \"遠近法\",\n  target: \"ターゲット\",\n  theta: \"Theta\",\n  phi: \"Phi\",\n  fovy: \"Y軸 FOV\",\n  near: \"Near\",\n  far: \"Far\",\n  syncCamera: \"カメラを同期する\",\n  syncCameraHelp: \"この設定が有効になっている他のパネルとカメラを同期します。\",\n\n  // Topics\n  topics: \"トピック\",\n\n  // Custom layers\n  customLayers: \"カスタムレイヤー\",\n  addURDF: \"URDF を追加する\",\n  size: \"サイズ\",\n  divisions: \"分割数\",\n  grid: \"グリッド\",\n  delete: \"削除\",\n  addGrid: \"グリッドを追加する\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { TypeOptions } from \"i18next\";\n\nexport const appBar: Partial<TypeOptions[\"resources\"][\"appBar\"]> = {\n  about: \"情報\",\n  exploreSampleData: \"サンプルデータを探索する\",\n  open: \"を開く\",\n  openLocalFile: \"ローカルファイルを開く\",\n  openConnection: \"接続を開く\",\n  noDataSource: undefined,\n  joinOurSlack: \"Slackに参加する\",\n  recentDataSources: \"最近のデータソース\",\n  viewOurDocs: \"ドキュメンテーションを見る\",\n  file: \"ファイル\",\n  view: \"表示\",\n  help: \"ヘルプ\",\n  signIn: \"ログイン\",\n  unknown: \"不明\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { TypeOptions } from \"i18next\";\n\nexport const appSettings: Partial<TypeOptions[\"resources\"][\"appSettings\"]> = {\n  settings: \"设置\",\n  colorScheme: \"配色方案\",\n  dark: \"暗色\",\n  light: \"亮色\",\n  followSystem: \"跟随系统\",\n  language: \"语言\",\n  displayTimestampsIn: \"显示时间戳在\",\n  timestampFormat: \"时间戳格式\",\n  messageRate: \"消息速率\",\n  openLinksIn: \"打开链接\",\n  webApp: \"网页应用\",\n  desktopApp: \"桌面应用\",\n  askEachTime: \"每次询问\",\n  general: \"通用\",\n  ros: \"ROS\",\n  privacy: \"隐私\",\n  privacyDescription: \"更改将在下次启动 Foxglove Studio 时生效\",\n  sendAnonymizedUsageData: \"发送匿名使用数据以帮助我们改进 Foxglove Studio\",\n  sendAnonymizedCrashReports: \"发送匿名崩溃报告\",\n  experimentalFeatures: \"实验性功能\",\n  experimentalFeaturesDescription: \"这些功能不稳定，不建议日常使用。\",\n  studioDebugPanels: \"Studio 调试面板\",\n  studioDebugPanelsDescription: \"在“添加面板”列表中显示 Foxglove Studio 调试面板。\",\n  memoryUseIndicator: \"内存使用指示器\",\n  memoryUseIndicatorDescription: \"在侧边栏显示应用程序的内存使用情况。\",\n  newNavigation: \"新版导航栏\",\n  newNavigationDescription: \"使用新版导航栏。\",\n  restartTheAppForChangesToTakeEffect: \" 重新启动应用程序以使更改生效。\",\n  layoutDebugging: \"布局调试\",\n  layoutDebuggingDescription: \"显示用于开发和调试布局存储的额外控件。\",\n  extensions: \"扩展\",\n  about: \"关于\",\n  noExperimentalFeatures: \"目前没有实验性的功能。\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { TypeOptions } from \"i18next\";\n\n// Generic global translation\nexport const general: Partial<TypeOptions[\"resources\"][\"general\"]> = {\n  foxglove: \"Foxglove\",\n  learnMore: \"了解更多\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { TypeOptions } from \"i18next\";\n\nexport const panels: Partial<TypeOptions[\"resources\"][\"panels\"]> = {\n  \"3D\": \"三维\",\n  \"3DPanelDescription\": \"在三维场景中显示标记、相机图像、网格、URDF 和其他内容。\",\n  dataSourceInfo: \"数据源信息\",\n  dataSourceInfoDescription: \"查看当前数据源的主题和时间戳等详细信息。\",\n  gauge: \"仪表\",\n  gaugeDescription: \"基于连续值显示彩色仪表。\",\n  image: \"图像\",\n  imageLegacy: \"图像（Legacy）\",\n  imageDescription: \"显示带注释的图像。\",\n  indicator: \"指示器\",\n  indicatorDescription: \"基于阈值值显示彩色和/或文本指示器。\",\n  log: \"日志\",\n  logDescription: \"按节点和严重程度级别显示日志。\",\n  map: \"地图\",\n  mapDescription: \"在地图上显示点。\",\n  parameters: \"参数\",\n  parametersDescription: \"读取和设置数据源的参数。\",\n  plot: \"图表\",\n  plotDescription: \"绘制随时间或其他值变化的数字值。\",\n  publish: \"发布\",\n  publishDescription: \"向数据源发布消息（仅限实时连接）。\",\n  rawMessages: \"原始消息\",\n  rawMessagesDescription: \"检查主题消息。\",\n  ROSDiagnosticsDetail: \"诊断 - 详细信息（ROS）\",\n  ROSDiagnosticsDetailDescription: \"显示特定 hardware_id 的 ROS DiagnosticArray 消息。\",\n  ROSDiagnosticSummary: \"诊断 - 概要（ROS）\",\n  ROSDiagnosticSummaryDescription: \"显示所有 ROS DiagnosticArray 消息的摘要。\",\n  stateTransitions: \"状态转换\",\n  stateTransitionsDescription: \"跟踪值随时间变化的情况。\",\n  studioPlaybackPerformance: \"Studio - 播放性能\",\n  studioPlaybackPerformanceDescription: \"显示回放和数据流式处理性能统计信息。\",\n  tab: \"选项卡\",\n  tabDescription: \"将面板分组在选项卡界面中。\",\n  table: \"表格\",\n  tableDescription: \"以表格格式显示主题消息。\",\n  teleop: \"远程操纵\",\n  teleopDescription: \"通过实时连接远程操纵机器人。\",\n  topicGraph: \"主题图\",\n  topicGraphDescription: \"显示活动节点、主题和服务的图形。\",\n  userScripts: \"用户脚本\",\n  userScriptsDescription: \"使用 TypeScript 编写自定义数据转换。以前称为 Node Playground。\",\n  variableSlider: \"变量滑块\",\n  variableSliderDescription: \"更新布局的数字变量值。\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\nimport { TypeOptions } from \"i18next\";\n\nexport const addPanel: Partial<TypeOptions[\"resources\"][\"addPanel\"]> = {\n  addPanel: \"添加面板\",\n  noLayoutSelected: \"<selectLayoutLink>选择一个布局</selectLayoutLink>来开始使用!\",\n  noPanelsMatchSearchCriteria: \"没有符合搜索条件的面板。\",\n  searchPanels: \"搜索面板\",\n  selectPanelToAddToLayout: \"在下面选择一个面板，将其添加到你的布局中。\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { TypeOptions } from \"i18next\";\n\nexport const panelSettings: Partial<TypeOptions[\"resources\"][\"panelSettings\"]> = {\n  importOrExportSettings: \"导入/导出设置\",\n  importOrExportSettingsWithEllipsis: \"导入/导出设置……\",\n  panelSettings: \"面板设置\",\n  selectAPanelToEditItsSettings: \"选择一个面板来编辑其设置。\",\n  loadingPanelSettings: \"正在加载面板设置……\",\n  currentSettingsPanelName: \"{{title}}面板设置\",\n  panelName: \"{{title}}面板\",\n  panelDoesNotHaveSettings: \"此面板没有任何设置\",\n  resetToDefaults: \"重置为默认值\",\n  unknown: \"未知\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { TypeOptions } from \"i18next\";\n\nexport const log: Partial<TypeOptions[\"resources\"][\"log\"]> = {\n  topicError: \"话题 {{topic}} 不可用\",\n  topic: \"话题\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { TypeOptions } from \"i18next\";\n\nexport const plot: Partial<TypeOptions[\"resources\"][\"plot\"]> = {\n  deleteSeries: \"删除数据系列\",\n  messagePath: \"消息地址\",\n  label: \"标签\",\n  color: \"颜色\",\n  timestamp: \"时间戳\",\n  receiveTime: \"接收时间\",\n  headerStamp: \"头时间戳\",\n  series: \"数据系列\",\n  addSeries: \"添加数据系列\",\n  maxYError: \"Y 的最大值必须大于 Y 的最小值。\",\n  maxXError: \"X 的最大值必须大于 X 的最小值。\",\n  general: \"通用\",\n  syncWithOtherPlots: \"与其他图表同步\",\n  legend: \"图例\",\n  position: \"位置\",\n  floating: \"浮动\",\n  left: \"左\",\n  top: \"上\",\n  hidden: \"隐藏\",\n  showValues: \"显示值\",\n  yAxis: \"Y 轴\",\n  showLabels: \"显示标签\",\n  min: \"最小值\",\n  max: \"最大值\",\n  xAxis: \"X 轴\",\n  value: \"值\",\n  index: \"索引\",\n  currentPath: \"地址（当前）\",\n  accumulatedPath: \"地址（累积）\",\n  secondsRange: \"范围（秒）\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { TypeOptions } from \"i18next\";\n\nexport const dataSourceInfo: Partial<TypeOptions[\"resources\"][\"dataSourceInfo\"]> = {\n  dataSource: \"数据源\",\n  currentSource: \"当前源\",\n  waitingForConnection: \"等待连接……\",\n  startTime: \"开始时间\",\n  endTime: \"结束时间\",\n  duration: \"持续时间\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { TypeOptions } from \"i18next\";\n\nexport const openDialog: Partial<TypeOptions[\"resources\"][\"openDialog\"]> = {\n  // Start\n  newToFoxgloveStudio: \"第一次使用 Foxglove Studio？\",\n  newToFoxgloveStudioDescription: \"从探索一个样本数据集开始，或查看我们的文档。\",\n  exploreSampleData: \"探索样本数据\",\n  viewOurDocs: \"查看我们的文档\",\n  joinOurCommunity: \"加入我们的社区\",\n  joinOurCommunityDescription: \"在 Slack 上与我们的开发人员和用户交流，或在 GitHub 上提出问题。\",\n  joinOurSlack: \"加入我们的 Slack\",\n  openAGitHubIssue: \"打开 GitHub issue\",\n  needHelp: \"需要帮助？\",\n  needHelpDescription: \"查看我们的文档，或查看 Foxglove 博客上的教程。\",\n  seeTutorials: \"查看教程\",\n  collaborateTitle: \"使用 Foxglove 数据平台加速开发\",\n  secureStorageOfData: \"安全地存储 PB 级的 ROS 或自定义数据\",\n  convenientWebInterface: \"使用一个方便的网络界面，以闪电般的速度标记、搜索和检索数据\",\n  canBeShared: \"与队友分享数据文件、可视化布局和自定义扩展程序\",\n  createAFreeAccount: \"创建免费帐户\",\n  signIn: \"登录\",\n  learnMore: \"了解更多\",\n  startCollaborating: \"与您的 Foxglove 组织开始合作\",\n  startCollaboratingDescription:\n    \"充分利用你的 Foxglove 账户——无论你想深入研究你的数据还是与你的团队成员分享工具。\",\n  uploadToDataPlatform: \"上传到数据平台\",\n  shareLayouts: \"分享布局\",\n  openLocalFile: \"打开本地文件\",\n  openLocalFileDescription: \"直接从本地文件系统可视化数据。\",\n  openUrl: \"上传和共享数据\",\n  openUrlDescription: \"使用 Foxglove 数据平台与您的团队共享数据。\",\n  openConnection: \"打开连接\",\n  openConnectionDescription: \"连接到实时机器人或服务器。\",\n  openDataSource: \"打开数据源\",\n  recentDataSources: \"最近使用的数据源\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { TypeOptions } from \"i18next\";\n\nexport const settingsEditor: Partial<TypeOptions[\"resources\"][\"settingsEditor\"]> = {\n  searchPanelSettings: \"搜索面板设置……\",\n  title: \"标题\",\n  clearSearch: \"清空搜索\",\n  labels: \"标签\",\n  showAll: \"显示全部\",\n  hideAll: \"隐藏全部\",\n  filterList: \"过滤列表\",\n  filterListHelp: \"按照可见性过滤列表\",\n  listAll: \"列出全部\",\n  listVisible: \"列出可见\",\n  listInvisible: \"列出不可见\",\n  general: \"通用\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { TypeOptions } from \"i18next\";\n\nexport const threeDee: Partial<TypeOptions[\"resources\"][\"threeDee\"]> = {\n  frame: \"参考系\",\n  reset: \"重置\",\n  color: \"颜色\",\n  position: \"位置\",\n  lineWidth: \"线宽\",\n  rotation: \"旋转\",\n\n  // Frame\n  displayFrame: \"展示参考系\",\n  displayFrameHelp: \"放置相机用于显示坐标系。相机的位置和方向将相对于该坐标系的原点。\",\n  followMode: \"跟踪模式\",\n  followModeHelp: \"更改回放期间相机的行为，是否跟踪显示坐标系。\",\n  pose: \"姿态\",\n  fixed: \"固定\",\n  frameNotFound: \"未找到参考系 {{frameId}}\",\n  noCoordinateFramesFound: \"未找到坐标系\",\n  enablePreloading: \"启用预加载\",\n  lineColor: \"线颜色\",\n  axisScale: \"轴比例\",\n  labelSize: \"标签大小\",\n  labels: \"标签\",\n  editable: \"可编辑\",\n  settings: \"设置\",\n  transforms: \"变换\",\n  showAll: \"显示全部\",\n  hideAll: \"隐藏全部\",\n\n  // Scene\n  scene: \"场景\",\n  renderStats: \"渲染统计\",\n  background: \"背景\",\n  labelScale: \"标签比例\",\n  labelScaleHelp: \"应用于所有标签的比例因子\",\n  ignoreColladaUpAxis: \"忽略 COLLADA 的 <up_axis>\",\n  ignoreColladaUpAxisHelp: \"通过忽略 COLLADA 文件中的 <up_axis> 标记，匹配 rviz 的行为\",\n  takeEffectAfterReboot: \"此设置需要重新启动以生效\",\n  meshUpAxis: \"网格上轴\",\n  meshUpAxisHelp: \"加载缺少方向信息的网格（STL 和 OBJ）时使用的“上”方向\",\n  YUp: \"Y-up\",\n  ZUp: \"Z-up\",\n\n  // Camera\n  view: \"视图\",\n  distance: \"距离\",\n  perspective: \"透视\",\n  target: \"目标\",\n  theta: \"极角\",\n  phi: \"方向角\",\n  fovy: \"Y轴视野\",\n  near: \"近面\",\n  far: \"远面\",\n  syncCamera: \"同步相机\",\n  syncCameraHelp: \"将相机与其他启用此设置的面板同步。\",\n\n  // Topics\n  topics: \"话题\",\n\n  // Custom layers\n  customLayers: \"自定义图层\",\n  addURDF: \"添加 URDF\",\n  size: \"大小\",\n  divisions: \"划分\",\n  grid: \"网格\",\n  delete: \"删除\",\n  addGrid: \"添加网格\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { TypeOptions } from \"i18next\";\n\nexport const appBar: Partial<TypeOptions[\"resources\"][\"appBar\"]> = {\n  about: \"关于\",\n  exploreSampleData: \"探索样本数据\",\n  open: \"打开……\",\n  openConnection: \"打开连接……\",\n  noDataSource: undefined,\n  openLocalFile: \"打开本地文件……\",\n  joinOurSlack: \"加入我们的 Slack\",\n  recentDataSources: \"最近使用的数据源\",\n  hideLeftSidebar: \"隐藏左侧边栏\",\n  hideRightSidebar: \"隐藏右侧边栏\",\n  showLeftSidebar: \"显示左侧边栏\",\n  showRightSidebar: \"显示右侧边栏\",\n  viewOurDocs: \"查看我们的文档\",\n  file: \"文件\",\n  view: \"查看\",\n  help: \"帮助\",\n  signIn: \"登录\",\n  unknown: \"未知\",\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport i18n from \"i18next\";\nimport LanguageDetector from \"i18next-browser-languagedetector\";\nimport { initReactI18next } from \"react-i18next\";\n\nimport * as en from \"./en\";\nimport * as ja from \"./ja\";\nimport * as zh from \"./zh\";\n\nexport const translations = { en, zh, ja };\n\nexport type Language = keyof typeof translations;\n\nexport const defaultNS = \"general\";\n\nexport async function initI18n(): Promise<void> {\n  await i18n\n    .use(LanguageDetector)\n    .use(initReactI18next)\n    .init({\n      resources: translations,\n      detection: {\n        order: [\"localStorage\", \"navigator\"],\n        caches: [\"localStorage\"],\n      },\n      fallbackLng: \"en\",\n      defaultNS,\n      interpolation: {\n        escapeValue: false, // not needed for react as it escapes by default\n      },\n    });\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport * as IDB from \"idb/with-async-ittr\";\n\nimport Log from \"@foxglove/log\";\nimport {\n  IExtensionStorage,\n  StoredExtension,\n} from \"@foxglove/studio-base/services/IExtensionStorage\";\nimport { ExtensionInfo } from \"@foxglove/studio-base/types/Extensions\";\n\nconst log = Log.getLogger(__filename);\n\nconst DATABASE_BASE_NAME = \"foxglove-extensions\";\nconst METADATA_STORE_NAME = \"metadata\";\nconst EXTENSION_STORE_NAME = \"extensions\";\n\ninterface ExtensionsDB extends IDB.DBSchema {\n  metadata: {\n    key: string;\n    value: ExtensionInfo;\n  };\n  extensions: {\n    key: string;\n    value: StoredExtension;\n  };\n}\n\nexport class IdbExtensionStorage implements IExtensionStorage {\n  #db: Promise<IDB.IDBPDatabase<ExtensionsDB>>;\n  public namespace: string;\n\n  public constructor(namespace: string) {\n    this.namespace = namespace;\n    this.#db = IDB.openDB<ExtensionsDB>([DATABASE_BASE_NAME, namespace].join(\"-\"), 1, {\n      upgrade: (db) => {\n        log.debug(\"Creating extension object stores\");\n\n        db.createObjectStore(METADATA_STORE_NAME, {\n          keyPath: \"id\",\n        });\n\n        db.createObjectStore(EXTENSION_STORE_NAME, {\n          keyPath: \"info.id\",\n        });\n      },\n    });\n  }\n\n  public async list(): Promise<ExtensionInfo[]> {\n    const records = await (await this.#db).getAll(METADATA_STORE_NAME);\n\n    log.debug(`Found ${records.length} extensions`);\n\n    return records;\n  }\n\n  public async get(id: string): Promise<undefined | StoredExtension> {\n    log.debug(\"Getting extension\", id);\n\n    return await (await this.#db).get(EXTENSION_STORE_NAME, id);\n  }\n\n  public async put(extension: StoredExtension): Promise<StoredExtension> {\n    log.debug(\"Storing extension\", { extension });\n\n    const transaction = (await this.#db).transaction(\n      [METADATA_STORE_NAME, EXTENSION_STORE_NAME],\n      \"readwrite\",\n    );\n    await Promise.all([\n      transaction.db.put(METADATA_STORE_NAME, extension.info),\n      transaction.db.put(EXTENSION_STORE_NAME, extension),\n      transaction.done,\n    ]);\n\n    return extension;\n  }\n\n  public async delete(id: string): Promise<void> {\n    log.debug(\"Deleting extension\", id);\n\n    const transaction = (await this.#db).transaction(\n      [METADATA_STORE_NAME, EXTENSION_STORE_NAME],\n      \"readwrite\",\n    );\n    await Promise.all([\n      transaction.db.delete(METADATA_STORE_NAME, id),\n      transaction.db.delete(EXTENSION_STORE_NAME, id),\n      transaction.done,\n    ]);\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport JSZip from \"jszip\";\n\nimport Log from \"@foxglove/log\";\nimport { ExtensionLoader } from \"@foxglove/studio-base/services/ExtensionLoader\";\nimport { IExtensionStorage } from \"@foxglove/studio-base/services/IExtensionStorage\";\nimport { ExtensionInfo, ExtensionNamespace } from \"@foxglove/studio-base/types/Extensions\";\n\nimport { IdbExtensionStorage } from \"./IdbExtensionStorage\";\n\nconst log = Log.getLogger(__filename);\n\nfunction parsePackageName(name: string): { publisher?: string; name: string } {\n  const res = /^@([^/]+)\\/(.+)/.exec(name);\n  if (res == undefined) {\n    return { name };\n  }\n  return { publisher: res[1], name: res[2] as string };\n}\n\nfunction qualifiedName(\n  namespace: ExtensionNamespace,\n  publisher: string,\n  info: ExtensionInfo,\n): string {\n  switch (namespace) {\n    case \"local\":\n      // For local namespace we follow the legacy naming convention of using displayName\n      // in order to stay compatible with existing layouts.\n      return info.displayName;\n    case \"org\":\n      // For private registry we use namespace and package name.\n      return [namespace, publisher, info.name].join(\":\");\n  }\n}\n\nfunction validatePackageInfo(info: Partial<ExtensionInfo>): ExtensionInfo {\n  if (info.name == undefined || info.name.length === 0) {\n    throw new Error(\"Invalid extension: missing name\");\n  }\n  const { publisher: parsedPublisher, name } = parsePackageName(info.name);\n  const publisher = info.publisher ?? parsedPublisher;\n  if (publisher == undefined || publisher.length === 0) {\n    throw new Error(\"Invalid extension: missing publisher\");\n  }\n\n  return { ...info, publisher, name: name.toLowerCase() } as ExtensionInfo;\n}\n\nexport class IdbExtensionLoader implements ExtensionLoader {\n  readonly #storage: IExtensionStorage;\n  public readonly namespace: ExtensionNamespace;\n\n  public constructor(namespace: ExtensionNamespace) {\n    this.namespace = namespace;\n    this.#storage = new IdbExtensionStorage(namespace);\n  }\n\n  public async getExtensions(): Promise<ExtensionInfo[]> {\n    log.debug(\"Listing extensions\");\n\n    return await this.#storage.list();\n  }\n\n  public async loadExtension(id: string): Promise<string> {\n    log.debug(\"Loading extension\", id);\n\n    const extension = await this.#storage.get(id);\n    const zip = new JSZip();\n\n    if (extension?.content == undefined) {\n      throw new Error(\"Extension is corrupted\");\n    }\n\n    const content = await zip.loadAsync(extension.content);\n    const srcText = await content.file(\"dist/extension.js\")?.async(\"string\");\n\n    if (srcText == undefined) {\n      throw new Error(\"Extension is corrupted\");\n    }\n\n    return srcText;\n  }\n\n  public async installExtension(foxeFileData: Uint8Array): Promise<ExtensionInfo> {\n    log.debug(\"Installing extension\");\n\n    const zip = new JSZip();\n    const content = await zip.loadAsync(foxeFileData);\n\n    const pkgInfoText = await content.file(\"package.json\")?.async(\"string\");\n    if (pkgInfoText == undefined) {\n      throw new Error(\"Invalid extension: missing package.json\");\n    }\n\n    const rawInfo = validatePackageInfo(JSON.parse(pkgInfoText) as Partial<ExtensionInfo>);\n    const normalizedPublisher = rawInfo.publisher.replace(/[^A-Za-z0-9_\\s]+/g, \"\");\n\n    const info: ExtensionInfo = {\n      ...rawInfo,\n      id: `${normalizedPublisher}.${rawInfo.name}`,\n      namespace: this.namespace,\n      qualifiedName: qualifiedName(this.namespace, normalizedPublisher, rawInfo),\n    };\n    await this.#storage.put({\n      content: foxeFileData,\n      info,\n    });\n\n    return info;\n  }\n\n  public async uninstallExtension(id: string): Promise<void> {\n    log.debug(\"Uninstalling extension\", id);\n\n    await this.#storage.delete(id);\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport * as base64 from \"@protobufjs/base64\";\n\nimport { MessageDefinitionField } from \"@foxglove/message-definition\";\n\nimport { MessageDefinitionMap } from \"./types\";\n\n/**\n * Parse a JSON Schema and produce datatypes and a deserializer function.\n */\nexport function parseJsonSchema(\n  rootJsonSchema: Record<string, unknown>,\n  rootTypeName: string,\n): {\n  datatypes: MessageDefinitionMap;\n\n  /**\n   * A function that should be called after parsing a value from a JSON string to do any necessary\n   * post-processing (e.g. base64 decoding)\n   */\n  postprocessValue: (value: Record<string, unknown>) => unknown;\n} {\n  const datatypes: MessageDefinitionMap = new Map();\n\n  function addFieldsRecursive(\n    schema: Record<string, unknown>,\n    typeName: string,\n    keyPath: string[],\n  ): (value: Record<string, unknown>) => unknown {\n    let postprocessObject: (value: Record<string, unknown>) => unknown = (value) => value;\n    const fields: MessageDefinitionField[] = [];\n    if (schema.type !== \"object\") {\n      throw new Error(\n        `Expected \"type\": \"object\" for schema ${typeName}, got ${JSON.stringify(schema.type)}`,\n      );\n    }\n    for (const [fieldName, fieldSchema] of Object.entries(\n      schema.properties as Record<string, Record<string, unknown>>,\n    )) {\n      if (Array.isArray(fieldSchema.oneOf)) {\n        if (fieldSchema.oneOf.every((alternative) => typeof alternative.const === \"number\")) {\n          for (const alternative of fieldSchema.oneOf) {\n            fields.push({\n              name: alternative.title,\n              type: \"uint32\",\n              isConstant: true,\n              value: alternative.const,\n            });\n          }\n          fields.push({ name: fieldName, type: \"uint32\" });\n          continue;\n        } else {\n          throw new Error(\n            `Unsupported type for ${keyPath\n              .concat(fieldName)\n              .join(\".\")}: oneOf alternatives must have number values`,\n          );\n        }\n      }\n      switch (fieldSchema.type) {\n        case \"boolean\":\n          fields.push({ name: fieldName, type: \"bool\" });\n          break;\n        case \"string\":\n          switch (fieldSchema.contentEncoding) {\n            case undefined:\n              fields.push({ name: fieldName, type: \"string\" });\n              break;\n            case \"base64\": {\n              fields.push({ name: fieldName, type: \"uint8\", isArray: true });\n              const prevPostprocess = postprocessObject;\n              postprocessObject = (value) => {\n                const str = value[fieldName];\n                if (typeof str === \"string\") {\n                  const decoded = new Uint8Array(base64.length(str));\n                  if (base64.decode(str, decoded, 0) !== decoded.byteLength) {\n                    throw new Error(\n                      `Failed to decode base64 data for ${keyPath.concat(fieldName).join(\".\")}`,\n                    );\n                  }\n                  value[fieldName] = decoded;\n                }\n                return prevPostprocess(value);\n              };\n              break;\n            }\n            default:\n              throw new Error(\n                `Unsupported contentEncoding ${JSON.stringify(\n                  fieldSchema.contentEncoding,\n                )} in ${keyPath.concat(fieldName).join(\".\")}`,\n              );\n          }\n          break;\n        case \"number\":\n        case \"integer\":\n          fields.push({ name: fieldName, type: \"float64\" });\n          break;\n        case \"object\": {\n          const nestedTypeName = `${typeName}.${fieldName}`;\n          const postprocessNestedObject = addFieldsRecursive(\n            fieldSchema,\n            nestedTypeName,\n            keyPath.concat(fieldName),\n          );\n          const prevPostprocess = postprocessObject;\n          postprocessObject = (value) => {\n            const fieldValue = value[fieldName];\n            if (fieldValue != undefined && typeof fieldValue === \"object\") {\n              value[fieldName] = postprocessNestedObject(fieldValue as Record<string, unknown>);\n            }\n            return prevPostprocess(value);\n          };\n          fields.push({ name: fieldName, type: nestedTypeName, isComplex: true });\n          break;\n        }\n        case \"array\": {\n          const itemSchema = fieldSchema.items as Record<string, unknown>;\n          switch (itemSchema.type) {\n            case \"boolean\":\n              fields.push({ name: fieldName, type: \"bool\", isArray: true });\n              break;\n            case \"string\":\n              if (itemSchema.contentEncoding != undefined) {\n                throw new Error(\n                  `Unsupported contentEncoding ${JSON.stringify(\n                    itemSchema.contentEncoding,\n                  )} for array item ${keyPath.concat(fieldName).join(\".\")}`,\n                );\n              }\n              fields.push({ name: fieldName, type: \"string\", isArray: true });\n              break;\n            case \"number\":\n            case \"integer\":\n              fields.push({ name: fieldName, type: \"float64\", isArray: true });\n              break;\n            case \"object\": {\n              const nestedTypeName = `${typeName}.${fieldName}`;\n              const postprocessArrayItem = addFieldsRecursive(\n                fieldSchema.items as Record<string, unknown>,\n                nestedTypeName,\n                keyPath.concat(fieldName),\n              );\n              const prevPostprocess = postprocessObject;\n              postprocessObject = (value) => {\n                const arr = value[fieldName];\n                if (Array.isArray(arr)) {\n                  value[fieldName] = arr.map(postprocessArrayItem);\n                }\n                return prevPostprocess(value);\n              };\n              fields.push({\n                name: fieldName,\n                type: nestedTypeName,\n                isComplex: true,\n                isArray: true,\n              });\n              break;\n            }\n            default:\n              throw new Error(\n                `Unsupported type ${JSON.stringify(itemSchema.type)} for array item ${keyPath\n                  .concat(fieldName)\n                  .join(\".\")}`,\n              );\n          }\n          break;\n        }\n        case \"null\":\n        default:\n          throw new Error(\n            `Unsupported type ${JSON.stringify(fieldSchema.type)} for ${keyPath\n              .concat(fieldName)\n              .join(\".\")}`,\n          );\n      }\n    }\n    datatypes.set(typeName, { definitions: fields });\n    return postprocessObject;\n  }\n\n  const postprocessValue = addFieldsRecursive(rootJsonSchema, rootTypeName, []);\n  return { datatypes, postprocessValue };\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\nimport protobufjs from \"protobufjs\";\n\nimport { MessageDefinitionField } from \"@foxglove/message-definition\";\n\nimport { MessageDefinitionMap } from \"./types\";\n\nfunction protobufScalarToRosPrimitive(type: string): string {\n  switch (type) {\n    case \"double\":\n      return \"float64\";\n    case \"float\":\n      return \"float32\";\n    case \"int32\":\n    case \"sint32\":\n    case \"sfixed32\":\n      return \"int32\";\n    case \"uint32\":\n    case \"fixed32\":\n      return \"uint32\";\n    case \"int64\":\n    case \"sint64\":\n    case \"sfixed64\":\n      return \"int64\";\n    case \"uint64\":\n    case \"fixed64\":\n      return \"uint64\";\n    case \"bool\":\n      return \"bool\";\n    case \"string\":\n      return \"string\";\n  }\n  throw new Error(`Expected protobuf scalar type, got ${type}`);\n}\n\nexport function stripLeadingDot(typeName: string): string {\n  return typeName.replace(/^\\./, \"\");\n}\n\nexport function protobufDefinitionsToDatatypes(\n  datatypes: MessageDefinitionMap,\n  type: protobufjs.Type,\n): void {\n  const definitions: MessageDefinitionField[] = [];\n  // The empty list reference is added to the map so a `.has` lookup below can prevent infinite recursion on cyclical types\n  datatypes.set(stripLeadingDot(type.fullName), { definitions });\n  for (const field of type.fieldsArray) {\n    if (field.resolvedType instanceof protobufjs.Enum) {\n      for (const [name, value] of Object.entries(field.resolvedType.values)) {\n        // Note: names from different enums might conflict. The player API will need to be updated\n        // to associate fields with enums (similar to the __foxglove_enum annotation hack).\n        // https://github.com/foxglove/studio/issues/2214\n        definitions.push({ name, type: \"int32\", isConstant: true, value });\n      }\n      definitions.push({ type: \"int32\", name: field.name });\n    } else if (field.resolvedType) {\n      const fullName = stripLeadingDot(field.resolvedType.fullName);\n      definitions.push({\n        type: fullName,\n        name: field.name,\n        isComplex: true,\n        isArray: field.repeated,\n      });\n\n      // If we've already processed this datatype we should skip it.\n      // This avoid infinite recursion with datatypes that reference themselves.\n      if (!datatypes.has(fullName)) {\n        protobufDefinitionsToDatatypes(datatypes, field.resolvedType);\n      }\n    } else if (field.type === \"bytes\") {\n      if (field.repeated) {\n        throw new Error(\"Repeated bytes are not currently supported\");\n      }\n      definitions.push({ type: \"uint8\", name: field.name, isArray: true });\n    } else {\n      definitions.push({\n        type: protobufScalarToRosPrimitive(field.type),\n        name: field.name,\n        isArray: field.repeated,\n      });\n    }\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { ByteBuffer } from \"flatbuffers\";\nimport { BaseType, Schema, SchemaT, FieldT, Parser, Table } from \"flatbuffers_reflection\";\n\nimport { MessageDefinitionField } from \"@foxglove/message-definition\";\n\nimport { MessageDefinitionMap } from \"./types\";\n\nfunction typeForSimpleField(type: BaseType): string {\n  switch (type) {\n    case BaseType.Bool:\n      return \"bool\";\n    case BaseType.Byte:\n      return \"int8\";\n    case BaseType.UType:\n    case BaseType.UByte:\n      return \"uint8\";\n    case BaseType.Short:\n      return \"int16\";\n    case BaseType.UShort:\n      return \"uint16\";\n    case BaseType.Int:\n      return \"int32\";\n    case BaseType.UInt:\n      return \"uint32\";\n    case BaseType.Long:\n      return \"int64\";\n    case BaseType.ULong:\n      return \"uint64\";\n    case BaseType.Float:\n      return \"float32\";\n    case BaseType.Double:\n      return \"float64\";\n    case BaseType.String:\n      return \"string\";\n    case BaseType.Vector:\n    case BaseType.Obj:\n    case BaseType.Union:\n    case BaseType.Array:\n      throw new Error(`${type} is not a simple type.`);\n    case BaseType.None:\n    case BaseType.MaxBaseType:\n      throw new Error(\"None is not a valid type.\");\n  }\n}\n\n// eslint-disable-next-line no-restricted-syntax\nfunction flatbufferString(unchecked: string | Uint8Array | null | undefined): string {\n  if (typeof unchecked === \"string\") {\n    return unchecked;\n  }\n  throw new Error(`Expected string, found ${typeof unchecked}`);\n}\n\nfunction typeForField(schema: SchemaT, field: FieldT): MessageDefinitionField[] {\n  const fields: MessageDefinitionField[] = [];\n  switch (field.type?.baseType) {\n    case BaseType.UType:\n    case BaseType.Bool:\n    case BaseType.Byte:\n    case BaseType.UByte:\n    case BaseType.Short:\n    case BaseType.UShort:\n    case BaseType.Int:\n    case BaseType.UInt:\n    case BaseType.Long:\n    case BaseType.ULong:\n    case BaseType.Float:\n    case BaseType.Double:\n    case BaseType.String:\n    case BaseType.None: {\n      const simpleType = typeForSimpleField(field.type.baseType);\n      // Enums have magic logic--the constants definitions for the enum values\n      // have to go right before the enum itself.\n      if (field.type.index !== -1) {\n        const enums = schema.enums[field.type.index]?.values;\n        if (enums == undefined) {\n          throw new Error(\n            `Invalid schema, missing enum values for field type ${\n              schema.enums[field.type.index]?.name\n            }`,\n          );\n        }\n        for (const enumVal of enums) {\n          fields.push({\n            name: flatbufferString(enumVal.name),\n            type: simpleType,\n            isConstant: true,\n            value: enumVal.value,\n          });\n        }\n      }\n      fields.push({ name: flatbufferString(field.name), type: simpleType });\n      break;\n    }\n    case BaseType.Vector:\n      switch (field.type.element) {\n        case BaseType.Vector:\n        case BaseType.Union:\n        case BaseType.Array:\n        case BaseType.None:\n          throw new Error(\"Vectors of vectors, unions, arrays, and None's are unsupported.\");\n        case BaseType.Obj:\n          fields.push({\n            name: flatbufferString(field.name),\n            type: flatbufferString(schema.objects[field.type.index]?.name),\n            isComplex: true,\n            isArray: true,\n          });\n          break;\n        default: {\n          const type = typeForSimpleField(field.type.element);\n          // Enums have magic logic--the constants definitions for the enum\n          // values have to go right before the enum itself.\n          if (field.type.index !== -1) {\n            const enums = schema.enums[field.type.index]?.values;\n            if (enums == undefined) {\n              throw new Error(\"Invalid schema\");\n            }\n            for (const enumVal of enums) {\n              fields.push({\n                name: flatbufferString(enumVal.name),\n                type,\n                isConstant: true,\n                value: enumVal.value,\n              });\n            }\n          }\n          fields.push({ name: flatbufferString(field.name), type, isArray: true });\n          break;\n        }\n      }\n      break;\n    case BaseType.Obj:\n      fields.push({\n        name: flatbufferString(field.name),\n        type: flatbufferString(schema.objects[field.type.index]?.name),\n        isComplex: true,\n      });\n      break;\n    case BaseType.Union:\n    case BaseType.Array:\n    case BaseType.MaxBaseType:\n    case undefined:\n      throw new Error(\"Unions and Arrays are not supported in mcap-support currently.\");\n  }\n  return fields;\n}\n\n/**\n * Parse a flatbuffer binary schema and produce datatypes and a deserializer function.\n *\n * Note: Currently this does not support \"lazy\" message reading in the style of the ros1 message\n * reader, and so will relatively inefficiently deserialize the entire flatbuffer message.\n */\nexport function parseFlatbufferSchema(\n  schemaName: string,\n  schemaArray: Uint8Array,\n): {\n  datatypes: MessageDefinitionMap;\n  deserialize: (buffer: ArrayBufferView) => unknown;\n} {\n  const datatypes: MessageDefinitionMap = new Map();\n  const schemaBuffer = new ByteBuffer(schemaArray);\n  const rawSchema = Schema.getRootAsSchema(schemaBuffer);\n  const schema = rawSchema.unpack();\n\n  let typeIndex = -1;\n  for (let schemaIndex = 0; schemaIndex < schema.objects.length; ++schemaIndex) {\n    const object = schema.objects[schemaIndex];\n    if (object?.name === schemaName) {\n      typeIndex = schemaIndex;\n    }\n    let fields: MessageDefinitionField[] = [];\n    if (object?.fields == undefined) {\n      continue;\n    }\n    for (const field of object.fields) {\n      fields = fields.concat(typeForField(schema, field));\n    }\n    datatypes.set(flatbufferString(object.name), { definitions: fields });\n  }\n  if (typeIndex === -1) {\n    if (schema.rootTable?.name !== schemaName) {\n      throw new Error(\n        `Type \"${schemaName}\" is not available in the schema for \"${schema.rootTable?.name}\".`,\n      );\n    }\n  }\n  const parser = new Parser(rawSchema);\n  // We set readDefaults=true to ensure that the reader receives default values for unset fields, or\n  // fields that were explicitly set but with ForceDefaults(false) on the writer side. This is\n  // necessary because `datatypes` does not include information about default values from the\n  // schema. See discussion: <https://github.com/foxglove/studio/pull/6256>\n  const toObject = parser.toObjectLambda(typeIndex, /*readDefaults=*/ true);\n  const deserialize = (buffer: ArrayBufferView) => {\n    const byteBuffer = new ByteBuffer(\n      new Uint8Array(buffer.buffer, buffer.byteOffset, buffer.byteLength),\n    );\n    const table = new Table(\n      byteBuffer,\n      typeIndex,\n      byteBuffer.readInt32(byteBuffer.position()) + byteBuffer.position(),\n      false,\n    );\n    return toObject(table);\n  };\n  return { datatypes, deserialize };\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport protobufjs from \"protobufjs\";\nimport { FileDescriptorSet } from \"protobufjs/ext/descriptor\";\n\nimport { protobufDefinitionsToDatatypes, stripLeadingDot } from \"./protobufDefinitionsToDatatypes\";\nimport { MessageDefinitionMap } from \"./types\";\n\n/**\n * Parse a Protobuf binary schema (FileDescriptorSet) and produce datatypes and a deserializer\n * function.\n */\nexport function parseProtobufSchema(\n  schemaName: string,\n  schemaData: Uint8Array,\n): {\n  datatypes: MessageDefinitionMap;\n  deserialize: (buffer: ArrayBufferView) => unknown;\n} {\n  const descriptorSet = FileDescriptorSet.decode(schemaData);\n\n  const root = protobufjs.Root.fromDescriptor(descriptorSet);\n  root.resolveAll();\n  const rootType = root.lookupType(schemaName);\n\n  // Modify the definition of google.protobuf.Timestamp and Duration so they are interpreted as\n  // {sec: number, nsec: number}, compatible with the rest of Studio. The standard Protobuf types\n  // use different names (`seconds` and `nanos`), and `seconds` is an `int64`, which would be\n  // deserialized as a bigint by default.\n  const fixTimeType = (\n    type: protobufjs.ReflectionObject | null /* eslint-disable-line no-restricted-syntax */,\n  ) => {\n    if (!type || !(type instanceof protobufjs.Type)) {\n      return;\n    }\n    // Rename fields so that protobufDefinitionsToDatatypes uses the new names\n    for (const field of type.fieldsArray) {\n      if (field.name === \"seconds\") {\n        field.name = \"sec\";\n      } else if (field.name === \"nanos\") {\n        field.name = \"nsec\";\n      }\n    }\n    type.setup(); // ensure the original optimized toObject has been created\n    const prevToObject = type.toObject; // eslint-disable-line @typescript-eslint/unbound-method\n    const newToObject: typeof prevToObject = (message, options) => {\n      const result = prevToObject.call(type, message, options);\n      const { sec, nsec } = result as { sec: bigint; nsec: number };\n      if (typeof sec !== \"bigint\" || typeof nsec !== \"number\") {\n        return result;\n      }\n      if (sec > BigInt(Number.MAX_SAFE_INTEGER)) {\n        throw new Error(\n          `Timestamps with seconds greater than 2^53-1 are not supported (found seconds=${sec}, nanos=${nsec})`,\n        );\n      }\n      return { sec: Number(sec), nsec };\n    };\n    type.toObject = newToObject;\n  };\n\n  fixTimeType(root.lookup(\".google.protobuf.Timestamp\"));\n  fixTimeType(root.lookup(\".google.protobuf.Duration\"));\n\n  const deserialize = (data: ArrayBufferView) => {\n    return rootType.toObject(\n      rootType.decode(new Uint8Array(data.buffer, data.byteOffset, data.byteLength)),\n      { defaults: true },\n    );\n  };\n\n  const datatypes: MessageDefinitionMap = new Map();\n  protobufDefinitionsToDatatypes(datatypes, rootType);\n\n  if (!datatypes.has(schemaName)) {\n    throw new Error(\n      `Protobuf schema does not contain an entry for '${schemaName}'. The schema name should be fully-qualified, e.g. '${stripLeadingDot(\n        rootType.fullName,\n      )}'.`,\n    );\n  }\n\n  return { deserialize, datatypes };\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { MessageDefinition } from \"@foxglove/message-definition\";\nimport { parse as parseMessageDefinition, parseRos2idl } from \"@foxglove/rosmsg\";\nimport { MessageReader } from \"@foxglove/rosmsg-serialization\";\nimport { MessageReader as ROS2MessageReader } from \"@foxglove/rosmsg2-serialization\";\n\nimport { parseFlatbufferSchema } from \"./parseFlatbufferSchema\";\nimport { parseJsonSchema } from \"./parseJsonSchema\";\nimport { parseProtobufSchema } from \"./parseProtobufSchema\";\nimport { MessageDefinitionMap } from \"./types\";\n\ntype Channel = {\n  messageEncoding: string;\n  schema: { name: string; encoding: string; data: Uint8Array } | undefined;\n};\n\nexport type ParsedChannel = {\n  deserialize: (data: ArrayBufferView) => unknown;\n  datatypes: MessageDefinitionMap;\n};\n\nfunction parsedDefinitionsToDatatypes(\n  parsedDefinitions: MessageDefinition[],\n  rootName: string,\n): MessageDefinitionMap {\n  const datatypes: MessageDefinitionMap = new Map();\n  parsedDefinitions.forEach(({ name, definitions }, index) => {\n    if (index === 0) {\n      datatypes.set(rootName, { name: rootName, definitions });\n    } else if (name != undefined) {\n      datatypes.set(name, { name, definitions });\n    }\n  });\n  return datatypes;\n}\n\n/**\n * Process a channel/schema and extract information that can be used to deserialize messages on the\n * channel, and schemas in the format expected by Studio's RosDatatypes.\n *\n * See:\n * - https://github.com/foxglove/mcap/blob/main/docs/specification/well-known-message-encodings.md\n * - https://github.com/foxglove/mcap/blob/main/docs/specification/well-known-schema-encodings.md\n */\nexport function parseChannel(channel: Channel): ParsedChannel {\n  if (channel.messageEncoding === \"json\") {\n    if (channel.schema != undefined && channel.schema.encoding !== \"jsonschema\") {\n      throw new Error(\n        `Message encoding ${channel.messageEncoding} with schema encoding '${channel.schema.encoding}' is not supported (expected jsonschema or no schema)`,\n      );\n    }\n    const textDecoder = new TextDecoder();\n    let datatypes: MessageDefinitionMap = new Map();\n    let deserialize = (data: ArrayBufferView) => JSON.parse(textDecoder.decode(data));\n    if (channel.schema != undefined) {\n      const schema =\n        channel.schema.data.length > 0\n          ? JSON.parse(textDecoder.decode(channel.schema.data))\n          : undefined;\n      if (schema != undefined) {\n        if (typeof schema !== \"object\") {\n          throw new Error(`Invalid schema, expected JSON object, got ${typeof schema}`);\n        }\n        const { datatypes: parsedDatatypes, postprocessValue } = parseJsonSchema(\n          schema as Record<string, unknown>,\n          channel.schema.name,\n        );\n        datatypes = parsedDatatypes;\n        deserialize = (data) =>\n          postprocessValue(JSON.parse(textDecoder.decode(data)) as Record<string, unknown>);\n      }\n    }\n    return { deserialize, datatypes };\n  }\n\n  if (channel.messageEncoding === \"flatbuffer\") {\n    if (channel.schema?.encoding !== \"flatbuffer\") {\n      throw new Error(\n        `Message encoding ${channel.messageEncoding} with ${\n          channel.schema == undefined\n            ? \"no encoding\"\n            : `schema encoding '${channel.schema.encoding}'`\n        } is not supported (expected flatbuffer)`,\n      );\n    }\n    return parseFlatbufferSchema(channel.schema.name, channel.schema.data);\n  }\n\n  if (channel.messageEncoding === \"protobuf\") {\n    if (channel.schema?.encoding !== \"protobuf\") {\n      throw new Error(\n        `Message encoding ${channel.messageEncoding} with ${\n          channel.schema == undefined\n            ? \"no encoding\"\n            : `schema encoding '${channel.schema.encoding}'`\n        } is not supported (expected protobuf)`,\n      );\n    }\n    return parseProtobufSchema(channel.schema.name, channel.schema.data);\n  }\n\n  if (channel.messageEncoding === \"ros1\") {\n    if (channel.schema?.encoding !== \"ros1msg\") {\n      throw new Error(\n        `Message encoding ${channel.messageEncoding} with ${\n          channel.schema == undefined\n            ? \"no encoding\"\n            : `schema encoding '${channel.schema.encoding}'`\n        } is not supported (expected ros1msg)`,\n      );\n    }\n    const schema = new TextDecoder().decode(channel.schema.data);\n    const parsedDefinitions = parseMessageDefinition(schema);\n    const reader = new MessageReader(parsedDefinitions);\n    return {\n      datatypes: parsedDefinitionsToDatatypes(parsedDefinitions, channel.schema.name),\n      deserialize: (data) => reader.readMessage(data),\n    };\n  }\n\n  if (channel.messageEncoding === \"cdr\") {\n    if (channel.schema?.encoding !== \"ros2msg\" && channel.schema?.encoding !== \"ros2idl\") {\n      throw new Error(\n        `Message encoding ${channel.messageEncoding} with ${\n          channel.schema == undefined\n            ? \"no encoding\"\n            : `schema encoding '${channel.schema.encoding}'`\n        } is not supported (expected \"ros2msg\" or \"ros2idl\")`,\n      );\n    }\n    const schema = new TextDecoder().decode(channel.schema.data);\n    const isIdl = channel.schema.encoding === \"ros2idl\";\n\n    const parsedDefinitions = isIdl\n      ? parseRos2idl(schema)\n      : parseMessageDefinition(schema, { ros2: true });\n\n    const reader = new ROS2MessageReader(parsedDefinitions);\n    return {\n      datatypes: parsedDefinitionsToDatatypes(parsedDefinitions, channel.schema.name),\n      deserialize: (data) => reader.readMessage(data),\n    };\n  }\n\n  throw new Error(`Unsupported encoding ${channel.messageEncoding}`);\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { PlayerProblem } from \"@foxglove/studio-base/players/types\";\n\n/**\n * Manages a set of PlayerProblems keyed by ID. Calls to problems() will return the same object as\n * long as problems have not been added/removed; this helps the player pipeline to know when it\n * needs to re-process player problems.\n */\nexport default class PlayerProblemManager {\n  #problemsById = new Map<string, PlayerProblem>();\n  #problems?: PlayerProblem[];\n\n  /**\n   * Returns the current set of problems. Subsequent calls will return the same object as long as\n   * problems have not been added/removed.\n   */\n  public problems(): PlayerProblem[] {\n    return (this.#problems ??= Array.from(this.#problemsById.values()));\n  }\n\n  public addProblem(id: string, problem: PlayerProblem): void {\n    console[problem.severity].call(console, \"Player problem\", id, problem);\n    this.#problemsById.set(id, problem);\n    this.#problems = undefined;\n  }\n\n  public hasProblem(id: string): boolean {\n    return this.#problemsById.has(id);\n  }\n\n  public removeProblem(id: string): boolean {\n    const changed = this.#problemsById.delete(id);\n    if (changed) {\n      this.#problems = undefined;\n    }\n    return changed;\n  }\n\n  public removeProblems(predicate: (id: string, problem: PlayerProblem) => boolean): boolean {\n    let changed = false;\n    for (const [id, problem] of this.#problemsById) {\n      if (predicate(id, problem)) {\n        if (this.#problemsById.delete(id)) {\n          changed = true;\n        }\n      }\n    }\n    if (changed) {\n      this.#problems = undefined;\n    }\n    return changed;\n  }\n\n  public clear(): void {\n    this.#problemsById.clear();\n    this.#problems = undefined;\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { MessageDefinition } from \"@foxglove/message-definition\";\nimport { RosDatatypes } from \"@foxglove/studio-base/types/RosDatatypes\";\n\n// For one datatype in the datatypes, find the MessageDefinition that we can use\n// to either write or parse it. `datatypes` should contain the root datatype and\n// all complex sub-datatypes.\nexport default function rosDatatypesToMessageDefinition(\n  datatypes: RosDatatypes,\n  rootDatatypeName: string,\n): MessageDefinition[] {\n  const result = [];\n  const seenDatatypeNames = new Set([rootDatatypeName]);\n  // It doesn't matter if we use a stack or queue here, but we use a stack.\n  const datatypeNameStack = [rootDatatypeName];\n\n  while (datatypeNameStack.length > 0) {\n    const currentDatatypeName = datatypeNameStack.pop();\n    if (currentDatatypeName == undefined) {\n      throw new Error(`Invariant violation - Array.pop() when length > 0`);\n    }\n    const currentDatatype = datatypes.get(currentDatatypeName);\n    if (!currentDatatype) {\n      throw new Error(\n        `While searching datatypes for \"${rootDatatypeName}\", could not find datatype \"${currentDatatypeName}\"`,\n      );\n    }\n    // The root datatype has no name field.\n    const msgDefinition: MessageDefinition =\n      currentDatatypeName === rootDatatypeName\n        ? { definitions: currentDatatype.definitions }\n        : { name: currentDatatypeName, definitions: currentDatatype.definitions };\n    result.push(msgDefinition);\n    for (const field of currentDatatype.definitions) {\n      // Only search subfields if we haven't already seen it and it is \"complex\", IE it has its own fields and should\n      // be contained in `datatypes`.\n      if (field.isComplex === true && !seenDatatypeNames.has(field.type)) {\n        datatypeNameStack.push(field.type);\n        seenDatatypeNames.add(field.type);\n      }\n    }\n  }\n\n  return result;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { MessageWriter } from \"./MessageWriter\";\n\nexport class JsonMessageWriter implements MessageWriter {\n  public writeMessage(message: unknown): Uint8Array {\n    return new Uint8Array(Buffer.from(JSON.stringify(message) ?? \"\"));\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { IWebSocket } from \"@foxglove/ws-protocol\";\n\nimport { FromWorkerMessage, ToWorkerMessage } from \"./worker\";\n\nexport default class WorkerSocketAdapter implements IWebSocket {\n  #worker: Worker;\n  #connectionClosed: boolean = false;\n  public binaryType: string = \"\";\n  public protocol: string = \"\";\n  public onerror: ((event: unknown) => void) | undefined = undefined;\n  public onopen: ((event: unknown) => void) | undefined = undefined;\n  public onclose: ((event: unknown) => void) | undefined = undefined;\n  public onmessage: ((event: unknown) => void) | undefined = undefined;\n\n  public constructor(wsUrl: string, protocols?: string[] | string) {\n    // foxglove-depcheck-used: babel-plugin-transform-import-meta\n    this.#worker = new Worker(new URL(\"./worker\", import.meta.url));\n    this.#sendToWorker({ type: \"open\", data: { wsUrl, protocols } });\n\n    this.#worker.onerror = (ev) => {\n      if (this.onerror) {\n        this.onerror(ev);\n      }\n    };\n\n    this.#worker.onmessage = (event: MessageEvent<FromWorkerMessage>) => {\n      switch (event.data.type) {\n        case \"open\":\n          if (this.onopen) {\n            this.protocol = event.data.protocol;\n            this.onopen(event.data);\n          }\n          break;\n        case \"close\":\n          // websocket connection got closed, we can terminate the worker\n          this.#connectionClosed = true;\n          this.#worker.terminate();\n\n          if (this.onclose) {\n            this.onclose(event.data);\n          }\n          break;\n        case \"error\":\n          if (this.onerror) {\n            this.onerror(event.data);\n          }\n          break;\n        case \"message\":\n          if (this.onmessage) {\n            this.onmessage(event.data);\n          }\n          break;\n      }\n    };\n  }\n\n  public close(): void {\n    if (!this.#connectionClosed) {\n      this.#sendToWorker({\n        type: \"close\",\n        data: undefined,\n      });\n    }\n  }\n\n  public send(data: string | ArrayBuffer | ArrayBufferView): void {\n    this.#sendToWorker({ type: \"data\", data });\n  }\n\n  #sendToWorker(msg: ToWorkerMessage): void {\n    if (this.#connectionClosed) {\n      throw Error(\"Can't send message over closed websocket connection\");\n    }\n    this.#worker.postMessage(msg);\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport * as base64 from \"@protobufjs/base64\";\nimport { isEqual, isMatch, uniqWith } from \"lodash\";\nimport { v4 as uuidv4 } from \"uuid\";\n\nimport { debouncePromise } from \"@foxglove/den/async\";\nimport Log from \"@foxglove/log\";\nimport { parseChannel, ParsedChannel } from \"@foxglove/mcap-support\";\nimport { MessageDefinition } from \"@foxglove/message-definition\";\nimport CommonRosTypes from \"@foxglove/rosmsg-msgs-common\";\nimport { MessageWriter as Ros1MessageWriter } from \"@foxglove/rosmsg-serialization\";\nimport { MessageWriter as Ros2MessageWriter } from \"@foxglove/rosmsg2-serialization\";\nimport { fromMillis, fromNanoSec, isGreaterThan, isLessThan, Time } from \"@foxglove/rostime\";\nimport { ParameterValue } from \"@foxglove/studio\";\nimport PlayerProblemManager from \"@foxglove/studio-base/players/PlayerProblemManager\";\nimport {\n  AdvertiseOptions,\n  MessageEvent,\n  Player,\n  PlayerCapabilities,\n  PlayerMetricsCollectorInterface,\n  PlayerPresence,\n  PlayerProblem,\n  PlayerState,\n  PublishPayload,\n  SubscribePayload,\n  Topic,\n  TopicStats,\n} from \"@foxglove/studio-base/players/types\";\nimport { RosDatatypes } from \"@foxglove/studio-base/types/RosDatatypes\";\nimport rosDatatypesToMessageDefinition from \"@foxglove/studio-base/util/rosDatatypesToMessageDefinition\";\nimport {\n  Channel,\n  ChannelId,\n  ClientChannel,\n  FoxgloveClient,\n  ServerCapability,\n  SubscriptionId,\n  Service,\n  ServiceCallPayload,\n  ServiceCallRequest,\n  ServiceCallResponse,\n  Parameter,\n  StatusLevel,\n} from \"@foxglove/ws-protocol\";\n\nimport { JsonMessageWriter } from \"./JsonMessageWriter\";\nimport { MessageWriter } from \"./MessageWriter\";\nimport WorkerSocketAdapter from \"./WorkerSocketAdapter\";\n\nconst log = Log.getLogger(__dirname);\nconst textEncoder = new TextEncoder();\nconst textDecoder = new TextDecoder();\n\n/** Suppress warnings about messages on unknown subscriptions if the susbscription was recently canceled. */\nconst SUBSCRIPTION_WARNING_SUPPRESSION_MS = 2000;\n\nconst ZERO_TIME = Object.freeze({ sec: 0, nsec: 0 });\nconst GET_ALL_PARAMS_REQUEST_ID = \"get-all-params\";\nconst GET_ALL_PARAMS_PERIOD_MS = 15000;\nconst ROS_ENCODINGS = [\"ros1\", \"cdr\"];\nconst SUPPORTED_PUBLICATION_ENCODINGS = [\"json\", ...ROS_ENCODINGS];\nconst FALLBACK_PUBLICATION_ENCODING = \"json\";\nconst SUPPORTED_SERVICE_ENCODINGS = [\"json\", ...ROS_ENCODINGS];\n\ntype ResolvedChannel = { channel: Channel; parsedChannel: ParsedChannel };\ntype Publication = ClientChannel & { messageWriter?: Ros1MessageWriter | Ros2MessageWriter };\ntype ResolvedService = {\n  service: Service;\n  parsedResponse: ParsedChannel;\n  requestMessageWriter: MessageWriter;\n};\ntype MessageDefinitionMap = Map<string, MessageDefinition>;\n\nexport default class FoxgloveWebSocketPlayer implements Player {\n  readonly #sourceId: string;\n\n  #url: string; // WebSocket URL.\n  #name: string;\n  #client?: FoxgloveClient; // The client when we're connected.\n  #id: string = uuidv4(); // Unique ID for this player session.\n  #serverCapabilities: string[] = [];\n  #playerCapabilities: (typeof PlayerCapabilities)[keyof typeof PlayerCapabilities][] = [];\n  #supportedEncodings?: string[];\n  #listener?: (arg0: PlayerState) => Promise<void>; // Listener for _emitState().\n  #closed: boolean = false; // Whether the player has been completely closed using close().\n  #topics?: Topic[]; // Topics as published by the WebSocket.\n  #topicsStats = new Map<string, TopicStats>(); // Topic names to topic statistics.\n  #datatypes: RosDatatypes = new Map(); // Datatypes as published by the WebSocket.\n  #parsedMessages: MessageEvent[] = []; // Queue of messages that we'll send in next _emitState() call.\n  #receivedBytes: number = 0;\n  #metricsCollector: PlayerMetricsCollectorInterface;\n  #hasReceivedMessage = false;\n  #presence: PlayerPresence = PlayerPresence.INITIALIZING;\n  #problems = new PlayerProblemManager();\n  #numTimeSeeks = 0;\n  #profile?: string;\n  #urlState: PlayerState[\"urlState\"];\n\n  /** Earliest time seen */\n  #startTime?: Time;\n  /** Latest time seen */\n  #endTime?: Time;\n  /* The most recent published time, if available */\n  #clockTime?: Time;\n  /* Flag indicating if the server publishes time messages */\n  #serverPublishesTime = false;\n\n  #unresolvedSubscriptions = new Set<string>();\n  #resolvedSubscriptionsByTopic = new Map<string, SubscriptionId>();\n  #resolvedSubscriptionsById = new Map<SubscriptionId, ResolvedChannel>();\n  #channelsByTopic = new Map<string, ResolvedChannel>();\n  #channelsById = new Map<ChannelId, ResolvedChannel>();\n  #unsupportedChannelIds = new Set<ChannelId>();\n  #recentlyCanceledSubscriptions = new Set<SubscriptionId>();\n  #parameters = new Map<string, ParameterValue>();\n  #getParameterInterval?: ReturnType<typeof setInterval>;\n  #openTimeout?: ReturnType<typeof setInterval>;\n  #connectionAttemptTimeout?: ReturnType<typeof setInterval>;\n  #unresolvedPublications: AdvertiseOptions[] = [];\n  #publicationsByTopic = new Map<string, Publication>();\n  #serviceCallEncoding?: string;\n  #servicesByName = new Map<string, ResolvedService>();\n  #serviceResponseCbs = new Map<\n    ServiceCallRequest[\"callId\"],\n    (response: ServiceCallResponse) => void\n  >();\n  #publishedTopics?: Map<string, Set<string>>;\n  #subscribedTopics?: Map<string, Set<string>>;\n  #advertisedServices?: Map<string, Set<string>>;\n  #nextServiceCallId = 0;\n\n  public constructor({\n    url,\n    metricsCollector,\n    sourceId,\n  }: {\n    url: string;\n    metricsCollector: PlayerMetricsCollectorInterface;\n    sourceId: string;\n  }) {\n    this.#metricsCollector = metricsCollector;\n    this.#url = url;\n    this.#name = url;\n    this.#metricsCollector.playerConstructed();\n    this.#sourceId = sourceId;\n    this.#urlState = {\n      sourceId: this.#sourceId,\n      parameters: { url: this.#url },\n    };\n    this.#open();\n  }\n\n  #open = (): void => {\n    if (this.#closed) {\n      return;\n    }\n    if (this.#client != undefined) {\n      throw new Error(`Attempted to open a second Foxglove WebSocket connection`);\n    }\n    log.info(`Opening connection to ${this.#url}`);\n\n    // Set a timeout to abort the connection if we are still not connected by then.\n    // This will abort hanging connection attempts that can for whatever reason not\n    // establish a connection with the server.\n    this.#connectionAttemptTimeout = setTimeout(() => {\n      this.#client?.close();\n    }, 10000);\n\n    this.#client = new FoxgloveClient({\n      ws:\n        typeof Worker !== \"undefined\"\n          ? new WorkerSocketAdapter(this.#url, [FoxgloveClient.SUPPORTED_SUBPROTOCOL])\n          : new WebSocket(this.#url, [FoxgloveClient.SUPPORTED_SUBPROTOCOL]),\n    });\n\n    this.#client.on(\"open\", () => {\n      if (this.#closed) {\n        return;\n      }\n      if (this.#connectionAttemptTimeout != undefined) {\n        clearTimeout(this.#connectionAttemptTimeout);\n      }\n      this.#presence = PlayerPresence.PRESENT;\n      this.#resetSessionState();\n      this.#problems.clear();\n      this.#channelsById.clear();\n      this.#channelsByTopic.clear();\n      this.#servicesByName.clear();\n      this.#serviceResponseCbs.clear();\n      this.#parameters.clear();\n      this.#profile = undefined;\n      this.#publishedTopics = undefined;\n      this.#subscribedTopics = undefined;\n      this.#advertisedServices = undefined;\n      this.#publicationsByTopic.clear();\n      this.#datatypes = new Map();\n\n      for (const topic of this.#resolvedSubscriptionsByTopic.keys()) {\n        this.#unresolvedSubscriptions.add(topic);\n      }\n      this.#resolvedSubscriptionsById.clear();\n      this.#resolvedSubscriptionsByTopic.clear();\n    });\n\n    this.#client.on(\"error\", (err) => {\n      log.error(err);\n\n      if (\n        (err as unknown as undefined | { message?: string })?.message != undefined &&\n        err.message.includes(\"insecure WebSocket connection\")\n      ) {\n        this.#problems.addProblem(\"ws:connection-failed\", {\n          severity: \"error\",\n          message: \"Insecure WebSocket connection\",\n          tip: `Check that the WebSocket server at ${\n            this.#url\n          } is reachable and supports protocol version ${FoxgloveClient.SUPPORTED_SUBPROTOCOL}.`,\n        });\n        this.#emitState();\n      }\n    });\n\n    // Note: We've observed closed being called not only when an already open connection is closed\n    // but also when a new connection fails to open\n    //\n    // Note: We explicitly avoid clearing state like start/end times, datatypes, etc to preserve\n    // this during a disconnect event. Any necessary state clearing is handled once a new connection\n    // is established\n    this.#client.on(\"close\", (event) => {\n      log.info(\"Connection closed:\", event);\n      this.#presence = PlayerPresence.RECONNECTING;\n\n      if (this.#getParameterInterval != undefined) {\n        clearInterval(this.#getParameterInterval);\n        this.#getParameterInterval = undefined;\n      }\n      if (this.#connectionAttemptTimeout != undefined) {\n        clearTimeout(this.#connectionAttemptTimeout);\n      }\n\n      this.#client?.close();\n      this.#client = undefined;\n\n      this.#problems.addProblem(\"ws:connection-failed\", {\n        severity: \"error\",\n        message: \"Connection failed\",\n        tip: `Check that the WebSocket server at ${\n          this.#url\n        } is reachable and supports protocol version ${FoxgloveClient.SUPPORTED_SUBPROTOCOL}.`,\n      });\n\n      this.#emitState();\n      this.#openTimeout = setTimeout(this.#open, 3000);\n    });\n\n    this.#client.on(\"serverInfo\", (event) => {\n      if (!Array.isArray(event.capabilities)) {\n        this.#problems.addProblem(\"ws:invalid-capabilities\", {\n          severity: \"warn\",\n          message: `Server sent an invalid or missing capabilities field: '${event.capabilities}'`,\n        });\n      }\n\n      const newSessionId = event.sessionId ?? uuidv4();\n      if (this.#id !== newSessionId) {\n        this.#resetSessionState();\n      }\n\n      this.#id = newSessionId;\n      this.#name = `${this.#url}\\n${event.name}`;\n      this.#serverCapabilities = Array.isArray(event.capabilities) ? event.capabilities : [];\n      this.#serverPublishesTime = this.#serverCapabilities.includes(ServerCapability.time);\n      this.#supportedEncodings = event.supportedEncodings;\n      this.#datatypes = new Map();\n\n      // If the server publishes the time we clear any existing clockTime we might have and let the\n      // server override\n      if (this.#serverPublishesTime) {\n        this.#clockTime = undefined;\n      }\n\n      const maybeRosDistro = event.metadata?.[\"ROS_DISTRO\"];\n      if (maybeRosDistro) {\n        const rosDistro = maybeRosDistro;\n        const isRos1 = [\"melodic\", \"noetic\"].includes(rosDistro);\n        this.#profile = isRos1 ? \"ros1\" : \"ros2\";\n\n        // Add common ROS message definitions\n        const rosDataTypes = isRos1\n          ? CommonRosTypes.ros1\n          : [\"foxy\", \"galactic\"].includes(rosDistro)\n          ? CommonRosTypes.ros2galactic\n          : CommonRosTypes.ros2humble;\n\n        const dataTypes: MessageDefinitionMap = new Map();\n        for (const dataType in rosDataTypes) {\n          const msgDef = (rosDataTypes as Record<string, MessageDefinition>)[dataType]!;\n          dataTypes.set(dataType, msgDef);\n        }\n        this.#updateDataTypes(dataTypes);\n      }\n\n      if (event.capabilities.includes(ServerCapability.clientPublish)) {\n        this.#playerCapabilities = this.#playerCapabilities.concat(PlayerCapabilities.advertise);\n        this.#setupPublishers();\n      }\n      if (event.capabilities.includes(ServerCapability.services)) {\n        this.#serviceCallEncoding = event.supportedEncodings?.find((e) =>\n          SUPPORTED_SERVICE_ENCODINGS.includes(e),\n        );\n\n        const problemId = \"callService:unsupportedEncoding\";\n        if (this.#serviceCallEncoding) {\n          this.#playerCapabilities = this.#playerCapabilities.concat(\n            PlayerCapabilities.callServices,\n          );\n          this.#problems.removeProblem(problemId);\n        } else {\n          this.#problems.addProblem(problemId, {\n            severity: \"warn\",\n            message: `Calling services is disabled as no compatible encoding could be found. \\\n            The server supports [${event.supportedEncodings?.join(\", \")}], \\\n            but Studio only supports [${SUPPORTED_SERVICE_ENCODINGS.join(\", \")}]`,\n          });\n        }\n      }\n\n      if (event.capabilities.includes(ServerCapability.parameters)) {\n        this.#playerCapabilities = this.#playerCapabilities.concat(\n          PlayerCapabilities.getParameters,\n          PlayerCapabilities.setParameters,\n        );\n\n        // Periodically request all available parameters.\n        this.#getParameterInterval = setInterval(() => {\n          this.#client?.getParameters([], GET_ALL_PARAMS_REQUEST_ID);\n        }, GET_ALL_PARAMS_PERIOD_MS);\n\n        this.#client?.getParameters([], GET_ALL_PARAMS_REQUEST_ID);\n      }\n\n      if (event.capabilities.includes(ServerCapability.connectionGraph)) {\n        this.#client?.subscribeConnectionGraph();\n      }\n\n      this.#emitState();\n    });\n\n    this.#client.on(\"status\", (event) => {\n      const msg = `FoxgloveWebSocket: ${event.message}`;\n      if (event.level === StatusLevel.INFO) {\n        log.info(msg);\n      } else if (event.level === StatusLevel.WARNING) {\n        log.warn(msg);\n      } else {\n        log.error(msg);\n      }\n\n      const problem: PlayerProblem = {\n        message: event.message,\n        severity: statusLevelToProblemSeverity(event.level),\n      };\n\n      if (event.message === \"Send buffer limit reached\") {\n        problem.tip =\n          \"Server is dropping messages to the client. Check if you are subscribing to large or frequent topics or adjust your server send buffer limit.\";\n      }\n\n      this.#problems.addProblem(event.message, problem);\n      this.#emitState();\n    });\n\n    this.#client.on(\"advertise\", (newChannels) => {\n      for (const channel of newChannels) {\n        let parsedChannel;\n        try {\n          let schemaEncoding;\n          let schemaData;\n          if (\n            channel.encoding === \"json\" &&\n            (channel.schemaEncoding == undefined || channel.schemaEncoding === \"jsonschema\")\n          ) {\n            schemaEncoding = \"jsonschema\";\n            schemaData = textEncoder.encode(channel.schema);\n          } else if (\n            channel.encoding === \"protobuf\" &&\n            (channel.schemaEncoding == undefined || channel.schemaEncoding === \"protobuf\")\n          ) {\n            schemaEncoding = \"protobuf\";\n            schemaData = new Uint8Array(base64.length(channel.schema));\n            if (base64.decode(channel.schema, schemaData, 0) !== schemaData.byteLength) {\n              throw new Error(`Failed to decode base64 schema on channel ${channel.id}`);\n            }\n          } else if (\n            channel.encoding === \"flatbuffer\" &&\n            (channel.schemaEncoding == undefined || channel.schemaEncoding === \"flatbuffer\")\n          ) {\n            schemaEncoding = \"flatbuffer\";\n            schemaData = new Uint8Array(base64.length(channel.schema));\n            if (base64.decode(channel.schema, schemaData, 0) !== schemaData.byteLength) {\n              throw new Error(`Failed to decode base64 schema on channel ${channel.id}`);\n            }\n          } else if (\n            channel.encoding === \"ros1\" &&\n            (channel.schemaEncoding == undefined || channel.schemaEncoding === \"ros1msg\")\n          ) {\n            schemaEncoding = \"ros1msg\";\n            schemaData = textEncoder.encode(channel.schema);\n          } else if (\n            channel.encoding === \"cdr\" &&\n            (channel.schemaEncoding == undefined ||\n              [\"ros2idl\", \"ros2msg\"].includes(channel.schemaEncoding))\n          ) {\n            schemaEncoding = channel.schemaEncoding ?? \"ros2msg\";\n            schemaData = textEncoder.encode(channel.schema);\n          } else {\n            const msg = channel.schemaEncoding\n              ? `Unsupported combination of message / schema encoding: (${channel.encoding} / ${channel.schemaEncoding})`\n              : `Unsupported message encoding ${channel.encoding}`;\n            throw new Error(msg);\n          }\n          parsedChannel = parseChannel({\n            messageEncoding: channel.encoding,\n            schema: { name: channel.schemaName, encoding: schemaEncoding, data: schemaData },\n          });\n        } catch (error) {\n          this.#unsupportedChannelIds.add(channel.id);\n          this.#problems.addProblem(`schema:${channel.topic}`, {\n            severity: \"error\",\n            message: `Failed to parse channel schema on ${channel.topic}`,\n            error,\n          });\n          this.#emitState();\n          continue;\n        }\n        const existingChannel = this.#channelsByTopic.get(channel.topic);\n        if (existingChannel && !isEqual(channel, existingChannel.channel)) {\n          this.#problems.addProblem(`duplicate-topic:${channel.topic}`, {\n            severity: \"error\",\n            message: `Multiple channels advertise the same topic: ${channel.topic} (${existingChannel.channel.id} and ${channel.id})`,\n          });\n          this.#emitState();\n          continue;\n        }\n        const resolvedChannel = { channel, parsedChannel };\n        this.#channelsById.set(channel.id, resolvedChannel);\n        this.#channelsByTopic.set(channel.topic, resolvedChannel);\n      }\n      this.#updateTopicsAndDatatypes();\n      this.#emitState();\n      this.#processUnresolvedSubscriptions();\n    });\n\n    this.#client.on(\"unadvertise\", (removedChannels) => {\n      for (const id of removedChannels) {\n        const chanInfo = this.#channelsById.get(id);\n        if (!chanInfo) {\n          if (!this.#unsupportedChannelIds.delete(id)) {\n            this.#problems.addProblem(`unadvertise:${id}`, {\n              severity: \"error\",\n              message: `Server unadvertised channel ${id} that was not advertised`,\n            });\n            this.#emitState();\n          }\n          continue;\n        }\n        for (const [subId, { channel }] of this.#resolvedSubscriptionsById) {\n          if (channel.id === id) {\n            this.#resolvedSubscriptionsById.delete(subId);\n            this.#resolvedSubscriptionsByTopic.delete(channel.topic);\n            this.#client?.unsubscribe(subId);\n            this.#unresolvedSubscriptions.add(channel.topic);\n          }\n        }\n        this.#channelsById.delete(id);\n        this.#channelsByTopic.delete(chanInfo.channel.topic);\n      }\n      this.#updateTopicsAndDatatypes();\n      this.#emitState();\n    });\n\n    this.#client.on(\"message\", ({ subscriptionId, data }) => {\n      if (!this.#hasReceivedMessage) {\n        this.#hasReceivedMessage = true;\n        this.#metricsCollector.recordTimeToFirstMsgs();\n      }\n      const chanInfo = this.#resolvedSubscriptionsById.get(subscriptionId);\n      if (!chanInfo) {\n        const wasRecentlyCanceled = this.#recentlyCanceledSubscriptions.has(subscriptionId);\n        if (!wasRecentlyCanceled) {\n          this.#problems.addProblem(`message-missing-subscription:${subscriptionId}`, {\n            severity: \"warn\",\n            message: `Received message on unknown subscription id: ${subscriptionId}. This might be a WebSocket server bug.`,\n          });\n          this.#emitState();\n        }\n        return;\n      }\n\n      try {\n        this.#receivedBytes += data.byteLength;\n        const receiveTime = this.#getCurrentTime();\n        const topic = chanInfo.channel.topic;\n        this.#parsedMessages.push({\n          topic,\n          receiveTime,\n          message: chanInfo.parsedChannel.deserialize(data),\n          sizeInBytes: data.byteLength,\n          schemaName: chanInfo.channel.schemaName,\n        });\n\n        // Update the message count for this topic\n        let stats = this.#topicsStats.get(topic);\n        if (!stats) {\n          stats = { numMessages: 0 };\n          this.#topicsStats.set(topic, stats);\n        }\n        stats.numMessages++;\n      } catch (error) {\n        this.#problems.addProblem(`message:${chanInfo.channel.topic}`, {\n          severity: \"error\",\n          message: `Failed to parse message on ${chanInfo.channel.topic}`,\n          error,\n        });\n      }\n      this.#emitState();\n    });\n\n    this.#client.on(\"time\", ({ timestamp }) => {\n      if (!this.#serverPublishesTime) {\n        return;\n      }\n\n      const time = fromNanoSec(timestamp);\n      if (this.#clockTime != undefined && isLessThan(time, this.#clockTime)) {\n        this.#numTimeSeeks++;\n        this.#parsedMessages = [];\n      }\n\n      this.#clockTime = time;\n      this.#emitState();\n    });\n\n    this.#client.on(\"parameterValues\", ({ parameters, id }) => {\n      const mappedParameters = parameters.map((param) => {\n        return param.type === \"byte_array\"\n          ? {\n              ...param,\n              value: Uint8Array.from(atob(param.value as string), (c) => c.charCodeAt(0)),\n            }\n          : param;\n      });\n\n      const newParameters = mappedParameters.filter((param) => !this.#parameters.has(param.name));\n\n      if (id === GET_ALL_PARAMS_REQUEST_ID) {\n        // Reset params\n        this.#parameters = new Map(mappedParameters.map((param) => [param.name, param.value]));\n      } else {\n        // Update params\n        mappedParameters.forEach((param) => this.#parameters.set(param.name, param.value));\n      }\n\n      this.#emitState();\n\n      if (\n        newParameters.length > 0 &&\n        this.#serverCapabilities.includes(ServerCapability.parametersSubscribe)\n      ) {\n        // Subscribe to value updates of new parameters\n        this.#client?.subscribeParameterUpdates(newParameters.map((p) => p.name));\n      }\n    });\n\n    this.#client.on(\"advertiseServices\", (services) => {\n      if (!this.#serviceCallEncoding) {\n        return;\n      }\n\n      let schemaEncoding: string;\n      if (this.#serviceCallEncoding === \"json\") {\n        schemaEncoding = \"jsonschema\";\n      } else if (this.#serviceCallEncoding === \"ros1\") {\n        schemaEncoding = \"ros1msg\";\n      } else if (this.#serviceCallEncoding === \"cdr\") {\n        schemaEncoding = \"ros2msg\";\n      } else {\n        throw new Error(`Unsupported encoding \"${this.#serviceCallEncoding}\"`);\n      }\n\n      for (const service of services) {\n        const requestType = `${service.type}_Request`;\n        const responseType = `${service.type}_Response`;\n        const parsedRequest = parseChannel({\n          messageEncoding: this.#serviceCallEncoding,\n          schema: {\n            name: requestType,\n            encoding: schemaEncoding,\n            data: textEncoder.encode(service.requestSchema),\n          },\n        });\n        const parsedResponse = parseChannel({\n          messageEncoding: this.#serviceCallEncoding,\n          schema: {\n            name: responseType,\n            encoding: schemaEncoding,\n            data: textEncoder.encode(service.responseSchema),\n          },\n        });\n        const requestMsgDef = rosDatatypesToMessageDefinition(parsedRequest.datatypes, requestType);\n        const requestMessageWriter = ROS_ENCODINGS.includes(this.#serviceCallEncoding)\n          ? this.#serviceCallEncoding === \"ros1\"\n            ? new Ros1MessageWriter(requestMsgDef)\n            : new Ros2MessageWriter(requestMsgDef)\n          : new JsonMessageWriter();\n\n        // Add type definitions for service response and request\n        this.#updateDataTypes(parsedRequest.datatypes);\n        this.#updateDataTypes(parsedResponse.datatypes);\n\n        const resolvedService: ResolvedService = {\n          service,\n          parsedResponse,\n          requestMessageWriter,\n        };\n        this.#servicesByName.set(service.name, resolvedService);\n      }\n      this.#emitState();\n    });\n\n    this.#client.on(\"unadvertiseServices\", (serviceIds) => {\n      for (const serviceId of serviceIds) {\n        const service: ResolvedService | undefined = Object.values(this.#servicesByName).find(\n          (srv) => srv.service.id === serviceId,\n        );\n        if (service) {\n          this.#servicesByName.delete(service.service.name);\n        }\n      }\n    });\n\n    this.#client.on(\"serviceCallResponse\", (response) => {\n      const responseCallback = this.#serviceResponseCbs.get(response.callId);\n      if (!responseCallback) {\n        this.#problems.addProblem(`callService:${response.callId}`, {\n          severity: \"error\",\n          message: `Received a response for a service for which no callback was registered`,\n        });\n        return;\n      }\n      responseCallback(response);\n      this.#serviceResponseCbs.delete(response.callId);\n    });\n\n    this.#client.on(\"connectionGraphUpdate\", (event) => {\n      if (event.publishedTopics.length > 0 || event.removedTopics.length > 0) {\n        const newMap: Map<string, Set<string>> = new Map(this.#publishedTopics ?? new Map());\n        for (const { name, publisherIds } of event.publishedTopics) {\n          newMap.set(name, new Set(publisherIds));\n        }\n        event.removedTopics.forEach((topic) => newMap.delete(topic));\n        this.#publishedTopics = newMap;\n      }\n      if (event.subscribedTopics.length > 0 || event.removedTopics.length > 0) {\n        const newMap: Map<string, Set<string>> = new Map(this.#subscribedTopics ?? new Map());\n        for (const { name, subscriberIds } of event.subscribedTopics) {\n          newMap.set(name, new Set(subscriberIds));\n        }\n        event.removedTopics.forEach((topic) => newMap.delete(topic));\n        this.#subscribedTopics = newMap;\n      }\n      if (event.advertisedServices.length > 0 || event.removedServices.length > 0) {\n        const newMap: Map<string, Set<string>> = new Map(this.#advertisedServices ?? new Map());\n        for (const { name, providerIds } of event.advertisedServices) {\n          newMap.set(name, new Set(providerIds));\n        }\n        event.removedServices.forEach((service) => newMap.delete(service));\n        this.#advertisedServices = newMap;\n      }\n\n      this.#emitState();\n    });\n  };\n\n  #updateTopicsAndDatatypes() {\n    // Build a new topics array from this._channelsById\n    const topics: Topic[] = Array.from(this.#channelsById.values(), (chanInfo) => ({\n      name: chanInfo.channel.topic,\n      schemaName: chanInfo.channel.schemaName,\n    }));\n\n    // Remove stats entries for removed topics\n    const topicsSet = new Set<string>(topics.map((topic) => topic.name));\n    for (const topic of this.#topicsStats.keys()) {\n      if (!topicsSet.has(topic)) {\n        this.#topicsStats.delete(topic);\n      }\n    }\n\n    this.#topics = topics;\n\n    // Update the _datatypes map;\n    for (const { parsedChannel } of this.#channelsById.values()) {\n      this.#updateDataTypes(parsedChannel.datatypes);\n    }\n\n    this.#emitState();\n  }\n\n  // Potentially performance-sensitive; await can be expensive\n  // eslint-disable-next-line @typescript-eslint/promise-function-async\n  #emitState = debouncePromise(() => {\n    if (!this.#listener || this.#closed) {\n      return Promise.resolve();\n    }\n\n    if (!this.#topics) {\n      return this.#listener({\n        name: this.#name,\n        presence: this.#presence,\n        progress: {},\n        capabilities: this.#playerCapabilities,\n        profile: undefined,\n        playerId: this.#id,\n        activeData: undefined,\n        problems: this.#problems.problems(),\n        urlState: this.#urlState,\n      });\n    }\n\n    const currentTime = this.#getCurrentTime();\n    if (!this.#startTime || isLessThan(currentTime, this.#startTime)) {\n      this.#startTime = currentTime;\n    }\n    if (!this.#endTime || isGreaterThan(currentTime, this.#endTime)) {\n      this.#endTime = currentTime;\n    }\n\n    const messages = this.#parsedMessages;\n    this.#parsedMessages = [];\n    return this.#listener({\n      name: this.#name,\n      presence: this.#presence,\n      progress: {},\n      capabilities: this.#playerCapabilities,\n      profile: this.#profile,\n      playerId: this.#id,\n      problems: this.#problems.problems(),\n      urlState: this.#urlState,\n\n      activeData: {\n        messages,\n        totalBytesReceived: this.#receivedBytes,\n        startTime: this.#startTime,\n        endTime: this.#endTime,\n        currentTime,\n        isPlaying: true,\n        speed: 1,\n        lastSeekTime: this.#numTimeSeeks,\n        topics: this.#topics,\n        // Always copy topic stats since message counts and timestamps are being updated\n        topicStats: new Map(this.#topicsStats),\n        datatypes: this.#datatypes,\n        parameters: new Map(this.#parameters),\n        publishedTopics: this.#publishedTopics,\n        subscribedTopics: this.#subscribedTopics,\n        services: this.#advertisedServices,\n      },\n    });\n  });\n\n  public setListener(listener: (arg0: PlayerState) => Promise<void>): void {\n    this.#listener = listener;\n    this.#emitState();\n  }\n\n  public close(): void {\n    this.#closed = true;\n    this.#client?.close();\n    this.#metricsCollector.close();\n    this.#hasReceivedMessage = false;\n    if (this.#openTimeout != undefined) {\n      clearTimeout(this.#openTimeout);\n      this.#openTimeout = undefined;\n    }\n    if (this.#getParameterInterval != undefined) {\n      clearInterval(this.#getParameterInterval);\n      this.#getParameterInterval = undefined;\n    }\n  }\n\n  public setSubscriptions(subscriptions: SubscribePayload[]): void {\n    const newTopics = new Set(subscriptions.map(({ topic }) => topic));\n\n    if (!this.#client || this.#closed) {\n      // Remember requested subscriptions so we can retry subscribing when\n      // the client is available.\n      this.#unresolvedSubscriptions = newTopics;\n      return;\n    }\n\n    for (const topic of newTopics) {\n      if (!this.#resolvedSubscriptionsByTopic.has(topic)) {\n        this.#unresolvedSubscriptions.add(topic);\n      }\n    }\n\n    for (const [topic, subId] of this.#resolvedSubscriptionsByTopic) {\n      if (!newTopics.has(topic)) {\n        this.#client.unsubscribe(subId);\n        this.#resolvedSubscriptionsByTopic.delete(topic);\n        this.#resolvedSubscriptionsById.delete(subId);\n        this.#recentlyCanceledSubscriptions.add(subId);\n\n        // Reset the message count for this topic\n        this.#topicsStats.delete(topic);\n\n        setTimeout(\n          () => this.#recentlyCanceledSubscriptions.delete(subId),\n          SUBSCRIPTION_WARNING_SUPPRESSION_MS,\n        );\n      }\n    }\n    for (const topic of this.#unresolvedSubscriptions) {\n      if (!newTopics.has(topic)) {\n        this.#unresolvedSubscriptions.delete(topic);\n      }\n    }\n\n    this.#processUnresolvedSubscriptions();\n  }\n\n  #processUnresolvedSubscriptions() {\n    if (!this.#client) {\n      return;\n    }\n\n    for (const topic of this.#unresolvedSubscriptions) {\n      const chanInfo = this.#channelsByTopic.get(topic);\n      if (chanInfo) {\n        const subId = this.#client.subscribe(chanInfo.channel.id);\n        this.#unresolvedSubscriptions.delete(topic);\n        this.#resolvedSubscriptionsByTopic.set(topic, subId);\n        this.#resolvedSubscriptionsById.set(subId, chanInfo);\n      }\n    }\n  }\n\n  public setPublishers(publishers: AdvertiseOptions[]): void {\n    // Filter out duplicates.\n    const uniquePublications = uniqWith(publishers, isEqual);\n\n    // Save publications and return early if we are not connected.\n    if (!this.#client || this.#closed) {\n      this.#unresolvedPublications = uniquePublications;\n      return;\n    }\n\n    // Determine new & removed publications.\n    const currentPublications = Array.from(this.#publicationsByTopic.values());\n    const removedPublications = currentPublications.filter((channel) => {\n      return (\n        uniquePublications.find(\n          ({ topic, schemaName }) => channel.topic === topic && channel.schemaName === schemaName,\n        ) == undefined\n      );\n    });\n    const newPublications = uniquePublications.filter(({ topic, schemaName }) => {\n      return (\n        currentPublications.find(\n          (publication) => publication.topic === topic && publication.schemaName === schemaName,\n        ) == undefined\n      );\n    });\n\n    // Unadvertise removed channels.\n    for (const channel of removedPublications) {\n      this.#unadvertiseChannel(channel);\n    }\n\n    // Advertise new channels.\n    for (const publication of newPublications) {\n      this.#advertiseChannel(publication);\n    }\n\n    if (removedPublications.length > 0 || newPublications.length > 0) {\n      this.#emitState();\n    }\n  }\n\n  public setParameter(key: string, value: ParameterValue): void {\n    if (!this.#client) {\n      throw new Error(`Attempted to set parameters without a valid Foxglove WebSocket connection`);\n    }\n\n    log.debug(`FoxgloveWebSocketPlayer.setParameter(key=${key}, value=${value})`);\n    const isByteArray = value instanceof Uint8Array;\n    const paramValueToSent = isByteArray ? btoa(textDecoder.decode(value)) : value;\n    this.#client.setParameters(\n      [\n        {\n          name: key,\n          value: paramValueToSent as Parameter[\"value\"],\n          type: isByteArray ? \"byte_array\" : undefined,\n        },\n      ],\n      uuidv4(),\n    );\n\n    // Pre-actively update our parameter map, such that a change is detected if our update failed\n    this.#parameters.set(key, value);\n    this.#emitState();\n  }\n\n  public publish({ topic, msg }: PublishPayload): void {\n    if (!this.#client) {\n      throw new Error(`Attempted to publish without a valid Foxglove WebSocket connection`);\n    }\n\n    const clientChannel = this.#publicationsByTopic.get(topic);\n    if (!clientChannel) {\n      throw new Error(`Tried to publish on topic '${topic}' that has not been advertised before.`);\n    }\n\n    if (clientChannel.encoding === \"json\") {\n      // Ensure that typed arrays are encoded as arrays and not objects.\n      const replacer = (_key: string, value: unknown) => {\n        return ArrayBuffer.isView(value)\n          ? Array.from(value as unknown as ArrayLike<unknown>)\n          : value;\n      };\n      const message = Buffer.from(JSON.stringify(msg, replacer) ?? \"\");\n      this.#client.sendMessage(clientChannel.id, message);\n    } else if (\n      ROS_ENCODINGS.includes(clientChannel.encoding) &&\n      clientChannel.messageWriter != undefined\n    ) {\n      const message = clientChannel.messageWriter.writeMessage(msg);\n      this.#client.sendMessage(clientChannel.id, message);\n    }\n  }\n\n  public async callService(serviceName: string, request: unknown): Promise<unknown> {\n    if (!this.#client) {\n      throw new Error(\n        `Attempted to call service ${serviceName} without a valid Foxglove WebSocket connection.`,\n      );\n    }\n\n    if (request == undefined || typeof request !== \"object\") {\n      throw new Error(\"FoxgloveWebSocketPlayer#callService request must be an object.\");\n    }\n\n    const resolvedService = this.#servicesByName.get(serviceName);\n    if (!resolvedService) {\n      throw new Error(\n        `Tried to call service '${serviceName}' that has not been advertised before.`,\n      );\n    }\n\n    const { service, parsedResponse, requestMessageWriter } = resolvedService;\n\n    const serviceCallRequest: ServiceCallPayload = {\n      serviceId: service.id,\n      callId: ++this.#nextServiceCallId,\n      encoding: this.#serviceCallEncoding!,\n      data: new DataView(new Uint8Array().buffer),\n    };\n\n    const message = requestMessageWriter.writeMessage(request);\n    serviceCallRequest.data = new DataView(message.buffer);\n    this.#client.sendServiceCallRequest(serviceCallRequest);\n\n    return await new Promise<Record<string, unknown>>((resolve, reject) => {\n      this.#serviceResponseCbs.set(serviceCallRequest.callId, (response: ServiceCallResponse) => {\n        try {\n          const data = parsedResponse.deserialize(response.data);\n          resolve(data as Record<string, unknown>);\n        } catch (error) {\n          reject(error);\n        }\n      });\n    });\n  }\n\n  public setGlobalVariables(): void {}\n\n  // Return the current time\n  //\n  // For servers which publish a clock, we return that time. If the server disconnects we continue\n  // to return the last known time. For servers which do not publish a clock, we use wall time.\n  #getCurrentTime(): Time {\n    // If the server does not publish the time, then we set the clock time to realtime as long as\n    // the server is connected. When the server is not connected, time stops.\n    if (!this.#serverPublishesTime) {\n      this.#clockTime =\n        this.#presence === PlayerPresence.PRESENT ? fromMillis(Date.now()) : this.#clockTime;\n    }\n\n    return this.#clockTime ?? ZERO_TIME;\n  }\n\n  #setupPublishers(): void {\n    // This function will be called again once a connection is established\n    if (!this.#client || this.#closed) {\n      return;\n    }\n\n    if (this.#unresolvedPublications.length === 0) {\n      return;\n    }\n\n    this.#problems.removeProblems((id) => id.startsWith(\"pub:\"));\n\n    for (const publication of this.#unresolvedPublications) {\n      this.#advertiseChannel(publication);\n    }\n\n    this.#unresolvedPublications = [];\n    this.#emitState();\n  }\n\n  #advertiseChannel(publication: AdvertiseOptions) {\n    if (!this.#client) {\n      return;\n    }\n\n    const encoding = this.#supportedEncodings\n      ? this.#supportedEncodings.find((e) => SUPPORTED_PUBLICATION_ENCODINGS.includes(e))\n      : FALLBACK_PUBLICATION_ENCODING;\n\n    const { topic, schemaName, options } = publication;\n\n    const encodingProblemId = `pub:encoding:${topic}`;\n    const msgdefProblemId = `pub:msgdef:${topic}`;\n\n    if (!encoding) {\n      this.#problems.addProblem(encodingProblemId, {\n        severity: \"warn\",\n        message: `Cannot advertise topic '${topic}': Server does not support one of the following encodings for client-side publishing: ${SUPPORTED_PUBLICATION_ENCODINGS}`,\n      });\n      return;\n    }\n\n    let messageWriter: Publication[\"messageWriter\"] = undefined;\n    if (ROS_ENCODINGS.includes(encoding)) {\n      // Try to retrieve the ROS message definition for this topic\n      let msgdef: MessageDefinition[];\n      try {\n        const datatypes = (options?.[\"datatypes\"] as RosDatatypes | undefined) ?? this.#datatypes;\n        if (!(datatypes instanceof Map)) {\n          throw new Error(\"Datatypes option must be a map\");\n        }\n        msgdef = rosDatatypesToMessageDefinition(datatypes, schemaName);\n      } catch (error) {\n        log.debug(error);\n        this.#problems.addProblem(msgdefProblemId, {\n          severity: \"warn\",\n          message: `Unknown message definition for \"${topic}\"`,\n          tip: `Try subscribing to the topic \"${topic}\" before publishing to it`,\n        });\n        return;\n      }\n\n      messageWriter =\n        encoding === \"ros1\" ? new Ros1MessageWriter(msgdef) : new Ros2MessageWriter(msgdef);\n    }\n\n    const channelId = this.#client.advertise({ topic, encoding, schemaName });\n    this.#publicationsByTopic.set(topic, {\n      id: channelId,\n      topic,\n      encoding,\n      schemaName,\n      messageWriter,\n    });\n\n    for (const problemId of [encodingProblemId, msgdefProblemId]) {\n      if (this.#problems.hasProblem(problemId)) {\n        this.#problems.removeProblem(problemId);\n      }\n    }\n  }\n\n  #unadvertiseChannel(channel: Publication) {\n    if (!this.#client) {\n      return;\n    }\n\n    this.#client.unadvertise(channel.id);\n    this.#publicationsByTopic.delete(channel.topic);\n    const problemIds = [`pub:encoding:${channel.topic}`, `pub:msgdef:${channel.topic}`];\n    for (const problemId of problemIds) {\n      if (this.#problems.hasProblem(problemId)) {\n        this.#problems.removeProblem(problemId);\n      }\n    }\n  }\n\n  #resetSessionState(): void {\n    this.#startTime = undefined;\n    this.#endTime = undefined;\n    this.#clockTime = undefined;\n    this.#topicsStats = new Map();\n    this.#parsedMessages = [];\n    this.#receivedBytes = 0;\n    this.#hasReceivedMessage = false;\n    this.#problems.clear();\n    this.#parameters.clear();\n  }\n\n  #updateDataTypes(datatypes: MessageDefinitionMap): void {\n    let updatedDatatypes: RosDatatypes | undefined = undefined;\n    const maybeRos = [\"ros1\", \"ros2\"].includes(this.#profile ?? \"\");\n    for (const [name, types] of datatypes) {\n      const knownTypes = this.#datatypes.get(name);\n      if (knownTypes && !isMatch(types, knownTypes)) {\n        this.#problems.addProblem(`schema-changed-${name}`, {\n          message: `Definition of schema '${name}' has changed during the server's runtime`,\n          severity: \"error\",\n        });\n      } else {\n        if (updatedDatatypes == undefined) {\n          updatedDatatypes = new Map(this.#datatypes);\n        }\n        updatedDatatypes.set(name, types);\n\n        const fullTypeName = dataTypeToFullName(name);\n        if (maybeRos && fullTypeName !== name) {\n          updatedDatatypes.set(fullTypeName, {\n            ...types,\n            name: types.name ? dataTypeToFullName(types.name) : undefined,\n          });\n        }\n      }\n    }\n    if (updatedDatatypes != undefined) {\n      this.#datatypes = updatedDatatypes; // Signal that datatypes changed.\n    }\n  }\n}\n\nfunction dataTypeToFullName(dataType: string): string {\n  const parts = dataType.split(\"/\");\n  if (parts.length === 2) {\n    return `${parts[0]}/msg/${parts[1]}`;\n  }\n  return dataType;\n}\n\nfunction statusLevelToProblemSeverity(level: StatusLevel): PlayerProblem[\"severity\"] {\n  if (level === StatusLevel.INFO) {\n    return \"info\";\n  } else if (level === StatusLevel.WARNING) {\n    return \"warn\";\n  } else {\n    return \"error\";\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport {\n  IDataSourceFactory,\n  DataSourceFactoryInitializeArgs,\n} from \"@foxglove/studio-base/context/PlayerSelectionContext\";\nimport FoxgloveWebSocketPlayer from \"@foxglove/studio-base/players/FoxgloveWebSocketPlayer\";\nimport { Player } from \"@foxglove/studio-base/players/types\";\n\nexport default class FoxgloveWebSocketDataSourceFactory implements IDataSourceFactory {\n  public id = \"foxglove-websocket\";\n  public type: IDataSourceFactory[\"type\"] = \"connection\";\n  public displayName = \"Foxglove WebSocket\";\n  public iconName: IDataSourceFactory[\"iconName\"] = \"Flow\";\n  public description =\n    \"Connect to a ROS 1, ROS 2, or custom system using the Foxglove WebSocket protocol. For ROS systems, be sure to first install the foxglove_bridge ROS package.\";\n  public docsLinks = [\n    {\n      label: \"ROS 1\",\n      url: \"https://foxglove.dev/docs/studio/connection/ros1#foxglove-websocket\",\n    },\n    {\n      label: \"ROS 2\",\n      url: \"https://foxglove.dev/docs/studio/connection/ros2#foxglove-websocket\",\n    },\n    {\n      label: \"custom data\",\n      url: \"https://foxglove.dev/docs/studio/connection/custom#foxglove-websocket\",\n    },\n  ];\n\n  public formConfig = {\n    fields: [\n      {\n        id: \"url\",\n        label: \"WebSocket URL\",\n        defaultValue: \"ws://localhost:8765\",\n        validate: (newValue: string): Error | undefined => {\n          try {\n            const url = new URL(newValue);\n            if (url.protocol !== \"ws:\" && url.protocol !== \"wss:\") {\n              return new Error(`Invalid protocol: ${url.protocol}`);\n            }\n            return undefined;\n          } catch (err) {\n            return new Error(\"Enter a valid url\");\n          }\n        },\n      },\n    ],\n  };\n\n  public initialize(args: DataSourceFactoryInitializeArgs): Player | undefined {\n    const url = args.params?.url;\n    if (!url) {\n      return;\n    }\n\n    return new FoxgloveWebSocketPlayer({\n      url,\n      metricsCollector: args.metricsCollector,\n      sourceId: this.id,\n    });\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\nimport { Time } from \"@foxglove/rostime\";\nimport {\n  PlayerMetricsCollectorInterface,\n  SubscribePayload,\n} from \"@foxglove/studio-base/players/types\";\n\nexport default class NoopMetricsCollector implements PlayerMetricsCollectorInterface {\n  public setProperty(_key: string, _value: string | number | boolean): void {\n    // no-op\n  }\n  public playerConstructed(): void {\n    // no-op\n  }\n  public play(_speed: number): void {\n    // no-op\n  }\n  public seek(_time: Time): void {\n    // no-op\n  }\n  public setSpeed(_speed: number): void {\n    // no-op\n  }\n  public pause(): void {\n    // no-op\n  }\n  public close(): void {\n    // no-op\n  }\n  public setSubscriptions(_subscriptions: SubscribePayload[]): void {\n    // no-op\n  }\n  public recordPlaybackTime(_time: Time): void {\n    // no-op\n  }\n  public recordBytesReceived(_bytes: number): void {\n    // no-op\n  }\n  public recordDataProviderPerformance(): void {\n    // no-op\n  }\n  public recordUncachedRangeRequest(): void {\n    // no-op\n  }\n  public recordTimeToFirstMsgs(): void {\n    // no-op\n  }\n  public recordDataProviderInitializePerformance(): void {\n    // no-op\n  }\n  public recordDataProviderStall(): void {\n    // no-op\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { compare, add as addTime } from \"@foxglove/rostime\";\nimport { Time } from \"@foxglove/studio\";\n\nimport type { IMessageCursor, IteratorResult } from \"./IIterableSource\";\n\nconst TIME_ZERO = Object.freeze({ sec: 0, nsec: 0 });\n\n/// IteratorCursor implements a IMessageCursor interface on top of an AsyncIterable\nclass IteratorCursor implements IMessageCursor {\n  #iter: AsyncIterableIterator<Readonly<IteratorResult>>;\n  // readUntil reads from the iterator inclusive of end time. To do this, it reads from the iterator\n  // until it receives a receiveTime after end time to signal it has received all the messages\n  // inclusive of end time. Since iterators are read once, this last result must be stored for the\n  // next readUntil call otherwise it would be lost.\n  #lastIteratorResult?: IteratorResult;\n  #abort?: AbortSignal;\n\n  public constructor(\n    iterator: AsyncIterableIterator<Readonly<IteratorResult>>,\n    abort?: AbortSignal,\n  ) {\n    this.#iter = iterator;\n    this.#abort = abort;\n  }\n\n  public async next(): ReturnType<IMessageCursor[\"next\"]> {\n    if (this.#abort?.aborted === true) {\n      return undefined;\n    }\n\n    const result = await this.#iter.next();\n    return result.value;\n  }\n\n  public async nextBatch(durationMs: number): Promise<IteratorResult[] | undefined> {\n    const firstResult = await this.next();\n    if (!firstResult) {\n      return undefined;\n    }\n\n    if (firstResult.type === \"problem\") {\n      return [firstResult];\n    }\n\n    const results: IteratorResult[] = [firstResult];\n\n    let cutoffTime: Time = TIME_ZERO;\n    switch (firstResult.type) {\n      case \"stamp\":\n        cutoffTime = addTime(firstResult.stamp, { sec: 0, nsec: durationMs * 1e6 });\n        break;\n      case \"message-event\":\n        cutoffTime = addTime(firstResult.msgEvent.receiveTime, { sec: 0, nsec: durationMs * 1e6 });\n        break;\n    }\n\n    for (;;) {\n      const result = await this.next();\n      if (!result) {\n        return results;\n      }\n\n      results.push(result);\n\n      if (result.type === \"problem\") {\n        break;\n      }\n      if (result.type === \"stamp\" && compare(result.stamp, cutoffTime) > 0) {\n        break;\n      }\n      if (result.type === \"message-event\" && compare(result.msgEvent.receiveTime, cutoffTime) > 0) {\n        break;\n      }\n    }\n    return results;\n  }\n\n  public async readUntil(end: Time): ReturnType<IMessageCursor[\"readUntil\"]> {\n    // Assign to a variable to fool typescript control flow analysis which does not understand\n    // that this value could change after the _await_\n    const isAborted = this.#abort?.aborted;\n    if (isAborted === true) {\n      return undefined;\n    }\n\n    const results: IteratorResult[] = [];\n\n    // if the last result is still past end time, return empty results\n    if (\n      this.#lastIteratorResult?.type === \"stamp\" &&\n      compare(this.#lastIteratorResult.stamp, end) >= 0\n    ) {\n      return results;\n    }\n\n    if (\n      this.#lastIteratorResult?.type === \"message-event\" &&\n      compare(this.#lastIteratorResult.msgEvent.receiveTime, end) > 0\n    ) {\n      return results;\n    }\n\n    if (this.#lastIteratorResult) {\n      results.push(this.#lastIteratorResult);\n      this.#lastIteratorResult = undefined;\n    }\n\n    for (;;) {\n      const result = await this.#iter.next();\n      if (this.#abort?.aborted === true) {\n        return undefined;\n      }\n\n      if (result.done === true) {\n        break;\n      }\n\n      const value = result.value;\n      if (value.type === \"stamp\" && compare(value.stamp, end) >= 0) {\n        this.#lastIteratorResult = value;\n        break;\n      }\n      if (value.type === \"message-event\" && compare(value.msgEvent.receiveTime, end) > 0) {\n        this.#lastIteratorResult = value;\n        break;\n      }\n      results.push(value);\n    }\n\n    return results;\n  }\n\n  public async end(): ReturnType<IMessageCursor[\"end\"]> {\n    await this.#iter.return?.();\n  }\n}\n\nexport { IteratorCursor };\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { simplify } from \"intervals-fn\";\nimport { isEqual } from \"lodash\";\n\nimport { Condvar } from \"@foxglove/den/async\";\nimport { filterMap } from \"@foxglove/den/collection\";\nimport Log from \"@foxglove/log\";\nimport {\n  Time,\n  subtract as subtractTimes,\n  toNanoSec,\n  add,\n  fromNanoSec,\n  clampTime,\n} from \"@foxglove/rostime\";\nimport { Immutable, MessageEvent } from \"@foxglove/studio\";\nimport { IteratorCursor } from \"@foxglove/studio-base/players/IterablePlayer/IteratorCursor\";\nimport PlayerProblemManager from \"@foxglove/studio-base/players/PlayerProblemManager\";\nimport { MessageBlock, Progress } from \"@foxglove/studio-base/players/types\";\n\nimport { IIterableSource, MessageIteratorArgs } from \"./IIterableSource\";\n\nconst log = Log.getLogger(__filename);\n\ntype BlockLoaderArgs = {\n  cacheSizeBytes: number;\n  source: IIterableSource;\n  start: Time;\n  end: Time;\n  maxBlocks: number;\n  minBlockDurationNs: number;\n  problemManager: PlayerProblemManager;\n};\n\ntype CacheBlock = MessageBlock & {\n  needTopics: Immutable<Set<string>>;\n};\n\ntype Blocks = (CacheBlock | undefined)[];\n\ntype LoadArgs = {\n  progress: (progress: Progress) => void;\n};\n\n/**\n * BlockLoader manages loading blocks from a source. Blocks are fixed time span containers for messages.\n */\nexport class BlockLoader {\n  #source: IIterableSource;\n  #blocks: Blocks = [];\n  #start: Time;\n  #end: Time;\n  #blockDurationNanos: number;\n  #topics: Set<string> = new Set();\n  #maxCacheSize: number = 0;\n  #problemManager: PlayerProblemManager;\n  #stopped: boolean = false;\n  #activeChangeCondvar: Condvar = new Condvar();\n  #abortController: AbortController;\n\n  public constructor(args: BlockLoaderArgs) {\n    this.#source = args.source;\n    this.#start = args.start;\n    this.#end = args.end;\n    this.#maxCacheSize = args.cacheSizeBytes;\n    this.#problemManager = args.problemManager;\n    this.#abortController = new AbortController();\n\n    const totalNs = Number(toNanoSec(subtractTimes(this.#end, this.#start))) + 1; // +1 since times are inclusive.\n    if (totalNs > Number.MAX_SAFE_INTEGER * 0.9) {\n      throw new Error(\"Time range is too long to be supported\");\n    }\n\n    this.#blockDurationNanos = Math.ceil(\n      Math.max(args.minBlockDurationNs, totalNs / args.maxBlocks),\n    );\n\n    const blockCount = Math.ceil(totalNs / this.#blockDurationNanos);\n\n    log.debug(`Block count: ${blockCount}`);\n    this.#blocks = Array.from({ length: blockCount });\n  }\n\n  public setTopics(topics: Set<string>): void {\n    if (isEqual(topics, this.#topics)) {\n      return;\n    }\n\n    this.#abortController.abort();\n    this.#topics = topics;\n    this.#activeChangeCondvar.notifyAll();\n    log.debug(`Preloaded topics: ${[...topics].join(\", \")}`);\n\n    // Update all the blocks with any missing topics\n    for (const block of this.#blocks) {\n      if (block) {\n        const blockTopics = Object.keys(block.messagesByTopic);\n        const needTopics = new Set(topics);\n        for (const topic of blockTopics) {\n          needTopics.delete(topic);\n        }\n        block.needTopics = needTopics;\n      }\n    }\n  }\n\n  /**\n   * Remove topics that are no longer requested to be preloaded from blocks to free up space\n   */\n  #removeUnusedBlockTopics(): number {\n    const topics = this.#topics;\n    let totalBytesRemoved = 0;\n    for (let i = 0; i < this.#blocks.length; i++) {\n      const block = this.#blocks[i];\n      if (block) {\n        let blockBytesRemoved = 0;\n        const newMessagesByTopic: Record<string, MessageEvent[]> = {\n          ...block.messagesByTopic,\n        };\n        const blockTopics = Object.keys(newMessagesByTopic);\n        for (const topic of blockTopics) {\n          // remove topics that are no longer requested to be preloaded.\n          if (!topics.has(topic) && newMessagesByTopic[topic]) {\n            for (const msg of newMessagesByTopic[topic]!) {\n              blockBytesRemoved += msg.sizeInBytes;\n            }\n            delete newMessagesByTopic[topic];\n          }\n        }\n        if (blockBytesRemoved > 0) {\n          this.#blocks[i] = {\n            ...block,\n            messagesByTopic: newMessagesByTopic,\n            sizeInBytes: block.sizeInBytes - blockBytesRemoved,\n          };\n          totalBytesRemoved += blockBytesRemoved;\n        }\n      }\n    }\n    return totalBytesRemoved;\n  }\n\n  public async stopLoading(): Promise<void> {\n    log.debug(\"Stop loading blocks\");\n    this.#stopped = true;\n    this.#activeChangeCondvar.notifyAll();\n  }\n\n  public async startLoading(args: LoadArgs): Promise<void> {\n    log.debug(\"Start loading process\");\n    this.#stopped = false;\n\n    // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n    while (!this.#stopped) {\n      this.#abortController = new AbortController();\n\n      const topics = this.#topics;\n\n      await this.#load({ progress: args.progress });\n\n      // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n      if (this.#stopped) {\n        break;\n      }\n\n      // Wait for topics to possibly change.\n      if (this.#topics === topics) {\n        await this.#activeChangeCondvar.wait();\n      }\n    }\n  }\n\n  async #load(args: { progress: LoadArgs[\"progress\"] }): Promise<void> {\n    const topics = this.#topics;\n\n    // Ignore changing the blocks if the topic list is empty\n    if (topics.size === 0) {\n      args.progress(this.#calculateProgress(topics));\n      return;\n    }\n\n    if (this.#blocks.length === 0) {\n      return;\n    }\n\n    log.debug(\"loading blocks\", { topics });\n\n    const { progress } = args;\n    let totalBlockSizeBytes = this.#cacheSize();\n\n    for (let blockId = 0; blockId < this.#blocks.length; ++blockId) {\n      // Topics we will fetch for this range\n      let topicsToFetch: Immutable<Set<string>>;\n\n      // Keep looking for a block that needs loading\n      {\n        const existingBlock = this.#blocks[blockId];\n\n        // The current block has everything, so we can move to the next block\n        if (existingBlock?.needTopics.size === 0) {\n          continue;\n        }\n\n        // The current block needs some topics so those will be come the topics we need to fetch\n        topicsToFetch = existingBlock?.needTopics ?? topics;\n      }\n\n      // blockId is the first block that needs loading\n      // Now we look for the last block. We do this by finding blocks that need the same topics to fetch.\n      // This creates a continuous span of the same topics to fetch\n      let endBlockId = blockId;\n      for (let endIdx = blockId + 1; endIdx < this.#blocks.length; ++endIdx) {\n        // if needtopics is undefined cause there's no block, then needTopics is all topics\n        const needTopics = this.#blocks[endIdx]?.needTopics ?? topics;\n\n        // The topics we need to fetch no longer match the topics we need so we stop the range\n        if (!isEqual(topicsToFetch, needTopics)) {\n          break;\n        }\n\n        endBlockId = endIdx;\n      }\n\n      // Compute the cursor start/end time from the range of blocks we need to load\n      const cursorStartTime = this.#blockIdToStartTime(blockId);\n      const cursorEndTime = clampTime(this.#blockIdToEndTime(endBlockId), this.#start, this.#end);\n\n      const iteratorArgs: MessageIteratorArgs = {\n        topics: Array.from(topicsToFetch),\n        start: cursorStartTime,\n        end: cursorEndTime,\n        consumptionType: \"full\",\n      };\n\n      // If the source provides a message cursor we use its message cursor, otherwise we make one\n      // using the source's message iterator.\n      const cursor =\n        this.#source.getMessageCursor?.({ ...iteratorArgs, abort: this.#abortController.signal }) ??\n        new IteratorCursor(\n          this.#source.messageIterator(iteratorArgs),\n          this.#abortController.signal,\n        );\n\n      log.debug(\"Loading range\", { blockId, endBlockId });\n      // Loop through the blocks corresponding to the range of our cursor\n      for (let currentBlockId = blockId; currentBlockId <= endBlockId; ++currentBlockId) {\n        // Until time is the end time of the current block, we want all the messages from the cursor\n        // until (inclusive) of the end of of the block\n        const untilTime = clampTime(this.#blockIdToEndTime(currentBlockId), this.#start, this.#end);\n\n        const results = await cursor.readUntil(untilTime);\n        // No results means cursor aborted or eof\n        if (!results) {\n          await cursor.end();\n          return;\n        }\n\n        const messagesByTopic: Record<string, MessageEvent[]> = {};\n\n        // Set all topics to empty arrays. Since our cursor requested all the topicsToFetch we either will\n        // have message on the topic or we don't have message on the topic. Either way the topic entry\n        // starts as an empty array.\n        for (const topic of topicsToFetch) {\n          messagesByTopic[topic] = [];\n        }\n\n        let sizeInBytes = 0;\n        for (const iterResult of results) {\n          if (iterResult.type === \"problem\") {\n            this.#problemManager.addProblem(\n              `connid-${iterResult.connectionId}`,\n              iterResult.problem,\n            );\n            continue;\n          }\n\n          if (iterResult.type !== \"message-event\") {\n            continue;\n          }\n\n          const msgTopic = iterResult.msgEvent.topic;\n          const arr = messagesByTopic[msgTopic];\n\n          // Because we initialized all the topicsToFetch earlier we expect to have an array for each message\n          // topic in our results. If we don't, thats a problem.\n          const problemKey = `unexpected-topic-${msgTopic}`;\n          if (!arr) {\n            this.#problemManager.addProblem(problemKey, {\n              severity: \"error\",\n              message: `Received a message on an unexpected topic: ${msgTopic}.`,\n            });\n\n            continue;\n          }\n          this.#problemManager.removeProblem(problemKey);\n\n          const messageSizeInBytes = iterResult.msgEvent.sizeInBytes;\n          totalBlockSizeBytes += messageSizeInBytes;\n          arr.push(iterResult.msgEvent);\n\n          sizeInBytes += messageSizeInBytes;\n\n          if (totalBlockSizeBytes < this.#maxCacheSize) {\n            this.#problemManager.removeProblem(\"cache-full\");\n            continue;\n          }\n          // cache over capacity, try removing unused topics\n          const removedSize = this.#removeUnusedBlockTopics();\n          totalBlockSizeBytes -= removedSize;\n          if (totalBlockSizeBytes > this.#maxCacheSize) {\n            this.#problemManager.addProblem(\"cache-full\", {\n              severity: \"error\",\n              message: `Cache is full. Preloading for topics [${Array.from(topicsToFetch).join(\n                \", \",\n              )}] has stopped on block ${currentBlockId + 1}/${this.#blocks.length}.`,\n              tip: \"Try reducing the number of topics that require preloading at a given time (e.g. in plots), or try to reduce the time range of the file.\",\n            });\n            return;\n          }\n        }\n\n        const existingBlock = this.#blocks[currentBlockId];\n        this.#blocks[currentBlockId] = {\n          needTopics: new Set(),\n          messagesByTopic: {\n            ...existingBlock?.messagesByTopic,\n            // Any new topics override the same previous topic\n            ...messagesByTopic,\n          },\n          sizeInBytes: (existingBlock?.sizeInBytes ?? 0) + sizeInBytes,\n        };\n\n        progress(this.#calculateProgress(topics));\n      }\n\n      await cursor.end();\n      blockId = endBlockId + 1;\n    }\n  }\n\n  #calculateProgress(topics: Set<string>): Progress {\n    const fullyLoadedFractionRanges = simplify(\n      filterMap(this.#blocks, (thisBlock, blockIndex) => {\n        if (!thisBlock) {\n          return;\n        }\n\n        for (const topic of topics) {\n          if (!thisBlock.messagesByTopic[topic]) {\n            return;\n          }\n        }\n\n        return {\n          start: blockIndex,\n          end: blockIndex + 1,\n        };\n      }),\n    );\n\n    return {\n      fullyLoadedFractionRanges: fullyLoadedFractionRanges.map((range) => ({\n        // Convert block ranges into fractions.\n        start: range.start / this.#blocks.length,\n        end: range.end / this.#blocks.length,\n      })),\n      messageCache: {\n        blocks: this.#blocks.slice(),\n        startTime: this.#start,\n      },\n    };\n  }\n\n  #cacheSize(): number {\n    return this.#blocks.reduce((prev, block) => {\n      if (!block) {\n        return prev;\n      }\n\n      return prev + block.sizeInBytes;\n    }, 0);\n  }\n\n  #blockIdToStartTime(id: number): Time {\n    return add(this.#start, fromNanoSec(BigInt(id) * BigInt(this.#blockDurationNanos)));\n  }\n\n  // The end time of a block is the start time of the next block minus 1 nanosecond\n  #blockIdToEndTime(id: number): Time {\n    return add(this.#start, fromNanoSec(BigInt(id + 1) * BigInt(this.#blockDurationNanos) - 1n));\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\n/**\n * VecQueue provides an interface for a FIFO queue backed by a growing circular buffer.\n *\n * `enqueue` inserts items at the end of the queue (possibly growing the underlying buffer)\n * `dequeue` removes items from the front of the queue\n */\nexport class VecQueue<T> {\n  #readPos = 0;\n  #writePos = 0;\n  #buffer: Array<T | undefined> = new Array(4);\n\n  /**\n   * Add an item at the end of the queue. If the queue is full the underlying buffer is grown.\n   * @param item the item to insert into the queue\n   */\n  public enqueue(item: T): void {\n    // When the write position is past the buffer end, we need to take one of two actions:\n    // 1. If read position is at 0, we grow the array and write to the end\n    // 2. Otherwise, we wrap write to the front and continue writing\n    if (this.#writePos >= this.#buffer.length) {\n      // Read head is at the start, we will write at the end\n      if (this.#readPos === 0) {\n        this.#addCapacity();\n      } else {\n        this.#writePos = this.#writePos % this.#buffer.length;\n      }\n    }\n\n    // Read is only 1 away from write, so once the item is written our write head would be at the read head\n    // we can't allow that so we need to add capacity\n    if (this.#readPos - this.#writePos === 1) {\n      this.#addCapacity();\n    }\n\n    // write to position and increment\n    this.#buffer[this.#writePos] = item;\n    this.#writePos++;\n  }\n\n  /**\n   * Remove an item from the front of the queue and return it.\n   * @returns the first item in the queue or undefined if the queue is empty\n   */\n  public dequeue(): T | undefined {\n    if (this.#readPos === this.#writePos) {\n      return undefined;\n    }\n\n    // Read position may have incremented from a previous read\n    // and we need to maybe wrap it to our size\n    if (this.#readPos >= this.#buffer.length) {\n      this.#readPos = this.#readPos % this.#buffer.length;\n    }\n\n    const item = this.#buffer[this.#readPos];\n    this.#buffer[this.#readPos] = undefined;\n    this.#readPos += 1;\n    return item;\n  }\n\n  /**\n   * @returns the number of items in the queue\n   */\n  public size(): number {\n    if (this.#writePos >= this.#readPos) {\n      return this.#writePos - this.#readPos;\n    }\n\n    return this.#buffer.length - this.#readPos + this.#writePos;\n  }\n\n  /**\n   * @returns the capacity of the underlying circular buffer\n   */\n  public capacity(): number {\n    return this.#buffer.length;\n  }\n\n  /**\n   * Clear the queue.\n   */\n  public clear(): void {\n    this.#buffer.length = 0;\n    this.#writePos = 0;\n    this.#readPos = 0;\n  }\n\n  #addCapacity() {\n    const oldLen = this.#buffer.length;\n    this.#buffer.length = this.#buffer.length * 2;\n\n    // if the read head is before write, then there's no change to index management and write can continue at end\n    // if the read head is ahead of write, then we can un-wrap the write bytes\n    if (this.#readPos <= this.#writePos) {\n      return;\n    }\n\n    const newLen = this.#buffer.length;\n\n    // if writePos is past half it is cheaper to move the read elements\n    if (this.#writePos >= oldLen / 2) {\n      const oldCount = oldLen - this.#readPos;\n      // move the read elements to the end giving us the most room to write\n      const offset = newLen - oldCount;\n      for (let i = 0; i < oldCount; ++i) {\n        this.#buffer[offset + i] = this.#buffer[this.#readPos + i];\n        this.#buffer[this.#readPos + i] = undefined;\n      }\n      this.#readPos = offset;\n    } else {\n      // copy all the elements from start to writePos - 1 to the end of the extended buffer\n      for (let i = 0; i < this.#writePos; ++i) {\n        this.#buffer[oldLen + i] = this.#buffer[i];\n        this.#buffer[i] = undefined;\n      }\n\n      this.#writePos = oldLen + this.#writePos;\n    }\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\n/**\n * Performs a binary search on a sorted array of tuples to find the index of the entry with the given key.\n *\n * Copied from @foxglove/den/collection ArrayMap\n *\n * @param key Key to search for.\n * @returns The index of the key/value tuple if an exact match is found; otherwise, a negative\n * number. If the key is not found and the key is less than one or more keys in the list, the\n * negative number returned is the bitwise complement of the index of the first element with a\n * larger key. If the key is not found and is greater than all keys in the list, the negative\n * number returned is the bitwise complement of the index of the last element plus 1.\n */\nfunction sortedIndexByTuple<T>(items: [bigint, T][], key: bigint): number {\n  const list = items;\n  if (list.length === 0) {\n    return -1;\n  }\n\n  let left = 0;\n  let right = list.length - 1;\n\n  while (left <= right) {\n    const mid = (left + right) >> 1;\n    const midKey = list[mid]![0];\n\n    if (midKey === key) {\n      return mid;\n    } else if (key < midKey) {\n      right = mid - 1;\n    } else {\n      left = mid + 1;\n    }\n  }\n\n  return ~left;\n}\n\nexport { sortedIndexByTuple };\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\n/**\n * minIndexBy scans a collection and returns the index of the smallest item\n *\n * minIndexBy iterates the collection and calls compare on each item of the collection. If an item\n * compares smaller than another, then its index becomes the smallest index. iteration continues\n * until the end of the collection. The index is then returned.\n *\n * @param collection the collection to scan\n * @param compare function used to compare two items in the collection. A value of < 0 means a < b.\n * @returns the index of the smallest item in the collection or -1 if the collection is empty\n */\nfunction minIndexBy<T>(collection: Array<T>, compare: (itemA: T, itemB: T) => number): number {\n  if (collection.length === 0) {\n    return -1;\n  }\n\n  let minIdx = 0;\n  let minItem = collection[0]!;\n\n  for (let i = 1; i < collection.length; ++i) {\n    const item = collection[i]!;\n    if (compare(item, minItem) < 0) {\n      minIdx = i;\n      minItem = item;\n    }\n  }\n\n  return minIdx;\n}\n\nexport { minIndexBy };\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport EventEmitter from \"eventemitter3\";\nimport { isEqual, sortedIndexBy } from \"lodash\";\n\nimport { minIndexBy, sortedIndexByTuple } from \"@foxglove/den/collection\";\nimport Log from \"@foxglove/log\";\nimport { subtract, add, toNanoSec, compare } from \"@foxglove/rostime\";\nimport { Time, MessageEvent } from \"@foxglove/studio\";\nimport { Range } from \"@foxglove/studio-base/util/ranges\";\n\nimport {\n  GetBackfillMessagesArgs,\n  IIterableSource,\n  Initalization,\n  IteratorResult,\n  MessageIteratorArgs,\n} from \"./IIterableSource\";\n\nconst log = Log.getLogger(__filename);\n\n// An individual cache item represents a continuous range of CacheIteratorItems\ntype CacheBlock = {\n  // The start time of the cache item (inclusive).\n  //\n  // When reading a data source, the first message may come after the requested \"start\" time.\n  // The start field is the request start time while the first item in items would be the first message\n  // which may be after this time.\n  //\n  // The start time is <= first item time.\n  start: Time;\n\n  // The end time (inclusive) of the last message within the cache item. Similar to start, the data source\n  // may \"end\" after the last message so.\n  //\n  // The end time is >= last item time.\n  end: Time;\n\n  // Sorted cache item tuples. The first value is the timestamp of the iterator result and the second is the result.\n  items: [bigint, IteratorResult][];\n\n  // The last time this block was accessed.\n  lastAccess: number;\n\n  // The size of this block in bytes\n  size: number;\n};\n\ntype Options = {\n  maxBlockSize?: number;\n  maxTotalSize?: number;\n};\n\ninterface EventTypes {\n  /** Dispatched when the loaded ranges have changed. Use `loadedRanges()` to get the new ranges. */\n  loadedRangesChange: () => void;\n}\n\n/**\n * CachingIterableSource proxies access to IIterableSource through a memory buffer.\n *\n * Message reading occurs from the memory buffer containing previously read messages. If there is no\n * buffer for previously read messages, then the underlying source is used and the messages are\n * cached when read.\n */\nclass CachingIterableSource extends EventEmitter<EventTypes> implements IIterableSource {\n  #source: IIterableSource;\n\n  // Stores which topics we have been caching. See notes at usage site for why we store this.\n  #cachedTopics: string[] = [];\n\n  // The producer loads results into the cache and the consumer reads from the cache.\n  #cache: CacheBlock[] = [];\n\n  // Cache of loaded ranges. Ranges correspond to the cache blocks and are normalized in [0, 1];\n  #loadedRangesCache: Range[] = [{ start: 0, end: 0 }];\n\n  #initResult?: Initalization;\n\n  #totalSizeBytes: number = 0;\n\n  // Maximum total cache size\n  #maxTotalSizeBytes: number;\n\n  // Maximum size per block\n  #maxBlockSizeBytes: number;\n\n  public constructor(source: IIterableSource, opt?: Options) {\n    super();\n\n    this.#source = source;\n    this.#maxTotalSizeBytes = opt?.maxTotalSize ?? 1073741824; // 1GB\n    this.#maxBlockSizeBytes = opt?.maxBlockSize ?? 52428800; // 50MB\n  }\n\n  public async initialize(): Promise<Initalization> {\n    this.#initResult = await this.#source.initialize();\n    return this.#initResult;\n  }\n\n  public async terminate(): Promise<void> {\n    this.#cache.length = 0;\n    this.#cachedTopics.length = 0;\n  }\n\n  public loadedRanges(): Range[] {\n    return this.#loadedRangesCache;\n  }\n\n  public async *messageIterator(\n    args: MessageIteratorArgs,\n  ): AsyncIterableIterator<Readonly<IteratorResult>> {\n    if (!this.#initResult) {\n      throw new Error(\"Invariant: uninitialized\");\n    }\n\n    const maxEnd = args.end ?? this.#initResult.end;\n    const maxEndNanos = toNanoSec(maxEnd);\n\n    const newTopics = [...args.topics].sort();\n\n    // When the list of topics we want changes we purge the entire cache and start again.\n    // This is heavy-handed but avoids dealing with how to handle disjoint cached ranges across topics.\n    if (!isEqual(newTopics, this.#cachedTopics)) {\n      log.debug(\"topics changed - clearing cache, resetting range\");\n      this.#cachedTopics = newTopics;\n      this.#cache.length = 0;\n      this.#totalSizeBytes = 0;\n      this.#recomputeLoadedRangeCache();\n    }\n\n    // Where we want to read messages from. As we move through blocks and messages, the read head\n    // moves forward to track the next place we should be reading.\n    let readHead = args.start ?? this.#initResult.start;\n\n    for (;;) {\n      if (compare(readHead, maxEnd) > 0) {\n        break;\n      }\n\n      const cacheBlockIndex = this.#cache.findIndex((item) => {\n        return compare(item.start, readHead) <= 0 && compare(item.end, readHead) >= 0;\n      });\n\n      let block = this.#cache[cacheBlockIndex];\n\n      // if the block start === end and done is false, then it could have been a new block we started but never\n      // got around to adding any messages into, we remove it.\n      if (block && compare(block.start, block.end) === 0 && block.items.length === 0) {\n        block = undefined;\n        this.#cache.splice(cacheBlockIndex, 1);\n        continue;\n      }\n\n      // We've found a block containing our readHead, try reading items from the block\n      if (block) {\n        const cacheIndex = CachingIterableSource.#FindStartCacheItemIndex(\n          block.items,\n          toNanoSec(readHead),\n        );\n\n        // We have a cached item, we can consume our cache until we've read to the end\n        for (let idx = cacheIndex; idx < block.items.length; ++idx) {\n          const cachedItem = block.items[idx];\n          if (!cachedItem) {\n            break;\n          }\n\n          // We may have found a cached time that is after our max iterator time.\n          // We bail with no return when that happens.\n          if (cachedItem[0] > maxEndNanos) {\n            return;\n          }\n\n          // update the last time this block was accessed\n          block.lastAccess = Date.now();\n\n          yield cachedItem[1];\n        }\n\n        // We've read all the messages cached for the block, this means our next read can start\n        // at 1 nanosecond after the end of the block because we know that block.end is inclusive\n        // of all the messages our block represents.\n        readHead = add(block.end, { sec: 0, nsec: 1 });\n        continue;\n      }\n\n      // We don't have a block for our readHead which meas we need to read from the source.\n      // We start reading from the source where the readHead is. We end reading from the source\n      // where the next block starts (or source.end if there is no next block)\n\n      // The block (and source) will start at the read head\n      const sourceReadStart = readHead;\n\n      // Look for the block that comes after our read head\n      const nextBlockIndex = this.#cache.findIndex((item) => {\n        // Find the first index where readHead is less than an existing start\n        return compare(readHead, item.start) < 0;\n      });\n\n      // If we have a next block (this is the block ours would come before), then we only need\n      // to read up to that block.\n      const nextBlock = this.#cache[nextBlockIndex];\n\n      let sourceReadEnd = nextBlock ? subtract(nextBlock.start, { sec: 0, nsec: 1 }) : maxEnd;\n\n      if (compare(sourceReadStart, sourceReadEnd) > 0) {\n        throw new Error(\"Invariant: sourceReadStart > sourceReadEnd\");\n      }\n\n      // When reading for our message iterator, we might have a nextBlock that starts\n      // after the end time we want to read. This limits our reading to the end time of the iterator.\n      if (compare(sourceReadEnd, maxEnd) > 0) {\n        sourceReadEnd = maxEnd;\n      }\n\n      const sourceMessageIterator = this.#source.messageIterator({\n        topics: this.#cachedTopics,\n        start: sourceReadStart,\n        end: sourceReadEnd,\n        consumptionType: args.consumptionType,\n      });\n\n      // The cache is indexed on time, but iterator results that are problems might not have a time.\n      // For these we use the lastTime that we knew about (or had a message for).\n      // This variable tracks the last known time from a read.\n      let lastTime = toNanoSec(sourceReadStart);\n\n      const pendingIterResults: [bigint, IteratorResult][] = [];\n\n      for await (const iterResult of sourceMessageIterator) {\n        // if there is no block, we make a new block\n        if (!block) {\n          const newBlock: CacheBlock = {\n            start: readHead,\n            end: readHead,\n            items: [],\n            size: 0,\n            lastAccess: Date.now(),\n          };\n\n          // Find where we need to insert our new block.\n          // It should come before any blocks with a start time > than new block start time.\n          const insertIndex = sortedIndexBy(this.#cache, newBlock, (item) => toNanoSec(item.start));\n          this.#cache.splice(insertIndex, 0, newBlock);\n\n          block = newBlock;\n          this.#recomputeLoadedRangeCache();\n        }\n\n        // When receiving a message event or stamp, we update our known time on the block to the\n        // stamp or receiveTime because we know we've received all the results up to this time\n        if (iterResult.type === \"message-event\" || iterResult.type === \"stamp\") {\n          const receiveTime =\n            iterResult.type === \"stamp\" ? iterResult.stamp : iterResult.msgEvent.receiveTime;\n          const receiveTimeNs = toNanoSec(receiveTime);\n\n          // There might be multiple messages at the same time, and since block end time\n          // is inclusive we only update the end time once we've moved to the next time\n          if (receiveTimeNs > lastTime) {\n            // write any pending messages to the block\n            for (const pendingIterResult of pendingIterResults) {\n              const item = pendingIterResult[1];\n              const pendingSizeInBytes =\n                item.type === \"message-event\" ? item.msgEvent.sizeInBytes : 0;\n              block.items.push(pendingIterResult);\n              block.size += pendingSizeInBytes;\n            }\n\n            pendingIterResults.length = 0;\n\n            // update the last time this block was accessed\n            block.lastAccess = Date.now();\n\n            // Set the end time to 1 nanosecond before the current receive time since we know we've\n            // read up to this receive time.\n            block.end = subtract(receiveTime, { sec: 0, nsec: 1 });\n\n            lastTime = receiveTimeNs;\n            this.#recomputeLoadedRangeCache();\n          }\n        }\n\n        // Block is too big so we close it and will start a new one next loop\n        if (block.size >= this.#maxBlockSizeBytes) {\n          // The new block starts right after our previous one\n          readHead = add(block.end, { sec: 0, nsec: 1 });\n\n          // Will force creation of a new block on the next loop\n          block = undefined;\n        }\n\n        const sizeInBytes =\n          iterResult.type === \"message-event\" ? iterResult.msgEvent.sizeInBytes : 0;\n        if (this.#maybePurgeCache({ activeBlock: block, sizeInBytes })) {\n          this.#recomputeLoadedRangeCache();\n        }\n\n        // As we add items to pending we also consider them as part of the total size\n        this.#totalSizeBytes += sizeInBytes;\n\n        // Store the latest message in pending results and flush to the block when time moves forward\n        pendingIterResults.push([lastTime, iterResult]);\n\n        yield iterResult;\n      }\n\n      // We've finished reading our source to the end, close out the block\n      if (block) {\n        block.end = sourceReadEnd;\n\n        // update the last time this block was accessed\n        block.lastAccess = Date.now();\n\n        // write any pending messages to the block\n        for (const pendingIterResult of pendingIterResults) {\n          const item = pendingIterResult[1];\n          const pendingSizeInBytes = item.type === \"message-event\" ? item.msgEvent.sizeInBytes : 0;\n          block.items.push(pendingIterResult);\n          block.size += pendingSizeInBytes;\n        }\n\n        this.#recomputeLoadedRangeCache();\n      } else {\n        // We don't have a block after finishing our source. This can happen if the last\n        // thing we read in the source made our block be over size and we cycled to a new block.\n        // This can also happen if there were no messages in our source range.\n        //\n        // Since we never loop again we need to insert an empty block from the readHead\n        // to sourceReadEnd because we know there's nothing else in that range.\n        const newBlock: CacheBlock = {\n          start: readHead,\n          end: sourceReadEnd,\n          items: pendingIterResults,\n          size: 0,\n          lastAccess: Date.now(),\n        };\n\n        for (const pendingIterResult of pendingIterResults) {\n          const item = pendingIterResult[1];\n          const pendingSizeInBytes = item.type === \"message-event\" ? item.msgEvent.sizeInBytes : 0;\n          newBlock.size += pendingSizeInBytes;\n        }\n\n        // Find where we need to insert our new block.\n        // It should come before any blocks with a start time > than new block start time.\n        const insertIndex = sortedIndexBy(this.#cache, newBlock, (item) => toNanoSec(item.start));\n        this.#cache.splice(insertIndex, 0, newBlock);\n\n        this.#recomputeLoadedRangeCache();\n      }\n\n      // We've read everything there was to read for this source, so our next read will be after\n      // the end of this source\n      readHead = add(sourceReadEnd, { sec: 0, nsec: 1 });\n    }\n  }\n\n  public async getBackfillMessages(args: GetBackfillMessagesArgs): Promise<MessageEvent[]> {\n    if (!this.#initResult) {\n      throw new Error(\"Invariant: uninitialized\");\n    }\n\n    // Find a block that contains args.time. We must find a block that contains args.time rather\n    // than one that occurs anytime before args.time to correctly get the last message before\n    // args.time rather than any message that occurs before args.time.\n    const cacheBlockIndex = this.#cache.findIndex((item) => {\n      return compare(item.start, args.time) <= 0 && compare(item.end, args.time) >= 0;\n    });\n\n    const out: MessageEvent[] = [];\n    const needsTopics = new Set(args.topics);\n\n    // Starting at the block we found for args.time, work backwards through blocks until:\n    // * we've loaded all the topics\n    // * we have a gap between our block and the previous block\n    //\n    // We must stop going backwards when we have a gap because we can no longer know if the source\n    // actually does have messages in the gap.\n    for (let idx = cacheBlockIndex; idx >= 0 && needsTopics.size > 0; --idx) {\n      const cacheBlock = this.#cache[idx];\n      if (!cacheBlock) {\n        break;\n      }\n\n      const targetTime = toNanoSec(args.time);\n      let readIdx = sortedIndexByTuple(cacheBlock.items, targetTime);\n\n      // If readIdx is negative then we don't have an exact match, but readIdx does tell us what that is\n      // See the findCacheItem documentation for how to interpret it.\n      if (readIdx < 0) {\n        readIdx = ~readIdx;\n\n        // readIdx will point to the element after our time (or 1 past the end of the array)\n        // We subtract 1 to start reading from before that element or end of array\n        readIdx -= 1;\n      } else {\n        // When readIdx is an exact match we get a positive value. For an exact match we traverse\n        // forward linearly to find the last occurrence of the matching timestamp in our cache\n        // block. We can then read backwards in the block to find the last messages on all requested\n        // topics.\n        for (let i = readIdx + 1; i < cacheBlock.items.length; ++i) {\n          if (cacheBlock.items[i]?.[0] !== targetTime) {\n            break;\n          }\n          readIdx = i;\n        }\n      }\n\n      for (let i = readIdx; i >= 0; --i) {\n        const record = cacheBlock.items[i];\n        if (!record || record[1].type !== \"message-event\") {\n          continue;\n        }\n\n        const msgEvent = record[1].msgEvent;\n        if (needsTopics.has(msgEvent.topic)) {\n          needsTopics.delete(msgEvent.topic);\n          out.push(msgEvent);\n        }\n      }\n\n      const prevBlock = this.#cache[idx - 1];\n      // If we have a gap between the start of our block and the previous block, then we must stop\n      // trying to read from the block cache\n      if (prevBlock && compare(add(prevBlock.end, { sec: 0, nsec: 1 }), cacheBlock.start) !== 0) {\n        break;\n      }\n    }\n\n    // If we found all our topics from our cache then we don't need to fallback to the source\n    if (needsTopics.size === 0) {\n      return out;\n    }\n\n    // fallback to the source for any topics we weren't able to load\n    const sourceBackfill = await this.#source.getBackfillMessages({\n      ...args,\n      topics: Array.from(needsTopics),\n    });\n\n    out.push(...sourceBackfill);\n    out.sort((a, b) => compare(a.receiveTime, b.receiveTime));\n\n    return out;\n  }\n\n  #recomputeLoadedRangeCache(): void {\n    if (!this.#initResult) {\n      throw new Error(\"Invariant: uninitialized\");\n    }\n\n    // The nanosecond time of the start of the source\n    const sourceStartNs = toNanoSec(this.#initResult.start);\n\n    const rangeNs = Number(toNanoSec(subtract(this.#initResult.end, this.#initResult.start)));\n    if (rangeNs === 0) {\n      this.#loadedRangesCache = [{ start: 0, end: 1 }];\n      this.emit(\"loadedRangesChange\");\n      return;\n    }\n\n    if (this.#cache.length === 0) {\n      this.#loadedRangesCache = [{ start: 0, end: 0 }];\n      this.emit(\"loadedRangesChange\");\n      return;\n    }\n\n    // Merge continuous ranges (i.e. a block that starts 1 nanosecond after previous ends)\n    // This avoids float rounding errors when computing loadedRangesCache and produces\n    // continuous ranges for continuous spans\n    const ranges: { start: number; end: number }[] = [];\n    let prevRange: { start: bigint; end: bigint } | undefined;\n    for (const block of this.#cache) {\n      const range = {\n        start: toNanoSec(block.start),\n        end: toNanoSec(block.end),\n      };\n      if (!prevRange) {\n        prevRange = range;\n      } else if (prevRange.end + 1n === range.start) {\n        prevRange.end = range.end;\n      } else {\n        ranges.push({\n          start: Number(prevRange.start - sourceStartNs) / rangeNs,\n          end: Number(prevRange.end - sourceStartNs) / rangeNs,\n        });\n        prevRange = range;\n      }\n    }\n    if (prevRange) {\n      ranges.push({\n        start: Number(prevRange.start - sourceStartNs) / rangeNs,\n        end: Number(prevRange.end - sourceStartNs) / rangeNs,\n      });\n    }\n\n    this.#loadedRangesCache = ranges;\n    this.emit(\"loadedRangesChange\");\n  }\n\n  // Purge the oldest cache block if adding sizeInBytes to the cache would exceed the maxTotalSizeBytes\n  // @return true if a block was purged\n  //\n  // Throws if the cache block we want to purge is the active block.\n  #maybePurgeCache(opt: { activeBlock?: CacheBlock; sizeInBytes: number }): boolean {\n    const { activeBlock, sizeInBytes } = opt;\n\n    // Determine if our total size would exceed max and purge the oldest block\n    if (this.#totalSizeBytes + sizeInBytes <= this.#maxTotalSizeBytes) {\n      return false;\n    }\n\n    // Find the oldest cache item\n    const oldestIdx = minIndexBy(this.#cache, (a, b) => a.lastAccess - b.lastAccess);\n\n    const oldestBlock = this.#cache[oldestIdx];\n    if (oldestBlock) {\n      if (oldestBlock === activeBlock) {\n        throw new Error(\"Cannot evict the active cache block.\");\n      }\n      this.#totalSizeBytes -= oldestBlock.size;\n      this.#cache.splice(oldestIdx, 1);\n      return true;\n    }\n\n    return false;\n  }\n\n  static #FindStartCacheItemIndex(items: [bigint, IteratorResult][], key: bigint) {\n    // A common case is to access consecutive blocks during playback. In that case, we expect to\n    // read from the first item in the block. We check this special case first to avoid a binary\n    // search if we are able to find the key in the first item.\n    if (items[0] != undefined && items[0][0] >= key) {\n      return 0;\n    }\n\n    let idx = sortedIndexByTuple(items, key);\n    if (idx < 0) {\n      return ~idx;\n    }\n\n    // An exact match just means we've found a matching item, not necessarily the first or last\n    // matching item. We want the first item so we linearly iterate backwards until we no longer have\n    // a match.\n    for (let i = idx - 1; i >= 0; --i) {\n      const prevItem = items[i];\n      if (prevItem != undefined && prevItem[0] !== key) {\n        break;\n      }\n      idx = i;\n    }\n\n    return idx;\n  }\n}\n\nexport { CachingIterableSource };\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport EventEmitter from \"eventemitter3\";\n\nimport { Condvar } from \"@foxglove/den/async\";\nimport { VecQueue } from \"@foxglove/den/collection\";\nimport Log from \"@foxglove/log\";\nimport { add as addTime, compare, clampTime } from \"@foxglove/rostime\";\nimport { Time, MessageEvent } from \"@foxglove/studio\";\nimport { Range } from \"@foxglove/studio-base/util/ranges\";\n\nimport { CachingIterableSource } from \"./CachingIterableSource\";\nimport {\n  GetBackfillMessagesArgs,\n  IIterableSource,\n  Initalization,\n  IteratorResult,\n  MessageIteratorArgs,\n} from \"./IIterableSource\";\n\nconst log = Log.getLogger(__filename);\n\nconst DEFAULT_READ_AHEAD_DURATION = { sec: 10, nsec: 0 };\n\ntype Options = {\n  // How far ahead to buffer\n  readAheadDuration?: Time;\n};\n\ninterface EventTypes {\n  /** Dispatched when the loaded ranges have changed. Use `loadedRanges()` to get the new ranges. */\n  loadedRangesChange: () => void;\n}\n\n/**\n * BufferedIterableSource proxies access to IIterableSource. It buffers the messageIterator by\n * reading ahead in the underlying source.\n *\n * The architecture of BufferedIterableSource follows a producer-consumer model. The messageIterator\n * is the consumer and reads messages from cache while the startProducer method produces messages by\n * reading from the underlying source and populating the cache.\n */\nclass BufferedIterableSource extends EventEmitter<EventTypes> implements IIterableSource {\n  #source: CachingIterableSource;\n\n  #readDone = false;\n  #aborted = false;\n\n  // The producer uses this signal to notify a waiting consumer there is data to consume.\n  #readSignal = new Condvar();\n\n  // The consumer uses this signal to notify a waiting producer that something has been consumed.\n  #writeSignal = new Condvar();\n\n  // The producer loads results into the cache and the consumer reads from the cache.\n  #cache = new VecQueue<IteratorResult>();\n\n  // The location of the consumer read head\n  #readHead: Time = { sec: 0, nsec: 0 };\n\n  // The promise for the current producer. The message generator starts a producer and awaits the\n  // producer before exiting.\n  #producer?: Promise<void>;\n\n  #initResult?: Initalization;\n\n  // How far ahead of the read head we should try to keep buffering\n  #readAheadDuration: Time;\n\n  public constructor(source: IIterableSource, opt?: Options) {\n    super();\n\n    this.#readAheadDuration = opt?.readAheadDuration ?? DEFAULT_READ_AHEAD_DURATION;\n    this.#source = new CachingIterableSource(source);\n\n    // pass-through the range change event\n    this.#source.on(\"loadedRangesChange\", () => this.emit(\"loadedRangesChange\"));\n  }\n\n  public async initialize(): Promise<Initalization> {\n    this.#initResult = await this.#source.initialize();\n    return this.#initResult;\n  }\n\n  async #startProducer(args: MessageIteratorArgs): Promise<void> {\n    if (!this.#initResult) {\n      throw new Error(\"Invariant: uninitialized\");\n    }\n\n    if (args.topics.length === 0) {\n      this.#readDone = true;\n      return;\n    }\n\n    log.debug(\"Starting producer\");\n\n    // Clear the cache and start producing into an empty array, the consumer removes elements from\n    // the start of the array.\n    this.#cache.clear();\n\n    try {\n      const sourceIterator = this.#source.messageIterator({\n        topics: args.topics,\n        start: this.#readHead,\n        consumptionType: \"partial\",\n      });\n\n      // Messages are read from the source until reaching the readUntil time. Then we wait for the read head\n      // to move forward and adjust readUntil\n      let readUntil = clampTime(\n        addTime(this.#readHead, this.#readAheadDuration),\n        this.#initResult.start,\n        this.#initResult.end,\n      );\n\n      for await (const result of sourceIterator) {\n        if (this.#aborted) {\n          return;\n        }\n\n        // Update the target readUntil to be ahead of the latest readHead\n        //\n        // Since reading a result from the iterator is async, we update the readUntil after we have\n        // the result so we can have the latest readHead\n        readUntil = addTime(this.#readHead, this.#readAheadDuration);\n\n        // When receiving a stamp result we enqueue the result into the cache and notify a reader.\n        if (result.type === \"stamp\" && compare(result.stamp, readUntil) >= 0) {\n          // Continue to wait until our stamp time surpasses the readUntil and we know that\n          // we should read more data.\n          while (compare(result.stamp, readUntil) >= 0) {\n            // The producer may have aborted while we are waiting for the read head to progress\n            // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n            if (this.#aborted) {\n              return;\n            }\n\n            // enqueue the stamp and wakeup the reader\n            // but the reader might not be reading - cause it is not being read from\n            this.#cache.enqueue(result);\n            this.#readSignal.notifyAll();\n\n            await this.#writeSignal.wait();\n            readUntil = addTime(this.#readHead, this.#readAheadDuration);\n          }\n          continue;\n        }\n\n        this.#cache.enqueue(result);\n\n        // Indicate to the consumer that it can try reading again\n        this.#readSignal.notifyAll();\n\n        // Keep reading while the messages we receive are <= the readUntil time.\n        if (\n          result.type === \"message-event\" &&\n          compare(result.msgEvent.receiveTime, readUntil) <= 0\n        ) {\n          continue;\n        }\n\n        // If we didn't load anything into the cache keep reading\n        if (this.#cache.size() === 0) {\n          continue;\n        }\n\n        // Wait for consumer thread to read something before trying to load more data\n        await this.#writeSignal.wait();\n      }\n    } finally {\n      // Indicate to the consumer that it can try reading again\n      this.#readSignal.notifyAll();\n      this.#readDone = true;\n    }\n\n    log.debug(\"producer done\");\n  }\n\n  public async terminate(): Promise<void> {\n    this.#cache.clear();\n    this.#source.removeAllListeners(\"loadedRangesChange\");\n    await this.#source.terminate();\n  }\n\n  public async stopProducer(): Promise<void> {\n    log.debug(\"Stopping producer\");\n    this.#aborted = true;\n    this.#writeSignal.notifyAll();\n    await this.#producer;\n    this.#producer = undefined;\n  }\n\n  public loadedRanges(): Range[] {\n    return this.#source.loadedRanges();\n  }\n\n  public messageIterator(\n    args: MessageIteratorArgs,\n  ): AsyncIterableIterator<Readonly<IteratorResult>> {\n    if (!this.#initResult) {\n      throw new Error(\"Invariant: uninitialized\");\n    }\n\n    if (this.#producer) {\n      throw new Error(\"Invariant: BufferedIterableSource allows only one messageIterator\");\n    }\n\n    const start = args.start ?? this.#initResult.start;\n\n    // Setup the initial cacheUntilTime to start buffing data\n    this.#readHead = start;\n\n    this.#aborted = false;\n    this.#readDone = false;\n\n    // Create and start the producer when the messageIterator function is called.\n    this.#producer = this.#startProducer(args);\n\n    // Rather than messageIterator itself being a generator, we return a generator function. This is\n    // so the setup code above will run when the messageIterator is called rather than when .next()\n    // is called the first time. This behavior is important because we want the producer to start\n    // producing immediately.\n    //\n    // Alias `this` to `self` for use in the generator function because we can't make fat-arrow\n    // generator functions\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const self = this;\n    return (async function* bufferedIterableGenerator() {\n      try {\n        if (args.topics.length === 0) {\n          return;\n        }\n\n        for (;;) {\n          const item = self.#cache.dequeue();\n          if (!item) {\n            if (self.#readDone) {\n              break;\n            }\n\n            // Wait for more stuff to load\n            await self.#readSignal.wait();\n            continue;\n          }\n\n          if (item.type === \"stamp\") {\n            self.#readHead = item.stamp;\n          }\n\n          // When there is a new message update the readHead for the producer to know where we are\n          // currently reading\n          if (item.type === \"message-event\") {\n            self.#readHead = item.msgEvent.receiveTime;\n          }\n\n          // Notify the producer thread that it can load more data. Since our producer and consumer are on the same _thread_\n          // this notification is picked up on the next tick.\n          self.#writeSignal.notifyAll();\n\n          yield item;\n        }\n      } finally {\n        log.debug(\"ending buffered message iterator\");\n        await self.stopProducer();\n      }\n    })();\n  }\n\n  public async getBackfillMessages(args: GetBackfillMessagesArgs): Promise<MessageEvent[]> {\n    return await this.#source.getBackfillMessages(args);\n  }\n}\n\nexport { BufferedIterableSource };\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport assert from \"assert\";\nimport { isEqual } from \"lodash\";\nimport { v4 as uuidv4 } from \"uuid\";\n\nimport { debouncePromise } from \"@foxglove/den/async\";\nimport { filterMap } from \"@foxglove/den/collection\";\nimport Log from \"@foxglove/log\";\nimport {\n  Time,\n  add,\n  compare,\n  clampTime,\n  fromMillis,\n  fromNanoSec,\n  toString,\n  toRFC3339String,\n} from \"@foxglove/rostime\";\nimport { MessageEvent, ParameterValue } from \"@foxglove/studio\";\nimport NoopMetricsCollector from \"@foxglove/studio-base/players/NoopMetricsCollector\";\nimport PlayerProblemManager from \"@foxglove/studio-base/players/PlayerProblemManager\";\nimport {\n  AdvertiseOptions,\n  Player,\n  PlayerMetricsCollectorInterface,\n  PlayerState,\n  Progress,\n  PublishPayload,\n  SubscribePayload,\n  Topic,\n  PlayerPresence,\n  PlayerCapabilities,\n  TopicStats,\n  PlayerStateActiveData,\n} from \"@foxglove/studio-base/players/types\";\nimport { RosDatatypes } from \"@foxglove/studio-base/types/RosDatatypes\";\nimport delay from \"@foxglove/studio-base/util/delay\";\n\nimport { BlockLoader } from \"./BlockLoader\";\nimport { BufferedIterableSource } from \"./BufferedIterableSource\";\nimport { IIterableSource, IteratorResult } from \"./IIterableSource\";\n\nconst log = Log.getLogger(__filename);\n\n// Number of bytes that we aim to keep in the cache.\n// Setting this to higher than 1.5GB caused the renderer process to crash on linux.\n// See: https://github.com/foxglove/studio/pull/1733\nconst DEFAULT_CACHE_SIZE_BYTES = 1.0e9;\n\n// Amount to wait until panels have had the chance to subscribe to topics before\n// we start playback\nconst START_DELAY_MS = 100;\n\n// Messages are laid out in blocks with a fixed number of milliseconds.\nconst MIN_MEM_CACHE_BLOCK_SIZE_NS = 0.1e9;\n\n// Original comment from webviz:\n// Preloading algorithms slow when there are too many blocks.\n// Adaptive block sizing is simpler than using a tree structure for immutable updates but\n// less flexible, so we may want to move away from a single-level block structure in the future.\nconst MAX_BLOCKS = 400;\n\n// Amount to seek into the data source from the start when loading the player. The purpose of this\n// is to provide some initial data to subscribers.\nconst SEEK_ON_START_NS = BigInt(99 * 1e6);\n\ntype IterablePlayerOptions = {\n  metricsCollector?: PlayerMetricsCollectorInterface;\n\n  source: IIterableSource;\n\n  // Optional player name\n  name?: string;\n\n  // Optional set of key/values to store with url handling\n  urlParams?: Record<string, string>;\n\n  // Source identifier used in constructing state urls.\n  sourceId: string;\n\n  isSampleDataSource?: boolean;\n\n  // Set to _false_ to disable preloading. (default: true)\n  enablePreload?: boolean;\n};\n\ntype IterablePlayerState =\n  | \"preinit\"\n  | \"initialize\"\n  | \"start-play\"\n  | \"idle\"\n  | \"seek-backfill\"\n  | \"play\"\n  | \"close\"\n  | \"reset-playback-iterator\";\n\n/**\n * IterablePlayer implements the Player interface for IIterableSource instances.\n *\n * The iterable player reads messages from an IIterableSource. The player is implemented as a state\n * machine. Each state runs until it finishes. A request to change state is handled by each state\n * detecting that there is another state waiting and cooperatively ending itself.\n */\nexport class IterablePlayer implements Player {\n  #urlParams?: Record<string, string>;\n  #name?: string;\n  #nextState?: IterablePlayerState;\n  #state: IterablePlayerState = \"preinit\";\n  #runningState: boolean = false;\n\n  #isPlaying: boolean = false;\n  #listener?: (playerState: PlayerState) => Promise<void>;\n  #speed: number = 1.0;\n  #start?: Time;\n  #end?: Time;\n  #enablePreload = true;\n\n  // next read start time indicates where to start reading for the next tick\n  // after a tick read, it is set to 1nsec past the end of the read operation (preparing for the next tick)\n  #lastTickMillis?: number;\n  // This is the \"lastSeekTime\" emitted in the playerState. This indicates the emit is due to a seek.\n  #lastSeekEmitTime: number = Date.now();\n\n  #providerTopics: Topic[] = [];\n  #providerTopicStats = new Map<string, TopicStats>();\n  #providerDatatypes: RosDatatypes = new Map();\n\n  #capabilities: string[] = [PlayerCapabilities.setSpeed, PlayerCapabilities.playbackControl];\n  #profile: string | undefined;\n  #metricsCollector: PlayerMetricsCollectorInterface;\n  #subscriptions: SubscribePayload[] = [];\n  #allTopics: Set<string> = new Set();\n  #preloadTopics: Set<string> = new Set();\n\n  #progress: Progress = {};\n  #id: string = uuidv4();\n  #messages: MessageEvent[] = [];\n  #receivedBytes: number = 0;\n  #hasError = false;\n  #lastRangeMillis?: number;\n  #lastMessageEvent?: MessageEvent;\n  #lastStamp?: Time;\n  #publishedTopics = new Map<string, Set<string>>();\n  #seekTarget?: Time;\n  #presence = PlayerPresence.INITIALIZING;\n\n  // To keep reference equality for downstream user memoization cache the currentTime provided in the last activeData update\n  // See additional comments below where _currentTime is set\n  #currentTime?: Time;\n\n  #problemManager = new PlayerProblemManager();\n\n  #iterableSource: IIterableSource;\n  #bufferedSource: BufferedIterableSource;\n\n  // Some states register an abort controller to signal they should abort\n  #abort?: AbortController;\n\n  // The iterator for reading messages during playback\n  #playbackIterator?: AsyncIterator<Readonly<IteratorResult>>;\n\n  #blockLoader?: BlockLoader;\n  #blockLoadingProcess?: Promise<void>;\n\n  #queueEmitState: ReturnType<typeof debouncePromise>;\n\n  readonly #sourceId: string;\n\n  #untilTime?: Time;\n\n  public constructor(options: IterablePlayerOptions) {\n    const { metricsCollector, urlParams, source, name, enablePreload, sourceId } = options;\n\n    this.#iterableSource = source;\n    this.#bufferedSource = new BufferedIterableSource(source);\n    this.#name = name;\n    this.#urlParams = urlParams;\n    this.#metricsCollector = metricsCollector ?? new NoopMetricsCollector();\n    this.#metricsCollector.playerConstructed();\n    this.#enablePreload = enablePreload ?? true;\n    this.#sourceId = sourceId;\n\n    // Wrap emitStateImpl in a debouncePromise for our states to call. Since we can emit from states\n    // or from block loading updates we use debouncePromise to guard against concurrent emits.\n    this.#queueEmitState = debouncePromise(this.#emitStateImpl.bind(this));\n  }\n\n  public setListener(listener: (playerState: PlayerState) => Promise<void>): void {\n    if (this.#listener) {\n      throw new Error(\"Cannot setListener again\");\n    }\n    this.#listener = listener;\n    this.#setState(\"initialize\");\n  }\n\n  public startPlayback(): void {\n    this.#startPlayImpl();\n  }\n\n  public playUntil(time: Time): void {\n    this.#startPlayImpl({ untilTime: time });\n  }\n\n  #startPlayImpl(opt?: { untilTime: Time }): void {\n    if (this.#isPlaying || this.#untilTime || !this.#start || !this.#end) {\n      return;\n    }\n\n    if (opt?.untilTime) {\n      if (this.#currentTime && compare(opt.untilTime, this.#currentTime) <= 0) {\n        throw new Error(\"Invariant: playUntil time must be after the current time\");\n      }\n      this.#untilTime = clampTime(opt.untilTime, this.#start, this.#end);\n    }\n    this.#metricsCollector.play(this.#speed);\n    this.#isPlaying = true;\n\n    // If we are idling we can start playing, if we have a next state queued we let that state\n    // finish and it will see that we should be playing\n    if (this.#state === \"idle\" && (!this.#nextState || this.#nextState === \"idle\")) {\n      this.#setState(\"play\");\n    }\n  }\n\n  public pausePlayback(): void {\n    if (!this.#isPlaying) {\n      return;\n    }\n    this.#metricsCollector.pause();\n    // clear out last tick millis so we don't read a huge chunk when we unpause\n    this.#lastTickMillis = undefined;\n    this.#isPlaying = false;\n    this.#untilTime = undefined;\n    if (this.#state === \"play\") {\n      this.#setState(\"idle\");\n    }\n  }\n\n  public setPlaybackSpeed(speed: number): void {\n    this.#lastRangeMillis = undefined;\n    this.#speed = speed;\n    this.#metricsCollector.setSpeed(speed);\n\n    // Queue event state update to update speed in player state to UI\n    this.#queueEmitState();\n  }\n\n  public seekPlayback(time: Time): void {\n    // Wait to perform seek until initialization is complete\n    if (this.#state === \"preinit\" || this.#state === \"initialize\") {\n      log.debug(`Ignoring seek, state=${this.#state}`);\n      this.#seekTarget = time;\n      return;\n    }\n\n    if (!this.#start || !this.#end) {\n      throw new Error(\"invariant: initialized but no start/end set\");\n    }\n\n    // Limit seek to within the valid range\n    const targetTime = clampTime(time, this.#start, this.#end);\n\n    // We are already seeking to this time, no need to reset seeking\n    if (this.#seekTarget && compare(this.#seekTarget, targetTime) === 0) {\n      log.debug(`Ignoring seek, already seeking to this time`);\n      return;\n    }\n\n    // We are already at this time, no need to reset seeking\n    if (this.#currentTime && compare(this.#currentTime, targetTime) === 0) {\n      log.debug(`Ignoring seek, already at this time`);\n      return;\n    }\n\n    this.#metricsCollector.seek(targetTime);\n    this.#seekTarget = targetTime;\n    this.#untilTime = undefined;\n\n    this.#setState(\"seek-backfill\");\n  }\n\n  public setSubscriptions(newSubscriptions: SubscribePayload[]): void {\n    log.debug(\"set subscriptions\", newSubscriptions);\n    this.#subscriptions = newSubscriptions;\n    this.#metricsCollector.setSubscriptions(newSubscriptions);\n\n    const allTopics = new Set(this.#subscriptions.map((subscription) => subscription.topic));\n    const preloadTopics = new Set(\n      filterMap(this.#subscriptions, (sub) =>\n        sub.preloadType !== \"partial\" ? sub.topic : undefined,\n      ),\n    );\n\n    // If there are no changes to topics there's no reason to perform a \"seek\" to trigger loading\n    if (isEqual(allTopics, this.#allTopics) && isEqual(preloadTopics, this.#preloadTopics)) {\n      return;\n    }\n\n    this.#allTopics = allTopics;\n    this.#preloadTopics = preloadTopics;\n    this.#blockLoader?.setTopics(this.#preloadTopics);\n\n    // If the player is playing, the playing state will detect any subscription changes and adjust\n    // iterators accordignly. However if we are idle or already seeking then we need to manually\n    // trigger the backfill.\n    if (this.#state === \"idle\" || this.#state === \"seek-backfill\" || this.#state === \"play\") {\n      if (!this.#isPlaying && this.#currentTime) {\n        this.#seekTarget ??= this.#currentTime;\n        this.#untilTime = undefined;\n\n        // Trigger a seek backfill to load any missing messages and reset the forward iterator\n        this.#setState(\"seek-backfill\");\n      }\n    }\n  }\n\n  public setPublishers(_publishers: AdvertiseOptions[]): void {\n    // no-op\n  }\n\n  public setParameter(_key: string, _value: ParameterValue): void {\n    throw new Error(\"Parameter editing is not supported by this data source\");\n  }\n\n  public publish(_payload: PublishPayload): void {\n    throw new Error(\"Publishing is not supported by this data source\");\n  }\n\n  public async callService(): Promise<unknown> {\n    throw new Error(\"Service calls are not supported by this data source\");\n  }\n\n  public close(): void {\n    this.#setState(\"close\");\n  }\n\n  public setGlobalVariables(): void {\n    // no-op\n  }\n\n  /** Request the state to switch to newState */\n  #setState(newState: IterablePlayerState) {\n    log.debug(`Set next state: ${newState}`);\n    this.#nextState = newState;\n    this.#abort?.abort();\n    this.#abort = undefined;\n    void this.#runState();\n  }\n\n  /**\n   * Run the requested state while there is a state to run.\n   *\n   * Ensures that only one state is running at a time.\n   * */\n  async #runState() {\n    if (this.#runningState) {\n      return;\n    }\n\n    this.#runningState = true;\n    try {\n      while (this.#nextState) {\n        const state = (this.#state = this.#nextState);\n        this.#nextState = undefined;\n\n        log.debug(`Start state: ${state}`);\n\n        // If we are going into a state other than play or idle we throw away the playback iterator since\n        // we will need to make a new one.\n        if (state !== \"idle\" && state !== \"play\" && this.#playbackIterator) {\n          log.debug(\"Ending playback iterator because next state is not IDLE or PLAY\");\n          await this.#playbackIterator.return?.();\n          this.#playbackIterator = undefined;\n        }\n\n        switch (state) {\n          case \"preinit\":\n            this.#queueEmitState();\n            break;\n          case \"initialize\":\n            await this.#stateInitialize();\n            break;\n          case \"start-play\":\n            await this.#stateStartPlay();\n            break;\n          case \"idle\":\n            await this.#stateIdle();\n            break;\n          case \"seek-backfill\":\n            // We allow aborting requests when moving on to the next state\n            await this.#stateSeekBackfill();\n            break;\n          case \"play\":\n            await this.#statePlay();\n            break;\n          case \"close\":\n            await this.#stateClose();\n            break;\n          case \"reset-playback-iterator\":\n            await this.#stateResetPlaybackIterator();\n        }\n\n        log.debug(`Done state ${state}`);\n      }\n    } catch (err) {\n      log.error(err);\n      this.#setError((err as Error).message, err);\n      this.#queueEmitState();\n    } finally {\n      this.#runningState = false;\n    }\n  }\n\n  #setError(message: string, error?: Error): void {\n    this.#hasError = true;\n    this.#problemManager.addProblem(\"global-error\", {\n      severity: \"error\",\n      message,\n      error,\n    });\n    this.#isPlaying = false;\n  }\n\n  // Initialize the source and player members\n  async #stateInitialize(): Promise<void> {\n    // emit state indicating start of initialization\n    this.#queueEmitState();\n\n    try {\n      const {\n        start,\n        end,\n        topics,\n        profile,\n        topicStats,\n        problems,\n        publishersByTopic,\n        datatypes,\n        name,\n      } = await this.#bufferedSource.initialize();\n\n      // Prior to initialization, the seekTarget may have been set to an out-of-bounds value\n      // This brings the value in bounds\n      if (this.#seekTarget) {\n        this.#seekTarget = clampTime(this.#seekTarget, start, end);\n      }\n\n      this.#profile = profile;\n      this.#start = start;\n      this.#currentTime = this.#seekTarget ?? start;\n      this.#end = end;\n      this.#publishedTopics = publishersByTopic;\n      this.#providerDatatypes = datatypes;\n      this.#name = name ?? this.#name;\n\n      // Studio does not like duplicate topics or topics with different datatypes\n      // Check for duplicates or for mismatched datatypes\n      const uniqueTopics = new Map<string, Topic>();\n      for (const topic of topics) {\n        const existingTopic = uniqueTopics.get(topic.name);\n        if (existingTopic) {\n          problems.push({\n            severity: \"warn\",\n            message: `Inconsistent datatype for topic: ${topic.name}`,\n            tip: `Topic ${topic.name} has messages with multiple datatypes: ${existingTopic.schemaName}, ${topic.schemaName}. This may result in errors during visualization.`,\n          });\n          continue;\n        }\n\n        uniqueTopics.set(topic.name, topic);\n      }\n\n      this.#providerTopics = Array.from(uniqueTopics.values());\n      this.#providerTopicStats = topicStats;\n\n      let idx = 0;\n      for (const problem of problems) {\n        this.#problemManager.addProblem(`init-problem-${idx}`, problem);\n        idx += 1;\n      }\n\n      if (this.#enablePreload) {\n        // --- setup block loader which loads messages for _full_ subscriptions in the \"background\"\n        try {\n          this.#blockLoader = new BlockLoader({\n            cacheSizeBytes: DEFAULT_CACHE_SIZE_BYTES,\n            source: this.#iterableSource,\n            start: this.#start,\n            end: this.#end,\n            maxBlocks: MAX_BLOCKS,\n            minBlockDurationNs: MIN_MEM_CACHE_BLOCK_SIZE_NS,\n            problemManager: this.#problemManager,\n          });\n        } catch (err) {\n          log.error(err);\n\n          const startStr = toRFC3339String(this.#start);\n          const endStr = toRFC3339String(this.#end);\n\n          this.#problemManager.addProblem(\"block-loader\", {\n            severity: \"warn\",\n            message: \"Failed to initialize message preloading\",\n            tip: `The start (${startStr}) and end (${endStr}) of your data is too far apart.`,\n            error: err,\n          });\n        }\n      }\n\n      this.#presence = PlayerPresence.PRESENT;\n    } catch (error) {\n      this.#setError(`Error initializing: ${error.message}`, error);\n    }\n    this.#queueEmitState();\n\n    if (!this.#hasError && this.#start) {\n      // Wait a bit until panels have had the chance to subscribe to topics before we start\n      // playback.\n      await delay(START_DELAY_MS);\n\n      this.#blockLoader?.setTopics(this.#preloadTopics);\n\n      // Block loadings is constantly running and tries to keep the preloaded messages in memory\n      this.#blockLoadingProcess = this.#startBlockLoading();\n\n      this.#setState(\"start-play\");\n    }\n  }\n\n  async #resetPlaybackIterator() {\n    if (!this.#currentTime) {\n      throw new Error(\"Invariant: Tried to reset playback iterator with no current time.\");\n    }\n\n    const next = add(this.#currentTime, { sec: 0, nsec: 1 });\n\n    log.debug(\"Ending previous iterator\");\n    await this.#playbackIterator?.return?.();\n\n    // set the playIterator to the seek time\n    await this.#bufferedSource.stopProducer();\n\n    log.debug(\"Initializing forward iterator from\", next);\n    this.#playbackIterator = this.#bufferedSource.messageIterator({\n      topics: Array.from(this.#allTopics),\n      start: next,\n      consumptionType: \"partial\",\n    });\n  }\n\n  async #stateResetPlaybackIterator() {\n    if (!this.#currentTime) {\n      throw new Error(\"Invariant: Tried to reset playback iterator with no current time.\");\n    }\n\n    await this.#resetPlaybackIterator();\n    this.#setState(this.#isPlaying ? \"play\" : \"idle\");\n  }\n\n  // Read a small amount of data from the datasource with the hope of producing a message or two.\n  // Without an initial read, the user would be looking at a blank layout since no messages have yet\n  // been delivered.\n  async #stateStartPlay() {\n    if (!this.#start || !this.#end) {\n      throw new Error(\"Invariant: start and end must be set\");\n    }\n\n    // If we have a target seek time, the seekPlayback function will take care of backfilling messages.\n    if (this.#seekTarget) {\n      this.#setState(\"seek-backfill\");\n      return;\n    }\n\n    const stopTime = clampTime(\n      add(this.#start, fromNanoSec(SEEK_ON_START_NS)),\n      this.#start,\n      this.#end,\n    );\n\n    log.debug(`Playing from ${toString(this.#start)} to ${toString(stopTime)}`);\n\n    if (this.#playbackIterator) {\n      throw new Error(\"Invariant. playbackIterator was already set\");\n    }\n\n    log.debug(\"Initializing forward iterator from\", this.#start);\n    this.#playbackIterator = this.#bufferedSource.messageIterator({\n      topics: Array.from(this.#allTopics),\n      start: this.#start,\n      consumptionType: \"partial\",\n    });\n\n    this.#lastMessageEvent = undefined;\n    this.#messages = [];\n\n    const messageEvents: MessageEvent[] = [];\n\n    // If we take too long to read the data, we set the player into a BUFFERING presence. This\n    // indicates that the player is waiting to load more data.\n    const tickTimeout = setTimeout(() => {\n      this.#presence = PlayerPresence.BUFFERING;\n      this.#queueEmitState();\n    }, 100);\n\n    try {\n      for (;;) {\n        const result = await this.#playbackIterator.next();\n        if (result.done === true) {\n          break;\n        }\n        const iterResult = result.value;\n        // Bail if a new state is requested while we are loading messages\n        // This usually happens when seeking before the initial load is complete\n        if (this.#nextState) {\n          return;\n        }\n\n        if (iterResult.type === \"problem\") {\n          this.#problemManager.addProblem(`connid-${iterResult.connectionId}`, iterResult.problem);\n          continue;\n        }\n\n        if (iterResult.type === \"stamp\" && compare(iterResult.stamp, stopTime) >= 0) {\n          this.#lastStamp = iterResult.stamp;\n          break;\n        }\n\n        if (iterResult.type === \"message-event\") {\n          // The message is past the tick end time, we need to save it for next tick\n          if (compare(iterResult.msgEvent.receiveTime, stopTime) > 0) {\n            this.#lastMessageEvent = iterResult.msgEvent;\n            break;\n          }\n\n          messageEvents.push(iterResult.msgEvent);\n        }\n      }\n    } finally {\n      clearTimeout(tickTimeout);\n    }\n\n    this.#currentTime = stopTime;\n    this.#messages = messageEvents;\n    this.#presence = PlayerPresence.PRESENT;\n    this.#queueEmitState();\n    this.#setState(\"idle\");\n  }\n\n  // Process a seek request. The seek is performed by requesting a getBackfillMessages from the source.\n  // This provides the last message on all subscribed topics.\n  async #stateSeekBackfill() {\n    if (!this.#start || !this.#end) {\n      throw new Error(\"invariant: stateSeekBackfill prior to initialization\");\n    }\n\n    if (!this.#seekTarget) {\n      return;\n    }\n\n    // Ensure the seek time is always within the data source bounds\n    const targetTime = clampTime(this.#seekTarget, this.#start, this.#end);\n\n    this.#lastMessageEvent = undefined;\n\n    // If the backfill does not complete within 100 milliseconds, we emit with no messages to\n    // indicate buffering. This provides feedback to the user that we've acknowledged their seek\n    // request but haven't loaded the data.\n    //\n    // Note: we explicitly avoid setting _lastSeekEmitTime so panels do not reset visualizations\n    const seekAckTimeout = setTimeout(() => {\n      this.#presence = PlayerPresence.BUFFERING;\n      this.#messages = [];\n      this.#currentTime = targetTime;\n      this.#queueEmitState();\n    }, 100);\n\n    const topics = Array.from(this.#allTopics);\n\n    try {\n      this.#abort = new AbortController();\n      const messages = await this.#bufferedSource.getBackfillMessages({\n        topics,\n        time: targetTime,\n        abortSignal: this.#abort.signal,\n      });\n\n      // We've successfully loaded the messages and will emit those, no longer need the ackTimeout\n      clearTimeout(seekAckTimeout);\n\n      if (this.#nextState) {\n        return;\n      }\n\n      this.#messages = messages;\n      this.#currentTime = targetTime;\n      this.#lastSeekEmitTime = Date.now();\n      this.#presence = PlayerPresence.PRESENT;\n      this.#queueEmitState();\n      await this.#resetPlaybackIterator();\n      this.#setState(this.#isPlaying ? \"play\" : \"idle\");\n    } catch (err) {\n      if (this.#nextState && err instanceof DOMException && err.name === \"AbortError\") {\n        log.debug(\"Aborted backfill\");\n      } else {\n        throw err;\n      }\n    } finally {\n      // Unless the next state is a seek backfill, we clear the seek target since we have finished seeking\n      if (this.#nextState !== \"seek-backfill\") {\n        this.#seekTarget = undefined;\n      }\n      clearTimeout(seekAckTimeout);\n      this.#abort = undefined;\n    }\n  }\n\n  /** Emit the player state to the registered listener */\n  async #emitStateImpl() {\n    if (!this.#listener) {\n      return;\n    }\n\n    if (this.#hasError) {\n      return await this.#listener({\n        name: this.#name,\n        presence: PlayerPresence.ERROR,\n        progress: {},\n        capabilities: this.#capabilities,\n        profile: this.#profile,\n        playerId: this.#id,\n        activeData: undefined,\n        problems: this.#problemManager.problems(),\n        urlState: {\n          sourceId: this.#sourceId,\n          parameters: this.#urlParams,\n        },\n      });\n    }\n\n    const messages = this.#messages;\n    this.#messages = [];\n\n    let activeData: PlayerStateActiveData | undefined;\n    if (this.#start && this.#end && this.#currentTime) {\n      activeData = {\n        messages,\n        totalBytesReceived: this.#receivedBytes,\n        currentTime: this.#currentTime,\n        startTime: this.#start,\n        endTime: this.#end,\n        isPlaying: this.#isPlaying,\n        speed: this.#speed,\n        lastSeekTime: this.#lastSeekEmitTime,\n        topics: this.#providerTopics,\n        topicStats: this.#providerTopicStats,\n        datatypes: this.#providerDatatypes,\n        publishedTopics: this.#publishedTopics,\n      };\n    }\n\n    const data: PlayerState = {\n      name: this.#name,\n      presence: this.#presence,\n      progress: this.#progress,\n      capabilities: this.#capabilities,\n      profile: this.#profile,\n      playerId: this.#id,\n      problems: this.#problemManager.problems(),\n      activeData,\n      urlState: {\n        sourceId: this.#sourceId,\n        parameters: this.#urlParams,\n      },\n    };\n\n    return await this.#listener(data);\n  }\n\n  /**\n   * Run one tick loop by reading from the message iterator a \"tick\" worth of messages.\n   * */\n  async #tick(): Promise<void> {\n    if (!this.#isPlaying) {\n      return;\n    }\n    if (!this.#start || !this.#end) {\n      throw new Error(\"Invariant: start & end should be set before tick()\");\n    }\n\n    // compute how long of a time range we want to read by taking into account\n    // the time since our last read and how fast we're currently playing back\n    const tickTime = performance.now();\n    const durationMillis =\n      this.#lastTickMillis != undefined && this.#lastTickMillis !== 0\n        ? tickTime - this.#lastTickMillis\n        : 20;\n    this.#lastTickMillis = tickTime;\n\n    // Read at most 300ms worth of messages, otherwise things can get out of control if rendering\n    // is very slow. Also, smooth over the range that we request, so that a single slow frame won't\n    // cause the next frame to also be unnecessarily slow by increasing the frame size.\n    let rangeMillis = Math.min(durationMillis * this.#speed, 300);\n    if (this.#lastRangeMillis != undefined) {\n      rangeMillis = this.#lastRangeMillis * 0.9 + rangeMillis * 0.1;\n    }\n    this.#lastRangeMillis = rangeMillis;\n\n    if (!this.#currentTime) {\n      throw new Error(\"Invariant: Tried to play with no current time.\");\n    }\n\n    // The end time when we want to stop reading messages and emit state for the tick\n    // The end time is inclusive.\n    const targetTime = add(this.#currentTime, fromMillis(rangeMillis));\n    const end: Time = clampTime(targetTime, this.#start, this.#untilTime ?? this.#end);\n\n    // If a lastStamp is available from the previous tick we check the stamp against our current\n    // tick's end time. If this stamp is after our current tick's end time then we don't need to\n    // read any messages and can shortcut the rest of the logic to set the current time to the tick\n    // end time and queue an emit.\n    //\n    // If we have a lastStamp but it isn't after the tick end, then we clear it and proceed with the\n    // tick logic.\n    if (this.#lastStamp) {\n      if (compare(this.#lastStamp, end) >= 0) {\n        // Wait for the previous render frame to finish\n        await this.#queueEmitState.currentPromise;\n\n        this.#currentTime = end;\n        this.#messages = [];\n        this.#queueEmitState();\n\n        if (this.#untilTime && compare(this.#currentTime, this.#untilTime) >= 0) {\n          this.pausePlayback();\n        }\n        return;\n      }\n\n      this.#lastStamp = undefined;\n    }\n\n    const msgEvents: MessageEvent[] = [];\n\n    // When ending the previous tick, we might have already read a message from the iterator which\n    // belongs to our tick. This logic brings that message into our current batch of message events.\n    if (this.#lastMessageEvent) {\n      // If the last message we saw is still ahead of the tick end time, we don't emit anything\n      if (compare(this.#lastMessageEvent.receiveTime, end) > 0) {\n        // Wait for the previous render frame to finish\n        await this.#queueEmitState.currentPromise;\n\n        this.#currentTime = end;\n        this.#messages = msgEvents;\n        this.#queueEmitState();\n\n        if (this.#untilTime && compare(this.#currentTime, this.#untilTime) >= 0) {\n          this.pausePlayback();\n        }\n        return;\n      }\n\n      msgEvents.push(this.#lastMessageEvent);\n      this.#lastMessageEvent = undefined;\n    }\n\n    // If we take too long to read the tick data, we set the player into a BUFFERING presence. This\n    // indicates that the player is waiting to load more data. When the tick finally finishes, we\n    // clear this timeout.\n    const tickTimeout = setTimeout(() => {\n      this.#presence = PlayerPresence.BUFFERING;\n      this.#queueEmitState();\n    }, 500);\n\n    try {\n      // Read from the iterator through the end of the tick time\n      for (;;) {\n        if (!this.#playbackIterator) {\n          throw new Error(\"Invariant. this._playbackIterator is undefined.\");\n        }\n\n        const result = await this.#playbackIterator.next();\n        if (result.done === true || this.#nextState) {\n          break;\n        }\n        const iterResult = result.value;\n\n        if (iterResult.type === \"problem\") {\n          this.#problemManager.addProblem(`connid-${iterResult.connectionId}`, iterResult.problem);\n          continue;\n        }\n\n        if (iterResult.type === \"stamp\" && compare(iterResult.stamp, end) >= 0) {\n          this.#lastStamp = iterResult.stamp;\n          break;\n        }\n\n        if (iterResult.type === \"message-event\") {\n          // The message is past the tick end time, we need to save it for next tick\n          if (compare(iterResult.msgEvent.receiveTime, end) > 0) {\n            this.#lastMessageEvent = iterResult.msgEvent;\n            break;\n          }\n\n          msgEvents.push(iterResult.msgEvent);\n        }\n      }\n    } finally {\n      clearTimeout(tickTimeout);\n    }\n\n    // Set the presence back to PRESENT since we are no longer buffering\n    this.#presence = PlayerPresence.PRESENT;\n\n    if (this.#nextState) {\n      return;\n    }\n\n    // Wait on any active emit state to finish as part of this tick\n    // Without waiting on the emit state to finish we might drop messages since our emitState\n    // might get debounced\n    await this.#queueEmitState.currentPromise;\n\n    this.#currentTime = end;\n    this.#messages = msgEvents;\n    this.#queueEmitState();\n\n    // This tick has reached the end of the untilTime so we go back to pause\n    if (this.#untilTime && compare(this.#currentTime, this.#untilTime) >= 0) {\n      this.pausePlayback();\n    }\n  }\n\n  async #stateIdle() {\n    assert(this.#abort == undefined, \"Invariant: some other abort controller exists\");\n\n    this.#isPlaying = false;\n    this.#presence = PlayerPresence.PRESENT;\n\n    // set the latest value of the loaded ranges for the next emit state\n    this.#progress = {\n      fullyLoadedFractionRanges: this.#bufferedSource.loadedRanges(),\n      messageCache: this.#progress.messageCache,\n    };\n\n    const abort = (this.#abort = new AbortController());\n    const aborted = new Promise((resolve) => abort.signal.addEventListener(\"abort\", resolve));\n\n    const rangeChangeHandler = () => {\n      this.#progress = {\n        fullyLoadedFractionRanges: this.#bufferedSource.loadedRanges(),\n        messageCache: this.#progress.messageCache,\n      };\n      this.#queueEmitState();\n    };\n\n    // While idle, the buffered source might still be loading and we still want to update downstream\n    // with the new ranges we've buffered. This event will update progress and queue state emits\n    this.#bufferedSource.on(\"loadedRangesChange\", rangeChangeHandler);\n\n    this.#queueEmitState();\n    await aborted;\n    this.#bufferedSource.off(\"loadedRangesChange\", rangeChangeHandler);\n  }\n\n  async #statePlay() {\n    this.#presence = PlayerPresence.PRESENT;\n\n    if (!this.#currentTime) {\n      throw new Error(\"Invariant: currentTime not set before statePlay\");\n    }\n    if (!this.#start || !this.#end) {\n      throw new Error(\"Invariant: start & end should be set before statePlay\");\n    }\n\n    // Track the identity of allTopics, if this changes we need to reset our iterator to\n    // get new messages for new topics\n    const allTopics = this.#allTopics;\n\n    try {\n      while (this.#isPlaying && !this.#hasError && !this.#nextState) {\n        if (compare(this.#currentTime, this.#end) >= 0) {\n          // Playback has ended. Reset internal trackers for maintaining the playback speed.\n          this.#lastTickMillis = undefined;\n          this.#lastRangeMillis = undefined;\n          this.#lastStamp = undefined;\n          this.#setState(\"idle\");\n          return;\n        }\n\n        const start = Date.now();\n\n        await this.#tick();\n        // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition, @typescript-eslint/strict-boolean-expressions\n        if (this.#nextState) {\n          return;\n        }\n\n        // Update with the latest loaded ranges from the buffered source\n        // The messageCache is updated separately by block loader events\n        this.#progress = {\n          fullyLoadedFractionRanges: this.#bufferedSource.loadedRanges(),\n          messageCache: this.#progress.messageCache,\n        };\n\n        // If subscriptions changed, update to the new subscriptions\n        if (this.#allTopics !== allTopics) {\n          // Discard any last message event since the new iterator will repeat it\n          this.#lastMessageEvent = undefined;\n\n          // Bail playback and reset the playback iterator when topics have changed so we can load\n          // the new topics\n          this.#setState(\"reset-playback-iterator\");\n          return;\n        }\n\n        const time = Date.now() - start;\n        // make sure we've slept at least 16 millis or so (aprox 1 frame)\n        // to give the UI some time to breathe and not burn in a tight loop\n        if (time < 16) {\n          await delay(16 - time);\n        }\n      }\n    } catch (err) {\n      this.#setError((err as Error).message, err);\n      this.#queueEmitState();\n    }\n  }\n\n  async #stateClose() {\n    this.#isPlaying = false;\n    this.#metricsCollector.close();\n    await this.#blockLoader?.stopLoading();\n    await this.#blockLoadingProcess;\n    await this.#bufferedSource.stopProducer();\n    await this.#bufferedSource.terminate();\n    await this.#playbackIterator?.return?.();\n    this.#playbackIterator = undefined;\n    await this.#iterableSource.terminate?.();\n  }\n\n  async #startBlockLoading() {\n    await this.#blockLoader?.startLoading({\n      progress: async (progress) => {\n        this.#progress = {\n          fullyLoadedFractionRanges: this.#progress.fullyLoadedFractionRanges,\n          messageCache: progress.messageCache,\n        };\n\n        // If we are in playback, we will let playback queue state updates\n        if (this.#state === \"play\") {\n          return;\n        }\n\n        this.#queueEmitState();\n      },\n    });\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { TransferHandler } from \"comlink\";\n\nconst isAbortSignal = (val: unknown): val is AbortSignal => val instanceof AbortSignal;\n\n/**\n * abortSignalTransferHandler implements a Comlink TransferHandler for AbortSignal instances\n *\n * Serialize creates an array with a boolean for whether the signal is already aborted and a message\n * port to send an abort signal.\n *\n * Deserialize creates a new abort controller and aborts it when the abort message is sent over the\n * message port.\n *\n * Reference: https://developer.mozilla.org/en-US/docs/Web/API/AbortSignal\n */\nconst abortSignalTransferHandler: TransferHandler<AbortSignal, [boolean, MessagePort]> = {\n  canHandle: isAbortSignal,\n  deserialize: ([aborted, msgPort]) => {\n    const controller = new AbortController();\n\n    if (aborted) {\n      controller.abort();\n    } else {\n      msgPort.onmessage = () => {\n        controller.abort();\n      };\n    }\n\n    return controller.signal;\n  },\n  serialize: (abortSignal) => {\n    const { port1, port2 } = new MessageChannel();\n    abortSignal.addEventListener(\"abort\", () => {\n      port1.postMessage(\"aborted\");\n    });\n\n    return [[abortSignal.aborted, port2], [port2]];\n  },\n};\n\nexport { abortSignalTransferHandler };\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport * as Comlink from \"comlink\";\n\nimport { abortSignalTransferHandler } from \"@foxglove/comlink-transfer-handlers\";\nimport { MessageEvent, Time } from \"@foxglove/studio\";\n\nimport type {\n  GetBackfillMessagesArgs,\n  IIterableSource,\n  IMessageCursor,\n  Initalization,\n  IteratorResult,\n  MessageIteratorArgs,\n  IterableSourceInitializeArgs,\n} from \"./IIterableSource\";\nimport type { WorkerIterableSourceWorker } from \"./WorkerIterableSourceWorker\";\n\nComlink.transferHandlers.set(\"abortsignal\", abortSignalTransferHandler);\n\ntype ConstructorArgs = {\n  initWorker: () => Worker;\n  initArgs: IterableSourceInitializeArgs;\n};\n\nexport class WorkerIterableSource implements IIterableSource {\n  readonly #args: ConstructorArgs;\n\n  #thread?: Worker;\n  #worker?: Comlink.Remote<WorkerIterableSourceWorker>;\n\n  public constructor(args: ConstructorArgs) {\n    this.#args = args;\n  }\n\n  public async initialize(): Promise<Initalization> {\n    // Note: this launches the worker.\n    this.#thread = this.#args.initWorker();\n\n    const initialize = Comlink.wrap<\n      (args: IterableSourceInitializeArgs) => Comlink.Remote<WorkerIterableSourceWorker>\n    >(this.#thread);\n\n    const worker = (this.#worker = await initialize(this.#args.initArgs));\n    return await worker.initialize();\n  }\n\n  public async *messageIterator(\n    args: MessageIteratorArgs,\n  ): AsyncIterableIterator<Readonly<IteratorResult>> {\n    if (this.#worker == undefined) {\n      throw new Error(`WorkerIterableSource is not initialized`);\n    }\n\n    const cursor = this.getMessageCursor(args);\n    try {\n      for (;;) {\n        // The fastest framerate that studio renders at is 60fps. So to render a frame studio needs\n        // at minimum ~16 milliseconds of messages before it will render a frame. Here we fetch\n        // batches of 17 milliseconds so that one batch fetch could result in one frame render.\n        // Fetching too much in a batch means we cannot render until the batch is returned.\n        const results = await cursor.nextBatch(17 /* milliseconds */);\n        if (!results || results.length === 0) {\n          break;\n        }\n        yield* results;\n      }\n    } finally {\n      await cursor.end();\n    }\n  }\n\n  public async getBackfillMessages(args: GetBackfillMessagesArgs): Promise<MessageEvent[]> {\n    if (this.#worker == undefined) {\n      throw new Error(`WorkerIterableSource is not initialized`);\n    }\n\n    // An AbortSignal is not clonable, so we remove it from the args and send it as a separate argumet\n    // to our worker getBackfillMessages call. Our installed Comlink handler for AbortSignal handles\n    // making the abort signal available within the worker.\n    const { abortSignal, ...rest } = args;\n    return await this.#worker.getBackfillMessages(rest, abortSignal);\n  }\n\n  public getMessageCursor(args: MessageIteratorArgs & { abort?: AbortSignal }): IMessageCursor {\n    if (this.#worker == undefined) {\n      throw new Error(`WorkerIterableSource is not initialized`);\n    }\n\n    // An AbortSignal is not clonable, so we remove it from the args and send it as a separate argumet\n    // to our worker getBackfillMessages call. Our installed Comlink handler for AbortSignal handles\n    // making the abort signal available within the worker.\n    const { abort, ...rest } = args;\n    const messageCursorPromise = this.#worker.getMessageCursor(rest, abort);\n\n    const cursor: IMessageCursor = {\n      async next() {\n        const messageCursor = await messageCursorPromise;\n        return await messageCursor.next();\n      },\n\n      async nextBatch(durationMs: number) {\n        const messageCursor = await messageCursorPromise;\n        return await messageCursor.nextBatch(durationMs);\n      },\n\n      async readUntil(end: Time) {\n        const messageCursor = await messageCursorPromise;\n        return await messageCursor.readUntil(end);\n      },\n\n      async end() {\n        const messageCursor = await messageCursorPromise;\n        try {\n          await messageCursor.end();\n        } finally {\n          messageCursor[Comlink.releaseProxy]();\n        }\n      },\n    };\n\n    return cursor;\n  }\n\n  public async terminate(): Promise<void> {\n    this.#thread?.terminate();\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport {\n  IDataSourceFactory,\n  DataSourceFactoryInitializeArgs,\n} from \"@foxglove/studio-base/context/PlayerSelectionContext\";\nimport { IterablePlayer, WorkerIterableSource } from \"@foxglove/studio-base/players/IterablePlayer\";\nimport { Player } from \"@foxglove/studio-base/players/types\";\n\nclass Ros1LocalBagDataSourceFactory implements IDataSourceFactory {\n  public id = \"ros1-local-bagfile\";\n  public type: IDataSourceFactory[\"type\"] = \"file\";\n  public displayName = \"ROS 1 Bag\";\n  public iconName: IDataSourceFactory[\"iconName\"] = \"OpenFile\";\n  public supportedFileTypes = [\".bag\"];\n\n  public initialize(args: DataSourceFactoryInitializeArgs): Player | undefined {\n    const file = args.file;\n    if (!file) {\n      return;\n    }\n\n    const source = new WorkerIterableSource({\n      initWorker: () => {\n        return new Worker(\n          // foxglove-depcheck-used: babel-plugin-transform-import-meta\n          new URL(\n            \"@foxglove/studio-base/players/IterablePlayer/BagIterableSourceWorker.worker\",\n            import.meta.url,\n          ),\n        );\n      },\n      initArgs: { file },\n    });\n\n    return new IterablePlayer({\n      metricsCollector: args.metricsCollector,\n      source,\n      name: file.name,\n      sourceId: this.id,\n    });\n  }\n}\n\nexport default Ros1LocalBagDataSourceFactory;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { isEqual, sortBy, keyBy } from \"lodash\";\nimport { v4 as uuidv4 } from \"uuid\";\n\nimport { debouncePromise } from \"@foxglove/den/async\";\nimport { Sockets } from \"@foxglove/electron-socket/renderer\";\nimport Logger from \"@foxglove/log\";\nimport { MessageDefinition } from \"@foxglove/message-definition\";\nimport { RosNode, TcpSocket } from \"@foxglove/ros1\";\nimport { Time, fromMillis, isGreaterThan, toSec } from \"@foxglove/rostime\";\nimport { ParameterValue } from \"@foxglove/studio\";\nimport OsContextSingleton from \"@foxglove/studio-base/OsContextSingleton\";\nimport PlayerProblemManager from \"@foxglove/studio-base/players/PlayerProblemManager\";\nimport {\n  AdvertiseOptions,\n  MessageEvent,\n  Player,\n  PlayerCapabilities,\n  PlayerMetricsCollectorInterface,\n  PlayerPresence,\n  PlayerState,\n  PlayerProblem,\n  PublishPayload,\n  SubscribePayload,\n  Topic,\n  TopicStats,\n  TopicWithSchemaName,\n} from \"@foxglove/studio-base/players/types\";\nimport { RosDatatypes } from \"@foxglove/studio-base/types/RosDatatypes\";\nimport rosDatatypesToMessageDefinition from \"@foxglove/studio-base/util/rosDatatypesToMessageDefinition\";\nimport { HttpServer } from \"@foxglove/xmlrpc\";\n\nconst log = Logger.getLogger(__filename);\nconst rosLog = Logger.getLogger(\"ROS1\");\n\nconst CAPABILITIES = [\n  PlayerCapabilities.advertise,\n  PlayerCapabilities.getParameters,\n  PlayerCapabilities.setParameters,\n];\n\nenum Problem {\n  Connection = \"Connection\",\n  Parameters = \"Parameters\",\n  Graph = \"Graph\",\n  Publish = \"Publish\",\n  Node = \"Node\",\n}\n\ntype Ros1PlayerOpts = {\n  url: string;\n  hostname?: string;\n  metricsCollector: PlayerMetricsCollectorInterface;\n  sourceId: string;\n};\n\n// Connects to `rosmaster` instance using `@foxglove/ros1`\nexport default class Ros1Player implements Player {\n  #url: string; // rosmaster URL.\n  #hostname?: string; // ROS_HOSTNAME\n  #rosNode?: RosNode; // Our ROS node when we're connected.\n  #id: string = uuidv4(); // Unique ID for this player.\n  #listener?: (arg0: PlayerState) => Promise<void>; // Listener for _emitState().\n  #closed: boolean = false; // Whether the player has been completely closed using close().\n  #providerTopics?: TopicWithSchemaName[]; // Topics as advertised by rosmaster.\n  #providerTopicsStats = new Map<string, TopicStats>(); // topic names to topic statistics.\n  #providerDatatypes: RosDatatypes = new Map(); // All ROS message definitions received from subscriptions and set by publishers.\n  #publishedTopics = new Map<string, Set<string>>(); // A map of topic names to the set of publisher IDs publishing each topic.\n  #subscribedTopics = new Map<string, Set<string>>(); // A map of topic names to the set of subscriber IDs subscribed to each topic.\n  #services = new Map<string, Set<string>>(); // A map of service names to service provider IDs that provide each service.\n  #parameters = new Map<string, ParameterValue>(); // rosparams\n  #start?: Time; // The time at which we started playing.\n  #clockTime?: Time; // The most recent published `/clock` time, if available\n  #requestedPublishers: AdvertiseOptions[] = []; // Requested publishers by setPublishers()\n  #requestedSubscriptions: SubscribePayload[] = []; // Requested subscriptions by setSubscriptions()\n  #parsedMessages: MessageEvent[] = []; // Queue of messages that we'll send in next _emitState() call.\n  #requestTopicsTimeout?: ReturnType<typeof setTimeout>; // setTimeout() handle for _requestTopics().\n  #hasReceivedMessage = false;\n  #metricsCollector: PlayerMetricsCollectorInterface;\n  #presence: PlayerPresence = PlayerPresence.INITIALIZING;\n  #problems = new PlayerProblemManager();\n  #emitTimer?: ReturnType<typeof setTimeout>;\n  readonly #sourceId: string;\n\n  public constructor({ url, hostname, metricsCollector, sourceId }: Ros1PlayerOpts) {\n    log.info(`initializing Ros1Player (url=${url}, hostname=${hostname})`);\n    this.#metricsCollector = metricsCollector;\n    this.#url = url;\n    this.#hostname = hostname;\n    this.#start = this.#getCurrentTime();\n    this.#metricsCollector.playerConstructed();\n    this.#sourceId = sourceId;\n    void this.#open();\n  }\n\n  #open = async (): Promise<void> => {\n    const os = OsContextSingleton;\n    if (this.#closed || os == undefined) {\n      return;\n    }\n    this.#presence = PlayerPresence.INITIALIZING;\n\n    const hostname =\n      this.#hostname ??\n      RosNode.GetRosHostname(os.getEnvVar, os.getHostname, os.getNetworkInterfaces);\n\n    const net = await Sockets.Create();\n    const httpServer = await net.createHttpServer();\n    const tcpSocketCreate = async (options: { host: string; port: number }): Promise<TcpSocket> => {\n      return await net.createSocket(options.host, options.port);\n    };\n    const tcpServer = await net.createServer();\n\n    // Mirror the ros_comm c++ library behavior when setting up the tcp server listener.\n    // ros_comm listens on all interfaces unless the hostname is explicity set to 'localhost'\n    // https://github.com/ros/ros_comm/blob/noetic-devel/clients/roscpp/src/libros/transport/transport_tcp.cpp#L393-L395\n    // https://github.com/ros/ros_comm/blob/f5fa3a168760d62e9693f10dcb9adfffc6132d22/clients/roscpp/src/libros/transport/transport.cpp#L67-L72\n    let listenHostname = \"0.0.0.0\";\n    if (hostname === \"localhost\") {\n      listenHostname = \"localhost\";\n    }\n    await tcpServer.listen(undefined, listenHostname, 10);\n\n    if (this.#rosNode == undefined) {\n      const rosNode = new RosNode({\n        name: `/foxglovestudio_${os.pid}`,\n        hostname,\n        pid: os.pid,\n        rosMasterUri: this.#url,\n        httpServer: httpServer as unknown as HttpServer,\n        tcpSocketCreate,\n        tcpServer,\n        log: rosLog,\n      });\n      this.#rosNode = rosNode;\n\n      rosNode.on(\"paramUpdate\", ({ key, value, prevValue, callerId }) => {\n        log.debug(\"paramUpdate\", key, value, prevValue, callerId);\n        this.#parameters = new Map(rosNode.parameters);\n      });\n      rosNode.on(\"error\", (error) => {\n        this.#addProblem(Problem.Node, {\n          severity: \"warn\",\n          message: \"ROS node error\",\n          tip: `Connectivity will be automatically re-established`,\n          error,\n        });\n      });\n    }\n\n    await this.#rosNode.start();\n\n    // Process any advertise requests made before our node was ready.\n    this.setPublishers(this.#requestedPublishers);\n\n    // Request topics *after* setting publishers in case we want to subscribe\n    // to topics we are publishing.\n    await this.#requestTopics();\n\n    this.#presence = PlayerPresence.PRESENT;\n  };\n\n  #addProblem(\n    id: string,\n    problem: PlayerProblem,\n    { skipEmit = false }: { skipEmit?: boolean } = {},\n  ): void {\n    this.#problems.addProblem(id, problem);\n    if (!skipEmit) {\n      this.#emitState();\n    }\n  }\n\n  #clearProblem(id: string, { skipEmit = false }: { skipEmit?: boolean } = {}): void {\n    if (this.#problems.removeProblem(id)) {\n      if (!skipEmit) {\n        this.#emitState();\n      }\n    }\n  }\n\n  #clearPublishProblems({ skipEmit = false }: { skipEmit?: boolean } = {}) {\n    if (\n      this.#problems.removeProblems(\n        (id) =>\n          id.startsWith(\"msgdef:\") || id.startsWith(\"advertise:\") || id.startsWith(\"publish:\"),\n      )\n    ) {\n      if (!skipEmit) {\n        this.#emitState();\n      }\n    }\n  }\n\n  #topicsChanged = (newTopics: Topic[]): boolean => {\n    if (!this.#providerTopics || newTopics.length !== this.#providerTopics.length) {\n      return true;\n    }\n    return !isEqual(this.#providerTopics, newTopics);\n  };\n\n  #requestTopics = async (): Promise<void> => {\n    if (this.#requestTopicsTimeout) {\n      clearTimeout(this.#requestTopicsTimeout);\n    }\n    const rosNode = this.#rosNode;\n    if (!rosNode || this.#closed) {\n      return;\n    }\n\n    try {\n      const topicArrays = await rosNode.getPublishedTopics();\n      const topics: TopicWithSchemaName[] = topicArrays.map(([name, schemaName]) => ({\n        name,\n        schemaName,\n      }));\n      // Sort them for easy comparison\n      const sortedTopics = sortBy(topics, \"name\");\n\n      if (this.#topicsChanged(sortedTopics)) {\n        // Remove stats entries for removed topics\n        const topicsSet = new Set<string>(topics.map((topic) => topic.name));\n        for (const topic of this.#providerTopicsStats.keys()) {\n          if (!topicsSet.has(topic)) {\n            this.#providerTopicsStats.delete(topic);\n          }\n        }\n\n        this.#providerTopics = sortedTopics;\n      }\n\n      // Try subscribing again, since we might now be able to subscribe to some new topics.\n      this.setSubscriptions(this.#requestedSubscriptions);\n\n      // Subscribe to all parameters\n      try {\n        const params = await rosNode.subscribeAllParams();\n        if (!isEqual(params, this.#parameters)) {\n          this.#parameters = new Map();\n          params.forEach((value, key) => this.#parameters.set(key, value));\n        }\n        this.#clearProblem(Problem.Parameters, { skipEmit: true });\n      } catch (error) {\n        this.#addProblem(\n          Problem.Parameters,\n          {\n            severity: \"warn\",\n            message: \"ROS parameter fetch failed\",\n            tip: `Ensure that roscore is running and accessible at: ${this.#url}`,\n            error,\n          },\n          { skipEmit: true },\n        );\n      }\n\n      // Fetch the full graph topology\n      await this.#updateConnectionGraph(rosNode);\n\n      this.#clearProblem(Problem.Connection, { skipEmit: true });\n      this.#presence = PlayerPresence.PRESENT;\n      this.#emitState();\n    } catch (error) {\n      this.#presence = PlayerPresence.INITIALIZING;\n      this.#addProblem(\n        Problem.Connection,\n        {\n          severity: \"error\",\n          message: \"ROS connection failed\",\n          tip: `Ensure that roscore is running and accessible at: ${this.#url}`,\n          error,\n        },\n        { skipEmit: false },\n      );\n    } finally {\n      // Regardless of what happens, request topics again in a little bit.\n      this.#requestTopicsTimeout = setTimeout(this.#requestTopics, 3000);\n    }\n  };\n\n  // Potentially performance-sensitive; await can be expensive\n  // eslint-disable-next-line @typescript-eslint/promise-function-async\n  #emitState = debouncePromise(() => {\n    if (!this.#listener || this.#closed) {\n      return Promise.resolve();\n    }\n\n    const providerTopics = this.#providerTopics;\n    const start = this.#start;\n    if (!providerTopics || !start) {\n      return this.#listener({\n        name: this.#url,\n        presence: this.#presence,\n        progress: {},\n        capabilities: CAPABILITIES,\n        profile: \"ros1\",\n        playerId: this.#id,\n        problems: this.#problems.problems(),\n        activeData: undefined,\n      });\n    }\n\n    // Time is always moving forward even if we don't get messages from the server.\n    // If we are not connected, don't emit updates since we are not longer getting new data\n    if (this.#presence === PlayerPresence.PRESENT) {\n      if (this.#emitTimer != undefined) {\n        clearTimeout(this.#emitTimer);\n      }\n      this.#emitTimer = setTimeout(this.#emitState, 100);\n    }\n\n    const currentTime = this.#getCurrentTime();\n    const messages = this.#parsedMessages;\n    this.#parsedMessages = [];\n    return this.#listener({\n      name: this.#url,\n      presence: this.#presence,\n      progress: {},\n      capabilities: CAPABILITIES,\n      profile: \"ros1\",\n      playerId: this.#id,\n      problems: this.#problems.problems(),\n      urlState: {\n        sourceId: this.#sourceId,\n        parameters: { url: this.#url },\n      },\n\n      activeData: {\n        messages,\n        totalBytesReceived: this.#rosNode?.receivedBytes() ?? 0,\n        startTime: start,\n        endTime: currentTime,\n        currentTime,\n        isPlaying: true,\n        speed: 1,\n        // We don't support seeking, so we need to set this to any fixed value. Just avoid 0 so\n        // that we don't accidentally hit falsy checks.\n        lastSeekTime: 1,\n        topics: providerTopics,\n        // Always copy topic stats since message counts and timestamps are being updated\n        topicStats: new Map(this.#providerTopicsStats),\n        datatypes: this.#providerDatatypes,\n        publishedTopics: this.#publishedTopics,\n        subscribedTopics: this.#subscribedTopics,\n        services: this.#services,\n        parameters: this.#parameters,\n      },\n    });\n  });\n\n  public setListener(listener: (arg0: PlayerState) => Promise<void>): void {\n    this.#listener = listener;\n    this.#emitState();\n  }\n\n  public close(): void {\n    this.#closed = true;\n    if (this.#rosNode) {\n      this.#rosNode.shutdown();\n    }\n    if (this.#emitTimer != undefined) {\n      clearTimeout(this.#emitTimer);\n      this.#emitTimer = undefined;\n    }\n    this.#metricsCollector.close();\n    this.#hasReceivedMessage = false;\n  }\n\n  public setSubscriptions(subscriptions: SubscribePayload[]): void {\n    this.#requestedSubscriptions = subscriptions;\n\n    if (!this.#rosNode || this.#closed) {\n      return;\n    }\n\n    // Subscribe to additional topics used by Ros1Player itself\n    this.#addInternalSubscriptions(subscriptions);\n\n    // See what topics we actually can subscribe to.\n    const availableTopicsByTopicName = keyBy(this.#providerTopics ?? [], ({ name }) => name);\n    const topicNames = subscriptions\n      .map(({ topic }) => topic)\n      .filter((topicName) => availableTopicsByTopicName[topicName]);\n\n    // Subscribe to all topics that we aren't subscribed to yet.\n    for (const topicName of topicNames) {\n      const availTopic = availableTopicsByTopicName[topicName];\n      if (!availTopic || this.#rosNode.subscriptions.has(topicName)) {\n        continue;\n      }\n\n      const { schemaName } = availTopic;\n      const subscription = this.#rosNode.subscribe({ topic: topicName, dataType: schemaName });\n\n      subscription.on(\"header\", (_header, msgdef, _reader) => {\n        // We have to create a new object instead of just updating _providerDatatypes to support\n        // shallow memo downstream.\n        const newDatatypes = this.#getRosDatatypes(schemaName, msgdef);\n        this.#providerDatatypes = new Map([...this.#providerDatatypes, ...newDatatypes]);\n      });\n      subscription.on(\"message\", (message, data, _pub) => {\n        this.#handleMessage(topicName, message, data.byteLength, schemaName, true);\n        // Clear any existing subscription problems for this topic if we're receiving messages again.\n        this.#clearProblem(`subscribe:${topicName}`, { skipEmit: true });\n      });\n      subscription.on(\"error\", (error) => {\n        this.#addProblem(`subscribe:${topicName}`, {\n          severity: \"warn\",\n          message: `Topic subscription error for \"${topicName}\"`,\n          tip: `The subscription to \"${topicName}\" will be automatically re-established`,\n          error,\n        });\n      });\n    }\n\n    // Unsubscribe from topics that we are subscribed to but shouldn't be.\n    for (const topicName of this.#rosNode.subscriptions.keys()) {\n      if (!topicNames.includes(topicName)) {\n        this.#rosNode.unsubscribe(topicName);\n\n        // Reset the message count for this topic\n        this.#providerTopicsStats.delete(topicName);\n      }\n    }\n  }\n\n  #handleMessage = (\n    topic: string,\n    message: unknown,\n    sizeInBytes: number,\n    schemaName: string,\n    // This is a hot path so we avoid extra object allocation from a parameters struct\n    // eslint-disable-next-line @foxglove/no-boolean-parameters\n    external: boolean,\n  ): void => {\n    if (this.#providerTopics == undefined) {\n      return;\n    }\n\n    const receiveTime = this.#getCurrentTime();\n\n    if (external && !this.#hasReceivedMessage) {\n      this.#hasReceivedMessage = true;\n      this.#metricsCollector.recordTimeToFirstMsgs();\n    }\n\n    const msg: MessageEvent = {\n      topic,\n      receiveTime,\n      message,\n      sizeInBytes,\n      schemaName,\n    };\n    this.#parsedMessages.push(msg);\n    this.#handleInternalMessage(msg);\n\n    // Update the message count for this topic\n    let stats = this.#providerTopicsStats.get(topic);\n    if (this.#rosNode?.subscriptions.has(topic) === true) {\n      if (!stats) {\n        stats = { numMessages: 0 };\n        this.#providerTopicsStats.set(topic, stats);\n      }\n      stats.numMessages++;\n      stats.firstMessageTime ??= receiveTime;\n      if (stats.lastMessageTime == undefined) {\n        stats.lastMessageTime = receiveTime;\n      } else if (isGreaterThan(receiveTime, stats.lastMessageTime)) {\n        stats.lastMessageTime = receiveTime;\n      }\n    }\n\n    this.#emitState();\n  };\n\n  public setPublishers(publishers: AdvertiseOptions[]): void {\n    this.#requestedPublishers = publishers;\n\n    if (!this.#rosNode || this.#closed) {\n      return;\n    }\n\n    const validPublishers = publishers.filter(({ topic }) => topic.length > 0 && topic !== \"/\");\n    const topics = new Set<string>(validPublishers.map(({ topic }) => topic));\n\n    // Clear all problems related to publishing\n    this.#clearPublishProblems({ skipEmit: true });\n\n    // Unadvertise any topics that were previously published and no longer appear in the list\n    for (const topic of this.#rosNode.publications.keys()) {\n      if (!topics.has(topic)) {\n        this.#rosNode.unadvertise(topic);\n      }\n    }\n\n    // Unadvertise any topics where the dataType changed\n    for (const { topic, schemaName: datatype } of validPublishers) {\n      const existingPub = this.#rosNode.publications.get(topic);\n      if (existingPub != undefined && existingPub.dataType !== datatype) {\n        this.#rosNode.unadvertise(topic);\n      }\n    }\n\n    // Advertise new topics\n    for (const advertiseOptions of validPublishers) {\n      const { topic, schemaName: dataType, options } = advertiseOptions;\n\n      if (this.#rosNode.publications.has(topic)) {\n        continue;\n      }\n\n      const msgdefProblemId = `msgdef:${topic}`;\n      const advertiseProblemId = `advertise:${topic}`;\n\n      // Try to retrieve the ROS message definition for this topic\n      let msgdef: MessageDefinition[];\n      try {\n        const datatypes = options?.[\"datatypes\"] as RosDatatypes | undefined;\n        if (!datatypes || !(datatypes instanceof Map)) {\n          throw new Error(\"The datatypes option is required for publishing\");\n        }\n        msgdef = rosDatatypesToMessageDefinition(datatypes, dataType);\n      } catch (error) {\n        log.debug(error);\n        this.#addProblem(msgdefProblemId, {\n          severity: \"warn\",\n          message: `Unknown message definition for \"${topic}\"`,\n          tip: `Try subscribing to the topic \"${topic}\" before publishing to it`,\n        });\n        continue;\n      }\n\n      // Advertise this topic to ROS as being published by us\n      this.#rosNode.advertise({ topic, dataType, messageDefinition: msgdef }).catch((error) =>\n        this.#addProblem(advertiseProblemId, {\n          severity: \"error\",\n          message: `Failed to advertise \"${topic}\"`,\n          error,\n        }),\n      );\n    }\n\n    this.#emitState();\n  }\n\n  public setParameter(key: string, value: ParameterValue): void {\n    log.debug(`Ros1Player.setParameter(key=${key}, value=${value})`);\n    void this.#rosNode?.setParameter(key, value);\n  }\n\n  public publish({ topic, msg }: PublishPayload): void {\n    const problemId = `publish:${topic}`;\n\n    if (this.#rosNode != undefined) {\n      if (this.#rosNode.isAdvertising(topic)) {\n        this.#rosNode\n          .publish(topic, msg)\n          .then(() => this.#clearProblem(problemId))\n          .catch((error) =>\n            this.#addProblem(problemId, {\n              severity: \"error\",\n              message: `Publishing to ${topic} failed`,\n              error,\n            }),\n          );\n      } else {\n        this.#addProblem(problemId, {\n          severity: \"warn\",\n          message: `Unable to publish to \"${topic}\"`,\n          tip: `ROS1 may be disconnected. Please try again in a moment`,\n        });\n      }\n    }\n  }\n\n  public async callService(): Promise<unknown> {\n    throw new Error(\"Service calls are not supported by this data source\");\n  }\n\n  // Bunch of unsupported stuff. Just don't do anything for these.\n  public setGlobalVariables(): void {\n    // no-op\n  }\n\n  #getRosDatatypes = (datatype: string, messageDefinition: MessageDefinition[]): RosDatatypes => {\n    const typesByName: RosDatatypes = new Map();\n    for (const def of messageDefinition) {\n      // The first definition usually doesn't have an explicit name so we use the datatype\n      if (def.name == undefined) {\n        typesByName.set(datatype, def);\n      } else {\n        typesByName.set(def.name, def);\n      }\n    }\n    return typesByName;\n  };\n\n  #addInternalSubscriptions(subscriptions: SubscribePayload[]): void {\n    // Always subscribe to /clock if available\n    if (subscriptions.find((sub) => sub.topic === \"/clock\") == undefined) {\n      subscriptions.unshift({\n        topic: \"/clock\",\n      });\n    }\n  }\n\n  #handleInternalMessage(msg: MessageEvent): void {\n    const maybeClockMsg = msg.message as { clock?: Time };\n    if (msg.topic === \"/clock\" && maybeClockMsg.clock && !isNaN(maybeClockMsg.clock.sec)) {\n      const time = maybeClockMsg.clock;\n      const seconds = toSec(maybeClockMsg.clock);\n      if (isNaN(seconds)) {\n        return;\n      }\n\n      if (this.#clockTime == undefined) {\n        this.#start = time;\n      }\n\n      this.#clockTime = time;\n      (msg as { receiveTime: Time }).receiveTime = this.#getCurrentTime();\n    }\n  }\n\n  async #updateConnectionGraph(rosNode: RosNode): Promise<void> {\n    try {\n      const graph = await rosNode.getSystemState();\n      if (\n        !isEqual(this.#publishedTopics, graph.publishers) ||\n        !isEqual(this.#subscribedTopics, graph.subscribers) ||\n        !isEqual(this.#services, graph.services)\n      ) {\n        this.#publishedTopics = graph.publishers;\n        this.#subscribedTopics = graph.subscribers;\n        this.#services = graph.services;\n      }\n      this.#clearProblem(Problem.Graph, { skipEmit: true });\n    } catch (error) {\n      this.#addProblem(\n        Problem.Graph,\n        {\n          severity: \"warn\",\n          message: \"Unable to update connection graph\",\n          tip: `The connection graph contains information about publishers and subscribers. A\nstale graph may result in missing topics you expect. Ensure that roscore is reachable at ${\n            this.#url\n          }.`,\n          error,\n        },\n        { skipEmit: true },\n      );\n      this.#publishedTopics = new Map();\n      this.#subscribedTopics = new Map();\n      this.#services = new Map();\n    }\n  }\n\n  #getCurrentTime(): Time {\n    return this.#clockTime ?? fromMillis(Date.now());\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { isString, isUndefined } from \"lodash\";\n\nimport { RosNode } from \"@foxglove/ros1\";\nimport OsContextSingleton from \"@foxglove/studio-base/OsContextSingleton\";\nimport {\n  IDataSourceFactory,\n  DataSourceFactoryInitializeArgs,\n} from \"@foxglove/studio-base/context/PlayerSelectionContext\";\nimport Ros1Player from \"@foxglove/studio-base/players/Ros1Player\";\nimport { Player } from \"@foxglove/studio-base/players/types\";\n\nclass Ros1SocketDataSourceFactory implements IDataSourceFactory {\n  public id = \"ros1-socket\";\n  public type: IDataSourceFactory[\"type\"] = \"connection\";\n  public displayName = \"ROS 1\";\n  public iconName: IDataSourceFactory[\"iconName\"] = \"ROS\";\n  public description =\n    \"Connect to a running ROS 1 system via a native TCP connection that accesses your ROS master and nodes directly.\";\n  public docsLinks = [{ url: \"https://foxglove.dev/docs/studio/connection/native\" }];\n\n  public formConfig = {\n    fields: [\n      {\n        id: \"url\",\n        label: \"ROS_MASTER_URI\",\n        defaultValue: OsContextSingleton?.getEnvVar(\"ROS_MASTER_URI\") ?? \"http://localhost:11311\",\n        description: \"Tells ROS nodes where they can locate the master\",\n      },\n      {\n        id: \"hostname\",\n        label: \"ROS_HOSTNAME\",\n        defaultValue: OsContextSingleton\n          ? RosNode.GetRosHostname(\n              OsContextSingleton.getEnvVar,\n              OsContextSingleton.getHostname,\n              OsContextSingleton.getNetworkInterfaces,\n            )\n          : \"localhost\",\n        description: \"Acts as the declared network address of a ROS node or tool\",\n      },\n    ],\n  };\n\n  public initialize(args: DataSourceFactoryInitializeArgs): Player | undefined {\n    const url = args.params?.url;\n    if (!url) {\n      return;\n    }\n\n    const hostname = args.params?.hostname;\n    if (!isUndefined(hostname) && !isString(hostname)) {\n      throw new Error(`Unable to initialize Ros1. Invalid hostname ${hostname}`);\n    }\n\n    return new Ros1Player({\n      url,\n      hostname,\n      metricsCollector: args.metricsCollector,\n      sourceId: this.id,\n    });\n  }\n}\n\nexport default Ros1SocketDataSourceFactory;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport {\n  IDataSourceFactory,\n  DataSourceFactoryInitializeArgs,\n} from \"@foxglove/studio-base/context/PlayerSelectionContext\";\nimport { IterablePlayer, WorkerIterableSource } from \"@foxglove/studio-base/players/IterablePlayer\";\nimport { Player } from \"@foxglove/studio-base/players/types\";\n\nclass Ros2LocalBagDataSourceFactory implements IDataSourceFactory {\n  public id = \"ros2-local-bagfile\";\n  public type: IDataSourceFactory[\"type\"] = \"file\";\n  public displayName = \"ROS 2 Bag\";\n  public iconName: IDataSourceFactory[\"iconName\"] = \"OpenFile\";\n  public supportedFileTypes = [\".db3\"];\n  public supportsMultiFile = true;\n\n  public initialize(args: DataSourceFactoryInitializeArgs): Player | undefined {\n    const files = args.file ? [args.file] : args.files;\n    const name = args.file ? args.file.name : args.files?.map((file) => file.name).join(\", \");\n\n    if (!files) {\n      return;\n    }\n\n    const source = new WorkerIterableSource({\n      initWorker: () => {\n        return new Worker(\n          // foxglove-depcheck-used: babel-plugin-transform-import-meta\n          new URL(\n            \"@foxglove/studio-base/players/IterablePlayer/rosdb3/RosDb3IterableSourceWorker.worker\",\n            import.meta.url,\n          ),\n        );\n      },\n      initArgs: { files },\n    });\n\n    return new IterablePlayer({\n      metricsCollector: args.metricsCollector,\n      source,\n      name,\n      sourceId: this.id,\n    });\n  }\n}\n\nexport default Ros2LocalBagDataSourceFactory;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { parse as parseMessageDefinition } from \"@foxglove/rosmsg\";\nimport { RosDatatypes } from \"@foxglove/studio-base/types/RosDatatypes\";\n\ntype DatatypeDescription = {\n  messageDefinition: string;\n  type: string;\n};\n\n// Extract one big list of datatypes from the individual connections.\nexport function bagConnectionsToDatatypes(\n  connections: readonly DatatypeDescription[],\n  { ros2 }: { ros2: boolean },\n): RosDatatypes {\n  const datatypes: RosDatatypes = new Map();\n  connections.forEach((connection) => {\n    const connectionDefinitions = parseMessageDefinition(connection.messageDefinition, { ros2 });\n    connectionDefinitions.forEach(({ name, definitions }, index) => {\n      // The first definition usually doesn't have an explicit name,\n      // so we get the name from the datatype.\n      if (index === 0) {\n        datatypes.set(connection.type, { name: connection.type, definitions });\n      } else if (name != undefined) {\n        datatypes.set(name, { name, definitions });\n      }\n    });\n  });\n  return datatypes;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { isEqual, sortBy, transform, keyBy } from \"lodash\";\nimport { v4 as uuidv4 } from \"uuid\";\n\nimport { debouncePromise } from \"@foxglove/den/async\";\nimport { filterMap } from \"@foxglove/den/collection\";\nimport Log from \"@foxglove/log\";\nimport roslib from \"@foxglove/roslibjs\";\nimport { parse as parseMessageDefinition } from \"@foxglove/rosmsg\";\nimport { LazyMessageReader } from \"@foxglove/rosmsg-serialization\";\nimport { MessageReader as ROS2MessageReader } from \"@foxglove/rosmsg2-serialization\";\nimport { Time, fromMillis, toSec } from \"@foxglove/rostime\";\nimport { ParameterValue } from \"@foxglove/studio\";\nimport PlayerProblemManager from \"@foxglove/studio-base/players/PlayerProblemManager\";\nimport {\n  AdvertiseOptions,\n  MessageEvent,\n  Player,\n  PlayerCapabilities,\n  PlayerState,\n  PublishPayload,\n  SubscribePayload,\n  Topic,\n  PlayerPresence,\n  PlayerMetricsCollectorInterface,\n  TopicStats,\n  TopicWithSchemaName,\n} from \"@foxglove/studio-base/players/types\";\nimport { RosDatatypes } from \"@foxglove/studio-base/types/RosDatatypes\";\nimport { bagConnectionsToDatatypes } from \"@foxglove/studio-base/util/bagConnectionsHelper\";\n\nconst log = Log.getLogger(__dirname);\n\nconst CAPABILITIES = [PlayerCapabilities.advertise, PlayerCapabilities.callServices];\n\ntype RosNodeDetails = Record<\n  \"subscriptions\" | \"publications\" | \"services\",\n  { node: string; values: string[] }\n>;\n\nfunction collateNodeDetails(\n  details: RosNodeDetails[],\n  key: keyof RosNodeDetails,\n): Map<string, Set<string>> {\n  return transform(\n    details,\n    (acc, detail) => {\n      const { node, values } = detail[key];\n      for (const value of values) {\n        if (!acc.has(value)) {\n          acc.set(value, new Set());\n        }\n        acc.get(value)?.add(node);\n      }\n    },\n    new Map<string, Set<string>>(),\n  );\n}\n\nfunction isClockMessage(topic: string, msg: unknown): msg is { clock: Time } {\n  const maybeClockMsg = msg as { clock?: Time };\n  return topic === \"/clock\" && maybeClockMsg.clock != undefined && !isNaN(maybeClockMsg.clock.sec);\n}\n\nfunction isRecord(value: unknown): value is Record<string, unknown> {\n  return typeof value === \"object\" && value != undefined;\n}\n\n// Connects to `rosbridge_server` instance using `roslibjs`. Currently doesn't support seeking or\n// showing simulated time, so current time from Date.now() is always used instead. Also doesn't yet\n// support raw ROS messages; instead we use the CBOR compression provided by roslibjs, which\n// unmarshalls into plain JS objects.\nexport default class RosbridgePlayer implements Player {\n  #url: string; // WebSocket URL.\n  #rosClient?: roslib.Ros; // The roslibjs client when we're connected.\n  #id: string = uuidv4(); // Unique ID for this player.\n  #isRefreshing = false; // True if currently refreshing the node graph.\n  #listener?: (arg0: PlayerState) => Promise<void>; // Listener for _emitState().\n  #closed: boolean = false; // Whether the player has been completely closed using close().\n  #providerTopics?: TopicWithSchemaName[]; // Topics as published by the WebSocket.\n  #providerTopicsStats = new Map<string, TopicStats>(); // topic names to topic statistics.\n  #providerDatatypes?: RosDatatypes; // Datatypes as published by the WebSocket.\n  #publishedTopics = new Map<string, Set<string>>(); // A map of topic names to the set of publisher IDs publishing each topic.\n  #subscribedTopics = new Map<string, Set<string>>(); // A map of topic names to the set of subscriber IDs subscribed to each topic.\n  #services = new Map<string, Set<string>>(); // A map of service names to service provider IDs that provide each service.\n  #messageReadersByDatatype: {\n    [datatype: string]: LazyMessageReader | ROS2MessageReader;\n  } = {};\n  #start?: Time; // The time at which we started playing.\n  #clockTime?: Time; // The most recent published `/clock` time, if available\n  // active subscriptions\n  #topicSubscriptions = new Map<string, roslib.Topic>();\n  #requestedSubscriptions: SubscribePayload[] = []; // Requested subscriptions by setSubscriptions()\n  #parsedMessages: MessageEvent[] = []; // Queue of messages that we'll send in next _emitState() call.\n  #requestTopicsTimeout?: ReturnType<typeof setTimeout>; // setTimeout() handle for _requestTopics().\n  // active publishers for the current connection\n  #topicPublishers = new Map<string, roslib.Topic>();\n  // which topics we want to advertise to other nodes\n  #advertisements: AdvertiseOptions[] = [];\n  #parsedTopics: Set<string> = new Set();\n  #receivedBytes: number = 0;\n  #metricsCollector: PlayerMetricsCollectorInterface;\n  #hasReceivedMessage = false;\n  #presence: PlayerPresence = PlayerPresence.NOT_PRESENT;\n  #problems = new PlayerProblemManager();\n  #emitTimer?: ReturnType<typeof setTimeout>;\n  #serviceTypeCache = new Map<string, Promise<string>>();\n  readonly #sourceId: string;\n  #rosVersion: 1 | 2 | undefined;\n\n  public constructor({\n    url,\n    metricsCollector,\n    sourceId,\n  }: {\n    url: string;\n    metricsCollector: PlayerMetricsCollectorInterface;\n    sourceId: string;\n  }) {\n    this.#presence = PlayerPresence.INITIALIZING;\n    this.#metricsCollector = metricsCollector;\n    this.#url = url;\n    this.#start = fromMillis(Date.now());\n    this.#metricsCollector.playerConstructed();\n    this.#sourceId = sourceId;\n    this.#open();\n  }\n\n  #open = (): void => {\n    if (this.#closed) {\n      return;\n    }\n    if (this.#rosClient != undefined) {\n      throw new Error(`Attempted to open a second Rosbridge connection`);\n    }\n    this.#problems.removeProblem(\"rosbridge:connection-failed\");\n    log.info(`Opening connection to ${this.#url}`);\n\n    // `workersocket` will open the actual WebSocket connection in a WebWorker.\n    const rosClient = new roslib.Ros({ url: this.#url, transportLibrary: \"workersocket\" });\n\n    rosClient.on(\"connection\", () => {\n      log.info(`Connected to ${this.#url}`);\n      if (this.#closed) {\n        return;\n      }\n      this.#presence = PlayerPresence.PRESENT;\n      this.#problems.removeProblem(\"rosbridge:connection-failed\");\n      this.#rosClient = rosClient;\n\n      this.#setupPublishers();\n      void this.#requestTopics({ forceUpdate: true });\n    });\n\n    rosClient.on(\"error\", (err) => {\n      if (err) {\n        this.#problems.addProblem(\"rosbridge:error\", {\n          severity: \"warn\",\n          message: \"Rosbridge error\",\n          error: err,\n        });\n        this.#emitState();\n      }\n    });\n\n    rosClient.on(\"close\", () => {\n      this.#presence = PlayerPresence.RECONNECTING;\n\n      if (this.#requestTopicsTimeout) {\n        clearTimeout(this.#requestTopicsTimeout);\n      }\n      for (const [topicName, topic] of this.#topicSubscriptions) {\n        topic.unsubscribe();\n        this.#topicSubscriptions.delete(topicName);\n      }\n      rosClient.close(); // ensure the underlying worker is cleaned up\n      this.#rosClient = undefined;\n\n      this.#problems.addProblem(\"rosbridge:connection-failed\", {\n        severity: \"error\",\n        message: \"Connection failed\",\n        tip: `Check that the rosbridge WebSocket server at ${this.#url} is reachable.`,\n      });\n\n      this.#emitState();\n\n      // Try connecting again.\n      setTimeout(this.#open, 3000);\n    });\n  };\n\n  #topicsChanged = (newTopics: Topic[]): boolean => {\n    if (!this.#providerTopics || newTopics.length !== this.#providerTopics.length) {\n      return true;\n    }\n    return !isEqual(this.#providerTopics, newTopics);\n  };\n\n  async #requestTopics(opt?: { forceUpdate: boolean }): Promise<void> {\n    const { forceUpdate = false } = opt ?? {};\n    // clear problems before each topics request so we don't have stale problems from previous failed requests\n    this.#problems.removeProblems((id) => id.startsWith(\"requestTopics:\"));\n\n    if (this.#requestTopicsTimeout) {\n      clearTimeout(this.#requestTopicsTimeout);\n    }\n    const rosClient = this.#rosClient;\n    if (!rosClient || this.#closed) {\n      return;\n    }\n\n    // getTopicsAndRawTypes might silently hang. When this happens, there is no indication to the user\n    // that the connection is doing anything and studio shows no errors and no data.\n    // This logic adds a warning after 5 seconds (picked arbitrarily) to display a notice to the user.\n    const topicsStallWarningTimeout = setTimeout(() => {\n      this.#problems.addProblem(\"topicsAndRawTypesTimeout\", {\n        severity: \"warn\",\n        message: \"Taking too long to get topics and raw types.\",\n      });\n\n      this.#emitState();\n    }, 5000);\n\n    try {\n      const result = await new Promise<{\n        topics: string[];\n        types: string[];\n        typedefs_full_text: string[];\n      }>((resolve, reject) => rosClient.getTopicsAndRawTypes(resolve, reject));\n\n      clearTimeout(topicsStallWarningTimeout);\n      this.#problems.removeProblem(\"topicsAndRawTypesTimeout\");\n\n      const topicsMissingDatatypes: string[] = [];\n      const topics: TopicWithSchemaName[] = [];\n      const datatypeDescriptions = [];\n      const messageReaders: Record<string, LazyMessageReader | ROS2MessageReader> = {};\n\n      // Automatically detect the ROS version based on the datatypes.\n      // The rosbridge server itself publishes /rosout so the topic should be reliably present.\n      if (result.types.includes(\"rcl_interfaces/msg/Log\")) {\n        this.#rosVersion = 2;\n        this.#problems.removeProblem(\"unknownRosVersion\");\n      } else if (result.types.includes(\"rosgraph_msgs/Log\")) {\n        this.#rosVersion = 1;\n        this.#problems.removeProblem(\"unknownRosVersion\");\n      } else {\n        this.#rosVersion = 1;\n        this.#problems.addProblem(\"unknownRosVersion\", {\n          severity: \"warn\",\n          message: \"Unable to detect ROS version, assuming ROS 1\",\n        });\n      }\n\n      for (let i = 0; i < result.topics.length; i++) {\n        const topicName = result.topics[i]!;\n        const type = result.types[i];\n        const messageDefinition = result.typedefs_full_text[i];\n\n        if (type == undefined || messageDefinition == undefined) {\n          topicsMissingDatatypes.push(topicName);\n          continue;\n        }\n        topics.push({ name: topicName, schemaName: type });\n        datatypeDescriptions.push({ type, messageDefinition });\n        const parsedDefinition = parseMessageDefinition(messageDefinition, {\n          ros2: this.#rosVersion === 2,\n        });\n        // https://github.com/typescript-eslint/typescript-eslint/issues/6632\n        if (!messageReaders[type]) {\n          messageReaders[type] =\n            this.#rosVersion !== 2\n              ? new LazyMessageReader(parsedDefinition)\n              : new ROS2MessageReader(parsedDefinition);\n        }\n      }\n\n      // We call requestTopics on a timeout to check for new topics. If there are no changes to topics\n      // we want to bail and avoid updating readers, subscribers, etc.\n      // However, during a re-connect, we _do_ want to refresh this list and re-subscribe\n      const sortedTopics = sortBy(topics, \"name\");\n      if (!forceUpdate && !this.#topicsChanged(sortedTopics)) {\n        return;\n      }\n\n      if (topicsMissingDatatypes.length > 0) {\n        this.#problems.addProblem(\"requestTopics:missing-types\", {\n          severity: \"warn\",\n          message: \"Could not resolve all message types\",\n          tip: `Message types could not be found for these topics: ${topicsMissingDatatypes.join(\n            \",\",\n          )}`,\n        });\n      }\n\n      // Remove stats entries for removed topics\n      const topicsSet = new Set<string>(topics.map((topic) => topic.name));\n      for (const topic of this.#providerTopicsStats.keys()) {\n        if (!topicsSet.has(topic)) {\n          this.#providerTopicsStats.delete(topic);\n        }\n      }\n\n      this.#providerTopics = sortedTopics;\n\n      this.#providerDatatypes = bagConnectionsToDatatypes(datatypeDescriptions, {\n        ros2: this.#rosVersion === 2,\n      });\n      this.#messageReadersByDatatype = messageReaders;\n\n      // Try subscribing again, since we might now be able to subscribe to some new topics.\n      this.setSubscriptions(this.#requestedSubscriptions);\n\n      // Refresh the full graph topology\n      this.#refreshSystemState().catch((error) => log.error(error));\n    } catch (error) {\n      log.error(error);\n      clearTimeout(topicsStallWarningTimeout);\n      this.#problems.removeProblem(\"topicsAndRawTypesTimeout\");\n\n      this.#problems.addProblem(\"requestTopics:error\", {\n        severity: \"error\",\n        message: \"Failed to fetch topics from rosbridge\",\n        error,\n      });\n    } finally {\n      this.#emitState();\n\n      // Regardless of what happens, request topics again in a little bit.\n      this.#requestTopicsTimeout = setTimeout(() => void this.#requestTopics(), 3000);\n    }\n  }\n\n  // Potentially performance-sensitive; await can be expensive\n  // eslint-disable-next-line @typescript-eslint/promise-function-async\n  #emitState = debouncePromise(() => {\n    if (!this.#listener || this.#closed) {\n      return Promise.resolve();\n    }\n\n    const providerTopics = this.#providerTopics;\n    const providerDatatypes = this.#providerDatatypes;\n    const start = this.#start;\n    if (!providerTopics || !providerDatatypes || !start) {\n      return this.#listener({\n        name: this.#url,\n        presence: this.#presence,\n        progress: {},\n        capabilities: CAPABILITIES,\n        profile: undefined,\n        playerId: this.#id,\n        activeData: undefined,\n        problems: this.#problems.problems(),\n        urlState: {\n          sourceId: this.#sourceId,\n          parameters: { url: this.#url },\n        },\n      });\n    }\n\n    // When connected\n    // Time is always moving forward even if we don't get messages from the server.\n    if (this.#presence === PlayerPresence.PRESENT) {\n      if (this.#emitTimer != undefined) {\n        clearTimeout(this.#emitTimer);\n      }\n      this.#emitTimer = setTimeout(this.#emitState, 100);\n    }\n\n    const currentTime = this.#getCurrentTime();\n    const messages = this.#parsedMessages;\n    this.#parsedMessages = [];\n    return this.#listener({\n      name: this.#url,\n      presence: this.#presence,\n      progress: {},\n      capabilities: CAPABILITIES,\n      profile: this.#rosVersion === 2 ? \"ros2\" : \"ros1\",\n      playerId: this.#id,\n      problems: this.#problems.problems(),\n      urlState: {\n        sourceId: this.#sourceId,\n        parameters: { url: this.#url },\n      },\n\n      activeData: {\n        messages,\n        totalBytesReceived: this.#receivedBytes,\n        startTime: start,\n        endTime: currentTime,\n        currentTime,\n        isPlaying: true,\n        speed: 1,\n        // We don't support seeking, so we need to set this to any fixed value. Just avoid 0 so\n        // that we don't accidentally hit falsy checks.\n        lastSeekTime: 1,\n        topics: providerTopics,\n        // Always copy topic stats since message counts and timestamps are being updated\n        topicStats: new Map(this.#providerTopicsStats),\n        datatypes: providerDatatypes,\n        publishedTopics: this.#publishedTopics,\n        subscribedTopics: this.#subscribedTopics,\n        services: this.#services,\n      },\n    });\n  });\n\n  public setListener(listener: (arg0: PlayerState) => Promise<void>): void {\n    this.#listener = listener;\n    this.#emitState();\n  }\n\n  public close(): void {\n    this.#closed = true;\n    if (this.#rosClient) {\n      this.#rosClient.close();\n    }\n    if (this.#emitTimer != undefined) {\n      clearTimeout(this.#emitTimer);\n      this.#emitTimer = undefined;\n    }\n    this.#metricsCollector.close();\n    this.#hasReceivedMessage = false;\n  }\n\n  public setSubscriptions(subscriptions: SubscribePayload[]): void {\n    this.#requestedSubscriptions = subscriptions;\n\n    if (!this.#rosClient || this.#closed) {\n      return;\n    }\n\n    // Subscribe to additional topics used by RosbridgePlayer itself\n    this.#addInternalSubscriptions(subscriptions);\n\n    this.#parsedTopics = new Set(subscriptions.map(({ topic }) => topic));\n\n    // See what topics we actually can subscribe to.\n    const availableTopicsByTopicName = keyBy(this.#providerTopics ?? [], ({ name }) => name);\n    const topicNames = subscriptions\n      .map(({ topic }) => topic)\n      .filter((topicName) => availableTopicsByTopicName[topicName]);\n\n    // Subscribe to all topics that we aren't subscribed to yet.\n    for (const topicName of topicNames) {\n      if (this.#topicSubscriptions.has(topicName)) {\n        continue;\n      }\n      const topic = new roslib.Topic({\n        ros: this.#rosClient,\n        name: topicName,\n        compression: \"cbor-raw\",\n      });\n      const availTopic = availableTopicsByTopicName[topicName];\n      if (!availTopic) {\n        continue;\n      }\n\n      const { schemaName } = availTopic;\n      const messageReader = this.#messageReadersByDatatype[schemaName];\n      if (!messageReader) {\n        continue;\n      }\n\n      const problemId = `message:${topicName}`;\n      topic.subscribe((message) => {\n        if (!this.#providerTopics) {\n          return;\n        }\n        try {\n          const buffer = (message as { bytes: ArrayBuffer }).bytes;\n          const bytes = new Uint8Array(buffer);\n\n          // This conditional can be removed when the ROS2 deserializer supports size()\n          if (messageReader instanceof LazyMessageReader) {\n            const msgSize = messageReader.size(bytes);\n            if (msgSize > bytes.byteLength) {\n              this.#problems.addProblem(problemId, {\n                severity: \"error\",\n                message: `Message buffer not large enough on ${topicName}`,\n                error: new Error(\n                  `Cannot read ${msgSize} byte message from ${bytes.byteLength} byte buffer`,\n                ),\n              });\n              this.#emitState();\n              return;\n            }\n          }\n\n          const innerMessage = messageReader.readMessage(bytes);\n\n          // handle clock messages before choosing receiveTime so the clock can set its own receive time\n          if (isClockMessage(topicName, innerMessage)) {\n            const time = innerMessage.clock;\n            const seconds = toSec(innerMessage.clock);\n            if (!isNaN(seconds)) {\n              if (this.#clockTime == undefined) {\n                this.#start = time;\n              }\n\n              this.#clockTime = time;\n            }\n          }\n          const receiveTime = this.#getCurrentTime();\n\n          if (!this.#hasReceivedMessage) {\n            this.#hasReceivedMessage = true;\n            this.#metricsCollector.recordTimeToFirstMsgs();\n          }\n\n          if (this.#parsedTopics.has(topicName)) {\n            const msg: MessageEvent = {\n              topic: topicName,\n              receiveTime,\n              message: innerMessage,\n              schemaName,\n              sizeInBytes: bytes.byteLength,\n            };\n            this.#parsedMessages.push(msg);\n          }\n          this.#problems.removeProblem(problemId);\n\n          // Update the message count for this topic\n          let stats = this.#providerTopicsStats.get(topicName);\n          if (this.#topicSubscriptions.has(topicName)) {\n            if (!stats) {\n              stats = { numMessages: 0 };\n              this.#providerTopicsStats.set(topicName, stats);\n            }\n            stats.numMessages++;\n          }\n        } catch (error) {\n          this.#problems.addProblem(problemId, {\n            severity: \"error\",\n            message: `Failed to parse message on ${topicName}`,\n            error,\n          });\n        }\n\n        this.#emitState();\n      });\n      this.#topicSubscriptions.set(topicName, topic);\n    }\n\n    // Unsubscribe from topics that we are subscribed to but shouldn't be.\n    for (const [topicName, topic] of this.#topicSubscriptions) {\n      if (!topicNames.includes(topicName)) {\n        topic.unsubscribe();\n        this.#topicSubscriptions.delete(topicName);\n\n        // Reset the message count for this topic\n        this.#providerTopicsStats.delete(topicName);\n      }\n    }\n  }\n\n  public setPublishers(publishers: AdvertiseOptions[]): void {\n    // Since `setPublishers` is rarely called, we can get away with just throwing away the old\n    // Roslib.Topic objects and creating new ones.\n    for (const publisher of this.#topicPublishers.values()) {\n      publisher.unadvertise();\n    }\n    this.#topicPublishers.clear();\n    this.#advertisements = publishers;\n    this.#setupPublishers();\n  }\n\n  public setParameter(_key: string, _value: ParameterValue): void {\n    throw new Error(\"Parameter editing is not supported by the Rosbridge connection\");\n  }\n\n  public publish({ topic, msg }: PublishPayload): void {\n    const publisher = this.#topicPublishers.get(topic);\n    if (!publisher) {\n      if (this.#advertisements.some((opts) => opts.topic === topic)) {\n        // Topic was advertised but the connection is not yet established\n        return;\n      }\n      throw new Error(\n        `Tried to publish on a topic that is not registered as a publisher: ${topic}`,\n      );\n    }\n    publisher.publish(msg);\n  }\n\n  // Query the type name for this service. Cache the query to avoid looking it up again.\n  async #getServiceType(service: string): Promise<string> {\n    if (!this.#rosClient) {\n      throw new Error(\"Not connected\");\n    }\n\n    const existing = this.#serviceTypeCache.get(service);\n    if (existing) {\n      return await existing;\n    }\n\n    const rosClient = this.#rosClient;\n    const serviceTypePromise = new Promise<string>((resolve, reject) => {\n      rosClient.getServiceType(service, resolve, reject);\n    });\n\n    this.#serviceTypeCache.set(service, serviceTypePromise);\n\n    return await serviceTypePromise;\n  }\n\n  public async callService(service: string, request: unknown): Promise<unknown> {\n    if (!this.#rosClient) {\n      throw new Error(\"Not connected\");\n    }\n\n    if (!isRecord(request)) {\n      throw new Error(\"RosbridgePlayer#callService request must be an object\");\n    }\n\n    const serviceType = await this.#getServiceType(service);\n\n    // Create a proxy object for dispatching our service call\n    const proxy = new roslib.Service({\n      ros: this.#rosClient,\n      name: service,\n      serviceType,\n    });\n\n    // Send the service request\n    return await new Promise<Record<string, unknown>>((resolve, reject) => {\n      proxy.callService(\n        request,\n        (response: Record<string, unknown>) => resolve(response),\n        (error: Error) => reject(error),\n      );\n    });\n  }\n\n  // Bunch of unsupported stuff. Just don't do anything for these.\n  public startPlayback(): void {\n    // no-op\n  }\n  public pausePlayback(): void {\n    // no-op\n  }\n  public seekPlayback(_time: Time): void {\n    // no-op\n  }\n  public setPlaybackSpeed(_speedFraction: number): void {\n    // no-op\n  }\n  public setGlobalVariables(): void {\n    // no-op\n  }\n\n  #setupPublishers(): void {\n    // This function will be called again once a connection is established\n    if (!this.#rosClient) {\n      return;\n    }\n\n    if (this.#advertisements.length <= 0) {\n      return;\n    }\n\n    for (const { topic, schemaName: datatype } of this.#advertisements) {\n      const roslibTopic = new roslib.Topic({\n        ros: this.#rosClient,\n        name: topic,\n        messageType: datatype,\n        queue_size: 0,\n      });\n      this.#topicPublishers.set(topic, roslibTopic);\n      roslibTopic.advertise();\n    }\n  }\n\n  #addInternalSubscriptions(subscriptions: SubscribePayload[]): void {\n    // Always subscribe to /clock if available\n    if (subscriptions.find((sub) => sub.topic === \"/clock\") == undefined) {\n      subscriptions.unshift({\n        topic: \"/clock\",\n      });\n    }\n  }\n\n  #getCurrentTime(): Time {\n    return this.#clockTime ?? fromMillis(Date.now());\n  }\n\n  // Refreshes the full system state graph. Runs in the background so we don't\n  // block app startup while mapping large node graphs.\n  async #refreshSystemState(): Promise<void> {\n    if (this.#isRefreshing) {\n      return;\n    }\n\n    try {\n      this.#isRefreshing = true;\n\n      const nodes = await new Promise<string[]>((resolve, reject) => {\n        this.#rosClient?.getNodes((fetchedNodes) => resolve(fetchedNodes), reject);\n      });\n\n      const promises = nodes.map(async (node) => {\n        return await new Promise<RosNodeDetails>((resolve, reject) => {\n          this.#rosClient?.getNodeDetails(\n            node,\n            (subscriptions, publications, services) => {\n              resolve({\n                publications: { node, values: publications },\n                services: { node, values: services },\n                subscriptions: { node, values: subscriptions },\n              });\n            },\n            reject,\n          );\n        });\n      });\n\n      const results = await Promise.allSettled(promises);\n      const fulfilled = filterMap(results, (item) =>\n        item.status === \"fulfilled\" ? item.value : undefined,\n      );\n      this.#publishedTopics = collateNodeDetails(fulfilled, \"publications\");\n      this.#subscribedTopics = collateNodeDetails(fulfilled, \"subscriptions\");\n      this.#services = collateNodeDetails(fulfilled, \"services\");\n\n      this.#emitState();\n    } catch (error) {\n      this.#problems.addProblem(\"requestTopics:system-state\", {\n        severity: \"error\",\n        message: \"Failed to fetch node details from rosbridge\",\n        error,\n      });\n    } finally {\n      this.#isRefreshing = false;\n    }\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport {\n  IDataSourceFactory,\n  DataSourceFactoryInitializeArgs,\n} from \"@foxglove/studio-base/context/PlayerSelectionContext\";\nimport RosbridgePlayer from \"@foxglove/studio-base/players/RosbridgePlayer\";\nimport { Player } from \"@foxglove/studio-base/players/types\";\n\nclass RosbridgeDataSourceFactory implements IDataSourceFactory {\n  public id = \"rosbridge-websocket\";\n  public type: IDataSourceFactory[\"type\"] = \"connection\";\n  public displayName = \"Rosbridge\";\n  public iconName: IDataSourceFactory[\"iconName\"] = \"Flow\";\n  public docsLinks = [{ url: \"https://foxglove.dev/docs/studio/connection/rosbridge\" }];\n  public description = \"Connect to a ROS 1 or ROS 2 system using the Rosbridge WebSocket protocol.\";\n\n  public formConfig = {\n    fields: [\n      {\n        id: \"url\",\n        label: \"WebSocket URL\",\n        defaultValue: \"ws://localhost:9090\",\n        validate: (newValue: string): Error | undefined => {\n          try {\n            const url = new URL(newValue);\n            if (url.protocol !== \"ws:\" && url.protocol !== \"wss:\") {\n              return new Error(`Invalid protocol: ${url.protocol}`);\n            }\n            return undefined;\n          } catch (err) {\n            return new Error(\"Enter a valid url\");\n          }\n        },\n      },\n    ],\n  };\n\n  public initialize(args: DataSourceFactoryInitializeArgs): Player | undefined {\n    const url = args.params?.url;\n    if (!url) {\n      return;\n    }\n\n    return new RosbridgePlayer({ url, metricsCollector: args.metricsCollector, sourceId: this.id });\n  }\n}\n\nexport default RosbridgeDataSourceFactory;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport {\n  IDataSourceFactory,\n  DataSourceFactoryInitializeArgs,\n} from \"@foxglove/studio-base/context/PlayerSelectionContext\";\nimport { IterablePlayer, WorkerIterableSource } from \"@foxglove/studio-base/players/IterablePlayer\";\nimport { Player } from \"@foxglove/studio-base/players/types\";\n\nclass UlogLocalDataSourceFactory implements IDataSourceFactory {\n  public id = \"ulog-local-file\";\n  public type: IDataSourceFactory[\"type\"] = \"file\";\n  public displayName = \"PX4 ULog\";\n  public iconName: IDataSourceFactory[\"iconName\"] = \"OpenFile\";\n  public supportedFileTypes = [\".ulg\", \".ulog\"];\n\n  public initialize(args: DataSourceFactoryInitializeArgs): Player | undefined {\n    const file = args.file;\n    if (!file) {\n      return;\n    }\n\n    const source = new WorkerIterableSource({\n      initWorker: () => {\n        return new Worker(\n          // foxglove-depcheck-used: babel-plugin-transform-import-meta\n          new URL(\n            \"@foxglove/studio-base/players/IterablePlayer/ulog/UlogIterableSourceWorker.worker\",\n            import.meta.url,\n          ),\n        );\n      },\n      initArgs: { file },\n    });\n\n    return new IterablePlayer({\n      metricsCollector: args.metricsCollector,\n      source,\n      name: file.name,\n      sourceId: this.id,\n    });\n  }\n}\n\nexport default UlogLocalDataSourceFactory;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Link } from \"@mui/material\";\nimport path from \"path\";\n\nimport {\n  IDataSourceFactory,\n  DataSourceFactoryInitializeArgs,\n} from \"@foxglove/studio-base/context/PlayerSelectionContext\";\nimport { IterablePlayer, WorkerIterableSource } from \"@foxglove/studio-base/players/IterablePlayer\";\nimport { Player } from \"@foxglove/studio-base/players/types\";\n\nconst initWorkers: Record<string, () => Worker> = {\n  \".bag\": () => {\n    return new Worker(\n      // foxglove-depcheck-used: babel-plugin-transform-import-meta\n      new URL(\n        \"@foxglove/studio-base/players/IterablePlayer/BagIterableSourceWorker.worker\",\n        import.meta.url,\n      ),\n    );\n  },\n  \".mcap\": () => {\n    return new Worker(\n      // foxglove-depcheck-used: babel-plugin-transform-import-meta\n      new URL(\n        \"@foxglove/studio-base/players/IterablePlayer/Mcap/McapIterableSourceWorker.worker\",\n        import.meta.url,\n      ),\n    );\n  },\n};\n\nclass RemoteDataSourceFactory implements IDataSourceFactory {\n  public id = \"remote-file\";\n\n  // The remote file feature use to be handled by two separate factories with these IDs.\n  // We consolidated this into one factory that appears in the \"connection\" list and has a `url` field.\n  //\n  // To keep backwards compatability with deep-link urls that used these ids we provide them as legacy aliases\n  public legacyIds = [\"mcap-remote-file\", \"ros1-remote-bagfile\"];\n\n  public type: IDataSourceFactory[\"type\"] = \"connection\";\n  public displayName = \"Remote file\";\n  public iconName: IDataSourceFactory[\"iconName\"] = \"FileASPX\";\n  public supportedFileTypes = [\".bag\", \".mcap\"];\n  public description = \"Open pre-recorded .bag or .mcap files from a remote location.\";\n  public docsLinks = [\n    { label: \"ROS 1\", url: \"https://foxglove.dev/docs/studio/connection/ros1#cloud-data\" },\n    { label: \"MCAP\", url: \"https://foxglove.dev/docs/studio/connection/mcap#cloud-data\" },\n  ];\n\n  public formConfig = {\n    fields: [\n      {\n        id: \"url\",\n        label: \"Remote file URL\",\n        placeholder: \"https://example.com/file.bag\",\n        validate: (newValue: string): Error | undefined => {\n          return this.#validateUrl(newValue);\n        },\n      },\n    ],\n  };\n\n  public warning = (\n    <>\n      Loading large files over HTTP can be slow. For better performance, we recommend{\" \"}\n      <Link href=\"https://foxglove.dev/data-platform\" target=\"_blank\">\n        Foxglove Data Platform\n      </Link>\n      .\n    </>\n  );\n\n  public initialize(args: DataSourceFactoryInitializeArgs): Player | undefined {\n    const url = args.params?.url;\n    if (!url) {\n      throw new Error(\"Missing url argument\");\n    }\n\n    const extension = path.extname(new URL(url).pathname);\n    const initWorker = initWorkers[extension];\n    if (!initWorker) {\n      throw new Error(`Unsupported extension: ${extension}`);\n    }\n\n    const source = new WorkerIterableSource({ initWorker, initArgs: { url } });\n\n    return new IterablePlayer({\n      source,\n      name: url,\n      metricsCollector: args.metricsCollector,\n      // Use blank url params so the data source is set in the url\n      urlParams: { url },\n      sourceId: this.id,\n    });\n  }\n\n  #validateUrl(newValue: string): Error | undefined {\n    try {\n      const url = new URL(newValue);\n      const extension = path.extname(url.pathname);\n\n      if (extension.length === 0) {\n        return new Error(\"URL must end with a filename and extension\");\n      }\n\n      if (!this.supportedFileTypes.includes(extension)) {\n        const supportedExtensions = new Intl.ListFormat(\"en-US\", { style: \"long\" }).format(\n          this.supportedFileTypes,\n        );\n        return new Error(`Only ${supportedExtensions} files are supported.`);\n      }\n\n      return undefined;\n    } catch (err) {\n      return new Error(\"Enter a valid url\");\n    }\n  }\n}\n\nexport default RemoteDataSourceFactory;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { v4 as uuidv4 } from \"uuid\";\n\nimport { debouncePromise } from \"@foxglove/den/async\";\nimport { Sockets, UdpRemoteInfo, UdpSocketRenderer } from \"@foxglove/electron-socket/renderer\";\nimport Logger from \"@foxglove/log\";\nimport { Time, fromMillis, add as addTimes, toDate, fromDate, fromMicros } from \"@foxglove/rostime\";\nimport { ParameterValue } from \"@foxglove/studio\";\nimport { GlobalVariables } from \"@foxglove/studio-base/hooks/useGlobalVariables\";\nimport {\n  AdvertiseOptions,\n  MessageEvent,\n  Player,\n  PlayerMetricsCollectorInterface,\n  PlayerPresence,\n  PlayerState,\n  PlayerProblem,\n  PublishPayload,\n  SubscribePayload,\n  Topic,\n  TopicStats,\n} from \"@foxglove/studio-base/players/types\";\nimport { RosDatatypes } from \"@foxglove/studio-base/types/RosDatatypes\";\nimport { Model, RawPacket, ReturnMode, packetRate } from \"@foxglove/velodyne-cloud\";\n\nconst log = Logger.getLogger(__filename);\n\nexport const DEFAULT_VELODYNE_PORT = 2369;\n\nconst RPM = 600;\nconst PROBLEM_SOCKET_ERROR = \"SOCKET_ERROR\";\nconst TOPIC_NAME = \"/velodyne_points\";\nconst TOPIC: Topic = { name: TOPIC_NAME, schemaName: \"velodyne_msgs/VelodyneScan\" };\nconst DATATYPES: RosDatatypes = new Map(\n  Object.entries({\n    \"velodyne_msgs/VelodyneScan\": {\n      name: \"velodyne_msgs/VelodyneScan\",\n      definitions: [\n        { type: \"std_msgs/Header\", name: \"header\", isArray: false, isComplex: true },\n        { type: \"velodyne_msgs/VelodynePacket\", name: \"packets\", isArray: true, isComplex: true },\n      ],\n    },\n    \"velodyne_msgs/VelodynePacket\": {\n      name: \"velodyne_msgs/VelodynePacket\",\n      definitions: [\n        { type: \"time\", name: \"stamp\", isArray: false, isComplex: false },\n        { type: \"uint8\", name: \"data\", isArray: true, arrayLength: 1206, isComplex: false },\n      ],\n    },\n    \"std_msgs/Header\": {\n      name: \"std_msgs/Header\",\n      definitions: [\n        { name: \"seq\", type: \"uint32\", isArray: false },\n        { name: \"stamp\", type: \"time\", isArray: false },\n        { name: \"frame_id\", type: \"string\", isArray: false },\n      ],\n    },\n  }),\n);\nconst CAPABILITIES: string[] = [];\n\ntype VelodynePlayerOpts = {\n  port?: number;\n  metricsCollector: PlayerMetricsCollectorInterface;\n};\n\nexport default class VelodynePlayer implements Player {\n  #id: string = uuidv4(); // Unique ID for this player\n  #port: number; // Listening UDP port\n  #listener?: (arg0: PlayerState) => Promise<void>; // Listener for _emitState()\n  #socket?: UdpSocketRenderer;\n  #seq = 0;\n  #totalBytesReceived = 0;\n  #closed: boolean = false; // Whether the player has been completely closed using close()\n  #topic: Topic = { ...TOPIC }; // The one topic we are \"subscribed\" to\n  #topics = [this.#topic]; // Stable list of all topics\n  #topicStats = new Map<string, TopicStats>(); // Message count and timestamps for our single topic\n  #start: Time; // The time at which we started playing\n  #packets: RawPacket[] = []; // Queue of packets that will form the next parsed message\n  #parsedMessages: MessageEvent[] = []; // Queue of messages that we'll send in next _emitState() call\n  #metricsCollector: PlayerMetricsCollectorInterface;\n  #presence: PlayerPresence = PlayerPresence.INITIALIZING;\n  #emitTimer?: ReturnType<typeof setTimeout>;\n\n  // track issues within the player\n  #problems: PlayerProblem[] = [];\n  #problemsById = new Map<string, PlayerProblem>();\n\n  public constructor({ port, metricsCollector }: VelodynePlayerOpts) {\n    this.#port = port ?? DEFAULT_VELODYNE_PORT;\n    log.info(`initializing VelodynePlayer on port ${this.#port}`);\n    this.#metricsCollector = metricsCollector;\n    this.#start = fromMillis(Date.now());\n    this.#metricsCollector.playerConstructed();\n    void this.#open();\n  }\n\n  #open = async (): Promise<void> => {\n    if (this.#closed) {\n      return;\n    }\n    this.#presence = PlayerPresence.PRESENT;\n    this.#emitState();\n\n    if (this.#socket == undefined) {\n      const net = await Sockets.Create();\n      this.#socket = await net.createUdpSocket();\n      this.#socket.on(\"error\", (error) => {\n        this.#addProblem(PROBLEM_SOCKET_ERROR, {\n          message: \"Networking error listening for Velodyne data\",\n          severity: \"error\",\n          error,\n          tip: \"Check that your are connected to the same local network (subnet) as the Velodyne sensor\",\n        });\n      });\n      this.#socket.on(\"message\", this.#handleMessage);\n    } else {\n      try {\n        await this.#socket.close();\n      } catch (err) {\n        log.error(`Failed to close socket: ${err}`);\n      }\n    }\n\n    try {\n      await this.#socket.bind({ address: \"0.0.0.0\", port: this.#port });\n      log.debug(`Bound Velodyne UDP listener socket to port ${this.#port}`);\n    } catch (error) {\n      this.#addProblem(PROBLEM_SOCKET_ERROR, {\n        message: \"Could not bind to the Velodyne UDP data port\",\n        severity: \"error\",\n        error,\n        tip: `Check that port ${this.#port} is not in use by another application`,\n      });\n    }\n  };\n\n  #handleMessage = (data: Uint8Array, rinfo: UdpRemoteInfo): void => {\n    const receiveTime = fromMillis(Date.now());\n    const date = toDate(receiveTime);\n    date.setMinutes(0, 0, 0);\n    const topOfHour = fromDate(date);\n\n    this.#totalBytesReceived += data.byteLength;\n    this.#presence = PlayerPresence.PRESENT;\n    this.#clearProblem(PROBLEM_SOCKET_ERROR, { skipEmit: true });\n\n    if (this.#seq === 0) {\n      this.#metricsCollector.recordTimeToFirstMsgs();\n    }\n\n    const rawPacket = new RawPacket(data);\n\n    const frequency = RPM / 60.0;\n    const rate =\n      rawPacket.returnMode === ReturnMode.DualReturn\n        ? packetRate(rawPacket.inferModel() ?? Model.HDL64E) * 2\n        : packetRate(rawPacket.inferModel() ?? Model.HDL64E);\n    const numPackets = Math.ceil(rate / frequency);\n\n    this.#packets.push(rawPacket);\n    if (this.#packets.length >= numPackets) {\n      const message = {\n        header: { seq: this.#seq++, stamp: receiveTime, frame_id: rinfo.address },\n        packets: this.#packets.map((raw) => rawPacketToRos(raw, topOfHour)),\n      };\n\n      const sizeInBytes = this.#packets.reduce((acc, packet) => acc + packet.data.byteLength, 0);\n      const msg: MessageEvent = {\n        topic: TOPIC_NAME,\n        receiveTime,\n        message,\n        sizeInBytes,\n        schemaName: TOPIC.schemaName ?? \"\",\n      };\n      this.#parsedMessages.push(msg);\n      this.#packets = [];\n\n      // Update the message count\n      let stats = this.#topicStats.get(TOPIC_NAME);\n      if (!stats) {\n        stats = { numMessages: 0 };\n        this.#topicStats.set(TOPIC_NAME, stats);\n      }\n      stats.numMessages++;\n      stats.firstMessageTime ??= receiveTime;\n      stats.lastMessageTime = receiveTime;\n\n      this.#emitState();\n    }\n  };\n\n  #addProblem(\n    id: string,\n    problem: PlayerProblem,\n    { skipEmit = false }: { skipEmit?: boolean } = {},\n  ): void {\n    this.#problemsById.set(id, problem);\n    this.#problems = Array.from(this.#problemsById.values());\n    if (!skipEmit) {\n      this.#emitState();\n    }\n  }\n\n  #clearProblem(id: string, { skipEmit = false }: { skipEmit?: boolean } = {}): void {\n    if (!this.#problemsById.delete(id)) {\n      return;\n    }\n    this.#problems = Array.from(this.#problemsById.values());\n    if (!skipEmit) {\n      this.#emitState();\n    }\n  }\n\n  // Potentially performance-sensitive; await can be expensive\n  // eslint-disable-next-line @typescript-eslint/promise-function-async\n  #emitState = debouncePromise(() => {\n    if (!this.#listener || this.#closed) {\n      return Promise.resolve();\n    }\n\n    // Time is always moving forward even if we don't get messages from the device.\n    // If we are not connected, don't emit updates since we are not longer getting new data\n    if (this.#presence === PlayerPresence.PRESENT) {\n      if (this.#emitTimer != undefined) {\n        clearTimeout(this.#emitTimer);\n      }\n      this.#emitTimer = setTimeout(this.#emitState, 100);\n    }\n\n    const currentTime = fromMillis(Date.now());\n    const messages = this.#parsedMessages;\n    this.#parsedMessages = [];\n    return this.#listener({\n      name: \"Velodyne\",\n      presence: this.#presence,\n      progress: {},\n      capabilities: CAPABILITIES,\n      profile: \"velodyne\",\n      playerId: this.#id,\n      problems: this.#problems,\n\n      activeData: {\n        messages,\n        totalBytesReceived: this.#totalBytesReceived,\n        startTime: this.#start,\n        endTime: currentTime,\n        currentTime,\n        isPlaying: true,\n        speed: 1,\n        // We don't support seeking, so we need to set this to any fixed value. Just avoid 0 so\n        // that we don't accidentally hit falsy checks.\n        lastSeekTime: 1,\n        topics: this.#topics,\n        topicStats: new Map(this.#topicStats),\n        datatypes: DATATYPES,\n        publishedTopics: undefined,\n        subscribedTopics: undefined,\n        services: undefined,\n        parameters: undefined,\n      },\n    });\n  });\n\n  public setListener(listener: (arg0: PlayerState) => Promise<void>): void {\n    this.#listener = listener;\n    this.#emitState();\n  }\n\n  public close(): void {\n    this.#closed = true;\n    if (this.#socket) {\n      void this.#socket.dispose();\n      this.#socket = undefined;\n    }\n    if (this.#emitTimer != undefined) {\n      clearTimeout(this.#emitTimer);\n      this.#emitTimer = undefined;\n    }\n    this.#metricsCollector.close();\n    this.#totalBytesReceived = 0;\n    this.#seq = 0;\n    this.#packets = [];\n    this.#parsedMessages = [];\n  }\n\n  public setSubscriptions(_subscriptions: SubscribePayload[]): void {}\n\n  public setPublishers(_publishers: AdvertiseOptions[]): void {\n    // no-op\n  }\n\n  // Modify a remote parameter such as a rosparam.\n  public setParameter(_key: string, _value: ParameterValue): void {\n    throw new Error(`Parameter modification is not supported for VelodynePlayer`);\n  }\n\n  public publish(_request: PublishPayload): void {\n    throw new Error(`Publishing is not supported for VelodynePlayer`);\n  }\n\n  public async callService(): Promise<unknown> {\n    throw new Error(\"Service calls are not supported for VelodynePlayer\");\n  }\n\n  public setGlobalVariables(_globalVariables: GlobalVariables): void {\n    // no-op\n  }\n}\n\nfunction rawPacketToRos(packet: RawPacket, topOfHour: Time): { stamp: Time; data: Uint8Array } {\n  const microSecSinceTopOfHour = packet.gpsTimestamp;\n  const stamp = addTimes(topOfHour, fromMicros(microSecSinceTopOfHour));\n  return { stamp, data: packet.data };\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport {\n  IDataSourceFactory,\n  DataSourceFactoryInitializeArgs,\n} from \"@foxglove/studio-base/context/PlayerSelectionContext\";\nimport VelodynePlayer from \"@foxglove/studio-base/players/VelodynePlayer\";\nimport { Player } from \"@foxglove/studio-base/players/types\";\n\nclass VelodyneDataSourceFactory implements IDataSourceFactory {\n  public id = \"velodyne-device\";\n  public type: IDataSourceFactory[\"type\"] = \"connection\";\n  public displayName = \"Velodyne Lidar\";\n  public iconName: IDataSourceFactory[\"iconName\"] = \"GenericScan\";\n  public description =\n    \"Connect directly to Velodyne Lidar hardware to inspect incoming sensor data.\";\n  public docsLinks = [{ url: \"https://foxglove.dev/docs/studio/connection/velodyne\" }];\n\n  public formConfig = {\n    fields: [{ id: \"port\", label: \"UDP Port\", defaultValue: \"2369\" }],\n  };\n\n  public initialize(args: DataSourceFactoryInitializeArgs): Player | undefined {\n    const portStr = args.params?.port;\n    if (portStr == undefined) {\n      return;\n    }\n\n    const port = parseInt(portStr);\n\n    return new VelodynePlayer({ port, metricsCollector: args.metricsCollector });\n  }\n}\n\nexport default VelodyneDataSourceFactory;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport {\n  IDataSourceFactory,\n  DataSourceFactoryInitializeArgs,\n} from \"@foxglove/studio-base/context/PlayerSelectionContext\";\nimport { IterablePlayer, WorkerIterableSource } from \"@foxglove/studio-base/players/IterablePlayer\";\nimport { Player } from \"@foxglove/studio-base/players/types\";\n\nclass McapLocalDataSourceFactory implements IDataSourceFactory {\n  public id = \"mcap-local-file\";\n  public type: IDataSourceFactory[\"type\"] = \"file\";\n  public displayName = \"MCAP\";\n  public iconName: IDataSourceFactory[\"iconName\"] = \"OpenFile\";\n  public supportedFileTypes = [\".mcap\"];\n\n  public initialize(args: DataSourceFactoryInitializeArgs): Player | undefined {\n    const file = args.file;\n    if (!file) {\n      return;\n    }\n\n    const source = new WorkerIterableSource({\n      initWorker: () => {\n        return new Worker(\n          // foxglove-depcheck-used: babel-plugin-transform-import-meta\n          new URL(\n            \"@foxglove/studio-base/players/IterablePlayer/Mcap/McapIterableSourceWorker.worker\",\n            import.meta.url,\n          ),\n        );\n      },\n      initArgs: { file },\n    });\n\n    return new IterablePlayer({\n      metricsCollector: args.metricsCollector,\n      source,\n      name: file.name,\n      sourceId: this.id,\n    });\n  }\n}\n\nexport default McapLocalDataSourceFactory;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport {\n  IDataSourceFactory,\n  DataSourceFactoryInitializeArgs,\n} from \"@foxglove/studio-base/context/PlayerSelectionContext\";\nimport { IterablePlayer, WorkerIterableSource } from \"@foxglove/studio-base/players/IterablePlayer\";\n\nimport SampleNuscenesLayout from \"./SampleNuscenesLayout.json\";\n\nclass SampleNuscenesDataSourceFactory implements IDataSourceFactory {\n  public id = \"sample-nuscenes\";\n  public type: IDataSourceFactory[\"type\"] = \"sample\";\n  public displayName = \"Sample: Nuscenes\";\n  public iconName: IDataSourceFactory[\"iconName\"] = \"FileASPX\";\n  public hidden = true;\n  public sampleLayout = SampleNuscenesLayout as IDataSourceFactory[\"sampleLayout\"];\n\n  public initialize(\n    args: DataSourceFactoryInitializeArgs,\n  ): ReturnType<IDataSourceFactory[\"initialize\"]> {\n    const bagUrl = \"https://assets.foxglove.dev/NuScenes-v1.0-mini-scene-0061-df24c12.mcap\";\n\n    const source = new WorkerIterableSource({\n      initWorker: () => {\n        return new Worker(\n          // foxglove-depcheck-used: babel-plugin-transform-import-meta\n          new URL(\n            \"@foxglove/studio-base/players/IterablePlayer/Mcap/McapIterableSourceWorker.worker\",\n            import.meta.url,\n          ),\n        );\n      },\n      initArgs: { url: bagUrl },\n    });\n\n    return new IterablePlayer({\n      source,\n      isSampleDataSource: true,\n      name: \"Adapted from nuScenes dataset. Copyright © 2020 nuScenes. https://www.nuscenes.org/terms-of-use\",\n      metricsCollector: args.metricsCollector,\n      // Use blank url params so the data source is set in the url\n      urlParams: {},\n      sourceId: this.id,\n    });\n  }\n}\n\nexport default SampleNuscenesDataSourceFactory;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { set, unset } from \"lodash\";\nimport * as THREE from \"three\";\nimport { DeepPartial } from \"ts-essentials\";\n\nimport { MessageEvent, SettingsTreeAction } from \"@foxglove/studio\";\n\nimport type { AnyRendererSubscription, IRenderer } from \"./IRenderer\";\nimport { Path } from \"./LayerErrors\";\nimport { BaseUserData, Renderable } from \"./Renderable\";\nimport type { SettingsTreeEntry } from \"./SettingsManager\";\nimport { missingTransformMessage, MISSING_TRANSFORM } from \"./renderables/transforms\";\nimport { AnyFrameId } from \"./transforms\";\nimport { updatePose } from \"./updatePose\";\n\nexport type PartialMessage<T> = DeepPartial<T>;\n\nexport type PartialMessageEvent<T> = MessageEvent<DeepPartial<T>>;\n\n/**\n * SceneExtension is a base class for extending the 3D scene. It extends THREE.Object3D and is a\n * child of the THREE.Scene with an identity position and orientation (origin is the render frame\n * origin). The `startFrame()` method will automatically call `updatePose()` for each Renderable in\n * the `renderables` map, placing it at the correct pose given the current renderer TransformTree.\n *\n * A minimum implementation can simply add THREE.Object3D instances using `this.add()`. If these\n * instances are Renderables and also added to this.renderables, their pose will be kept\n * up-to-date in `startFrame()`.\n *\n * - Override `dispose()` to dispose of any unmanaged resources such as GPU buffers. Don't forget\n *   to call `super.dispose()`.\n * - Override `startFrame()` to execute code at the start of each frame. Call `super.startFrame()`\n *   to run `updatePose()` on each entry in `this.renderables`.\n * - Override `settingsNodes()` to add entries to the settings sidebar.\n * - Message subscriptions are created with `getSubscriptions()`.\n * - Custom layer actions are added with `renderer.addCustomLayerAction()`.\n */\nexport class SceneExtension<\n  TRenderable extends Renderable<BaseUserData> = Renderable<BaseUserData>,\n  E extends THREE.BaseEvent = THREE.Event,\n> extends THREE.Object3D<E> {\n  /** A unique identifier for this SceneExtension, such as `foxglove.Markers`. */\n  public readonly extensionId: string;\n  /** A reference to the parent `Renderer` instance. */\n  protected readonly renderer: IRenderer;\n  /**\n   * A map of string identifiers to Renderable instances. SceneExtensions are free to use any IDs\n   * they choose, although topic names are a common choice for extensions display up to one\n   * renderable per topic.\n   */\n  public readonly renderables = new Map<string, TRenderable>();\n\n  /**\n   * @param extensionId A unique identifier for this SceneExtension, such as `foxglove.Markers`.\n   * @param renderer A reference to the parent `Renderer` instance.\n   */\n  public constructor(extensionId: string, renderer: IRenderer) {\n    super();\n    this.extensionId = this.name = extensionId;\n    this.renderer = renderer;\n    // updateSettingsTree() will call settingsNodes() which may be overridden in a child class.\n    // The child class may not assign its members until after this constructor returns. This breaks\n    // type assumptions, so we need to defer the call to updateSettingsTree()\n    queueMicrotask(() => this.updateSettingsTree());\n  }\n\n  /**\n   * Called when the scene is being destroyed. Free any unmanaged resources such as GPU buffers\n   * here. The base class implementation calls dispose() on all `renderables`.\n   */\n  public dispose(): void {\n    for (const renderable of this.renderables.values()) {\n      renderable.dispose();\n    }\n    this.children.length = 0;\n    this.renderables.clear();\n  }\n\n  /**\n   * Will add subscriptions from this scene extension to the renderer\n   * This will be called by the renderer when building topic and schema subscriptions on\n   * initialization and when imageOnlyMode becomes enabled\n   */\n  public getSubscriptions(): readonly AnyRendererSubscription[] {\n    return [];\n  }\n\n  /**\n   * Called when seeking or a new data source is loaded. The base class implementation removes all\n   * `renderables` and calls `updateSettingsTree()`.\n   */\n  public removeAllRenderables(): void {\n    for (const renderable of this.renderables.values()) {\n      renderable.dispose();\n      this.remove(renderable);\n    }\n    this.renderables.clear();\n    this.updateSettingsTree();\n  }\n\n  /**\n   * Returns a list of settings nodes generated by this extension and the paths they appear at in\n   * the settings sidebar. This method is only called when the scene fundamentally changes such as\n   * new topics appearing or seeking. To manually trigger this method being called, use\n   * `updateSettingsTree()`. The base class implementation returns an empty list.\n   */\n  public settingsNodes(): SettingsTreeEntry[] {\n    return [];\n  }\n\n  /**\n   * Handler for settings tree updates such as visibility toggling or field edits. This is a stub\n   * meant to be overridden in derived classes and used as the handler for settings tree nodes.\n   */\n  public handleSettingsAction = (action: SettingsTreeAction): void => {\n    void action;\n  };\n\n  /**\n   * Manually triggers an update of the settings tree for the nodes generated by this extension. The\n   * `settingsNodes()` method will be called to retrieve the latest nodes.\n   */\n  public updateSettingsTree(): void {\n    this.renderer.settings.setNodesForKey(this.extensionId, this.settingsNodes());\n  }\n\n  /**\n   * Persists a value to the panel configuration at the given path. The base class implementation\n   * calls `renderer.updateConfig()` and `updateSettingsTree()`.\n   */\n  public saveSetting(path: Path, value: unknown): void {\n    // Update the configuration\n    this.renderer.updateConfig((draft) => {\n      if (value == undefined) {\n        unset(draft, path);\n      } else {\n        set(draft, path, value);\n      }\n    });\n\n    // Update the settings sidebar\n    this.updateSettingsTree();\n  }\n\n  /**\n   * Can be overridden to react to color scheme changes. The base class implementation does nothing.\n   */\n  public setColorScheme(\n    colorScheme: \"dark\" | \"light\",\n    backgroundColor: THREE.Color | undefined,\n  ): void {\n    void colorScheme;\n    void backgroundColor;\n  }\n\n  /**\n   * Called before the Renderer renders a new frame. The base class implementation calls\n   * updatePose() for each entry in `this.renderables`.\n   * @param currentTime Current time of the scene being rendered in nanoseconds. This is the\n   *   playback timestamp not a message timestamp, so it only makes sense to compare it to\n   *   `receiveTime` values.\n   * @param renderFrameId Coordinate frame where the scene camera is currently located.\n   * @param fixedFrameId The root coordinate frame of the scene, called the fixed frame because it\n   *   does not move relative to any parent frame. The fixed frame is the root frame of the render\n   *   frame.\n   */\n  public startFrame(\n    currentTime: bigint,\n    renderFrameId: AnyFrameId,\n    fixedFrameId: AnyFrameId,\n  ): void {\n    for (const renderable of this.renderables.values()) {\n      const path = renderable.userData.settingsPath;\n\n      // Update the THREE.Object3D.visible flag from the user settings visible toggle. If this\n      // renderable is not visible, clear any layer errors and skip its per-frame update logic\n      renderable.visible = renderable.userData.settings.visible;\n      if (!renderable.visible) {\n        this.renderer.settings.errors.clearPath(path);\n        continue;\n      }\n\n      // SceneExtension Renderables exist in a coordinate frame (`frameId`) at some position and\n      // orientation (`pose`) at a point in time (`messageTime` if `frameLocked` is false, otherwise\n      // `currentTime`). The scene is rendered from the point of view of another coordinate frame\n      // (`renderFrameId`) that is part of a coordinate frame hierarchy with `fixedFrameId` at its\n      // root (`renderFrameId` can be equal to `fixedFrameId`). The fixed is assumed to be the\n      // static world coordinates that all other frames connect to.\n      //\n      // Before each visual frame is rendered, every Renderable is transformed from its own\n      // coordinate frame (at its own `messageTime` when `frameLocked` is false) to the fixed frame\n      // at `currentTime` and then to the render frame at `currentTime`. This transformation is\n      // done using transform interpolation, so as new transform messages are received the results\n      // of this interpolation can change from frame to frame\n      const frameLocked = renderable.userData.settings.frameLocked ?? true;\n      const srcTime = frameLocked ? currentTime : renderable.userData.messageTime;\n      const frameId = renderable.userData.frameId;\n      const updated = updatePose(\n        renderable,\n        this.renderer.transformTree,\n        renderFrameId,\n        fixedFrameId,\n        frameId,\n        currentTime,\n        srcTime,\n      );\n      if (!updated) {\n        const message = missingTransformMessage(renderFrameId, fixedFrameId, frameId);\n        this.renderer.settings.errors.add(path, MISSING_TRANSFORM, message);\n      } else {\n        this.renderer.settings.errors.remove(path, MISSING_TRANSFORM);\n      }\n    }\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport type { ColorRGBA, Vector3 } from \"./ros\";\nimport type { Pose } from \"./transforms\";\n\nexport type BaseShape = {\n  pose: Pose;\n  scale: Vector3;\n  color?: ColorRGBA;\n};\n\nexport type MouseEventObject = {\n  object: BaseShape;\n  instanceIndex?: number;\n};\n\nexport type CameraState = {\n  distance: number;\n  perspective: boolean;\n  phi: number;\n  target: readonly [number, number, number];\n  targetOffset: readonly [number, number, number];\n  targetOrientation: readonly [number, number, number, number];\n  thetaOffset: number;\n  fovy: number;\n  near: number;\n  far: number;\n};\n\nexport const DEFAULT_CAMERA_STATE: CameraState = {\n  distance: 20,\n  perspective: true,\n  phi: 60,\n  target: [0, 0, 0],\n  targetOffset: [0, 0, 0],\n  targetOrientation: [0, 0, 0, 1],\n  thetaOffset: 45,\n  fovy: 45,\n  near: 0.5,\n  far: 5000,\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { round, set } from \"lodash\";\n\nimport { SettingsTreeAction } from \"@foxglove/studio\";\n\nimport { PublishClickType } from \"./PublishClickTool\";\nimport type { IRenderer, RendererConfig } from \"../IRenderer\";\nimport { SceneExtension } from \"../SceneExtension\";\nimport { SettingsTreeEntry } from \"../SettingsManager\";\n\nexport const DEFAULT_PUBLISH_SETTINGS: RendererConfig[\"publish\"] = {\n  type: \"point\",\n  poseTopic: \"/move_base_simple/goal\",\n  pointTopic: \"/clicked_point\",\n  poseEstimateTopic: \"/initialpose\",\n  poseEstimateXDeviation: 0.5,\n  poseEstimateYDeviation: 0.5,\n  poseEstimateThetaDeviation: round(Math.PI / 12, 8),\n};\n\nexport class PublishSettings extends SceneExtension {\n  public constructor(renderer: IRenderer) {\n    super(\"foxglove.PublishSettings\", renderer);\n\n    renderer.publishClickTool.addEventListener(\n      \"foxglove.publish-type-change\",\n      this.#handlePublishToolChange,\n    );\n  }\n\n  public override dispose(): void {\n    this.renderer.publishClickTool.removeEventListener(\n      \"foxglove.publish-type-change\",\n      this.#handlePublishToolChange,\n    );\n    super.dispose();\n  }\n\n  public override settingsNodes(): SettingsTreeEntry[] {\n    const config = this.renderer.config;\n    const { publish } = config;\n    const handler = this.handleSettingsAction;\n\n    return [\n      {\n        path: [\"publish\"],\n        node: {\n          label: \"Publish\",\n          fields: {\n            type: {\n              label: \"Type\",\n              input: \"select\",\n              value: publish.type,\n              options: [\n                { label: \"Point (geometry_msgs/Point)\", value: \"point\" },\n                { label: \"Pose (geometry_msgs/PoseStamped)\", value: \"pose\" },\n                {\n                  label: \"Pose estimate (geometry_msgs/PoseWithCovarianceStamped)\",\n                  value: \"pose_estimate\",\n                },\n              ],\n              help: \"The type of message to publish when clicking in the scene\",\n            },\n            topic: {\n              label: \"Topic\",\n              input: \"string\",\n              value: {\n                point: publish.pointTopic,\n                pose: publish.poseTopic,\n                pose_estimate: publish.poseEstimateTopic,\n              }[publish.type],\n              help: `The topic on which to publish ${\n                { point: \"points\", pose: \"poses\", pose_estimate: \"pose estimates\" }[publish.type]\n              }`,\n            },\n            ...(publish.type === \"pose_estimate\" && {\n              poseEstimateXDeviation: {\n                label: \"X deviation\",\n                input: \"number\",\n                value: publish.poseEstimateXDeviation,\n                help: \"The X standard deviation to publish with pose estimates\",\n              },\n              poseEstimateYDeviation: {\n                label: \"Y deviation\",\n                input: \"number\",\n                value: publish.poseEstimateYDeviation,\n                help: \"The Y standard deviation to publish with pose estimates\",\n              },\n              poseEstimateThetaDeviation: {\n                label: \"Theta deviation\",\n                input: \"number\",\n                value: publish.poseEstimateThetaDeviation,\n                help: \"The theta standard deviation to publish with pose estimates\",\n              },\n            }),\n          },\n          defaultExpansionState: \"collapsed\",\n          handler,\n        },\n      },\n    ];\n  }\n\n  public override handleSettingsAction = (action: SettingsTreeAction): void => {\n    if (action.action !== \"update\" || action.payload.path.length === 0) {\n      return;\n    }\n\n    const path = action.payload.path;\n    const category = path[0]!;\n    const value = action.payload.value;\n    if (category === \"publish\") {\n      // Update the configuration\n      if (path[1] === \"topic\") {\n        this.renderer.updateConfig((draft) => {\n          switch (draft.publish.type) {\n            case \"point\":\n              draft.publish.pointTopic =\n                (value as string | undefined) ?? DEFAULT_PUBLISH_SETTINGS.pointTopic;\n              break;\n            case \"pose\":\n              draft.publish.poseTopic =\n                (value as string | undefined) ?? DEFAULT_PUBLISH_SETTINGS.poseTopic;\n              break;\n            case \"pose_estimate\":\n              draft.publish.poseEstimateTopic =\n                (value as string | undefined) ?? DEFAULT_PUBLISH_SETTINGS.poseEstimateTopic;\n              break;\n          }\n        });\n      } else if (path[1] === \"type\") {\n        // ThreeDeeRender will update the config based on this change\n        if (this.renderer.publishClickTool.publishClickType !== value) {\n          this.renderer.publishClickTool.setPublishClickType(value as PublishClickType);\n          this.renderer.publishClickTool.stop();\n        }\n      } else {\n        this.renderer.updateConfig((draft) => set(draft, path, value));\n      }\n    } else {\n      return;\n    }\n\n    // Update the settings sidebar\n    this.updateSettingsTree();\n  };\n\n  #handlePublishToolChange = (): void => {\n    this.renderer.updateConfig((draft) => {\n      draft.publish.type = this.renderer.publishClickTool.publishClickType;\n      return draft;\n    });\n    this.updateSettingsTree();\n  };\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { AnyFrameId, CoordinateFrame } from \"../transforms\";\n\nexport const MISSING_TRANSFORM = \"MISSING_TRANSFORM\";\n\nexport function missingTransformMessage(\n  renderFrameId: AnyFrameId,\n  fixedFrameId: AnyFrameId,\n  srcFrameId: AnyFrameId,\n): string {\n  const dstFrameId = renderFrameId === srcFrameId ? fixedFrameId : renderFrameId;\n  if (srcFrameId !== dstFrameId) {\n    return `Missing transform from frame <${CoordinateFrame.DisplayName(\n      srcFrameId,\n    )}> to frame <${CoordinateFrame.DisplayName(dstFrameId)}>`;\n  } else if (srcFrameId !== fixedFrameId) {\n    return `Missing transform from frame <${CoordinateFrame.DisplayName(\n      srcFrameId,\n    )}> to fixed frame <${CoordinateFrame.DisplayName(\n      fixedFrameId,\n    )}> to frame <${CoordinateFrame.DisplayName(dstFrameId)}>`;\n  } else {\n    return `Identity transform failed for frame <${CoordinateFrame.DisplayName(srcFrameId)}>`;\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { vec3, quat, mat4, ReadonlyMat4 } from \"gl-matrix\";\n\n// ts-prune-ignore-next\nexport type Point = {\n  x: number;\n  y: number;\n  z: number;\n};\n\n// ts-prune-ignore-next\nexport type Orientation = {\n  x: number;\n  y: number;\n  z: number;\n  w: number;\n};\n\nexport type Pose = {\n  position: Point;\n  orientation: Orientation;\n};\n\n// ts-prune-ignore-next\nexport function makePose(): Pose {\n  return { position: { x: 0, y: 0, z: 0 }, orientation: { x: 0, y: 0, z: 0, w: 1 } };\n}\n\nexport function xyzrpyToPose(xyz: vec3, rpy: vec3): Pose {\n  const o = quat.fromEuler([0, 0, 0, 1], rpy[0], rpy[1], rpy[2]);\n  return {\n    position: { x: xyz[0], y: xyz[1], z: xyz[2] },\n    orientation: { x: o[0], y: o[1], z: o[2], w: o[3] },\n  };\n}\n\n// Helper functions for constructing geometry primitives that can be used with\n// gl-matrix. These methods are preferred over the gl-matrix equivalents since\n// they produce number[] arrays instead of Float32Array, which have less\n// precision and are slower (float32 requires upcasting/downcasting to do math\n// in JavaScript).\n\nexport function vec3Identity(): vec3 {\n  return [0, 0, 0];\n}\n\n// ts-prune-ignore-next\nexport function vec3FromValues(x: number, y: number, z: number): vec3 {\n  return [x, y, z];\n}\n\n// ts-prune-ignore-next\nexport function vec3Clone(a: vec3): vec3 {\n  return [a[0], a[1], a[2]];\n}\n\n// ts-prune-ignore-next\nexport function quatIdentity(): quat {\n  return [0, 0, 0, 1];\n}\n\n// ts-prune-ignore-next\nexport function quatFromValues(x: number, y: number, z: number, w: number): quat {\n  return [x, y, z, w];\n}\n\n// ts-prune-ignore-next\nexport function quatClone(q: quat): quat {\n  return [q[0], q[1], q[2], q[3]];\n}\n\n// ts-prune-ignore-next\nexport function mat4Identity(): mat4 {\n  return [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\n}\n\n// ts-prune-ignore-next\nexport function mat4FromValues(\n  m00: number,\n  m01: number,\n  m02: number,\n  m03: number,\n  m10: number,\n  m11: number,\n  m12: number,\n  m13: number,\n  m20: number,\n  m21: number,\n  m22: number,\n  m23: number,\n  m30: number,\n  m31: number,\n  m32: number,\n  m33: number,\n): mat4 {\n  return [m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33];\n}\n\n// ts-prune-ignore-next\nexport function mat4Clone(m: mat4): mat4 {\n  return [\n    m[0],\n    m[1],\n    m[2],\n    m[3],\n    m[4],\n    m[5],\n    m[6],\n    m[7],\n    m[8],\n    m[9],\n    m[10],\n    m[11],\n    m[12],\n    m[13],\n    m[14],\n    m[15],\n  ];\n}\n\n/**\n * Test if two numbers are approximately equal.\n */\nexport function approxEq(v1: number, v2: number, epsilon = 0.00001): boolean {\n  return Math.abs(v1 - v2) <= epsilon;\n}\n\n/**\n * Test if two quaternions are approximately equal.\n */\nexport function quatAproxEq(q1: Orientation, q2: Orientation): boolean {\n  return (\n    approxEq(q1.x, q2.x) && approxEq(q1.y, q2.y) && approxEq(q1.z, q2.z) && approxEq(q1.w, q2.w)\n  );\n}\n\n/**\n * Test if two poses are approximately equal.\n */\nexport function poseApproxEq(p1: Pose, p2: Pose): boolean {\n  return (\n    approxEq(p1.position.x, p2.position.x) &&\n    approxEq(p1.position.y, p2.position.y) &&\n    approxEq(p1.position.z, p2.position.z) &&\n    quatAproxEq(p1.orientation, p2.orientation)\n  );\n}\n\n/**\n * Returns a quaternion representing the rotational component of a\n * transformation matrix. The matrix must not have any scaling applied to it.\n * @param out Quaternion to receive the rotation component\n * @param mat Matrix to be decomposed (input)\n * @param scaling Scaling of the matrix (input)\n * @return out\n */\nexport function getRotationNoScaling(out: quat, mat: ReadonlyMat4): quat {\n  const m11 = mat[0];\n  const m12 = mat[1];\n  const m13 = mat[2];\n  const m21 = mat[4];\n  const m22 = mat[5];\n  const m23 = mat[6];\n  const m31 = mat[8];\n  const m32 = mat[9];\n  const m33 = mat[10];\n  const trace = m11 + m22 + m33;\n  let S = 0;\n  if (trace > 0) {\n    S = Math.sqrt(trace + 1.0) * 2;\n    out[3] = 0.25 * S;\n    out[0] = (m23 - m32) / S;\n    out[1] = (m31 - m13) / S;\n    out[2] = (m12 - m21) / S;\n  } else if (m11 > m22 && m11 > m33) {\n    S = Math.sqrt(1.0 + m11 - m22 - m33) * 2;\n    out[3] = (m23 - m32) / S;\n    out[0] = 0.25 * S;\n    out[1] = (m12 + m21) / S;\n    out[2] = (m31 + m13) / S;\n  } else if (m22 > m33) {\n    S = Math.sqrt(1.0 + m22 - m11 - m33) * 2;\n    out[3] = (m31 - m13) / S;\n    out[0] = (m12 + m21) / S;\n    out[1] = 0.25 * S;\n    out[2] = (m23 + m32) / S;\n  } else {\n    S = Math.sqrt(1.0 + m33 - m11 - m22) * 2;\n    out[3] = (m12 - m21) / S;\n    out[0] = (m31 + m13) / S;\n    out[1] = (m23 + m32) / S;\n    out[2] = 0.25 * S;\n  }\n  return out;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\n/**\n * A list of values with type `V` sorted by numeric keys of type `K`\n * (either number or BigInt). Keys are unique, so setting a value with the same\n * key as an existing entry is a replacement operation.\n */\nexport class ArrayMap<K, V> {\n  #list: [K, V][] = [];\n\n  // eslint-disable-next-line no-restricted-syntax\n  public get size(): number {\n    return this.#list.length;\n  }\n\n  public clear(): void {\n    this.#list.length = 0;\n  }\n\n  /** Retrieve the key/value tuple at the given index, if it exists. */\n  public at(index: number): [K, V] | undefined {\n    return this.#list[index];\n  }\n\n  /**\n   * Store a key/value tuple in the sorted list. If the key already exists, the\n   * previous entry is overwritten.\n   */\n  public set(key: K, value: V): void {\n    const index = this.binarySearch(key);\n    if (index >= 0) {\n      this.#list[index]![1] = value;\n    } else {\n      const greaterThanIndex = ~index;\n      const newEntry: [K, V] = [key, value];\n      if (greaterThanIndex >= this.#list.length) {\n        this.#list.push(newEntry);\n      } else {\n        this.#list.splice(greaterThanIndex, 0, newEntry);\n      }\n    }\n  }\n\n  /** Removes the first element and returns it, if available. */\n  public shift(): [K, V] | undefined {\n    return this.#list.shift();\n  }\n\n  /** Removes the last element and returns it, if available. */\n  public pop(): [K, V] | undefined {\n    return this.#list.pop();\n  }\n\n  /** Removes the element with the given key, if it exists */\n  public remove(key: K): void {\n    const index = this.binarySearch(key);\n    if (index >= 0) {\n      this.#list.splice(index, 1);\n    }\n  }\n\n  /** Removes all elements with keys greater than the given key. */\n  public removeAfter(key: K): void {\n    const index = this.binarySearch(key);\n    const greaterThanIndex = index >= 0 ? index + 1 : ~index;\n    this.#list.length = greaterThanIndex;\n  }\n\n  /** Removes all elements with keys less than the given key. */\n  public removeBefore(key: K): void {\n    const index = this.binarySearch(key);\n    const lessThanIndex = index >= 0 ? index : ~index;\n    this.#list.splice(0, lessThanIndex);\n  }\n\n  /** Access the first key/value tuple in the list, without modifying the list. */\n  public minEntry(): [K, V] | undefined {\n    return this.#list[0];\n  }\n\n  /** Access the last key/value tuple in the list, without modifying the list. */\n  public maxEntry(): [K, V] | undefined {\n    return this.#list[this.#list.length - 1];\n  }\n\n  /** Access the first key in the list, without modifying the list. */\n  public minKey(): K | undefined {\n    return this.#list[0]?.[0];\n  }\n\n  /** Access the last key in the list, without modifying the list. */\n  public maxKey(): K | undefined {\n    return this.#list[this.#list.length - 1]?.[0];\n  }\n\n  /**\n   * Performs a binary search on the sorted list to find the index of the entry\n   * with the given key.\n   * @param key Key to search for.\n   * @returns The index of the key/value tuple if an exact match is found;\n   * otherwise, a negative number. If the key is not found and the key is less\n   * than one or more keys in the list, the negative number returned is the\n   * bitwise complement of the index of the first element with a larger key. If\n   * the key is not found and is greater than all keys in the list, the negative\n   * number returned is the bitwise complement of the index of the last element\n   * plus 1.\n   */\n  public binarySearch(key: K): number {\n    const list = this.#list;\n    if (list.length === 0) {\n      return -1;\n    }\n\n    let left = 0;\n    let right = list.length - 1;\n\n    // Quick checks to see if key is outside the bounds of the list\n    if (key < list[left]![0]) {\n      return ~left;\n    } else if (key > list[right]![0]) {\n      return ~(right + 1);\n    }\n\n    while (left <= right) {\n      const mid = (left + right) >> 1;\n      const midKey = list[mid]![0];\n\n      if (midKey === key) {\n        return mid;\n      } else if (key < midKey) {\n        right = mid - 1;\n      } else {\n        left = mid + 1;\n      }\n    }\n\n    return ~left;\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { mat4, vec3, quat, ReadonlyMat4, ReadonlyVec3, ReadonlyQuat } from \"gl-matrix\";\n\nimport { Pose, getRotationNoScaling, mat4Identity, quatIdentity, vec3Identity } from \"./geometry\";\n\n/**\n * Transform represents a position and rotation in 3D space. It can be set and\n * accessed using either Vec3/Quat or Mat4, and these different representations\n * are automatically kept in sync.\n */\nexport class Transform {\n  #position: vec3;\n  #rotation: quat;\n  #matrix: mat4;\n\n  public constructor(matrixOrPosition: mat4 | vec3, rotation?: quat) {\n    if (matrixOrPosition.length === 16) {\n      this.#matrix = matrixOrPosition;\n      this.#position = [0, 0, 0];\n      this.#rotation = [0, 0, 0, 1];\n      mat4.getTranslation(this.#position, this.#matrix);\n      getRotationNoScaling(this.#rotation, this.#matrix);\n    } else if (matrixOrPosition.length === 3 && rotation != undefined) {\n      this.#position = matrixOrPosition;\n      this.#rotation = rotation;\n      quat.normalize(this.#rotation, this.#rotation);\n      this.#matrix = mat4.fromRotationTranslation(mat4Identity(), this.#rotation, this.#position);\n    } else {\n      throw new Error(`new Transform() expected either mat4 or vec3 + quat`);\n    }\n  }\n\n  public position(): ReadonlyVec3 {\n    return this.#position;\n  }\n\n  public rotation(): ReadonlyQuat {\n    return this.#rotation;\n  }\n\n  public matrix(): ReadonlyMat4 {\n    return this.#matrix;\n  }\n\n  public setPosition(position: ReadonlyVec3): this {\n    vec3.copy(this.#position, position);\n    mat4.fromRotationTranslation(this.#matrix, this.#rotation, this.#position);\n    return this;\n  }\n\n  public setRotation(rotation: ReadonlyQuat): this {\n    quat.normalize(this.#rotation, rotation);\n    mat4.fromRotationTranslation(this.#matrix, this.#rotation, this.#position);\n    return this;\n  }\n\n  /**\n   * Update position and rotation simultaneously. This is more efficient than\n   * calling setPosition and setRotation separately, since we only need to\n   * update the matrix once\n   */\n  public setPositionRotation(position: ReadonlyVec3, rotation: ReadonlyQuat): this {\n    vec3.copy(this.#position, position);\n    quat.normalize(this.#rotation, rotation);\n    mat4.fromRotationTranslation(this.#matrix, this.#rotation, this.#position);\n    return this;\n  }\n\n  /**\n   * Update position and rotation from a Pose object\n   */\n  public setPose(pose: Readonly<Pose>): this {\n    vec3.set(this.#position, pose.position.x, pose.position.y, pose.position.z);\n    quat.set(\n      this.#rotation,\n      pose.orientation.x,\n      pose.orientation.y,\n      pose.orientation.z,\n      pose.orientation.w,\n    );\n    quat.normalize(this.#rotation, this.#rotation);\n    mat4.fromRotationTranslation(this.#matrix, this.#rotation, this.#position);\n    return this;\n  }\n\n  /**\n   * Update position and rotation from a matrix with unit scale\n   */\n  public setMatrixUnscaled(matrix: ReadonlyMat4): this {\n    mat4.copy(this.#matrix, matrix);\n    mat4.getTranslation(this.#position, matrix);\n    getRotationNoScaling(this.#rotation, matrix); // A faster mat4.getRotation when there is no scaling\n    return this;\n  }\n\n  /**\n   * Copy the values in another transform into this one\n   */\n  public copy(other: Transform): this {\n    vec3.copy(this.#position, other.#position);\n    quat.copy(this.#rotation, other.#rotation);\n    mat4.copy(this.#matrix, other.#matrix);\n    return this;\n  }\n\n  public toPose(out: Pose): void {\n    out.position.x = this.#position[0];\n    out.position.y = this.#position[1];\n    out.position.z = this.#position[2];\n    out.orientation.x = this.#rotation[0];\n    out.orientation.y = this.#rotation[1];\n    out.orientation.z = this.#rotation[2];\n    out.orientation.w = this.#rotation[3];\n  }\n\n  public static Identity(): Transform {\n    return new Transform(vec3Identity(), quatIdentity());\n  }\n\n  /**\n   * Interpolate between two rigid body transforms using linear interpolation on\n   * the translation vector and spherical linear interpolation on the rotation\n   * quaternion.\n   *\n   * @param out Output transform to store the result in\n   * @param a Start transform\n   * @param b End transform\n   * @param t Interpolant in the range [0, 1]\n   * @returns A reference to `out`\n   */\n  public static Interpolate(out: Transform, a: Transform, b: Transform, t: number): Transform {\n    vec3.lerp(out.#position, a.position(), b.position(), t);\n    quat.slerp(out.#rotation, a.rotation(), b.rotation(), t);\n    out.setPositionRotation(out.#position, out.#rotation);\n    return out;\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nexport type Time = bigint;\nexport type Duration = bigint;\n\nexport function compareTime(a: Time, b: Time): number {\n  return a < b ? -1 : a > b ? 1 : 0;\n}\n\nexport function percentOf(start: Time, end: Time, target: Time): number {\n  const totalDuration = end - start;\n  const targetDuration = target - start;\n  return Number(targetDuration) / Number(totalDuration);\n}\n\nexport function interpolate(start: Time, end: Time, fraction: number): Time {\n  const duration = Number(end - start);\n  return start + BigInt(Math.round(duration * fraction));\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\n/* eslint-disable @foxglove/no-boolean-parameters */\n\nimport { mat4, quat, vec3, vec4 } from \"gl-matrix\";\n\nimport { ArrayMap } from \"@foxglove/den/collection\";\n\nimport { Transform } from \"./Transform\";\nimport { Pose, mat4Identity } from \"./geometry\";\nimport { Duration, interpolate, percentOf, Time } from \"./time\";\n\ntype TimeAndTransform = [time: Time, transform: Transform];\n\nexport const MAX_DURATION: Duration = 4_294_967_295n * BigInt(1e9);\n\nconst DEG2RAD = Math.PI / 180;\nconst RAD2DEG = 180 / Math.PI;\n\nconst tempLower: TimeAndTransform = [0n, Transform.Identity()];\nconst tempUpper: TimeAndTransform = [0n, Transform.Identity()];\nconst tempVec3: vec3 = [0, 0, 0];\nconst tempVec4: vec4 = [0, 0, 0, 0];\nconst tempTransform = Transform.Identity();\nconst tempMatrix = mat4Identity();\nconst temp2Matrix = mat4Identity();\n\nconst FALLBACK_FRAME_ID = Symbol(\"FALLBACK_FRAME_ID\");\nexport type FallbackFrameId = typeof FALLBACK_FRAME_ID;\n\nexport type UserFrameId = string;\nexport type AnyFrameId = UserFrameId | FallbackFrameId;\n\n/**\n * CoordinateFrame is a named 3D coordinate frame with an optional parent frame\n * and a history of transforms from this frame to its parent. The parent/child\n * hierarchy and transform history allow points to be transformed from one\n * coordinate frame to another while interpolating over time.\n */\n// ts-prune-ignore-next\nexport class CoordinateFrame<ID extends AnyFrameId = UserFrameId> {\n  public static readonly FALLBACK_FRAME_ID: FallbackFrameId = FALLBACK_FRAME_ID;\n\n  public readonly id: ID;\n  public maxStorageTime: Duration;\n  public maxCapacity: number;\n  // The percentage of maxCapacity that can be exceeded before overfilled frames in history are cleared\n  // allows for better perf by amortizing trimming of frames every few thousand transforms rather than every new transform\n  public capacityOverfillPercentage: number;\n  public offsetPosition: vec3 | undefined;\n  public offsetEulerDegrees: vec3 | undefined;\n\n  #parent?: CoordinateFrame<UserFrameId>;\n  #transforms: ArrayMap<Time, Transform>;\n\n  public constructor(\n    id: ID,\n    parent: CoordinateFrame<UserFrameId> | undefined, // fallback frame not allowed as parent\n    maxStorageTime: Duration,\n    maxCapacity: number,\n    capacityOverfillPercentage = 0.1,\n  ) {\n    if (parent) {\n      this.#parent = parent;\n    }\n    this.id = id;\n    this.maxStorageTime = maxStorageTime;\n    this.maxCapacity = maxCapacity;\n    this.capacityOverfillPercentage = capacityOverfillPercentage;\n    this.#transforms = new ArrayMap<Time, Transform>();\n  }\n\n  public static assertUserFrame(\n    frame: CoordinateFrame<AnyFrameId>,\n  ): asserts frame is CoordinateFrame<UserFrameId> {\n    if (frame.id === FALLBACK_FRAME_ID) {\n      throw new Error(\"Expected user frame\");\n    }\n  }\n\n  public parent(): CoordinateFrame<UserFrameId> | undefined {\n    return this.#parent;\n  }\n\n  /**\n   * Returns the top-most frame by walking up each parent frame. If the current\n   * frame does not have a parent, the current frame is returned.\n   */\n  public root(): CoordinateFrame<ID> {\n    if (this.id === FALLBACK_FRAME_ID) {\n      return this;\n    }\n    CoordinateFrame.assertUserFrame(this);\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    let root: CoordinateFrame<UserFrameId> = this;\n    while (root.#parent) {\n      root = root.#parent;\n    }\n    return root as CoordinateFrame<ID>;\n  }\n\n  /**\n   * Returns true if this frame has no parent frame.\n   */\n  public isRoot(): boolean {\n    return this.#parent == undefined;\n  }\n\n  /**\n   * Returns the number of transforms stored in the transform history.\n   */\n  public transformsSize(): number {\n    return this.#transforms.size;\n  }\n\n  /**\n   * Set the parent frame for this frame. If the parent frame is already set to\n   * a different frame, the transform history is cleared.\n   */\n  public setParent(parent: CoordinateFrame<UserFrameId>): void {\n    if (this.#parent && this.#parent !== parent) {\n      this.#transforms.clear();\n    }\n    this.#parent = parent;\n  }\n\n  /**\n   * Search for an ancestor frame with the given ID by walking up the chain of\n   * parent frames, starting at the current frame.\n   * @param id Frame ID to search for\n   * @returns The ancestor frame, or undefined if not found\n   */\n  public findAncestor(id: string): CoordinateFrame<UserFrameId> | undefined {\n    let ancestor = this.#parent;\n    while (ancestor) {\n      if (ancestor.id === id) {\n        return ancestor;\n      }\n      ancestor = ancestor.#parent;\n    }\n    return undefined;\n  }\n\n  /**\n   * Add a transform to the transform history maintained by this frame. When the overfill\n   * limit has been reached, the history is trimmed by removing the larger portion of either\n   * frames that are outside of the `maxStorageTime` or the oldest frames over `maxCapacity`.\n   * This is to amortize the cost of trimming the history ever time a new transform is added.\n   *\n   * If a transform with an identical timestamp already exists, it is replaced.\n   */\n  public addTransform(time: Time, transform: Transform): void {\n    this.#transforms.set(time, transform);\n\n    // Remove transforms that are too old\n    // percent over the maxCapacity\n    const overfillPercent =\n      Math.max(0, this.#transforms.size - this.maxCapacity) / this.maxCapacity;\n\n    // Trim down to the maximum history size if we've exceeded the overfill\n    if (overfillPercent > this.capacityOverfillPercentage) {\n      const overfillIndex = this.#transforms.size - this.maxCapacity;\n      // guaranteed to be more than minKey\n      let removeBeforeTime = this.#transforms.at(overfillIndex)![0];\n      const endTime = this.#transforms.maxKey()!;\n      // not guaranteed to be more than minKey\n      const startTime = endTime - this.maxStorageTime;\n      // at the very least we remove the overfill, but if the maxStorageTime enforces a  larger trim we take that\n      // we can't afford to check maxStorageTime every time we add a transform, so we only check it when overfill is full\n      removeBeforeTime = startTime > removeBeforeTime ? startTime : removeBeforeTime;\n\n      this.#transforms.removeBefore(removeBeforeTime);\n    }\n  }\n\n  /** Remove all transforms with timestamps greater than the given timestamp. */\n  public removeTransformsAfter(time: Time): void {\n    this.#transforms.removeAfter(time);\n  }\n\n  /** Removes a transform with a specific timestamp */\n  public removeTransformAt(time: Time): void {\n    this.#transforms.remove(time);\n  }\n\n  /**\n   * Find the closest transform(s) in the transform history to the given time.\n   * Note that if an exact match is found, both `outLower` and `outUpper` will\n   * be set to the same transform.\n   * @param outLower This will be set to the found transform with the closest\n   *   timestamp <= the given time\n   * @param outUpper This will be set to the found transform with the closest\n   *   timestamp >= the given time\n   * @param time Time to search for\n   * @param maxDelta The time parameter can exceed the bounds of the transform\n   *   history by up to this amount and still clamp to the oldest or newest\n   *   transform\n   * @returns True if the search was successful\n   */\n  public findClosestTransforms(\n    outLower: TimeAndTransform,\n    outUpper: TimeAndTransform,\n    time: Time,\n    maxDelta: Duration,\n  ): boolean {\n    // perf-sensitive: function params instead of options object to avoid allocations\n    const transformCount = this.#transforms.size;\n    if (transformCount === 0) {\n      return false;\n    } else if (transformCount === 1) {\n      // If only a single transform exists, check if `time` is before or equal to\n      // `latestTime + maxDelta`\n      const [latestTime, latestTf] = this.#transforms.maxEntry()!;\n      if (time <= latestTime + maxDelta) {\n        outLower[0] = outUpper[0] = latestTime;\n        outLower[1] = outUpper[1] = latestTf;\n        return true;\n      }\n      return false;\n    }\n\n    const index = this.#transforms.binarySearch(time);\n    if (index >= 0) {\n      // If the time is exactly on an existing transform, return it\n      const [_, tf] = this.#transforms.at(index)!;\n      outLower[0] = outUpper[0] = time;\n      outLower[1] = outUpper[1] = tf;\n      return true;\n    }\n\n    const greaterThanIndex = ~index;\n    if (greaterThanIndex >= this.#transforms.size) {\n      // If the time is greater than all existing transforms, return the last\n      // transform\n      const [latestTime, latestTf] = this.#transforms.maxEntry()!;\n      if (time <= latestTime + maxDelta) {\n        outLower[0] = outUpper[0] = latestTime;\n        outLower[1] = outUpper[1] = latestTf;\n        return true;\n      }\n      return false;\n    }\n\n    const lessThanIndex = greaterThanIndex - 1;\n    if (lessThanIndex < 0) {\n      // If the time is less than all existing transforms, return the first\n      // transform\n      const [earliestTime, earliestTf] = this.#transforms.minEntry()!;\n      if (earliestTime + maxDelta >= time) {\n        outLower[0] = outUpper[0] = earliestTime;\n        outLower[1] = outUpper[1] = earliestTf;\n        return true;\n      }\n      return false;\n    }\n\n    const [lteTime, lteTf] = this.#transforms.at(lessThanIndex)!;\n    const [gtTime, gtTf] = this.#transforms.at(greaterThanIndex)!;\n    outLower[0] = lteTime;\n    outLower[1] = lteTf;\n    outUpper[0] = gtTime;\n    outUpper[1] = gtTf;\n    return true;\n  }\n\n  /**\n   * Transform a pose from the coordinate frame `srcFrame` to this coordinate\n   * frame at the given time. The transform will be done using the shortest path\n   * from `srcFrame` to this frame\n   *\n   * Transforms can go up through multiple parents, down through one or more\n   * children, or both as long as the transforms share a common ancestor.\n   *\n   * A common variable naming convention for the returned pose is\n   * `thisFrame_T_srcFrame` which is read right-to-left as \"the translation that\n   * moves a point from `srcFrame` to `thisFrame`\".\n   * @param out Output pose, this will be modified with the result on success\n   * @param input Input pose that exists in `srcFrame`\n   * @param srcFrame Coordinate frame we are transforming from\n   * @param time Time to compute the transform at\n   * @param maxDelta The time parameter can exceed the bounds of the transform\n   *   history by up to this amount and still clamp to the oldest or newest\n   *   transform\n   * @returns A reference to `out` on success, otherwise undefined\n   */\n  public applyLocal(\n    out: Pose,\n    input: Readonly<Pose>,\n    srcFrame: CoordinateFrame<AnyFrameId>,\n    time: Time,\n    maxDelta: Duration = MAX_DURATION,\n  ): Pose | undefined {\n    // perf-sensitive: function params instead of options object to avoid allocations\n    if (this.id === FALLBACK_FRAME_ID || srcFrame.id === FALLBACK_FRAME_ID) {\n      // Fallback frame will be used as both src and input frame because it is both the render and root/fixed frame\n      // This will result in no transformation being done to the input pose.\n      return out;\n    }\n    CoordinateFrame.assertUserFrame(this);\n    CoordinateFrame.assertUserFrame(srcFrame);\n    if (srcFrame === this) {\n      // Identity transform\n      copyPose(out, input);\n      return out;\n    } else if (srcFrame.findAncestor(this.id)) {\n      // This frame is an ancestor of the source frame\n      return CoordinateFrame.Apply(out, input, this, srcFrame, false, time, maxDelta)\n        ? out\n        : undefined;\n    } else if (this.findAncestor(srcFrame.id)) {\n      // This frame is a descendant of the source frame\n      return CoordinateFrame.Apply(out, input, srcFrame, this, true, time, maxDelta)\n        ? out\n        : undefined;\n    }\n    // Check if the two frames share a common ancestor\n    let curSrcFrame: CoordinateFrame<UserFrameId> | undefined = srcFrame;\n    while (curSrcFrame) {\n      const commonAncestor = this.findAncestor(curSrcFrame.id);\n      if (commonAncestor) {\n        // Common ancestor found. Apply transforms from the source frame to the common ancestor,\n        // then apply transforms from the common ancestor to this frame\n        if (!CoordinateFrame.Apply(out, input, commonAncestor, srcFrame, false, time, maxDelta)) {\n          return undefined;\n        }\n        return CoordinateFrame.Apply(out, out, commonAncestor, this, true, time, maxDelta)\n          ? out\n          : undefined;\n      }\n      curSrcFrame = curSrcFrame.#parent;\n    }\n\n    return undefined;\n  }\n\n  /**\n   * Transform a pose from the coordinate frame `srcFrame` to rootFrame at\n   * `srcTime`, then from `rootFrame` to this coordinate frame at `dstTime`. The\n   * transform will be done using the shortest path from `srcFrame` to the root\n   * frame, then from the root frame to this frame.\n   *\n   * Transforms can go up through multiple parents, down through one or more\n   * children, or both as long as the transforms share a common ancestor.\n   * @param out Output pose, this will be modified with the result on success\n   * @param input Input pose that exists in `srcFrame`\n   * @param rootFrame Reference coordinate frame to transform from srcFrame into as srcTime\n   * @param srcFrame Coordinate frame we are transforming from\n   * @param dstTime Time to transform from rootFrome into this frame\n   * @param srcTime Time to transform from srcFrame into rootFrame\n   * @param maxDelta The time parameter can exceed the bounds of the transform\n   *   history by up to this amount and still clamp to the oldest or newest\n   *   transform\n   * @returns A reference to `out` on success, otherwise undefined\n   */\n  public apply(\n    out: Pose,\n    input: Readonly<Pose>,\n    rootFrame: CoordinateFrame<AnyFrameId>,\n    srcFrame: CoordinateFrame<AnyFrameId>,\n    dstTime: Time,\n    srcTime: Time,\n    maxDelta: Duration = MAX_DURATION,\n  ): Pose | undefined {\n    // perf-sensitive: function params instead of options object to avoid allocations\n\n    // Transform from the source frame to the root frame\n    if (rootFrame.applyLocal(out, input, srcFrame, srcTime, maxDelta) == undefined) {\n      return undefined;\n    }\n    // Transform from the root frame to this frame\n    return this.applyLocal(out, out, rootFrame, dstTime, maxDelta);\n  }\n\n  /**\n   * Returns a display-friendly rendition of `id`, quoting the frame id if it is\n   * an empty string or starts or ends with whitespace.\n   */\n  public displayName(): string {\n    return CoordinateFrame.DisplayName(this.id);\n  }\n\n  /**\n   * Interpolate between two [time, transform] pairs.\n   * @param output Output parameter for the interpolated time and transform\n   * @param lower Start [time, transform]\n   * @param upper End [time, transform]\n   * @param time Interpolant in the range [lower[0], upper[0]]\n   */\n  public static Interpolate(\n    output: TimeAndTransform,\n    lower: TimeAndTransform,\n    upper: TimeAndTransform,\n    time: Time,\n  ): void {\n    // perf-sensitive: function params instead of options object to avoid allocations\n    const [lowerTime, lowerTf] = lower;\n    const [upperTime, upperTf] = upper;\n\n    if (lowerTime === upperTime) {\n      output[0] = upperTime;\n      output[1].copy(upperTf);\n      return;\n    }\n\n    // Interpolate times and transforms\n    const fraction = Math.max(0, Math.min(1, percentOf(lowerTime, upperTime, time)));\n    output[0] = interpolate(lowerTime, upperTime, fraction);\n    Transform.Interpolate(output[1], lowerTf, upperTf, fraction);\n  }\n\n  /**\n   * Interpolate the transform between two [time, transform] pairs.\n   * @param output Output parameter for the interpolated transform\n   * @param lower Start [time, transform]\n   * @param upper End [time, transform]\n   * @param time Interpolant in the range [lower[0], upper[0]]\n   */\n  public static InterpolateTransform(\n    output: Transform,\n    lower: TimeAndTransform,\n    upper: TimeAndTransform,\n    time: Time,\n  ): void {\n    // perf-sensitive: function params instead of options object to avoid allocations\n    const [lowerTime, lowerTf] = lower;\n    const [upperTime, upperTf] = upper;\n\n    if (lowerTime === upperTime) {\n      output.copy(upperTf);\n      return;\n    }\n\n    // Interpolate times and transforms\n    const fraction = Math.max(0, Math.min(1, percentOf(lowerTime, upperTime, time)));\n    Transform.Interpolate(output, lowerTf, upperTf, fraction);\n  }\n\n  /**\n   * Get the transform `parentFrame_T_childFrame` (from child to parent) at the\n   * given time.\n   * @param out Output transform matrix\n   * @param parentFrame Parent destination frame\n   * @param childFrame Child source frame\n   * @param time Time to transform at\n   * @param maxDelta The time parameter can exceed the bounds of the transform\n   *   history by up to this amount and still clamp to the oldest or newest\n   *   transform\n   * @returns True on success\n   */\n  public static GetTransformMatrix(\n    out: mat4,\n    parentFrame: CoordinateFrame,\n    childFrame: CoordinateFrame,\n    time: Time,\n    maxDelta: Duration,\n  ): boolean {\n    // perf-sensitive: function params instead of options object to avoid allocations\n    mat4.identity(out);\n\n    let curFrame = childFrame;\n    while (curFrame !== parentFrame) {\n      if (!curFrame.findClosestTransforms(tempLower, tempUpper, time, maxDelta)) {\n        return false;\n      }\n      CoordinateFrame.InterpolateTransform(tempTransform, tempLower, tempUpper, time);\n\n      if (curFrame.offsetEulerDegrees) {\n        const quaternion = tempTransform.rotation();\n        const rotationMatrix = mat4.fromQuat(temp2Matrix, quaternion);\n        const euler = eulerFromMatrixUnscaled(tempVec3, rotationMatrix);\n        vec3.add(euler, euler, curFrame.offsetEulerDegrees);\n        tempTransform.setRotation(quaternionFromEuler(tempVec4, euler));\n      }\n\n      if (curFrame.offsetPosition) {\n        const p = tempTransform.position() as vec3;\n        vec3.add(p, p, curFrame.offsetPosition);\n        tempTransform.setPosition(p);\n      }\n\n      mat4.multiply(out, tempTransform.matrix(), out);\n\n      if (curFrame.#parent == undefined) {\n        throw new Error(\n          `Frame \"${parentFrame.displayName()}\" is not a parent of \"${childFrame.displayName()}\"`,\n        );\n      }\n      curFrame = curFrame.#parent;\n    }\n\n    return true;\n  }\n\n  /**\n   * Apply the transform from `child` to `parent` at the given time to the given\n   * input pose. The transform can optionally be inverted, to go from `parent`\n   * to `child`.\n   * @param out Output pose, this will be modified with the result on success\n   * @param input Input pose that exists in `child`, or `parent` if `invert` is\n   *   true\n   * @param parent Parent frame\n   * @param child Child frame\n   * @invert Whether to invert the transform (go from parent to child)\n   * @param time Time to compute the transform at\n   * @param maxDelta The time parameter can exceed the bounds of the transform\n   *   history by up to this amount and still clamp to the oldest or newest\n   *   transform\n   * @returns True on success\n   */\n  public static Apply(\n    out: Pose,\n    input: Readonly<Pose>,\n    parent: CoordinateFrame,\n    child: CoordinateFrame,\n    invert: boolean,\n    time: Time,\n    maxDelta: Duration,\n  ): boolean {\n    // perf-sensitive: function params instead of options object to avoid allocations\n    if (!CoordinateFrame.GetTransformMatrix(tempMatrix, parent, child, time, maxDelta)) {\n      return false;\n    }\n    if (invert) {\n      mat4.invert(tempMatrix, tempMatrix);\n    }\n\n    mat4.multiply(tempMatrix, tempMatrix, tempTransform.setPose(input).matrix());\n    tempTransform.setMatrixUnscaled(tempMatrix).toPose(out);\n    return true;\n  }\n\n  /**\n   * Returns a display-friendly rendition of `frameId`, quoting the id if it is\n   * an empty string or starts or ends with whitespace.\n   */\n  public static DisplayName(frameId: AnyFrameId): string {\n    if (frameId === FALLBACK_FRAME_ID) {\n      return \"(none)\";\n    }\n    return frameId === \"\" || frameId.startsWith(\" \") || frameId.endsWith(\" \")\n      ? `\"${frameId}\"`\n      : frameId;\n  }\n}\n\nfunction copyPose(out: Pose, pose: Readonly<Pose>): void {\n  const p = pose.position;\n  const o = pose.orientation;\n  out.position.x = p.x;\n  out.position.y = p.y;\n  out.position.z = p.z;\n  out.orientation.x = o.x;\n  out.orientation.y = o.y;\n  out.orientation.z = o.z;\n  out.orientation.w = o.w;\n}\n\n// Compute XYZ Euler angles in degrees from an unscaled rotation matrix. This\n// method is adapted from THREE.js Euler#setFromRotationMatrix()\nfunction eulerFromMatrixUnscaled(out: vec3, m: mat4): vec3 {\n  const m11 = m[0];\n  const m12 = m[4];\n  const m13 = m[8];\n  const m22 = m[5];\n  const m23 = m[9];\n  const m32 = m[6];\n  const m33 = m[10];\n\n  out[1] = Math.asin(Math.max(-1, Math.min(1, m13)));\n\n  if (Math.abs(m13) < 0.9999999) {\n    out[0] = Math.atan2(-m23, m33);\n    out[2] = Math.atan2(-m12, m11);\n  } else {\n    out[0] = Math.atan2(m32, m22);\n    out[2] = 0;\n  }\n\n  // Convert to degrees\n  out[0] *= RAD2DEG;\n  out[1] *= RAD2DEG;\n  out[2] *= RAD2DEG;\n  return out;\n}\n\n// Compute a quaternion from XYZ Euler angles in degrees. This method is adapted\n// from THREE.js Quaternionr#setFromEuler()\nfunction quaternionFromEuler(out: quat, euler: vec3): quat {\n  const x = euler[0] * DEG2RAD;\n  const y = euler[1] * DEG2RAD;\n  const z = euler[2] * DEG2RAD;\n\n  const c1 = Math.cos(x / 2);\n  const c2 = Math.cos(y / 2);\n  const c3 = Math.cos(z / 2);\n\n  const s1 = Math.sin(x / 2);\n  const s2 = Math.sin(y / 2);\n  const s3 = Math.sin(z / 2);\n\n  out[0] = s1 * c2 * c3 + c1 * s2 * s3;\n  out[1] = c1 * s2 * c3 - s1 * c2 * s3;\n  out[2] = c1 * c2 * s3 + s1 * s2 * c3;\n  out[3] = c1 * c2 * c3 - s1 * s2 * s3;\n  return out;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { CoordinateFrame, MAX_DURATION, FallbackFrameId, AnyFrameId } from \"./CoordinateFrame\";\nimport { Transform } from \"./Transform\";\nimport { Pose } from \"./geometry\";\nimport { Duration, Time } from \"./time\";\n\nconst DEFAULT_MAX_CAPACITY_PER_FRAME = 50_000;\n\nexport enum AddTransformResult {\n  NOT_UPDATED,\n  UPDATED,\n  CYCLE_DETECTED,\n}\n\n// Coordinate frames named in [REP-105](https://www.ros.org/reps/rep-0105.html)\nconst DEFAULT_FRAME_IDS = [\"base_link\", \"odom\", \"map\", \"earth\"];\n\n/**\n * TransformTree is a collection of coordinate frames with convenience methods\n * for getting and creating frames and adding transforms between frames.\n */\nexport class TransformTree {\n  #frames = new Map<string, CoordinateFrame>();\n  #maxStorageTime: Duration;\n  #maxCapacityPerFrame: number;\n  public defaultRootFrame: CoordinateFrame<FallbackFrameId>;\n\n  public constructor(\n    maxStorageTime = MAX_DURATION,\n    maxCapacityPerFrame = DEFAULT_MAX_CAPACITY_PER_FRAME,\n  ) {\n    this.#maxStorageTime = maxStorageTime;\n    this.#maxCapacityPerFrame = maxCapacityPerFrame;\n    this.defaultRootFrame = new CoordinateFrame(\n      CoordinateFrame.FALLBACK_FRAME_ID,\n      undefined,\n      this.#maxStorageTime,\n      this.#maxCapacityPerFrame,\n    );\n    this.defaultRootFrame.addTransform(0n, Transform.Identity());\n  }\n\n  public addTransform(\n    frameId: string,\n    parentFrameId: string,\n    time: Time,\n    transform: Transform,\n  ): AddTransformResult {\n    let updated = !this.hasFrame(frameId);\n    let cycleDetected = false;\n    const frame = this.getOrCreateFrame(frameId);\n    const curParentFrame = frame.parent();\n    if (curParentFrame == undefined || curParentFrame.id !== parentFrameId) {\n      cycleDetected = this.#checkParentForCycle(frameId, parentFrameId);\n      // This frame was previously unparented but now we know its parent, or we\n      // are reparenting this frame\n      if (!cycleDetected) {\n        frame.setParent(this.getOrCreateFrame(parentFrameId));\n        updated = true;\n      }\n    }\n\n    if (!cycleDetected) {\n      frame.addTransform(time, transform);\n    }\n    return cycleDetected\n      ? AddTransformResult.CYCLE_DETECTED\n      : updated\n      ? AddTransformResult.UPDATED\n      : AddTransformResult.NOT_UPDATED;\n  }\n\n  /**\n   * Removes transform data from a particular parent-child link at the given timestamp. Does nothing\n   * if the child does not exist or has a different parent.\n   */\n  public removeTransform(childFrameId: string, parentFrameId: string, stamp: bigint): void {\n    const child = this.frame(childFrameId);\n    if (!child) {\n      return;\n    }\n    if (child.parent()?.id !== parentFrameId) {\n      return;\n    }\n    child.removeTransformAt(stamp);\n    this.#removeEmptyAncestors(child);\n  }\n\n  /**\n   * Walk up the tree starting from `candidate` and prune frames with no history entries and no\n   * children.\n   */\n  #removeEmptyAncestors(candidate: CoordinateFrame): void {\n    if (candidate.transformsSize() > 0) {\n      // don't want to delete this frame, it is not empty\n      return;\n    }\n\n    // Build a list of children for each frame in the tree, used to check whether nodes are leaf\n    // nodes\n    const childrenByParentId = new Map<string, Set<string>>();\n    for (const frame of this.#frames.values()) {\n      childrenByParentId.set(frame.id, new Set());\n    }\n    for (const frame of this.#frames.values()) {\n      const parent = frame.parent();\n      if (parent === candidate) {\n        // can't delete this frame or its ancestors, it still has children\n        return;\n      }\n      if (parent == undefined) {\n        continue;\n      }\n      const children = childrenByParentId.get(parent.id);\n      if (!children) {\n        throw new Error(\"invariant: should have children array\");\n      }\n      children.add(frame.id);\n    }\n\n    // Walk upwards, deleting nodes with no history entries and no children\n    for (\n      let current: typeof candidate | undefined = candidate;\n      current;\n      current = current.parent()\n    ) {\n      if (current.transformsSize() > 0) {\n        // don't want to delete this frame, it is not empty\n        return;\n      }\n      const children = childrenByParentId.get(current.id);\n      if (children && children.size > 0) {\n        // can't delete this frame or its ancestors, it still has children\n        return;\n      }\n      this.#frames.delete(current.id);\n      childrenByParentId.delete(current.id);\n      const parentId = current.parent()?.id;\n      if (parentId) {\n        childrenByParentId.get(parentId)?.delete(current.id);\n      }\n    }\n  }\n\n  public clear(): void {\n    this.#frames.clear();\n  }\n\n  public clearAfter(time: Time): void {\n    for (const frame of this.#frames.values()) {\n      frame.removeTransformsAfter(time);\n    }\n  }\n\n  public hasFrame(id: AnyFrameId): boolean {\n    if (id === CoordinateFrame.FALLBACK_FRAME_ID) {\n      return true;\n    }\n    return this.#frames.has(id);\n  }\n\n  public frame<ID extends AnyFrameId>(id: ID): CoordinateFrame<ID> | undefined {\n    if (id === CoordinateFrame.FALLBACK_FRAME_ID) {\n      return this.defaultRootFrame as CoordinateFrame<ID>;\n    }\n    return this.#frames.get(id) as CoordinateFrame<ID>;\n  }\n\n  public getOrCreateFrame(id: string): CoordinateFrame {\n    let frame = this.#frames.get(id);\n    if (!frame) {\n      frame = new CoordinateFrame(id, undefined, this.#maxStorageTime, this.#maxCapacityPerFrame);\n      this.#frames.set(id, frame);\n    }\n    return frame;\n  }\n\n  public frames(): ReadonlyMap<string, CoordinateFrame> {\n    return this.#frames;\n  }\n\n  public apply(\n    output: Pose,\n    input: Readonly<Pose>,\n    frameId: AnyFrameId,\n    rootFrameId: AnyFrameId | undefined,\n    srcFrameId: AnyFrameId,\n    dstTime: Time,\n    srcTime: Time,\n    maxDelta?: Duration,\n  ): Pose | undefined {\n    const frame = this.frame(frameId);\n    const srcFrame = this.frame(srcFrameId);\n    if (!frame || !srcFrame) {\n      return undefined;\n    }\n    const rootFrame =\n      (rootFrameId != undefined ? this.frame(rootFrameId) : frame.root()) ?? frame.root();\n    return frame.apply(output, input, rootFrame, srcFrame, dstTime, srcTime, maxDelta);\n  }\n\n  public frameList(): { label: string; value: string }[] {\n    type FrameEntry = { id: string; children: FrameEntry[] };\n\n    const frames = Array.from(this.#frames.values());\n    const frameMap = new Map<string, FrameEntry>(\n      frames.map((frame) => [frame.id, { id: frame.id, children: [] }]),\n    );\n\n    // Create a hierarchy of coordinate frames\n    const rootFrames: FrameEntry[] = [];\n    for (const frame of frames) {\n      const frameEntry = frameMap.get(frame.id)!;\n      const parentId = frame.parent()?.id;\n      if (parentId == undefined) {\n        rootFrames.push(frameEntry);\n      } else {\n        const parent = frameMap.get(parentId);\n        if (parent == undefined) {\n          continue;\n        }\n        parent.children.push(frameEntry);\n      }\n    }\n\n    // Convert the `rootFrames` hierarchy into a flat list of coordinate frames with depth\n    const output: { label: string; value: string }[] = [];\n\n    function addFrame(frame: FrameEntry, depth: number) {\n      const displayName = CoordinateFrame.DisplayName(frame.id);\n      output.push({\n        value: frame.id,\n        label: `${\"\\u00A0\\u00A0\".repeat(depth)}${displayName}`,\n      });\n      frame.children.sort((a, b) => a.id.localeCompare(b.id));\n      for (const child of frame.children) {\n        addFrame(child, depth + 1);\n      }\n    }\n\n    rootFrames.sort((a, b) => a.id.localeCompare(b.id));\n    for (const entry of rootFrames) {\n      addFrame(entry, 0);\n    }\n\n    return output;\n  }\n\n  /** Get heuristically most valid follow frame Id */\n  public getDefaultFollowFrameId(): string | undefined {\n    const allFrames = this.frames();\n    if (allFrames.size === 0) {\n      return undefined;\n    }\n\n    // Prefer frames from [REP-105](https://www.ros.org/reps/rep-0105.html)\n    for (const frameId of DEFAULT_FRAME_IDS) {\n      const frame = this.frame(frameId);\n      if (frame) {\n        return frame.id;\n      }\n    }\n\n    // Choose the root frame with the most children\n    const rootsToCounts = new Map<string, number>();\n    for (const frame of allFrames.values()) {\n      const root = frame.root();\n      const rootId = root.id;\n\n      rootsToCounts.set(rootId, (rootsToCounts.get(rootId) ?? 0) + 1);\n    }\n    const rootsArray = Array.from(rootsToCounts.entries());\n    const rootId = rootsArray.sort((a, b) => b[1] - a[1])[0]?.[0];\n    return rootId;\n  }\n\n  #checkParentForCycle(frameId: string, parentFrameId: string): boolean {\n    if (frameId === parentFrameId) {\n      return true;\n    }\n    // walk up tree from parent Frame to check if it eventually crosses the frame\n    let frame = this.frame(parentFrameId);\n    while (frame?.parent()) {\n      if (frame.parent()?.id === frameId) {\n        return true;\n      }\n      frame = frame.parent();\n    }\n    return false;\n  }\n\n  public static Clone(tree: TransformTree): TransformTree {\n    const newTree = new TransformTree(tree.#maxStorageTime, tree.#maxCapacityPerFrame);\n    newTree.#frames = tree.#frames;\n    return newTree;\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport * as THREE from \"three\";\n\nimport { TransformTree, makePose, Pose, AnyFrameId } from \"./transforms\";\n\nconst tempPose = makePose();\n\nexport function updatePose(\n  renderable: THREE.Object3D,\n  transformTree: TransformTree,\n  renderFrameId: AnyFrameId,\n  fixedFrameId: AnyFrameId,\n  srcFrameId: string,\n  dstTime: bigint,\n  srcTime: bigint,\n): boolean {\n  const pose = renderable.userData.pose as Readonly<Pose> | undefined;\n  if (!pose) {\n    throw new Error(`Missing userData.pose for ${renderable.name}`);\n  }\n  const poseApplied = Boolean(\n    transformTree.apply(tempPose, pose, renderFrameId, fixedFrameId, srcFrameId, dstTime, srcTime),\n  );\n  renderable.visible = poseApplied;\n  if (poseApplied) {\n    const p = tempPose.position;\n    const q = tempPose.orientation;\n    renderable.position.set(p.x, p.y, p.z);\n    renderable.quaternion.set(q.x, q.y, q.z, q.w);\n  }\n  return poseApplied;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Topic } from \"@foxglove/studio-base/players/types\";\nimport { RosDatatypes } from \"@foxglove/studio-base/types/RosDatatypes\";\n\ntype Args = {\n  topics: Topic[];\n  datatypes: RosDatatypes;\n};\n\n// http://wiki.ros.org/msg\nconst rosPrimitiveToTypescriptTypeMap = new Map<string, string>([\n  [\"uint8\", \"number\"],\n  [\"int8\", \"number\"],\n  [\"uint16\", \"number\"],\n  [\"int16\", \"number\"],\n  [\"uint32\", \"number\"],\n  [\"int32\", \"number\"],\n  [\"float32\", \"number\"],\n  [\"float64\", \"number\"],\n  [\"int64\", \"bigint\"],\n  [\"uint64\", \"bigint\"],\n  [\"string\", \"string\"],\n  [\"bool\", \"boolean\"],\n  [\"time\", \"Time\"],\n  [\"duration\", \"Duration\"],\n]);\n\nexport const typedArrayMap = new Map<string, string>([\n  [\"uint8\", \"Uint8Array\"],\n  [\"int8\", \"Int8Array\"],\n  [\"int16\", \"Int16Array\"],\n  [\"uint16\", \"Uint16Array\"],\n  [\"int32\", \"Int32Array\"],\n  [\"uint32\", \"Uint32Array\"],\n  [\"int64\", \"BigInt64Array\"],\n  [\"uint64\", \"BigUint64Array\"],\n  [\"float32\", \"Float32Array\"],\n  [\"float64\", \"Float64Array\"],\n]);\n\nfunction safeString(str: string): string {\n  return JSON.stringify(str) as string;\n}\n\nexport const generateTypesInterface = (datatypes: RosDatatypes): string => {\n  const seenDatatypes = new Set();\n  let src = `\n    /**\n     * MessageTypeBySchemaName enumerates the message types for for all the schema names\n     * in the current data source.\n     *\n     * You probably want to use Message<...> instead.\n     */\n    export type MessageTypeBySchemaName = {\n  `;\n\n  for (const [datatype, definition] of datatypes) {\n    // Avoid adding a repeating datatype name again.\n    // We shouldn't have this happen so we add a comment indicating it happened.\n    if (seenDatatypes.has(datatype)) {\n      src += `\\n// ${datatype} appeared multiple times`;\n      continue;\n    }\n    seenDatatypes.add(datatype);\n\n    src += `\\n${safeString(datatype)}: {`;\n\n    for (const field of definition.definitions) {\n      const { type, isConstant, isArray } = field;\n      const typedArray = typedArrayMap.get(type);\n      const rosPrimitive = rosPrimitiveToTypescriptTypeMap.get(type);\n\n      const fieldName = safeString(field.name);\n      const sigil = field.optional === true ? \"?\" : \"\";\n\n      if (isConstant === true) {\n        src += `\\n // ${field.name} = ${field.valueText}`;\n      } else if (isArray === true) {\n        if (typedArray) {\n          src += `\\n${fieldName}${sigil}: ${typedArray},`;\n        } else if (rosPrimitive) {\n          src += `\\n${fieldName}${sigil}: ${rosPrimitive}[],`;\n        } else {\n          src += `\\n${fieldName}${sigil}: MessageTypeBySchemaName[${safeString(type)}][],`;\n        }\n      } else {\n        if (rosPrimitive) {\n          src += `\\n${fieldName}${sigil}: ${rosPrimitive},`;\n        } else {\n          src += `\\n${fieldName}${sigil}: MessageTypeBySchemaName[${safeString(type)}],`;\n        }\n      }\n    }\n\n    src += \"\\n},\";\n  }\n\n  src += \"\\n};\";\n\n  return src;\n};\n\nfunction generateTypesByTopicInterface(topics: Topic[]): string {\n  let src = `\n    /**\n     * MessageTypeByTopic enumerates the Messages types for all the topics in\n     * the current data source.\n     *\n     * You probably want to use Input<\"/my-topic\"> instead of MessageTypeByTopic.\n     */\n    export type MessageTypeByTopic = {`;\n\n  for (const topic of topics) {\n    src += `${safeString(topic.name)}: MessageTypeBySchemaName[${safeString(\n      topic.schemaName ?? \"\",\n    )}]\\n`;\n  }\n\n  src += \"\\n};\";\n  return src;\n}\n\nfunction generateTypesLib(args: Args): string {\n  const typesByTopic = generateTypesByTopicInterface(args.topics);\n\n  // A topic may reference a datatype that we don't have in args.datatypes.\n  // This happens for some data sources if nothing's subscribe to a topic and we never get info\n  // about the specific datatype.\n  //\n  // We want the types library to still generate and compile so we use empty placeholders for such datatypes.\n  const allDatatypes = new Map(args.datatypes);\n  for (const topic of args.topics) {\n    if (topic.schemaName == undefined || !allDatatypes.has(topic.schemaName)) {\n      allDatatypes.set(topic.schemaName ?? \"\", {\n        name: topic.schemaName,\n        definitions: [],\n      });\n    }\n  }\n\n  const typesBySchemaName = generateTypesInterface(allDatatypes);\n\n  const src = `\n// NOTE:\n// This file is generated from the current data source.\n// It contains helper types for looking up message definitions by schema name or topic.\n//\n// You likely want to use the higher-level types in \\`./types\\` rather than the types in this file directly.\n\ntype Time = {\n  sec: number,\n  nsec: number,\n};\n\ntype Duration = Time;\n\n${typesBySchemaName}\n\n${typesByTopic}\n`;\n\n  return src;\n}\n\nlet emptyLib: string | undefined;\nfunction generateEmptyTypesLib(): string {\n  return (emptyLib ??= generateTypesLib({ topics: [], datatypes: new Map() }));\n}\n\nexport { generateTypesLib, generateEmptyTypesLib };\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\nexport const ros_lib_filename = \"ros/index.d.ts\";\nexport const ros_lib_dts = `\n  export declare interface Duration {\n    sec: number;\n    nsec: number;\n  }\n\n  export declare interface Time {\n    sec: number;\n    nsec: number;\n  }\n\n  // Once a data source Messages will be populated with interfaces matching the data source messages.\n  export declare namespace Messages {}\n\n  // Once a data source TopicsToMessageDefinition will be populated with topic names to message interfaces.\n  export declare interface TopicsToMessageDefinition {}\n\n  /**\n   * To correctly type your inputs, you use this type to refer to specific\n   * input topics, e.g. 'Input<\"/your_input_topic\">'. If you have\n   * multiple input topics, use a union type, e.g.\n   * 'Input<\"/your_input_topic_1\"> |\n   * Input<\"/your_input_topic_2\">'.\n   *\n   * These types are dynamically generated from the bag(s) currently in your\n   * Foxglove Studio session, so if a datatype changes, your User Script\n   * may not compile on the newly formatted bag.\n   */\n  export declare interface Input<T extends keyof TopicsToMessageDefinition> {\n    topic: T;\n    receiveTime: Time;\n    message: TopicsToMessageDefinition[T];\n  }\n\n`;\n","import { Time } from \"./types\";\n\n/*\n * Checks ROS-time equality.\n */\nexport const areSame = (t1: Time, t2: Time): boolean => t1.sec === t2.sec && t1.nsec === t2.nsec;\n\n/*\n * Compare two times, returning a negative value if the right is greater or a\n * positive value if the left is greater or 0 if the times are equal useful to\n * supply to Array.prototype.sort\n */\nexport const compare = (left: Time, right: Time): number => {\n  const secDiff = left.sec - right.sec;\n  return secDiff !== 0 ? secDiff : left.nsec - right.nsec;\n};\n\nconst fixTime = (t: Time): Time => {\n  // Equivalent to fromNanoSec(toNanoSec(t)), but no chance of precision loss.\n  // nsec should be non-negative, and less than 1e9.\n  let { sec, nsec } = t;\n  while (nsec > 1e9) {\n    nsec -= 1e9;\n    sec += 1;\n  }\n  while (nsec < 0) {\n    nsec += 1e9;\n    sec -= 1;\n  }\n  return { sec, nsec };\n};\n\nexport const subtractTimes = (\n  { sec: sec1, nsec: nsec1 }: Time,\n  { sec: sec2, nsec: nsec2 }: Time,\n): Time => {\n  return fixTime({ sec: sec1 - sec2, nsec: nsec1 - nsec2 });\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\nimport type { SourceFile, TypeChecker } from \"typescript\";\n\nimport { GlobalVariables } from \"@foxglove/studio-base/hooks/useGlobalVariables\";\nimport { Topic, MessageEvent } from \"@foxglove/studio-base/players/types\";\nimport { RosDatatypes } from \"@foxglove/studio-base/types/RosDatatypes\";\n\n// make sure to use import type to avoid bringing in the actual implementations to the bundle\n\nexport const DiagnosticSeverity = {\n  Hint: 1,\n  Info: 2,\n  Warning: 4,\n  Error: 8,\n};\n\nexport const Sources = {\n  Typescript: \"Typescript\",\n  DatatypeExtraction: \"DatatypeExtraction\",\n  InputTopicsChecker: \"InputTopicsChecker\",\n  OutputTopicChecker: \"OutputTopicChecker\",\n  Runtime: \"Runtime\",\n};\n\nexport const ErrorCodes = {\n  RUNTIME: 1,\n  DatatypeExtraction: {\n    NO_DEFAULT_EXPORT: 1,\n    NON_FUNC_DEFAULT_EXPORT: 2,\n    NO_TYPE_RETURN: 3,\n    BAD_TYPE_RETURN: 4,\n    UNKNOWN_ERROR: 5,\n    NO_UNIONS: 6,\n    NO_FUNCTIONS: 7,\n    NO_CLASSES: 8,\n    NO_TYPE_LITERALS: 9,\n    NO_TUPLES: 10,\n    NO_INTERSECTION_TYPES: 11,\n    NO_TYPEOF: 12,\n    PREFER_ARRAY_LITERALS: 13,\n    STRICT_MARKERS_RETURN_TYPE: 14,\n    LIMITED_UNIONS: 15,\n    NO_NESTED_ANY: 16,\n    NO_MAPPED_TYPES: 17,\n    INVALID_PROPERTY: 18,\n    INVALID_INDEXED_ACCESS: 19,\n  },\n  InputTopicsChecker: {\n    NO_TOPIC_AVAIL: 1,\n    NO_INPUTS_EXPORT: 2,\n    EMPTY_INPUTS_EXPORT: 3,\n    BAD_INPUTS_TYPE: 4,\n  },\n  OutputTopicChecker: {\n    NO_OUTPUTS: 1,\n    NOT_UNIQUE: 2,\n    EXISTING_TOPIC: 3,\n  },\n};\n\nexport type Diagnostic = {\n  severity: (typeof DiagnosticSeverity)[keyof typeof DiagnosticSeverity];\n  message: string;\n  source: (typeof Sources)[keyof typeof Sources];\n  startLineNumber?: number;\n  startColumn?: number;\n  endLineNumber?: number;\n  endColumn?: number;\n  code: number;\n};\n\nexport type NodeData = {\n  name: string;\n  sourceCode: string;\n  transpiledCode: string;\n  projectCode: Map<string, string> | undefined;\n  diagnostics: readonly Diagnostic[];\n  inputTopics: readonly string[];\n  outputTopic: string;\n  outputDatatype: string;\n  datatypes: RosDatatypes;\n  sourceFile?: SourceFile;\n  typeChecker?: TypeChecker;\n  rosLib: string;\n  typesLib: string;\n  // An array of globalVariable names\n  globalVariables: readonly string[];\n};\n\nexport type NodeRegistration = {\n  nodeId: string;\n  nodeData: NodeData;\n  inputs: readonly string[];\n  output: Topic;\n  processBlockMessage: (\n    messageEvent: MessageEvent,\n    globalVariables: GlobalVariables,\n  ) => Promise<MessageEvent | undefined>;\n  processMessage: (\n    messageEvent: MessageEvent,\n    globalVariables: GlobalVariables,\n  ) => Promise<MessageEvent | undefined>;\n  terminate: () => void;\n};\n\nexport type NodeDataTransformer = (nodeData: NodeData, topics: Topic[]) => NodeData;\n\nexport type UserNodeLog = {\n  source: \"registerNode\" | \"processMessage\";\n  value: unknown;\n};\n\nexport type RegistrationOutput = {\n  error?: string;\n  userNodeLogs: UserNodeLog[];\n  userNodeDiagnostics: Diagnostic[];\n};\n\nexport type ProcessMessageOutput = {\n  message: Record<string, unknown> | undefined;\n  error?: string;\n  userNodeLogs: UserNodeLog[];\n  userNodeDiagnostics: Diagnostic[];\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { MessageDefinition } from \"@foxglove/message-definition\";\nimport { Time } from \"@foxglove/rostime\";\nimport type { MessageEvent, ParameterValue } from \"@foxglove/studio\";\nimport { Immutable } from \"@foxglove/studio\";\nimport { GlobalVariables } from \"@foxglove/studio-base/hooks/useGlobalVariables\";\nimport { RosDatatypes } from \"@foxglove/studio-base/types/RosDatatypes\";\nimport { Range } from \"@foxglove/studio-base/util/ranges\";\nimport { NotificationSeverity } from \"@foxglove/studio-base/util/sendNotification\";\n\n// re-exported until other import sites are updated from players/types to @foxglove/studio\nexport type { MessageEvent };\n\nexport type MessageDefinitionsByTopic = {\n  [topic: string]: string;\n};\nexport type ParsedMessageDefinitionsByTopic = {\n  [topic: string]: MessageDefinition[];\n};\n\n// A `Player` is a class that manages playback state. It manages subscriptions,\n// current time, which topics and datatypes are available, and so on.\n// For more details, see the types below.\n\nexport interface Player {\n  // The main way to get information out the player is to set a listener. This listener will be\n  // called whenever the PlayerState changes, so that we can render the new state to the UI. Users\n  // should return a promise from the listener that resolves when the UI has finished updating, so\n  // that we don't get overwhelmed with new state that we can't keep up with. The Player is\n  // responsible for appropriately throttling based on when we resolve this promise.\n  setListener(listener: (playerState: PlayerState) => Promise<void>): void;\n  // Close the player; i.e. terminate any connections it might have open.\n  close(): void;\n  // Set a new set of subscriptions/advertisers. This might trigger fetching\n  // new data, which might in turn trigger a backfill of messages.\n  setSubscriptions(subscriptions: Immutable<SubscribePayload[]>): void;\n  setPublishers(publishers: AdvertiseOptions[]): void;\n  // Modify a remote parameter such as a rosparam.\n  setParameter(key: string, value: ParameterValue): void;\n  // If the Player supports publishing (i.e. PlayerState#capabilities contains\n  // PlayerCapabilities.advertise), publish a message.\n  publish(request: PublishPayload): void;\n  // If the player support service calls (i.e. PlayerState#capabilities contains PlayerCapabilities.callServices)\n  // this will make a service call to the named service with the request payload.\n  callService(service: string, request: unknown): Promise<unknown>;\n  // Basic playback controls. Available if `capabilities` contains PlayerCapabilities.playbackControl.\n  startPlayback?(): void;\n  pausePlayback?(): void;\n  seekPlayback?(time: Time): void;\n  playUntil?(time: Time): void;\n  // Seek to a particular time. Might trigger backfilling.\n  // If the Player supports non-real-time speeds (i.e. PlayerState#capabilities contains\n  // PlayerCapabilities.setSpeed), set that speed. E.g. 1.0 is real time, 0.2 is 20% of real time.\n  setPlaybackSpeed?(speedFraction: number): void;\n  // Set the globalVariables for Players that support it.\n  // This is generally used to pass new globalVariables to the UserNodePlayer\n  setGlobalVariables(globalVariables: GlobalVariables): void;\n}\n\nexport enum PlayerPresence {\n  NOT_PRESENT = \"NOT_PRESENT\",\n  INITIALIZING = \"INITIALIZING\",\n  RECONNECTING = \"RECONNECTING\",\n  BUFFERING = \"BUFFERING\",\n  PRESENT = \"PRESENT\",\n  ERROR = \"ERROR\",\n}\n\nexport type PlayerProblem = {\n  severity: NotificationSeverity;\n  message: string;\n  error?: Error;\n  tip?: string;\n};\n\nexport type PlayerURLState = Immutable<{\n  sourceId: string;\n  parameters?: Record<string, string>;\n}>;\n\nexport type PlayerState = {\n  // Information about the player's presence or connection status, for the UI to show a loading indicator.\n  presence: PlayerPresence;\n\n  // Show some sort of progress indication in the playback bar; see `type Progress` for more details.\n  progress: Progress;\n\n  // Capabilities of this particular `Player`, which are not shared across all players.\n  // See `const PlayerCapabilities` for more details.\n  capabilities: (typeof PlayerCapabilities)[keyof typeof PlayerCapabilities][];\n\n  /**\n   * Identifies the semantics of the data being played back, such as which topics or parameters are\n   * semantically meaningful or normalization conventions to use. This typically maps to a shorthand\n   * identifier for a robotics framework such as \"ros1\", \"ros2\", or \"ulog\". See the MCAP profiles\n   * concept at <https://github.com/foxglove/mcap/blob/main/docs/specification/appendix.md#well-known-profiles>.\n   */\n  profile: string | undefined;\n\n  // A unique id for this player (typically a UUID generated on construction). This is used to clear\n  // out any data when switching to a new player.\n  playerId: string;\n\n  // String name for the player\n  // The player could set this value to represent the current connection, name, ports, etc.\n  name?: string;\n\n  // Surface issues during playback or player initialization\n  problems?: PlayerProblem[];\n\n  // The actual data to render panels with. Can be empty during initialization, until all this data\n  // is known. See `type PlayerStateActiveData` for more details.\n  activeData?: PlayerStateActiveData;\n\n  /** State to serialize into the active URL. */\n  urlState?: PlayerURLState;\n};\n\nexport type PlayerStateActiveData = {\n  // An array of (ROS-like) messages that should be rendered. Should be ordered by `receiveTime`,\n  // and should be immediately following the previous array of messages that was emitted as part of\n  // this state. If there is a discontinuity in messages, `lastSeekTime` should be different than\n  // the previous state. Panels collect these messages using the `PanelAPI`.\n  messages: readonly MessageEvent[];\n  totalBytesReceived: number; // always-increasing\n\n  // The current playback position, which will be shown in the playback bar. This time should be\n  // equal to or later than the latest `receiveTime` in `messages`. Why not just use\n  // `last(messages).receiveTime`? The reason is that the data source (e.g. ROS bag) might have\n  // empty sections, i.e. `messages` can be empty, but we still want to be able to show a playback\n  // cursor moving forward during these regions.\n  currentTime: Time;\n\n  // The start time to show in the playback bar. Every `message.receiveTime` (and therefore\n  // `currentTime`) has to later than or equal to `startTime`.\n  startTime: Time;\n\n  // The end time to show in the playback bar. Every `message.receiveTime` (and therefore\n  // `currentTime`) has to before than or equal to `endTime`.\n  endTime: Time;\n\n  // Whether or not we're currently playing back. Controls the play/pause icon in the playback bar.\n  // It's still allowed to emit `messages` even when not playing (e.g. when doing a backfill after\n  // a seek).\n  isPlaying: boolean;\n\n  // If the Player supports non-real-time speeds (i.e. PlayerState#capabilities contains\n  // PlayerCapabilities.setSpeed), this represents that speed as a fraction of real time.\n  // E.g. 1.0 is real time, 0.2 is 20% of real time.\n  speed: number;\n\n  // The last time a seek / discontinuity in messages happened. This will clear out data within\n  // `PanelAPI` so we're not looking at stale data.\n  lastSeekTime: number;\n\n  // A list of topics that panels can subscribe to. This list may change across states,\n  // but when a topic is removed from the list we should treat it as a seek (i.e. lastSeekTime\n  // should be bumped). Also, no messages are allowed to be emitted which have a `topic` field that\n  // isn't represented in this list. Finally, every topic must have a `datatype` which is actually\n  // present in the `datatypes` field (see below).\n  topics: Topic[];\n\n  // A map of topic names to topic statistics, such as message count. This should be treated as a\n  // sparse list that may be missing some or all topics, depending on the active data source and its\n  // current state.\n  topicStats: Map<string, TopicStats>;\n\n  // A complete list of ROS datatypes. Allowed to change. But it must always be \"complete\" (every\n  // topic must refer to a datatype that is present in this list, every datatypes that refers to\n  // another datatype must refer to a datatype that is present in this list).\n  datatypes: RosDatatypes;\n\n  // A map of topic names to the set of publisher IDs publishing each topic.\n  publishedTopics?: Map<string, Set<string>>;\n\n  // A map of topic names to the set of subscriber IDs subscribed to each topic.\n  subscribedTopics?: Map<string, Set<string>>;\n\n  // A map of service names to service provider IDs that provide each service.\n  services?: Map<string, Set<string>>;\n\n  // A map of parameter names to parameter values, used to describe remote parameters such as\n  // rosparams.\n  parameters?: Map<string, ParameterValue>;\n\n  /** Set to true when `messages` has been recomputed without seek, backfill or playback.\n   * For example: when global variables changes, user-scripts needs to be rerun to recompute\n   * messages. This variable would be set to true to indicate that `messages` may have changed\n   * without a seek or backfill occurring.\n   */\n  messagesRecomputed?: boolean;\n};\n\n// Represents a ROS topic, though the actual data does not need to come from a ROS system.\nexport type Topic = {\n  // Of ROS topic format, i.e. \"/some/topic\". We currently depend on this slashes format a bit in\n  // `<MessageHistroy>`, though we could relax this and support arbitrary strings. It's nice to have\n  // a consistent representation for topics that people recognize though.\n  name: string;\n  // Name of the datatype (see `type PlayerStateActiveData` for details).\n  schemaName: string | undefined;\n  // Name of the topic before topic aliasing, if any.\n  aliasedFromName?: string;\n};\n\nexport type TopicWithSchemaName = Topic & { schemaName: string };\n\nexport type TopicStats = {\n  // The number of messages observed on the topic.\n  numMessages: number;\n  // Timestamp of the first observed message on this topic. Only set for static data sources such as\n  // local files or servers that provide a fixed set of data.\n  firstMessageTime?: Time;\n  // Timestamp of the last observed message on this topic. Only set for static data sources such as\n  // local files or servers that provide a fixed set of data.\n  lastMessageTime?: Time;\n};\n\ntype RosTypedArray =\n  | Int8Array\n  | Uint8Array\n  | Int16Array\n  | Uint16Array\n  | Int32Array\n  | Uint32Array\n  | Float32Array\n  | Float64Array;\n\ntype RosSingularField = number | string | boolean | RosObject | undefined; // No time -- consider it a message.\nexport type RosValue =\n  | RosSingularField\n  | readonly RosSingularField[]\n  | RosTypedArray\n  // eslint-disable-next-line no-restricted-syntax\n  | null;\n\nexport type RosObject = Readonly<{\n  [property: string]: RosValue;\n}>;\n\n// For each memory block we store the actual messages (grouped by topic), and a total byte size of\n// the underlying ArrayBuffers.\nexport type MessageBlock = {\n  readonly messagesByTopic: {\n    readonly [topic: string]: MessageEvent[];\n  };\n  readonly sizeInBytes: number;\n};\n\nexport type BlockCache = {\n  blocks: readonly (MessageBlock | undefined)[];\n  startTime: Time;\n};\n\n// Contains different kinds of progress indications\nexport type Progress = Readonly<{\n  // Indicate which ranges are loaded\n  fullyLoadedFractionRanges?: Range[];\n\n  // A raw view into the cached binary data stored by the MemoryCacheDataProvider. Only present when\n  // using the RandomAccessPlayer.\n  readonly messageCache?: BlockCache;\n}>;\n\nexport type SubscriptionPreloadType =\n  | \"full\" // Fetch messages for the entire content range.\n  | \"partial\"; // Fetch messages as needed.\n\n// Represents a subscription to a single topic, for use in `setSubscriptions`.\nexport type SubscribePayload = {\n  // The topic name to subscribe to\n  topic: string;\n  preloadType?: SubscriptionPreloadType;\n};\n\n// Represents a single topic publisher, for use in `setPublishers`.\nexport type AdvertiseOptions = {\n  /** The topic name */\n  topic: string;\n\n  /** The schema name */\n  schemaName: string;\n\n  /** Additional player-specific advertise options */\n  options?: Record<string, unknown>;\n};\n\n// The actual message to publish.\nexport type PublishPayload = { topic: string; msg: Record<string, unknown> };\n\n// Capabilities that are not shared by all players.\nexport const PlayerCapabilities = {\n  // Publishing messages. Need to be connected to some sort of live robotics system (e.g. ROS).\n  advertise: \"advertise\",\n\n  // Calling services\n  callServices: \"callServices\",\n\n  // Setting speed to something that is not real time.\n  setSpeed: \"setSpeed\",\n\n  // Ability to play, pause, and seek in time.\n  playbackControl: \"playbackControl\",\n\n  // List and retrieve values for configuration key/value pairs\n  getParameters: \"getParameters\",\n\n  // Set values for configuration key/value pairs\n  setParameters: \"setParameters\",\n};\n\n// A metrics collector is an interface passed into a `Player`, which will get called when certain\n// events happen, so we can track those events in some metrics system.\nexport interface PlayerMetricsCollectorInterface {\n  setProperty(key: string, value: string | number | boolean): void;\n  playerConstructed(): void;\n  play(speed: number): void;\n  seek(time: Time): void;\n  setSpeed(speed: number): void;\n  pause(): void;\n  close(): void;\n  setSubscriptions(subscriptions: SubscribePayload[]): void;\n  recordBytesReceived(bytes: number): void;\n  recordPlaybackTime(time: Time, params: { stillLoadingData: boolean }): void;\n  recordUncachedRangeRequest(): void;\n  recordTimeToFirstMsgs(): void;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { pick, uniq } from \"lodash\";\nimport { PropsWithChildren, useCallback, useEffect, useMemo, useState } from \"react\";\nimport { createSelector, createSelectorCreator, defaultMemoize } from \"reselect\";\nimport { StoreApi, createStore } from \"zustand\";\n\nimport { Immutable } from \"@foxglove/studio\";\nimport { usePanelContext } from \"@foxglove/studio-base/components/PanelContext\";\nimport {\n  LayoutState,\n  useCurrentLayoutSelector,\n} from \"@foxglove/studio-base/context/CurrentLayoutContext\";\nimport {\n  ImmutableSettingsTree,\n  PanelStateContext,\n  PanelStateStore,\n  SharedPanelState,\n  usePanelStateStore,\n} from \"@foxglove/studio-base/context/PanelStateContext\";\nimport { getPanelTypeFromId } from \"@foxglove/studio-base/util/layout\";\n\nfunction createPanelStateStore(initialState?: Partial<PanelStateStore>): StoreApi<PanelStateStore> {\n  return createStore((set) => {\n    return {\n      sequenceNumbers: {},\n      settingsTrees: {},\n      sharedPanelState: {},\n      defaultTitles: {},\n\n      incrementSequenceNumber: (panelId: string) => {\n        set((state) => {\n          return {\n            sequenceNumbers: {\n              ...state.sequenceNumbers,\n              [panelId]: (state.sequenceNumbers[panelId] ?? 0) + 1,\n            },\n          };\n        });\n      },\n\n      updateSettingsTree: (panelId, settingsTree) => {\n        set((state) => ({\n          settingsTrees: {\n            ...state.settingsTrees,\n            [panelId]: settingsTree,\n          },\n        }));\n      },\n\n      updateDefaultTitle: (panelId, defaultTitle) => {\n        set((state) => ({ defaultTitles: { ...state.defaultTitles, [panelId]: defaultTitle } }));\n      },\n\n      updateSharedPanelState: (type: string, data: SharedPanelState) => {\n        set((old) => ({ sharedPanelState: { ...old.sharedPanelState, [type]: data } }));\n      },\n\n      ...initialState,\n    };\n  });\n}\n\nconst updateSettingsTreeSelector = (store: PanelStateStore) => store.updateSettingsTree;\n\n/**\n * Returns updater function for the current panels settings tree.\n */\nexport function usePanelSettingsTreeUpdate(): (newTree: ImmutableSettingsTree) => void {\n  const { id } = usePanelContext();\n  const updateStoreTree = usePanelStateStore(updateSettingsTreeSelector);\n\n  const updateSettingsTree = useCallback(\n    (newTree: ImmutableSettingsTree) => {\n      updateStoreTree(id, newTree);\n    },\n    [id, updateStoreTree],\n  );\n\n  /** Cleanup unmounted panels\n   * `actionHandler` can capture panel variables in closure context and keep them in memory\n   * even after unmounting. To prevent this we set the panelSettingsTree entry to undefined,\n   * allowing the actionHandler and its captured closure context from the unmounted panel to\n   * be garbage collected.\n   */\n  useEffect(() => {\n    return () => {\n      updateStoreTree(id, undefined);\n    };\n  }, [id, updateStoreTree]);\n\n  return updateSettingsTree;\n}\n\nconst updateSharedDataSelector = (store: PanelStateStore) => store.updateSharedPanelState;\nconst updateDefaultTitleSelector = (store: PanelStateStore) => store.updateDefaultTitle;\n\n/**\n * Returns a [state, setState] pair that can be used to read and update shared transient\n * panel state.\n */\nexport function useSharedPanelState(): [\n  Immutable<SharedPanelState>,\n  (data: Immutable<SharedPanelState>) => void,\n] {\n  const panelId = usePanelContext().id;\n  const panelType = useMemo(() => getPanelTypeFromId(panelId), [panelId]);\n\n  const selector = useCallback(\n    (store: PanelStateStore) => {\n      return store.sharedPanelState[panelType];\n    },\n    [panelType],\n  );\n\n  const updateSharedData = usePanelStateStore(updateSharedDataSelector);\n  const sharedData = usePanelStateStore(selector);\n  const update = useCallback(\n    (data: Immutable<SharedPanelState>) => {\n      updateSharedData(panelType, data);\n    },\n    [panelType, updateSharedData],\n  );\n\n  return [sharedData, update];\n}\n\n/**\n * Returns a [state, setState] pair that can be used to read and update a panel's default title.\n */\nexport function useDefaultPanelTitle(): [\n  string | undefined,\n  (defaultTitle: string | undefined) => void,\n] {\n  const panelId = usePanelContext().id;\n\n  const selector = useCallback((store: PanelStateStore) => store.defaultTitles[panelId], [panelId]);\n\n  const updateDefaultTitle = usePanelStateStore(updateDefaultTitleSelector);\n  const defaultTitle = usePanelStateStore(selector);\n  const update = useCallback(\n    (newValue: string | undefined) => {\n      updateDefaultTitle(panelId, newValue);\n    },\n    [panelId, updateDefaultTitle],\n  );\n\n  return [defaultTitle, update];\n}\n\n/**\n * True if both objects have the same keys, ignoring values.\n */\nfunction hasSameKeys(\n  a: undefined | Record<string, unknown>,\n  b: undefined | Record<string, unknown>,\n) {\n  if (a === b) {\n    return true;\n  }\n\n  if (a == undefined && b != undefined) {\n    return false;\n  }\n  if (a != undefined && b == undefined) {\n    return false;\n  }\n\n  if (a != undefined && b != undefined) {\n    for (const keyA in a) {\n      if (!Object.prototype.hasOwnProperty.call(b, keyA)) {\n        return false;\n      }\n    }\n\n    for (const keyB in b) {\n      if (!Object.prototype.hasOwnProperty.call(a, keyB)) {\n        return false;\n      }\n    }\n  }\n\n  return true;\n}\n\nconst createHasSameKeySelector = createSelectorCreator(defaultMemoize, hasSameKeys);\n\nconst selectCurrentLayoutId = (state: LayoutState) => state.selectedLayout?.id;\n\nconst selectLayoutConfigById = createHasSameKeySelector(\n  (state: LayoutState) => state.selectedLayout?.data?.configById,\n  (config) => config,\n);\n\nconst selectPanelTypesInUse = createSelector(selectLayoutConfigById, (config) => {\n  return uniq(Object.keys(config ?? {}).map(getPanelTypeFromId));\n});\n\ntype Props = PropsWithChildren<{\n  initialState?: Partial<PanelStateStore>;\n}>;\n\nexport function PanelStateContextProvider(props: Props): JSX.Element {\n  const { children, initialState } = props;\n\n  const [store] = useState(() => createPanelStateStore(initialState));\n\n  // discared shared panel state for panel types that are no longer in the layout\n  const panelTypesInUse = useCurrentLayoutSelector(selectPanelTypesInUse);\n  useEffect(() => {\n    store.setState((old) => ({ sharedPanelState: pick(old.sharedPanelState, panelTypesInUse) }));\n  }, [panelTypesInUse, store]);\n\n  // clear shared panel state on layout change\n  const currentLayoutId = useCurrentLayoutSelector(selectCurrentLayoutId);\n  useEffect(() => {\n    void currentLayoutId;\n    store.setState({ sharedPanelState: {} });\n  }, [currentLayoutId, store]);\n\n  return <PanelStateContext.Provider value={store}>{children}</PanelStateContext.Provider>;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\ntype ReportErrorHandler = (error: Error) => void;\n\nconst globalWithHandler = global as { foxgloveStudioReportErrorFn?: ReportErrorHandler };\n\n/**\n * Report an error that has escaped past normal error-handling flows in the app and should be\n * triaged and diagnosed.\n */\nexport function reportError(error: Error): void {\n  globalWithHandler.foxgloveStudioReportErrorFn?.(error);\n}\n\n/**\n * Set the handler function which will be called when an error is passed to `reportError()`. The default is\n * a no-op.\n */\nexport function setReportErrorHandler(fn: ReportErrorHandler): void {\n  globalWithHandler.foxgloveStudioReportErrorFn = fn;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nenum AppEvent {\n  APP_INIT = \"Studio: App Initialized\",\n\n  // Dialog events\n  DIALOG_SELECT_VIEW = \"Studio: Dialog View Selected\",\n  DIALOG_CLOSE = \"Studio: Dialog Closed\",\n  DIALOG_CLICK_CTA = \"Studio: Dialog CTA Clicked\",\n\n  // App Bar events\n  APP_BAR_CLICK_CTA = \"Studio: App Bar CTA CLicked\",\n\n  // Tour events\n  TOUR_PROMPT_SHOWN = \"Studio: New UI Tour prompt shown\",\n  TOUR_STARTED = \"Studio: New UI Tour started\",\n  TOUR_BACK = \"Studio: New UI Tour step back\",\n  TOUR_NEXT = \"Studio: New UI Tour step next\",\n  TOUR_COMPLETED = \"Studio: New UI Tour completed\",\n  TOUR_DISMISSED = \"Studio: New UI Tour dismissed\",\n\n  // App Menu events\n  APP_MENU_CLICK = \"Studio: App Menu Clicked\",\n\n  // Help Menu events\n  HELP_MENU_CLICK_CTA = \"Studio: Help Menu CTA Clicked\",\n\n  // Player events\n  PLAYER_CONSTRUCTED = \"Studio: Player Constructed\",\n  PLAYER_PLAY = \"Studio: Player Played\",\n  PLAYER_SEEK = \"Studio: Player Seeked\",\n  PLAYER_SET_SPEED = \"Studio: Player Speed Set\",\n  PLAYER_PAUSE = \"Studio: Player Paused\",\n  PLAYER_CLOSE = \"Studio: Player Closed\",\n\n  // Layout events\n  LAYOUT_UPDATE = \"Studio: Layout Updated\",\n  LAYOUT_CREATE = \"Studio: Layout Created\",\n  LAYOUT_DUPLICATE = \"Studio: Layout Duplicated\",\n  LAYOUT_RENAME = \"Studio: Layout Renamed\",\n  LAYOUT_DELETE = \"Studio: Layout Deleted\",\n  LAYOUT_SELECT = \"Studio: Layout Selected\",\n  LAYOUT_IMPORT = \"Studio: Layout Imported\",\n  LAYOUT_EXPORT = \"Studio: Layout Exported\",\n  LAYOUT_SHARE = \"Studio: Layout Shared\",\n  LAYOUT_OVERWRITE = \"Studio: Layout Overwritten\",\n  LAYOUT_REVERT = \"Studio: Layout Reverted\",\n  LAYOUT_MAKE_PERSONAL_COPY = \"Studio: Layout Personal Copy Made\",\n\n  // Panel events\n  PANEL_ADD = \"Studio: Panel Added\",\n  PANEL_DELETE = \"Studio: Panel Deleted\",\n\n  // Variable events\n  VARIABLE_ADD = \"Studio: Variable Added\",\n  VARIABLE_DELETE = \"Studio: Variable Deleted\",\n\n  // Image events\n  IMAGE_DOWNLOAD = \"Studio: Image Downloaded\",\n\n  // Extension events\n  EXTENSION_INSTALL = \"Studio: Extension Installed\",\n  EXTENSION_UNINSTALL = \"Studio: Extension Uninstalled\",\n\n  // Experimental features\n  EXPERIMENTAL_FEATURE_TOGGLE = \"Studio: Experimental Feature Toggled\",\n}\n\ninterface IAnalytics {\n  logEvent(event: AppEvent, data?: { [key: string]: unknown }): void | Promise<void>;\n}\n\nexport { AppEvent };\nexport default IAnalytics;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport createCache from \"@emotion/cache\";\nimport { CacheProvider } from \"@emotion/react\";\nimport { ThemeProvider as MuiThemeProvider } from \"@mui/material\";\nimport { useEffect, useLayoutEffect, useMemo } from \"react\";\nimport { useTranslation } from \"react-i18next\";\n\nimport { Language } from \"@foxglove/studio-base/i18n\";\nimport { createMuiTheme } from \"@foxglove/studio-base/theme\";\n\n// Make sure mui styles are loaded first so that our makeStyles customizations\n// take precedence.\nconst muiCache = createCache({ key: \"mui\", prepend: true });\n\n// By default the ThemeProvider adds an extra div to the DOM tree. We can disable this with a\n// custom `as` component to FluentThemeProvider. The component must support a `ref` property\n// otherwise we get react warnings.\nconst ThemeContainer = React.forwardRef((props, _ref) => <>{props.children}</>);\nThemeContainer.displayName = \"ThemeContainer\";\n\nexport default function ThemeProvider({\n  children,\n  isDark,\n}: React.PropsWithChildren<{ isDark: boolean }>): React.ReactElement | ReactNull {\n  useEffect(() => {\n    // Trick CodeEditor into sync with our theme\n    document.documentElement.setAttribute(\"data-color-mode\", isDark ? \"dark\" : \"light\");\n\n    // remove styles set to prevent browser flash on init\n    document.querySelector(\"#loading-styles\")?.remove();\n  }, [isDark]);\n\n  const { i18n } = useTranslation();\n  const muiTheme = useMemo(\n    () => createMuiTheme(isDark ? \"dark\" : \"light\", i18n.language as Language | undefined),\n    [i18n.language, isDark],\n  );\n\n  useLayoutEffect(() => {\n    // Set the theme color to match the sidebar and playback bar\n    const meta = document.createElement(\"meta\");\n    meta.name = \"theme-color\";\n    meta.content = muiTheme.palette.background.paper;\n    document.head.appendChild(meta);\n    return () => meta.remove();\n  }, [muiTheme]);\n\n  return (\n    <CacheProvider value={muiCache}>\n      <MuiThemeProvider theme={muiTheme}>{children}</MuiThemeProvider>\n    </CacheProvider>\n  );\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\n// this type mirrors the MessageChannel and MessagePort APIs which are available on\n// instances of web-workers and shared-workers respectively, as well as avaiable on\n// 'global' within them.\nexport interface Channel {\n  postMessage(data: unknown, transfer?: Transferable[]): void;\n  onmessage?: ((ev: MessageEvent) => unknown) | null; // eslint-disable-line no-restricted-syntax\n  terminate: () => void;\n}\n\nconst RESPONSE = \"$$RESPONSE\";\nconst ERROR = \"$$ERROR\";\n\n// helper function to create linked channels for testing\nexport function createLinkedChannels(): { local: Channel; remote: Channel } {\n  const local: Channel = {\n    onmessage: undefined,\n\n    postMessage(data: unknown, _transfer?: Array<ArrayBuffer>) {\n      const ev = new MessageEvent(\"message\", { data });\n      if (remote.onmessage) {\n        remote.onmessage(ev);\n      }\n    },\n    terminate: () => {\n      // no-op\n    },\n  };\n\n  const remote: Channel = {\n    onmessage: undefined,\n\n    postMessage(data: unknown, _transfer?: Array<ArrayBuffer>) {\n      const ev = new MessageEvent(\"message\", { data });\n      if (local.onmessage) {\n        local.onmessage(ev);\n      }\n    },\n    terminate: () => {\n      // no-op\n    },\n  };\n  return { local, remote };\n}\n\n// This class allows you to hook up bi-directional async calls across web-worker\n// boundaries where a single call to or from a worker can 'wait' on the response.\n// Errors in receivers are propigated back to the caller as a rejection.\n// It also supports returning transferables over the web-worker postMessage api,\n// which was the main shortcomming with the worker-rpc npm module.\n// To attach rpc to an instance of a worker in the main thread:\n//   const rpc = new Rpc(workerInstace);\n// To attach rpc within an a web worker:\n//   const rpc = new Rpc(global);\n// Check out the tests for more examples.\nexport default class Rpc {\n  public static transferables = \"$$TRANSFERABLES\";\n  #channel: Omit<Channel, \"terminate\">;\n  #messageId: number = 0;\n  #pendingCallbacks: {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    [key: number]: (arg0: any) => void;\n  } = {};\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  #receivers: Map<string, (arg0: any) => any> = new Map();\n\n  public constructor(channel: Omit<Channel, \"terminate\">) {\n    this.#channel = channel;\n    if (this.#channel.onmessage) {\n      throw new Error(\n        \"channel.onmessage is already set. Can only use one Rpc instance per channel.\",\n      );\n    }\n    this.#channel.onmessage = this.#onChannelMessage;\n  }\n\n  #onChannelMessage = (ev: MessageEvent): void => {\n    const { id, topic, data } = ev.data;\n    if (topic === RESPONSE) {\n      this.#pendingCallbacks[id]?.(ev.data);\n      delete this.#pendingCallbacks[id];\n      return;\n    }\n    // invoke the receive handler in a promise so if it throws synchronously we can reject\n    new Promise<Record<string, Transferable[] | undefined> | undefined>((resolve) => {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n      const handler = this.#receivers.get(topic);\n      if (!handler) {\n        throw new Error(`no receiver registered for ${topic}`);\n      }\n      // This works both when `handler` returns a value or a Promise.\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n      resolve(handler(data));\n    })\n      .then((result) => {\n        if (!result) {\n          return this.#channel.postMessage({ topic: RESPONSE, id });\n        }\n        const transferables = result[Rpc.transferables];\n        delete result[Rpc.transferables];\n        const message = {\n          topic: RESPONSE,\n          id,\n          data: result,\n        };\n        this.#channel.postMessage(message, transferables);\n      })\n      .catch((err) => {\n        const message = {\n          topic: RESPONSE,\n          id,\n          data: {\n            [ERROR]: true,\n            name: err.name,\n            message: err.message,\n            stack: err.stack,\n          },\n        };\n        this.#channel.postMessage(message);\n      });\n  };\n\n  /** Call this when the channel has been terminated to reject any outstanding send callbacks. */\n  public terminate(): void {\n    for (const [id, callback] of Object.entries(this.#pendingCallbacks)) {\n      callback({\n        topic: RESPONSE,\n        id,\n        data: {\n          [ERROR]: true,\n          name: \"Error\",\n          message: \"Rpc terminated\",\n          stack: new Error().stack,\n        },\n      });\n    }\n  }\n\n  // send a message across the rpc boundary to a receiver on the other side\n  // this returns a promise for the receiver's response.  If there is no registered\n  // receiver for the given topic, this method throws\n  public async send<TResult, TData = unknown>(\n    topic: string,\n    data?: TData,\n    transfer?: Transferable[],\n  ): Promise<TResult> {\n    const id = this.#messageId++;\n    const message = { topic, id, data };\n    const result = new Promise<TResult>((resolve, reject) => {\n      this.#pendingCallbacks[id] = (info) => {\n        if (info.data?.[ERROR] != undefined) {\n          // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n          const error = new Error(info.data.message);\n          error.name = info.data.name;\n          error.stack = info.data.stack;\n          reject(error);\n        } else {\n          // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n          resolve(info.data);\n        }\n      };\n    });\n    this.#channel.postMessage(message, transfer);\n    return await result;\n  }\n\n  // register a receiver for a given message on a topic\n  // only one receiver can be registered per topic and currently\n  // 'deregistering' a receiver is not supported since this is not common\n  public receive<T, TOut>(topic: string, handler: (arg0: T) => TOut): void {\n    if (this.#receivers.has(topic)) {\n      throw new Error(`Receiver already registered for topic: ${topic}`);\n    }\n    this.#receivers.set(topic, handler);\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nexport function assertNever(_: never, msg: string): never {\n  throw new Error(msg);\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { mightActuallyBePartial } from \"@foxglove/studio-base/util/mightActuallyBePartial\";\n\nfunction fallbackCopy(text: string) {\n  const body = document.body;\n  const el = document.createElement(\"textarea\");\n  body.appendChild(el);\n  el.value = text;\n  el.select();\n  document.execCommand(\"copy\");\n  body.removeChild(el);\n}\n\nexport default {\n  // Copy a string to the clipboard\n  async copy(text: string): Promise<void> {\n    // attempt to use the new async clipboard methods. If those are not available or fail, fallback to the old\n    // `execCommand` method.\n    if (mightActuallyBePartial(navigator.clipboard).writeText != undefined) {\n      try {\n        return await navigator.clipboard.writeText(text);\n      } catch (error) {\n        fallbackCopy(text);\n      }\n    } else {\n      fallbackCopy(text);\n    }\n  },\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\n// extra boundary added for jest testing, since jsdom's Blob doesn't support .text()\nexport function downloadTextFile(text: string, fileName: string): void {\n  return downloadFiles([{ blob: new Blob([text]), fileName }]);\n}\n\nexport function downloadFiles(files: { blob: Blob; fileName: string }[]): void {\n  const body = document.body;\n\n  const link = document.createElement(\"a\");\n  link.style.display = \"none\";\n  body.appendChild(link);\n\n  const urls = files.map((file) => {\n    const url = window.URL.createObjectURL(file.blob);\n    link.setAttribute(\"download\", file.fileName);\n    link.setAttribute(\"href\", url);\n    link.click();\n    return url;\n  });\n\n  // remove the link after triggering download\n  window.requestAnimationFrame(() => {\n    body.removeChild(link);\n    urls.forEach((url) => {\n      URL.revokeObjectURL(url);\n    });\n  });\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { DetailsType } from \"@foxglove/studio-base/util/sendNotification\";\n\nexport class AppError extends Error {\n  public details: DetailsType;\n  public extraInfo: unknown;\n  public override message: string;\n\n  public constructor(details: DetailsType, extraInfo?: unknown) {\n    super();\n    this.details = details;\n    this.extraInfo = extraInfo;\n    this.name = \"AppError\";\n    this.message = \"\";\n\n    if (details instanceof Error) {\n      this.message = details.stack ?? details.message;\n    } else if (typeof details === \"string\") {\n      this.message = details;\n    }\n\n    if (extraInfo != undefined) {\n      // If `extraInfo` was passed via a componentDidCatch:\n      // https://reactjs.org/docs/react-component.html#componentdidcatch\n      if ((extraInfo as { componentStack: unknown }).componentStack != undefined) {\n        this.message += `\\n\\n${(extraInfo as { componentStack: unknown }).componentStack}`;\n      } else {\n        try {\n          const stringifiedExtraInfo = JSON.stringify(extraInfo);\n          this.message += `\\n\\n${stringifiedExtraInfo}`;\n        } catch (e) {\n          this.message += `\\n\\n[ Either cyclic object or object with BigInt(s) ]`;\n        }\n      }\n    }\n\n    if (this.message === \"\") {\n      this.message = \"Unknown Error\";\n    }\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { Time } from \"@foxglove/rostime\";\n\nconst DIGITS_WITHOUT_DECIMAL_POINT_RE = /^\\d+$/;\nconst DIGITS_WITH_DECIMAL_POINT_RE = /^(?!\\.$)(\\d*)\\.(\\d*)$/;\nconst THOUSAND_YEARS_IN_NANOSEC = 1000n * 365n * 24n * 60n * 60n * BigInt(1e9);\n\n/**\n * Parses a ROS time (UNIX timestamp) containing a whole or floating point number of seconds. If\n * more than 9 digits of nanoseconds are given, the rest will be truncated.\n *\n * Parsing is lenient: if the numeric value given is too large and contains no decimal point, assume\n * it is ms, µs, ns instead of seconds (or a smaller unit, in powers of 1000).\n */\nexport default function parseFuzzyRosTime(stamp: string): Time | undefined {\n  const trimmedStamp = stamp.trim();\n  if (DIGITS_WITHOUT_DECIMAL_POINT_RE.test(trimmedStamp)) {\n    // Start by assuming the input is in seconds, and convert to nanoseconds.\n    let nanos = BigInt(trimmedStamp) * BigInt(1e9);\n    while (nanos > THOUSAND_YEARS_IN_NANOSEC) {\n      nanos /= 1000n;\n    }\n    return { sec: Number(nanos / BigInt(1e9)), nsec: Number(nanos % BigInt(1e9)) };\n  }\n\n  const match = DIGITS_WITH_DECIMAL_POINT_RE.exec(trimmedStamp);\n  if (match?.[1] != undefined && match[2] != undefined) {\n    // There can be at most 9 digits of nanoseconds. Truncate any others.\n    return { sec: Number(match[1]), nsec: Number(match[2].substr(0, 9).padEnd(9, \"0\")) };\n  }\n\n  return undefined;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport momentDurationFormatSetup from \"moment-duration-format\";\nimport moment from \"moment-timezone\";\n\n// Educate the unused-dependency checker that we implicitly use moment via moment-timezone\n// foxglove-depcheck-used: moment\n\nimport { Time, toDate, fromDate } from \"@foxglove/rostime\";\nimport { TimeDisplayMethod } from \"@foxglove/studio-base/types/panels\";\n\nimport parseFuzzyRosTime from \"./parseFuzzyRosTime\";\n\n// All time functions that require `moment` should live in this file.\n\n// @ts-expect-error suppress Argument of type 'typeof moment' is not assignable to parameter of type 'typeof import ...\n// There is some miss-match between the moment we import and the one the type declarations expect\nmomentDurationFormatSetup(moment);\n\nexport function format(stamp: Time, timezone?: string): string {\n  return `${formatDate(stamp, timezone)} ${formatTime(stamp, timezone)}`;\n}\n\nexport function formatDate(stamp: Time, timezone?: string): string {\n  if (stamp.sec < 0 || stamp.nsec < 0) {\n    console.error(\"Times are not allowed to be negative\");\n    return \"(invalid negative time)\";\n  }\n  return moment\n    .tz(toDate(stamp), timezone != undefined ? timezone : moment.tz.guess())\n    .format(\"YYYY-MM-DD\");\n}\n\nexport function formatTime(stamp: Time, timezone?: string): string {\n  if (stamp.sec < 0 || stamp.nsec < 0) {\n    console.error(\"Times are not allowed to be negative\");\n    return \"(invalid negative time)\";\n  }\n  return moment\n    .tz(toDate(stamp), timezone != undefined ? timezone : moment.tz.guess())\n    .format(\"h:mm:ss.SSS A z\");\n}\n\nexport function formatDuration(stamp: Time): string {\n  return moment\n    .duration(Math.round(stamp.sec * 1000 + stamp.nsec / 1e6))\n    .format(\"h:mm:ss.SSS\", { trim: false });\n}\n\nexport function parseTimeStr(str: string, timezone?: string): Time | undefined {\n  const newMomentTimeObj =\n    timezone != undefined\n      ? moment.tz(str, \"YYYY-MM-DD h:mm:ss.SSS A z\", timezone)\n      : moment(str, \"YYYY-MM-DD h:mm:ss.SSS A z\");\n  const date = newMomentTimeObj.toDate();\n  const result = newMomentTimeObj.isValid() ? fromDate(date) : undefined;\n\n  if (!result || result.sec <= 0 || result.nsec < 0) {\n    return undefined;\n  }\n  return result;\n}\n\nconst todTimeRegex = /^\\d+:\\d+:\\d+.\\d+\\s[PpAa][Mm]\\s[A-Za-z$]+/;\nexport const getValidatedTimeAndMethodFromString = ({\n  text,\n  date,\n  timezone,\n}: {\n  text?: string;\n  date: string;\n  timezone?: string;\n}): { time?: Time; method: TimeDisplayMethod } | undefined => {\n  if (text == undefined || text === \"\") {\n    return;\n  }\n  const isInvalidRawTime = isNaN(+text);\n  const isInvalidTodTime = !(todTimeRegex.test(text) && parseTimeStr(`${date} ${text}`, timezone));\n\n  if (isInvalidRawTime && isInvalidTodTime) {\n    return;\n  }\n\n  return {\n    time: !isInvalidRawTime ? parseFuzzyRosTime(text) : parseTimeStr(`${date} ${text}`, timezone),\n    method: isInvalidRawTime ? \"TOD\" : \"SEC\",\n  };\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\nimport { useTheme } from \"@mui/material\";\nimport type { Base16Theme } from \"base16\";\n\nexport const DEFAULT_STUDIO_NODE_PREFIX = \"/studio_script/\";\n\nexport function useJsonTreeTheme(): Pick<\n  Base16Theme,\n  \"base00\" | \"base07\" | \"base0B\" | \"base09\" | \"base08\" | \"base0D\" | \"base03\"\n> {\n  const {\n    palette: { mode, text },\n  } = useTheme();\n\n  return {\n    dark: {\n      base00: \"transparent\", // bg\n      base0B: \"#ffa657\", // string & date, item string\n      base09: \"#7ee787\", // # & boolean\n      base07: \"#79c0ff\", // text\n      base08: \"#ff7b72\", // null, undefined, function, & symbol\n      base0D: \"#79c0ff\", // label & arrow\n      base03: text.secondary, // item string expanded\n    },\n    light: {\n      base00: \"transparent\", // bg\n      base0B: \"#953800\", // string & date, item string\n      base09: \"#116329\", // # & boolean\n      base07: \"#0550ae\", // text\n      base08: \"#cf222e\", // null, undefined, function, & symbol\n      base0D: \"#0550ae\", // label & arrow\n      base03: text.secondary, // item string expanded\n    },\n  }[mode];\n}\n\nexport const TAB_PANEL_TYPE = \"Tab\";\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nexport default function isDesktopApp(): boolean {\n  return Boolean((global as unknown as { desktopBridge: unknown }).desktopBridge);\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\nimport { compact, flatMap, xor, uniq } from \"lodash\";\nimport {\n  createRemoveUpdate,\n  getLeaves,\n  getNodeAtPath,\n  updateTree,\n  MosaicUpdate,\n  isParent,\n  MosaicNode,\n  MosaicPath,\n} from \"react-mosaic-component\";\nimport { MosaicDirection, MosaicKey } from \"react-mosaic-component/lib/types\";\n\nimport { filterMap } from \"@foxglove/den/collection\";\nimport Logger from \"@foxglove/log\";\nimport {\n  ConfigsPayload,\n  SaveConfigsPayload,\n} from \"@foxglove/studio-base/context/CurrentLayoutContext/actions\";\nimport { reportError } from \"@foxglove/studio-base/reportError\";\nimport { TabConfig, TabLocation, TabPanelConfig } from \"@foxglove/studio-base/types/layouts\";\nimport {\n  PanelConfig,\n  MosaicDropTargetPosition,\n  SavedProps,\n} from \"@foxglove/studio-base/types/panels\";\nimport { TAB_PANEL_TYPE } from \"@foxglove/studio-base/util/globalConstants\";\n\nconst log = Logger.getLogger(__filename);\n\n/** Key injected into panel configs for user-selected title (overrides setDefaultPanelTitle) */\nexport const PANEL_TITLE_CONFIG_KEY = \"foxglovePanelTitle\";\n\n// given a panel type, create a unique id for a panel\n// with the type embedded within the id\n// we need this because react-mosaic\nexport function getPanelIdForType(type: string): string {\n  const factor = 1e10;\n  const rnd = Math.round(Math.random() * factor).toString(36);\n  // a panel id consists of its type, an exclamation mark for splitting, and a random val\n  // because each panel id functions is the react 'key' for the react-mosaic-component layout\n  // but also must encode the panel type for panel factory construction\n  return `${type}!${rnd}`;\n}\n\nexport function getPanelTypeFromId(id: string): string {\n  return id.split(\"!\")[0] ?? \"\";\n}\n\nexport function isTabPanel(panelId: string): boolean {\n  return getPanelTypeFromId(panelId) === TAB_PANEL_TYPE;\n}\n\nexport function isTabPanelConfig(config: PanelConfig | undefined): config is TabPanelConfig {\n  return config != undefined && \"tabs\" in config && \"activeTabIdx\" in config;\n}\n\n// Traverses `tree` to find the path to the specified `node`\nexport function getPathFromNode<T extends MosaicKey>(\n  node: T | undefined,\n  tree: MosaicNode<T> | null, // eslint-disable-line no-restricted-syntax\n  path: MosaicPath = [],\n): MosaicPath {\n  if (tree === node) {\n    return path;\n  }\n  if (tree != undefined && isParent(tree)) {\n    const first = getPathFromNode(node, tree.first, [...path, \"first\"]);\n    if (first.length > 0) {\n      return first;\n    }\n    const second = getPathFromNode(node, tree.second, [...path, \"second\"]);\n    if (second.length > 0) {\n      return second;\n    }\n  }\n  return [];\n}\n\ntype PanelIdMap = {\n  [panelId: string]: string;\n};\nfunction mapTemplateIdsToNewIds(templateIds: string[]): PanelIdMap {\n  const result: PanelIdMap = {};\n  for (const id of templateIds) {\n    result[id] = getPanelIdForType(getPanelTypeFromId(id));\n  }\n  return result;\n}\n\ntype IndexableMosaic = MosaicNode<string> & Record<string, unknown>;\n\nfunction getLayoutWithNewPanelIds(\n  layout: undefined | IndexableMosaic,\n  panelIdMap: PanelIdMap,\n): MosaicNode<string> | undefined {\n  if (typeof layout === \"string\") {\n    // return corresponding ID if it exists in panelIdMap\n    // (e.g. for Tab panel presets with 1 panel in active layout)\n    return panelIdMap[layout] ?? getPanelIdForType(getPanelTypeFromId(layout));\n  }\n\n  if (layout == undefined) {\n    return undefined;\n  }\n  const newLayout: Record<string, unknown> = {};\n  for (const key in layout) {\n    if (typeof layout[key] === \"object\" && !Array.isArray(layout[key])) {\n      newLayout[key] = getLayoutWithNewPanelIds(layout[key] as IndexableMosaic, panelIdMap);\n    } else if (typeof layout[key] === \"string\" && panelIdMap[layout[key] as string] != undefined) {\n      newLayout[key] = panelIdMap[layout[key] as string];\n    } else {\n      newLayout[key] = layout[key];\n    }\n  }\n  return newLayout as unknown as MosaicNode<string>;\n}\n\n// Recursively removes all empty nodes from a layout\nfunction compactLayout(layout: MosaicNode<string>): MosaicNode<string> {\n  if (typeof layout === \"string\") {\n    return layout;\n  }\n\n  const prunedChildren = [layout.first, layout.second].filter(Boolean).map(compactLayout);\n  const [first, second] = prunedChildren;\n  if (first == undefined && second == undefined) {\n    return \"\";\n  } else if (first != undefined && second != undefined) {\n    return {\n      ...layout,\n      first,\n      second,\n    };\n  }\n\n  return {\n    ...layout,\n    first: first ?? second ?? \"\",\n    second: \"\",\n  };\n}\n\n// Recursively replaces all leaves of the current layout\nfunction replaceLeafLayouts(\n  layout: MosaicNode<string>,\n  replacerFn: (layout: MosaicNode<string>) => MosaicNode<string>,\n): MosaicNode<string> {\n  if (typeof layout === \"string\") {\n    return replacerFn(layout);\n  }\n  return {\n    ...layout,\n    first: replaceLeafLayouts(layout.first, replacerFn),\n    second: replaceLeafLayouts(layout.second, replacerFn),\n  };\n}\n\n// Replaces Tab panels with their active tab's layout\nexport function inlineTabPanelLayouts(\n  layout: MosaicNode<string>,\n  savedProps: SavedProps,\n  preserveTabPanelIds: readonly string[],\n): MosaicNode<string> {\n  const tabFreeLayout = replaceLeafLayouts(layout, (id) => {\n    if (typeof id === \"string\" && isTabPanel(id) && !preserveTabPanelIds.includes(id)) {\n      const panelProps = getValidTabPanelConfig(id, savedProps);\n      const tabLayout = panelProps.tabs[panelProps.activeTabIdx]?.layout;\n      if (tabLayout != undefined) {\n        return inlineTabPanelLayouts(tabLayout, savedProps, preserveTabPanelIds);\n      }\n    }\n    return id;\n  });\n  return compactLayout(tabFreeLayout);\n}\n\n// Maps panels to their parent Tab panel\nexport const getParentTabPanelByPanelId = (\n  savedProps: SavedProps,\n): {\n  [key: string]: string;\n} =>\n  Object.entries(savedProps).reduce(\n    (\n      memo: Record<string, string>,\n      [savedPanelId, savedConfig]: [string, undefined | PanelConfig],\n    ) => {\n      if (isTabPanel(savedPanelId) && savedConfig != undefined) {\n        const tabPanelConfig = savedConfig as Partial<TabPanelConfig>;\n        tabPanelConfig.tabs?.forEach((tab) => {\n          const panelIdsInTab = getLeaves(tab.layout ?? ReactNull);\n          panelIdsInTab.forEach((id) => (memo[id] = savedPanelId));\n        });\n      }\n      return memo;\n    },\n    {},\n  );\n\nconst replaceMaybeTabLayoutWithNewPanelIds = (panelIdMap: PanelIdMap) => {\n  return ({ id, config }: { id: string; config: Partial<TabPanelConfig> }) => {\n    return config.tabs\n      ? {\n          id,\n          config: {\n            ...config,\n            tabs: config.tabs.map((tab: TabConfig) => ({\n              ...tab,\n              layout: getLayoutWithNewPanelIds(tab.layout as IndexableMosaic, panelIdMap),\n            })),\n          },\n        }\n      : { id, config };\n  };\n};\n\nexport const getSaveConfigsPayloadForAddedPanel = ({\n  id,\n  config,\n  relatedConfigs,\n}: {\n  id: string;\n  config: PanelConfig;\n  relatedConfigs?: SavedProps;\n}): SaveConfigsPayload => {\n  if (!relatedConfigs) {\n    return { configs: [{ id, config }] };\n  }\n  const templateIds = getPanelIdsInsideTabPanels([id], { [id]: config });\n  const panelIdMap = mapTemplateIdsToNewIds(templateIds);\n  const newConfigs = filterMap(templateIds, (templateId) => {\n    const panelId = panelIdMap[templateId];\n    const relatedConfig = relatedConfigs[templateId];\n    if (panelId == undefined || relatedConfig == undefined) {\n      return;\n    }\n\n    return {\n      id: panelId,\n      config: relatedConfig,\n    };\n  });\n  const allConfigs = [...newConfigs, { id, config }].map(\n    replaceMaybeTabLayoutWithNewPanelIds(panelIdMap),\n  );\n  return { configs: allConfigs };\n};\n\nexport function getPanelIdsInsideTabPanels(panelIds: string[], savedProps: SavedProps): string[] {\n  const tabPanelIds = panelIds.filter(isTabPanel);\n  const tabLayouts: MosaicNode<string>[] = [];\n  tabPanelIds.forEach((panelId) => {\n    const tabProps = savedProps[panelId] as Partial<TabPanelConfig> | undefined;\n    if (tabProps?.tabs) {\n      tabProps.tabs.forEach((tab: TabConfig) => {\n        tabLayouts.push(\n          tab.layout as MosaicNode<string>,\n          ...getPanelIdsInsideTabPanels(getLeaves(tab.layout ?? ReactNull), savedProps),\n        );\n      });\n    }\n  });\n  return flatMap(tabLayouts, getLeaves);\n}\n\nexport const DEFAULT_TAB_PANEL_CONFIG: TabPanelConfig = {\n  activeTabIdx: 0,\n  tabs: [{ title: \"1\", layout: undefined }],\n};\n// Returns all panelIds for a given layout (including layouts stored in Tab panels)\nexport function getAllPanelIds(layout: MosaicNode<string>, savedProps: SavedProps): string[] {\n  const layoutPanelIds = getLeaves(layout);\n  const tabPanelIds = getPanelIdsInsideTabPanels(layoutPanelIds, savedProps);\n  return [...layoutPanelIds, ...tabPanelIds];\n}\n\nexport const validateTabPanelConfig = (config?: PanelConfig): config is TabPanelConfig => {\n  if (!config) {\n    return false;\n  }\n\n  if (!Array.isArray(config.tabs) || typeof config.activeTabIdx !== \"number\") {\n    const error = new Error(\n      \"A non-Tab panel config is being operated on as if it were a Tab panel.\",\n    );\n    log.info(`Invalid Tab panel config: ${error.message}`, config);\n    reportError(error);\n    return false;\n  }\n  if (config.activeTabIdx >= config.tabs.length) {\n    const error = new Error(\"A Tab panel has an activeTabIdx for a nonexistent tab.\");\n    log.info(`Invalid Tab panel config: ${error.message}`, config);\n    reportError(error);\n    return false;\n  }\n  return true;\n};\n\nexport const updateTabPanelLayout = (\n  layout: MosaicNode<string> | undefined,\n  tabPanelConfig: TabPanelConfig,\n): TabPanelConfig => {\n  const updatedTabs = tabPanelConfig.tabs.map((tab, i) => {\n    if (i === tabPanelConfig.activeTabIdx) {\n      return { ...tab, layout };\n    }\n    return tab;\n  });\n  // Create a new tab if there isn't one active\n  if (tabPanelConfig.activeTabIdx === -1) {\n    updatedTabs.push({ layout, title: \"1\" });\n  }\n  return {\n    ...tabPanelConfig,\n    tabs: updatedTabs,\n    activeTabIdx: Math.max(0, tabPanelConfig.activeTabIdx),\n  };\n};\n\nexport const removePanelFromTabPanel = (\n  path: MosaicPath = [],\n  config: TabPanelConfig,\n  tabId: string,\n): SaveConfigsPayload => {\n  if (!validateTabPanelConfig(config)) {\n    return { configs: [] };\n  }\n\n  const currentTabLayout = config.tabs[config.activeTabIdx]?.layout;\n  let newTree: MosaicNode<string> | undefined;\n  if (path.length === 0) {\n    newTree = undefined;\n  } else {\n    const update = createRemoveUpdate(currentTabLayout ?? ReactNull, path);\n    newTree = updateTree<string>(currentTabLayout as MosaicNode<string>, [update]);\n  }\n\n  const saveConfigsPayload = {\n    configs: [{ id: tabId, config: updateTabPanelLayout(newTree, config) }],\n  };\n  return saveConfigsPayload;\n};\n\nexport const createAddUpdates = (\n  tree: MosaicNode<string> | undefined,\n  panelId: string,\n  newPath: MosaicPath,\n  position: MosaicDropTargetPosition,\n): MosaicUpdate<string>[] => {\n  if (tree == undefined) {\n    return [];\n  }\n  const node = getNodeAtPath(tree, newPath) as MosaicNode<string>;\n  const before = position === \"left\" || position === \"top\";\n  const [first, second] = before ? [panelId, node] : [node, panelId];\n  const direction: MosaicDirection = position === \"left\" || position === \"right\" ? \"row\" : \"column\";\n  const updates = [{ path: newPath, spec: { $set: { first, second, direction } } }];\n  return updates;\n};\n\nexport const addPanelToTab = (\n  insertedPanelId: string,\n  destinationPath: MosaicPath | undefined,\n  destinationPosition: MosaicDropTargetPosition | undefined,\n  tabConfig: PanelConfig | undefined,\n  tabId: string,\n): SaveConfigsPayload => {\n  const safeTabConfig = validateTabPanelConfig(tabConfig) ? tabConfig : DEFAULT_TAB_PANEL_CONFIG;\n\n  const currentTabLayout = safeTabConfig.tabs[safeTabConfig.activeTabIdx]?.layout;\n  const newTree =\n    currentTabLayout != undefined && destinationPath && destinationPosition != undefined\n      ? updateTree<string>(\n          currentTabLayout,\n          createAddUpdates(currentTabLayout, insertedPanelId, destinationPath, destinationPosition),\n        )\n      : insertedPanelId;\n\n  const saveConfigsPayload = {\n    configs: [\n      {\n        id: tabId,\n        config: updateTabPanelLayout(newTree, safeTabConfig),\n      },\n    ],\n  };\n  return saveConfigsPayload;\n};\n\nfunction getValidTabPanelConfig(panelId: string, savedProps: SavedProps): TabPanelConfig {\n  const config = savedProps[panelId];\n  if (!config) {\n    return DEFAULT_TAB_PANEL_CONFIG;\n  }\n  return validateTabPanelConfig(config) ? config : DEFAULT_TAB_PANEL_CONFIG;\n}\n\nexport const reorderTabWithinTabPanel = ({\n  source,\n  target,\n  savedProps,\n}: {\n  source: TabLocation;\n  target: TabLocation;\n  savedProps: SavedProps;\n}): SaveConfigsPayload => {\n  const { tabs, activeTabIdx } = getValidTabPanelConfig(source.panelId, savedProps);\n\n  const sourceIndex = source.tabIndex ?? tabs.length - 1; // source.tabIndex will always be set\n  const targetIndex = target.tabIndex ?? tabs.length - 1; // target.tabIndex will only be set when dropping on a tab\n\n  const nextSourceTabs = [...tabs.slice(0, sourceIndex), ...tabs.slice(sourceIndex + 1)];\n  nextSourceTabs.splice(targetIndex, 0, tabs[sourceIndex]!);\n\n  // Update activeTabIdx so the active tab does not change when we move the tab\n  const movedActiveTab = activeTabIdx === source.tabIndex;\n  const movedToBeforeActiveTab = targetIndex <= activeTabIdx && sourceIndex >= activeTabIdx;\n  const movedFromBeforeActiveTab = sourceIndex <= activeTabIdx && targetIndex >= activeTabIdx;\n\n  let nextActiveTabIdx = activeTabIdx;\n  if (movedActiveTab) {\n    nextActiveTabIdx = targetIndex;\n  } else if (movedToBeforeActiveTab) {\n    nextActiveTabIdx++;\n  } else if (movedFromBeforeActiveTab) {\n    nextActiveTabIdx--;\n  }\n\n  return {\n    configs: [\n      { id: source.panelId, config: { tabs: nextSourceTabs, activeTabIdx: nextActiveTabIdx } },\n    ],\n  };\n};\n\nexport const moveTabBetweenTabPanels = ({\n  source,\n  target,\n  savedProps,\n}: {\n  source: TabLocation;\n  target: TabLocation;\n  savedProps: SavedProps;\n}): SaveConfigsPayload => {\n  const sourceConfig = getValidTabPanelConfig(source.panelId, savedProps);\n  const targetConfig = getValidTabPanelConfig(target.panelId, savedProps);\n\n  const sourceIndex = source.tabIndex ?? sourceConfig.tabs.length;\n  const targetIndex = target.tabIndex ?? targetConfig.tabs.length;\n  const nextTabsSource = [\n    ...sourceConfig.tabs.slice(0, sourceIndex),\n    ...sourceConfig.tabs.slice(sourceIndex + 1),\n  ];\n\n  const nextTabsTarget = targetConfig.tabs.slice();\n  nextTabsTarget.splice(targetIndex, 0, sourceConfig.tabs[sourceIndex]!);\n\n  // Update activeTabIdx so the active tab does not change as we move the tab\n  const movedToBeforeActiveTabSource = sourceIndex <= sourceConfig.activeTabIdx;\n  const nextActiveTabIdxSource = movedToBeforeActiveTabSource\n    ? Math.max(0, sourceConfig.activeTabIdx - 1)\n    : sourceConfig.activeTabIdx;\n\n  const movedToBeforeActiveTabTarget = targetIndex <= targetConfig.activeTabIdx;\n  const nextActiveTabIdxTarget = movedToBeforeActiveTabTarget\n    ? targetConfig.activeTabIdx + 1\n    : targetConfig.activeTabIdx;\n\n  return {\n    configs: [\n      {\n        id: source.panelId,\n        config: { tabs: nextTabsSource, activeTabIdx: nextActiveTabIdxSource },\n      },\n      {\n        id: target.panelId,\n        config: { tabs: nextTabsTarget, activeTabIdx: nextActiveTabIdxTarget },\n      },\n    ],\n  };\n};\n\nexport const replaceAndRemovePanels = (\n  panelArgs: {\n    originalId?: string;\n    newId?: string;\n    idsToRemove?: readonly string[];\n  },\n  layout: MosaicNode<string>,\n): MosaicNode<string> | undefined => {\n  const { originalId, newId, idsToRemove = [] } = panelArgs;\n  const panelIds = getLeaves(layout);\n  if (xor(panelIds, idsToRemove).length === 0) {\n    return newId;\n  }\n\n  return uniq(compact([...idsToRemove, originalId])).reduce(\n    (currentLayout: MosaicNode<string> | undefined, panelIdToRemove) => {\n      if (!panelIds.includes(panelIdToRemove)) {\n        return currentLayout;\n      } else if (currentLayout === originalId) {\n        return newId;\n      } else if (currentLayout == undefined || currentLayout === panelIdToRemove) {\n        return undefined;\n      }\n\n      const pathToNode = getPathFromNode(panelIdToRemove, currentLayout);\n      const update =\n        panelIdToRemove === originalId\n          ? ({ path: pathToNode, spec: { $set: newId } } as MosaicUpdate<string>)\n          : createRemoveUpdate(currentLayout, pathToNode);\n      return updateTree(currentLayout, [update]);\n    },\n    layout,\n  );\n};\n\nexport function getConfigsForNestedPanelsInsideTab(\n  panelIdToReplace: string | undefined,\n  tabPanelId: string | undefined,\n  panelIdsToRemove: readonly string[],\n  savedProps: SavedProps,\n): ConfigsPayload[] {\n  const configs: ConfigsPayload[] = [];\n  const tabPanelIds = Object.keys(savedProps).filter(isTabPanel);\n  tabPanelIds.forEach((panelId) => {\n    const { tabs, activeTabIdx } = getValidTabPanelConfig(panelId, savedProps);\n    const tabLayout = tabs[activeTabIdx]?.layout;\n    if (\n      tabLayout != undefined &&\n      getLeaves(tabLayout).some((id) => panelIdsToRemove.includes(id))\n    ) {\n      const newTabLayout = replaceAndRemovePanels(\n        { originalId: panelIdToReplace, newId: tabPanelId, idsToRemove: panelIdsToRemove },\n        tabLayout,\n      );\n      const newTabConfig = updateTabPanelLayout(\n        newTabLayout,\n        savedProps[panelId] as TabPanelConfig,\n      );\n      configs.push({ id: panelId, config: newTabConfig });\n    }\n  });\n  return configs;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\n/**\n * Casts a value to a possibly undefined value of a new type.\n */\nexport function maybeCast<T>(v: unknown): undefined | T {\n  return v as undefined | T;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\n/**\n * Marks a value as possibly having missing properties even if the specified type is\n * complete. Used to manually add checks for missing values without flagging the\n * @typescript-eslint/no-unnecessary-condition rule.\n *\n * If you need this it probably means your types are not rigorous enough.\n */\nexport function mightActuallyBePartial<T>(value: T): Partial<T> {\n  return value as Partial<T>;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\n// Overwrite the default fetch error handler with one that catches one message: \"Failed to fetch\". We see this often\n// in our logs and want the logs to more fully reflect the error message.\nexport default function overwriteFetch(): void {\n  const originalFetch = global.fetch;\n  global.fetch = async (url: RequestInfo | URL, init?: RequestInit) => {\n    // Use this replacement error instead of the original one, because this one will have the correct stack trace.\n    const replacementError = new TypeError(`Failed to fetch: ${url}`);\n    return await originalFetch(url, init).catch((error) => {\n      if (error.message === \"Failed to fetch\") {\n        throw replacementError;\n      }\n      throw error;\n    });\n  };\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\n// Provide a shim for global process variable users\n// We avoid using the npm process module since it has unfavorable performance for process.nextTick\n// and uses setTimeout(..., 0). Instead we use queueMicrotask which is much faster.\nconst process = {\n  // We want to be able to use Function type for _fn_ param\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  nextTick: (fn: Function, ...args: unknown[]): void => {\n    queueMicrotask(() => {\n      fn(...args);\n    });\n  },\n\n  title: \"browser\",\n  browser: true,\n  env: {},\n  argv: [],\n};\n\n// ts-prune-ignore-next\nexport default process;\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nimport { keyBy } from \"lodash\";\nimport { createSelector } from \"reselect\";\n\nimport { Immutable } from \"@foxglove/studio\";\nimport { Topic } from \"@foxglove/studio-base/players/types\";\nimport { RosDatatypes } from \"@foxglove/studio-base/types/RosDatatypes\";\n\nexport const getTopicsByTopicName = createSelector(\n  (topics: readonly Topic[]) => topics,\n  (\n    topics: readonly Topic[],\n  ): {\n    [key: string]: Topic;\n  } => {\n    return keyBy(topics, ({ name }) => name);\n  },\n);\n\n// Only exported for tests\nexport const constantsByDatatype = createSelector(\n  (datatypes: Immutable<RosDatatypes>) => datatypes,\n  (\n    datatypes,\n  ): {\n    [key: string]: {\n      [key: string]: string;\n    };\n  } => {\n    type Result = Record<string | number, string>;\n    const results: Record<string, Result> = {};\n    for (const [datatype, value] of datatypes) {\n      const result: Result = (results[datatype] = {});\n      for (const field of value.definitions) {\n        if (\n          field.isConstant === true &&\n          field.value != undefined &&\n          typeof field.value !== \"boolean\"\n        ) {\n          if (result[field.value.toString()] != undefined) {\n            result[field.value.toString()] = \"<multiple constants match>\";\n          } else {\n            result[field.value.toString()] = field.name;\n          }\n        }\n      }\n    }\n    return results;\n  },\n);\n\n// Foxglove Studio enum annotations are of the form: \"Foo__foxglove_enum\" (notice double underscore)\n// This method returns type name from \"Foo\" or undefined name doesn't match this format\nexport function extractTypeFromStudioEnumAnnotation(name: string): string | undefined {\n  const match = /(.*)__(foxglove|webviz)_enum$/.exec(name);\n  if (match) {\n    return match[1];\n  }\n  return undefined;\n}\n\n// returns a map of the form {datatype -> {field -> {value -> name}}}\nexport const enumValuesByDatatypeAndField = createSelector(\n  (datatypes: Immutable<RosDatatypes>) => datatypes,\n  (\n    datatypes: Immutable<RosDatatypes>,\n  ): { [datatype: string]: { [field: string]: { [value: string]: string } } } => {\n    const results: { [datatype: string]: { [field: string]: { [value: string]: string } } } = {};\n    for (const [datatype, value] of datatypes) {\n      const currentResult: { [field: string]: { [value: string]: string } } = {};\n      // keep track of parsed constants\n      let constants: { [key: string]: string } = {};\n      // constants' types\n      let lastType: string | undefined;\n      for (const field of value.definitions) {\n        if (lastType != undefined && field.type !== lastType) {\n          // encountering new type resets the accumulated constants\n          constants = {};\n          lastType = undefined;\n        }\n\n        if (\n          field.isConstant === true &&\n          field.value != undefined &&\n          typeof field.value !== \"boolean\"\n        ) {\n          lastType = field.type;\n          if (constants[field.value.toString()] != undefined) {\n            constants[field.value.toString()] = \"<multiple constants match>\";\n          } else {\n            constants[field.value.toString()] = field.name;\n          }\n          continue;\n        }\n        // check if current field is annotation of the form: \"Foo bar__foxglove_enum\"\n        // This means that \"bar\" is enum of type \"Foo\"\n        const fieldName = extractTypeFromStudioEnumAnnotation(field.name);\n        if (fieldName != undefined) {\n          // associate all constants of type field.type with the annotated field\n          const fieldConstants = constantsByDatatype(datatypes)[field.type];\n          if (fieldConstants) {\n            currentResult[fieldName] = fieldConstants;\n          }\n          continue;\n        }\n\n        // this field was already covered by annotation, skip it\n        if (currentResult[field.name]) {\n          continue;\n        }\n\n        // otherwise assign accumulated constants for that field\n        if (Object.keys(constants).length > 0) {\n          currentResult[field.name] = constants;\n        }\n        // and start over - reset constants\n        constants = {};\n      }\n      // only assign result if we found non-empty mapping into constants\n      if (Object.keys(currentResult).length > 0) {\n        results[datatype] = currentResult;\n      }\n    }\n    return results;\n  },\n);\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\n// For some handlers it's important to know if the error was due to the application malfunctioning\n// (programming error, dependency being down, etc) or a user mistake (incorrect/malformed data,\n// etc). We should generally prevent users from making mistakes in the first place, but sometimes\n// its unavoidable to bail out with a generic error message (e.g. when dragging in a malformed\n// ROS bag).\nimport { ReactNode } from \"react\";\n\nimport { reportError } from \"@foxglove/studio-base/reportError\";\nimport { AppError } from \"@foxglove/studio-base/util/errors\";\nimport { inWebWorker } from \"@foxglove/studio-base/util/workers\";\n\nexport type NotificationType = \"app\" | \"user\";\nexport type DetailsType = string | Error | ReactNode;\nexport type NotificationSeverity = \"error\" | \"warn\" | \"info\";\nexport type NotificationHandler = (\n  message: string,\n  details: DetailsType,\n  type: NotificationType,\n  severity: NotificationSeverity,\n) => void;\nexport type NotificationMessage = {\n  readonly id?: string;\n  readonly message: string;\n  readonly details: DetailsType;\n  readonly subText?: string;\n  readonly created?: Date;\n  readonly severity: NotificationSeverity;\n};\n\nconst defaultNotificationHandler: NotificationHandler = (\n  message: string,\n  details: DetailsType,\n  type: NotificationType,\n  severity: NotificationSeverity,\n): void => {\n  if (inWebWorker()) {\n    const webWorkerError =\n      \"Web Worker has uninitialized sendNotification function; this means this error message cannot show up in the UI (so we show it here in the console instead).\";\n    if (process.env.NODE_ENV === \"test\") {\n      throw new Error(webWorkerError);\n    } else {\n      const consoleFn =\n        severity === \"error\" ? console.error : severity === \"warn\" ? console.warn : console.info;\n      consoleFn(webWorkerError, message, details, type);\n    }\n    return;\n  } else if (process.env.NODE_ENV === \"test\") {\n    return;\n  }\n  console.error(\"Notification before error display is mounted\", message, details, type);\n};\n\nlet addNotification: NotificationHandler = defaultNotificationHandler;\n\nexport function setNotificationHandler(handler: NotificationHandler): void {\n  if (addNotification !== defaultNotificationHandler) {\n    throw new Error(\"Tried to overwrite existing NotificationHandler\");\n  }\n  addNotification = handler;\n}\n\nexport function unsetNotificationHandler(): void {\n  if (addNotification === defaultNotificationHandler) {\n    throw new Error(\"Tried to unset NotificationHandler but it was already the default\");\n  }\n  addNotification = defaultNotificationHandler;\n}\n\n// Call this to add an notification to the application nav bar error component if mounted.\n// If the component is not mounted, use the console as a fallback.\nexport default function sendNotification(\n  message: string,\n  details: DetailsType,\n  type: NotificationType,\n  severity: NotificationSeverity,\n): void {\n  // We only want to send non-user errors and warnings to Sentry\n  if (type === \"app\") {\n    if (severity === \"warn\" || severity === \"error\") {\n      reportError(new AppError(details, message));\n    }\n  }\n\n  addNotification(message, details, type, severity);\n}\n\nsendNotification.expectCalledDuringTest = (): void => {\n  throw new Error(\"Should be overriden in setupTestFramework.ts\");\n};\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nexport default function setImmediate(\n  callback: (..._args: unknown[]) => void,\n  ...args: unknown[]\n): NodeJS.Immediate {\n  void Promise.resolve().then(() => callback(...args));\n  return undefined as unknown as NodeJS.Immediate;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2018-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\n// No time functions that require `moment` should live in this file.\nimport log from \"@foxglove/log\";\nimport { Time } from \"@foxglove/rostime\";\nimport { MessageEvent } from \"@foxglove/studio-base/players/types\";\nimport { MarkerArray, StampedMessage } from \"@foxglove/studio-base/types/Messages\";\n\nexport type TimestampMethod = \"receiveTime\" | \"headerStamp\";\n\nexport function formatTimeRaw(stamp: Time): string {\n  if (stamp.sec < 0 || stamp.nsec < 0) {\n    log.error(\"Times are not allowed to be negative\");\n    return \"(invalid negative time)\";\n  }\n  return `${stamp.sec}.${stamp.nsec.toFixed().padStart(9, \"0\")}`;\n}\n\nconst DURATION_20_YEARS_SEC = 20 * 365 * 24 * 60 * 60;\n\n// Values \"too small\" to be absolute epoch-based times are probably relative durations.\nexport function isAbsoluteTime(time: Time): boolean {\n  return time.sec > DURATION_20_YEARS_SEC;\n}\n\nexport function formatFrame({ sec, nsec }: Time): string {\n  return `${sec}.${String.prototype.padStart.call(nsec, 9, \"0\")}`;\n}\n\nexport function getTimestampForMessageEvent(\n  messageEvent: MessageEvent,\n  timestampMethod?: TimestampMethod,\n): Time | undefined {\n  return timestampMethod === \"headerStamp\"\n    ? getTimestampForMessage(messageEvent.message)\n    : messageEvent.receiveTime;\n}\n\nexport function getTimestampForMessage(message: unknown): Time | undefined {\n  if ((message as Partial<StampedMessage>).header != undefined) {\n    // This message has a \"header\" field\n    const stamp = (message as Partial<StampedMessage>).header?.stamp;\n    if (stamp != undefined && \"sec\" in stamp && \"nsec\" in stamp) {\n      return stamp;\n    }\n  } else if ((message as Partial<MarkerArray>).markers?.[0]?.header != undefined) {\n    // This is a marker array message with a \"markers\" array and at least one entry\n    const stamp = (message as MarkerArray).markers[0]?.header.stamp;\n    if (stamp != undefined && \"sec\" in stamp && \"nsec\" in stamp) {\n      return stamp;\n    }\n  }\n\n  return undefined;\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n//\n// This file incorporates work covered by the following copyright and\n// permission notice:\n//\n//   Copyright 2019-2021 Cruise LLC\n//\n//   This source code is licensed under the Apache License, Version 2.0,\n//   found at http://www.apache.org/licenses/LICENSE-2.0\n//   You may not use this file except in compliance with the License.\n\nexport const inWebWorker = (): boolean => {\n  return (\n    typeof global.postMessage !== \"undefined\" &&\n    typeof WorkerGlobalScope !== \"undefined\" &&\n    self instanceof WorkerGlobalScope\n  );\n};\n\n// To debug shared workers, enter 'chrome://inspect/#workers' into the url bar.\nexport const inSharedWorker = (): boolean =>\n  typeof SharedWorkerGlobalScope !== \"undefined\" && self instanceof SharedWorkerGlobalScope;\n\nexport const enforceFetchIsBlocked = <R, Args extends readonly unknown[]>(\n  fn: (...args: Args) => R,\n): ((...args: Args) => Promise<R>) => {\n  const canFetch =\n    typeof fetch !== \"undefined\" &&\n    fetch(\"data:test\")\n      .then(() => true)\n      .catch(() => false);\n  return async (...args) => {\n    if (await canFetch) {\n      throw new Error(\"Content security policy too loose.\");\n    }\n    return fn(...args);\n  };\n};\n"],"names":["id","x","grammar","d","loc","char","acc","arr","module","LazilyInitialized","#state","compute","promise","MutexLocked","#mutex","value","body","debouncePromise","fn","calling","callPending","debouncedFn","args","start","PromiseTimeoutError","promiseTimeout","ms","resolve","reject","Condvar","#waitQueue","item","filterMap","values","mapFn","results","index","mappedItem","useChangeDetector","deps","initiallyTrue","ref","changed","useDeepMemo","useGuaranteedContext","contextType","debugContextName","context","log","useMustNotChangeImpl","valueRef","useRethrow","_","setError","err","useShallowMemo","useValueChangedDebugLogImpl","msg","prevValue","useVisibilityState","visibility","setVisibility","listener","useMemoryInfo","opt","refreshIntervalMs","memoryInfo","setMemoryInfo","interval","selectWithUnstableIdentityWarning","selector","reducer","useCrash","dispatch","useSessionStorageValue","key","updateValue","setValue","newValue","changeListener","event","useSynchronousMountedState","mountedRef","get","AppSetting","selectDatatypes","ctx","selectTopics","selectStartTime","selectCapabilities","selectPlayerId","useDataSourceInfo","datatypes","topics","startTime","capabilities","playerId","selectSetSubscriptions","useMessageReducer","props","restore","addMessage","addMessages","preloadType","useShouldNotChangeOften","requestedTopics","subscriptions","topic","setSubscriptions","state","messageEvents","lastSeekTime","newReducedValue","messageEvent","concatAndTruncate","array1","array2","limit","toTakeFromArray1","ret","toTakeFromArray2","i","useMessagesByTopic","params","historySize","prevMessagesByTopic","messages","newMessagesByTopic","newMessages","retTopic","prevMessages","filterBlockByTopics","block","blockMessages","useSubscribeToTopicsForBlocks","pipelineSetSubscriptions","useBlocksByTopic","allBlocks","useConfigById","panelId","getCurrentLayoutState","savePanelConfigs","configSelector","maybeCast","config","saveConfig","newConfig","currentConfig","APP_BAR_HEIGHT","CopyButtonComponent","children","className","color","edge","size","iconSize","getText","copied","setCopied","handleCopy","React","EMPTY_TOPIC_STATS","smoothValues","oldValue","calculateStaticItemFrequency","numMessages","firstMessageTime","lastMessageTime","duration","durationSec","topicDurationSec","calculateLiveItemFrequency","selectCurrentTime","playerState","selectEndTime","selectTopicStats","selectPlayerCapabilities","EMPTY_FREQUENCIES","useTopicPublishFrequencies","playerCurrentTime","endTime","topicStats","playerCapabilities","samplesByTopic","playerIsStaticSource","currentTime","result","stat","frequency","sample","messageDelta","timeDelta","newFrequency","smoothedFrequency","EM_DASH","DirectTopicStatsUpdater","latestStats","useLatest","updateCount","rootRef","frequenciesByTopic","latestFrequenciesByTopic","updateStats","field","useStyles","theme","EmptyPanelLayout","tabId","classes","cx","addPanel","t","isOver","drop","monitor","onPanelSelect","type","relatedConfigs","EmptyState","ErrorBoundary","error","errorInfo","actions","sanitizeStack","stack","ErrorStacktrace","hideSourceLocations","lines","line","match","ErrorDisplay","hideErrorSourceLocations","showErrorDetails","setShowErrorDetails","errorDetails","stackWithoutMessage","errorString","HoverableIconButton","icon","activeIcon","activeColor","onMouseLeave","onMouseEnter","rest","hovered","setHovered","handleMouseEnter","handleMouseLeave","validationErrorToString","validationResult","useState","useCallback","useRef","useLayoutEffect","useEffect","ValidatedInputBase","dataTestId","dataValidator","onChange","onError","parse","readOnly","maxHeight","stringify","inputStr","setInputStr","prevIncomingVal","inputRef","isEditing","setIsEditing","memorizedInputValidation","newInputVal","onChangeFcn","newVal","newError","e","handleChange","val","inputElem","Stack","Error","Typography","JsonInput","callHandlers","handlers","preventDefault","KeyListener","element","handleEvent","target","Constants","renderRow","data","style","dataSet","inlineStyle","OuterElementContext","OuterElementType","outerProps","ReactWindowListboxAdapter","other","itemData","totalHeight","MAX_FZF_MATCHES","defaultGetText","name","EMPTY_SET","itemToFzfResult","HighlightChars","useTheme","nodes","stateValue","getItemText","getItemValue","selectedItem","disabled","filterText","items","onBlurCallback","onChangeCallback","onSelectCallback","placeholder","selectOnFocus","sortWhenFiltering","fzfUnfiltered","fzf","autocompleteItems","hasError","selectedItemValue","setSelectionRange","selectionStart","selectionEnd","focus","blur","_event","onSelect","selectedValue","filterOptions","options","Cancel","TextField","optProps","selected","itemValue","MenuItem","getFieldPaths","output","addFieldPathsForType","curPath","typeName","seenTypes","msgdef","fieldPath","tryToSetDefaultGlobalVar","variableName","setGlobalVariables","defaultVar","getFirstInvalidVariableFromRosPath","rosPath","globalVariables","messagePath","globalVars","path","messagePathParts","getExamplePrimitive","primitiveType","useGlobalVariables","PanelAPI","supportsMathModifiers","prioritizedDatatype","validTypes","autoSize","noMultiSlices","inputStyle","disableAutocomplete","topicFields","onChangeProp","rawValue","newCursorPosition","setImmediate","autocomplete","autocompleteType","autocompleteRange","completeStart","completeEnd","completedPath","completedField","isSimpleField","messageIsValidType","keepGoingAfterTopicName","parseRosPath","topicName","messagePathStructuresForDataype","structureTraversalResult","invalidGlobalVariablesVariable","topicNamesAutocompleteItems","topicNamesAndFieldsAutocompleteItems","autocompleteFilterText","msgPathPart","initialFilterLength","messagePathsForDatatype","msgPath","orderedAutocompleteItems","Autocomplete","TypicalFilterNames","typicalFilterNameRegex","isTypicalFilterName","sortFn","naturalSort","a","b","rosPrimitives","STRUCTURE_ITEM_INTEGER_TYPES","isRosPrimitive","structureItemIsIntegerPrimitive","lastDatatypes","lastStructures","messagePathStructures","structureFor","datatype","seenDatatypes","nextByName","rosDatatype","msgField","next","validTerminatingStructureItem","structureItem","clonedMessagePath","messagePaths","traverse","builtString","typicalFilterItem","typicalFilterName","typicalFilterValue","matchingFilterPart","pathPart","traverseStructure","initialStructureItem","currentItem","assertNever","grammarObj","quoteTopicNameIfNeeded","quoteFieldNameIfNeeded","parser","getTopicsFromPaths","paths","DRIFT_THRESHOLD_SEC","WAIT_FOR_SEEK_SEC","MessageOrderTracker","#lastMessages","#lastCurrentTime","#lastMessageTime","#lastMessageTopic","#lastLastSeekTime","#warningTimeout","#trackIncorrectMessages","#incorrectMessages","problems","messagesRecomputed","didSeek","message","messageTime","info","formattedTime","errorMessage","MAX_PROMISE_TIMEOUT_TIME_MS","pauseFrameForPromises","promises","sendNotification","defaultPlayerState","createMessagePipelineStore","promisesToWaitForRef","initialPlayer","set","action","payloads","payload","service","request","player","condvar","updateSubscriberAction","prevState","previousSubscriptionsById","newTopicsBySubscriberId","newTopics","previousSubscription","prevTopics","sub","newTopic","actionTopics","newSubscriptionsById","subscriberIdsByTopic","subs","subscription","ids","updatePlayerStateAction","seenTopics","messagesBySubscriberId","subsById","lastMessageEventByTopic","subscriberMessageEvents","msgEvent","newPublicState","newPublishersById","ContextInternal","useMessagePipelineGetter","store","useMessagePipeline","selectRenderDone","selectSubscriptions","MessagePipelineProvider","debouncedPlayerSetSubscriptions","messageRate","useAppConfigurationValue","renderDone","msPerFrameRef","cleanupListener","createPlayerListener","concatProblems","origState","updateState","messageOrderTracker","closed","resolveFn","listenerPlayerState","newPlayerState","called","delta","frameTime","promisesToWaitFor","MosaicPathContext","PanelErrorBoundary","reportError","Link","Button","usePanelDrag","sourceTabId","onDragStart","onDragEnd","mosaicWindowActions","mosaicId","getCurrentLayout","startDrag","endDrag","connectDragSource","connectDragPreview","useDrag","selectedLayout","originalLayout","originalConfigById","deferredHide","ownPath","dropResult","position","destinationPath","targetTabId","FALLBACK_PANEL_ID","Panel","PanelComponent","ConnectedPanel","childId","overrideConfig","otherProps","isMounted","useMountedState","mosaicActions","selectedPanelIds","setSelectedPanelIds","selectAllPanels","togglePanelSelected","getSelectedPanelIds","isSelected","numSelectedPanelsIfSelected","updatePanelConfigs","createTabPanel","closePanel","swapPanel","quickActionsKeyPressed","setQuickActionsKeyPressed","fullscreen","setFullscreen","fullscreenSourceRect","setFullscreenSourceRect","hasFullscreenDescendant","_setHasFullscreenDescendant","panelRootRef","panelCatalog","mosaicPath","isTopLevelPanel","parentPanelContext","PanelContext","title","defaultConfig","savedConfig","resetPanel","savedDefaultConfig","panelComponentConfig","openSiblingPanel","panelType","siblingConfigCreator","updateIfExists","panelsState","siblingDefaultConfig","siblingPanelInfo","siblingModule","lastNode","siblingPathEnd","siblingPath","siblingId","siblingConfig","newPanelPath","newPanelConfig","newPanelId","replacePanel","newPanelType","panelSettingsOpen","onPanelRootClick","groupPanels","layout","createTabs","removePanel","splitPanel","savedProps","tabSavedProps","newId","activeTabLayout","pathToPanelInTab","newTabLayout","newTabConfig","enterFullscreen","exitFullscreen","setHasFullscreenDescendant","keyUpHandlers","keyDownHandlers","fullScreenKeyHandlers","otherPanelProps","childProps","child","renderCount","perfInfo","quickActionsOverlayRef","overlay","dragSpec","connectOverlayDragSource","connectOverlayDragPreview","connectToolbarDragHandle","connectToolbarDragPreview","_id","_phase","actualDuration","_baseDuration","_startTime","_commitTime","_interactions","Transition","fullscreenState","PanelRoot","el","Tab","LibraryAddOutlined","DeleteForeverOutlined","BorderAll","TextHighlight","targetStr","searchText","PanelGridCard","searchQuery","panel","onClick","targetString","onClickWithStopPropagation","Card","CardActionArea","CardMedia","CardContent","PanelGrid","filteredPanels","displayPanelListItem","panelInfo","Container","_params","PanelListItem","onDrop","checked","highlighted","scrollRef","_item","highlightedItem","scrollContainer","scrollContainerToTop","mergedRef","Tooltip","Fade","ListItem","ListItemButton","ListItemText","blurActiveElement","PanelList","highlightedPanelIdx","selectedPanelType","dropPanel","onPanelMenuItemDrop","highlightedPanel","List","spacing","palette","verifyPanels","panels","panelTypes","mightActuallyBePartial","dispName","existingPanel","otherDisplayName","PanelCatalog","isMenu","mode","setSearchQuery","setHighlightedPanelIdx","handleSearchChange","query","namespacedPanels","countByTitle","allRegularPanels","allPreconfiguredPanels","regular","preconfigured","sortByTitle","getFilteredPanels","searchResult","filteredRegularPanels","filteredPreconfiguredPanels","allFilteredPanels","noResults","onKeyDown","existing","Search","IconButton","Close","usePanelContext","PanelConfigVersionError","Paper","converterKey","schema","convertMessage","converters","convertedMessages","matchedConverters","converter","convertedMessage","mapDifference","newValues","collateTopicSchemaConversions","sortedTopics","messageConverters","topicSchemaConverters","unconvertedSubscriptionTopics","noConversion","subscriberTopic","existingConverters","conv","forEachSortedArrays","arrays","compareFn","forEach","cursors","minCursorIndex","cursor","array","minItem","EmptyParameters","initRenderStateBuilder","prevVariables","prevBlocks","prevSeekTime","prevSortedTopics","prevMessageConverters","prevSharedPanelState","prevCurrentFrame","prevCollatedConversions","lastMessageByTopic","memoMapDifference","memoCollateTopicSchemaConversions","prevRenderState","input","appSettings","colorScheme","currentFrame","hoverValue","sharedPanelState","watchedFields","shouldRender","activeData","renderState","collatedConversions","conversionsChanged","newConverters","parameters","convertibleTo","postProcessedFrame","newBlocks","blocksToProcess","frames","topicsToPreloadForPanel","stamp","VERSION_CONFIG_KEY","isVersionedPanelConfig","selectContext","selectInstalledMessageConverters","PanelExtensionAdapter","initPanel","highestSupportedConfigVersion","initialState","messagePipelineContext","pauseFrame","seekPlayback","dataSourceProfile","setWatchedFields","localSubscriptions","setLocalSubscriptions","setAppSettings","subscribedAppSettings","setSubscribedAppSettings","renderFn","setRenderFn","isPanelInitializedRef","slowRender","setSlowRender","setDefaultPanelTitle","setHoverValue","clearHoverValue","advertisementsRef","appConfiguration","getMessagePipelineContext","buildRenderState","setBuildRenderState","setSharedPanelState","handler","old","newAppSettings","renderingRef","resumeFrame","doneCalled","updatePanelSettingsTree","partialExtensionContext","getState","existingConfig","seekTarget","secondsFromStart","newWatchedFields","subscribePayloads","localSubs","settings","panelContainerRef","configTooNew","latestConfig","panelElement","onUnmount","renderFunction","PanelToolbar","PanelRemounter","sequenceNumber","UnconnectedUnknownPanel","UnknownPanel","TabMosaicWrapper","useDrop","nestedDropResult","UnconnectedPanelLayout","createTile","defaultPanelType","panelComponents","renderTile","mosaicWindow","CircularProgress","bodyToRender","newLayout","LoadingState","selectedLayoutLoadingSelector","selectedLayoutExistsSelector","selectedLayoutMosaicSelector","PanelLayout","layoutEmptyState","changePanelLayout","layoutExists","layoutLoading","mosaicLayout","registeredExtensions","PANEL_ROOT_CLASS_NAME","usePanelRootStyles","transitions","sourceRect","classNames","ChangePanelMenu","anchorEl","onClose","panelContext","open","handleSwap","fixMui35287","Popper","TransitionProps","placement","Grow","ClickAwayListener","getPanelTypeFromMosaic","node","PanelActionsDropdown","isUnknownPanel","menuAnchorEl","setMenuAnchorEl","subMenuAnchorEl","setSubmenuAnchorEl","menuOpen","submenuOpen","getPanelType","handleMenuClick","handleMenuClose","handleSubmenuClick","handleSubmenuClose","handleSubmenuMouseEnter","close","split","direction","menuItems","buttonRef","ToolbarIconButton","MoreVert","Menu","ChevronRight","Divider","idx","PanelToolbarControlsComponent","additionalIcons","PanelCatalogContext","openPanelSettings","useWorkspaceActions","hasSettingsSelector","hasSettings","openSettings","showSettingsButton","Settings","PanelToolbarControls","PANEL_TOOLBAR_MIN_HEIGHT","backgroundColor","isFullscreen","customTitle","additionalIconsWithHelp","FullscreenExit","rootDragRef","controlsDragRef","defaultPanelTitle","componentId","isTimestampScale","scales","Wrapper","VerticalBarWrapper","xValue","positionX","xScale","pixels","range","pos","NullAnalytics","AnalyticsContext","useAnalytics","AppConfigurationContext","useAppConfiguration","storage","AppContext","useAppContext","toggleSelectedPanel","containingTabId","configById","panelIdsToDeselect","activeTabIdx","tabs","childrenPanelIds","parentTabPanelByPanelId","nextParentId","parentTabPanelIds","nextSelectedPanelIds","CurrentLayoutContext","usePanelMosaicId","useCurrentLayoutActions","useCurrentLayoutSelector","currentLayout","forceUpdate","mounted","layoutState","useSelectedPanels","setSelectedPanelIdsState","newIds","panelIds","selectedIds","CurrentUserContext","useCurrentUser","useCurrentUserType","user","ExtensionCatalogContext","useExtensionCatalog","equalityFn","usePanelCatalog","PanelStateContext","usePanelStateStore","PlayerSelectionContext","usePlayerSelection","TimelineInteractionStateContext","selectClearHoverValue","useClearHoverValue","useTimelineInteractionState","selectSetHoverValue","useSetHoverValue","useHoverValue","hasArgs","UserNodeStateContext","UserNodeStateProvider","setState","setUserNodeDiagnostics","nodeId","diagnostics","addUserNodeLogs","logs","clearUserNodeLogs","setUserNodeRosLib","rosLib","setUserNodeTypesLib","typesLib","useUserNodeState","SidebarItemKeys","LeftSidebarItemKeys","RightSidebarItemKeys","WorkspaceContext","WorkspaceStoreSelectors","useWorkspaceStore","showOpenFilePicker","files","file","blob","url","useOpenFile","sources","selectSource","allExtensions","all","source","fileHandle","matchingSources","extension","foundSource","setterValue","signIn","supportsAccountSettings","availableSources","openFile","setter","draft","selectedDataSourceDialogItem","dataSource","initialTab","tour","repeat","selectedSidebarItem","selectedLeftSidebarItem","leftSidebarOpen","oldItem","leftSidebarSize","selectedRightSidebarItem","rightSidebarOpen","rightSidebarSize","useAppTimeFormat","timeFormat","setTimeFormat","timeZone","effectiveFormat","formatDateCallback","date","formatTimeCallback","formatTime","formatDurationCallback","configurationValue","setConfigurationValue","wrappedSetter","EMPTY_GLOBAL_VARIABLES","globalVariablesSelector","overwriteGlobalVariables","warn","prev","prevPrev","lastTime","DialogHostIdContext","useDialogHostId","GlobalCss","GlobalStyles","EventsContext","useEvents","NO_EVENTS","createEventsStore","events","filter","eventsSupported","deviceId","EventsProvider","StudioLogsSettingsContext","useStudioLogsSettings","defaultGlobalLevel","createStudioLogsSettingsStore","globalLevel","disabledChannels","channels","channelByName","sortedChannels","channel","regenerateChannels","currentGlobalLevel","didChange","logChannels","anyChannel","level","prefix","StudioLogsSettingsProvider","studioLogsSettingsSavedState","setStudioLogsSettingsSavedState","useLocalStorage","studioLogsSettingsStore","setStudioLogsSettingsStore","savedStateRef","storeChannelsCount","intervalHandle","createTimelineInteractionStateStore","eventsAtHoverValue","newBounds","hoveredEvent","TimelineInteractionStateProvider","tinycolor","AppBarIconButton","DEFAULT_END_TEXT_LENGTH","TextMiddleTruncate","text","endTextLength","startTextLen","startText","endText","NestedMenuItem","onPointerEnter","setAnchorEl","handlePointerEnter","selectWorkspace","AppMenu","handleClose","anchorReference","anchorPosition","disablePortal","nestedMenu","setNestedMenu","currentUserType","analytics","recentSources","selectRecent","shallow","sidebarActions","dialogActions","handleNestedMenuClose","handleItemPointerEnter","handleAnalytics","cta","fileItems","recent","viewItems","onAboutClick","onDocsClick","onSlackClick","onDemoClick","helpItems","CustomWindowControls","isMaximized","onMinimizeWindow","onMaximizeWindow","onUnmaximizeWindow","onCloseWindow","Minimize","FilterNone","CheckBoxOutlineBlank","FoxgloveLogo","SvgIcon","toMB","bytes","MemoryUseIndicator","usedPercent","usedMb","limitMb","useAddPanel","AddPanelMenu","selection","WssErrorModal","playerProblems","setOpen","hasDismissedWssErrorModal","setHasDismissedWssErrorModal","hasWssConnectionProblem","problem","Dialog","ICON_SIZE","_classes","selectPlayerPresence","selectPlayerProblems","DataSource","playerPresence","reconnecting","initializing","loading","setSource","handleClick","selectedSource","reason","liveAnim","sourceItems","Chip","BusinessCenter","StyledMenu","styled","KeyboardArrowDown","ConfirmModal","originalOnComplete","completed","onComplete","useKeyPressEvent","buttons","DialogTitle","DialogContent","DialogActions","useConfirm","modal","setModal","UserMenu","currentUser","signOut","enqueueSnackbar","confirm","confirmModal","beginSignOut","onSignoutClick","response","onSignInClick","onSettingsClick","tab","onProfileClick","process","leftInset","debugDragRegion","DRAGGABLE_STYLE","NOT_DRAGGABLE_STYLE","selectCurrentLayoutId","disableSignIn","onDoubleClick","showCustomWindowControls","appBarLayoutButton","enableMemoryUseIndicator","currentLayoutId","appMenuEl","setAppMenuEl","userAnchorEl","setUserAnchorEl","panelAnchorEl","setPanelAnchorEl","appMenuOpen","userMenuOpen","panelMenuOpen","container","navButton","navButton2","navCurrent","handleDoubleClick","Avatar","Snow","effect","containerRef","requestID","scene","camera","POINT_COUNT","positions","colors","sizes","phases","vertex","geometry","material","points","renderer","render","time","animating","animate","BlockheadFilledIcon","BlockheadIcon","_g","_extends","SvgDatabaseSettings","_path","SvgPanelLayout","SvgPanelSettings","BuiltinIcon","FormField","maybeError","FormHelperText","View","onOpen","ChevronLeft","selectDataSourceDialog","Connection","mdUp","useMediaQuery","activeDataSource","connectionSources","enabledSourcesFirst","enabledSources","disabledSources","selectedConnectionIdx","setSelectedConnectionIdx","foundIdx","selectedIdx","fieldErrors","setFieldErrors","fieldValues","setFieldValues","connectionIdx","defaultFieldValues","disableOpen","onSubmit","Tabs","iconName","displayName","Alert","FoxgloveLogoText","DataSourceOption","secondaryText","href","button","SidebarItems","onSelectView","freeUser","teamOrEnterpriseUser","demoItem","sidebarItems","Start","startItems","DataSourceDialogItems","DataSourceDialog","backdropAnimation","activeView","firstSampleSource","onModalClose","backdrop","now","view","DropOverlay","DocumentDropListener","hovering","setHovering","onDropProp","allowedExtensions","ev","handles","handlePromises","allFiles","directories","dataItems","entry","fileSystemHandle","directory","entries","filteredFiles","filteredHandles","handle","onDragOver","dataTransfer","onDragLeave","HighlightedText","highlight","regex","parts","part","formatEventDuration","intDuration","EventViewComponent","isHovered","onHoverStart","onHoverEnd","fields","EventView","selectSeek","selectEventFilter","selectSetEventFilter","selectEvents","selectHoveredEvent","selectSetHoveredEvent","selectEventsAtHoverValue","selectSelectedEventId","selectSelectEvent","EventsList","selectedEventId","selectEvent","seek","setHoveredEvent","setFilter","timestampedEvents","clearFilter","AppBar","Clear","MultiProvider","providers","wrapped","wrappedChildren","provider","ActionMenu","allowShare","onReset","onShare","fontSize","isValidHexColor","alphaType","ColorPickerControl","onEnterKey","parsedValue","swatchColor","editedValue","setEditedValue","editedValueIsInvalid","updateColor","updateEditedValue","Tag","calculateBorderColor","parsedColor","ColorSwatch","ColorPickerInput","hideClearButton","anchorElement","setAnchorElement","displayValue","clearValue","shouldHideClearButton","Popover","ColorGradientInput","leftAnchor","setLeftAnchor","rightAnchor","setRightAnchor","handleLeftClick","handleRightClick","leftColor","rightColor","safeLeftColor","safeRightColor","NumberInput","iconDown","iconUp","step","min","max","precision","scrubValue","latestValue","placeHolderValue","clampedValue","onPointerDown","scrubStart","onPointerUp","onPointerMove","scale","Vec2Input","inputValue","Vec3Input","UNDEFINED_SENTINEL_VALUE","INVALID_SENTINEL_VALUE","prefersDarkMode","inputBackgroundColor","FieldInput","actionHandler","MenuList","option","ToggleButtonGroup","ToggleButton","MessagePathInput","selectedOptionIndex","selectedOption","isEmpty","selectValue","Select","_value","label","FieldLabel","labels","FieldEditorComponent","paddingLeft","FieldEditor","NodeActionsMenu","onSelectAction","anyItemHasIcon","Icon","ListItemIcon","VisibilityToggle","Checkbox","prepareSettingsNodes","roots","filterTreeNodes","filtered","NODE_HEADER_MIN_HEIGHT","ExpansionArrow","expanded","Component","ArrowRight","makeStablePath","SelectVisibilityFilterOptions","showVisibleFilter","showInvisibleFilter","getSelectVisibilityFilterField","NodeEditorComponent","defaultOpen","focusedPath","indent","allowVisibilityToggle","visible","selectVisibilityFilterEnabled","selectVisibilityFilter","toggleVisibility","handleNodeAction","actionId","isFocused","hasChildren","hasProperties","fieldEditors","filterFn","childNodes","NodeEditor","IconComponent","onEditLabel","toggleEditing","toggleOpen","onLabelKeyDown","inlineActions","menuActions","Check","Edit","SettingsTreeEditor","setFilterText","filteredNodes","definedNodes","selectedPanelId","customPanelTitle","panelTitleField","handleTitleChange","showTitleField","root","outlinedInputClasses","ShareJsonModal","initialValue","onRequestClose","decodedValue","handleSubmit","handleDownload","download","CopyButton","DeleteOutline","singlePanelIdSelector","selectIncrementSequenceNumber","EMPTY_SETTINGS_TREE","PanelSettings","selectedPanelIdsForTests","singlePanelId","originalSelectedPanelIds","useUnmount","incrementSequenceNumber","showShareModal","setShowShareModal","shareModal","panelConfigById","settingsTree","resetToDefaults","fadeInAnimation","selectRefreshEvents","selectDeviceId","CreateEventDialog","refreshEvents","setEvent","updateMetadata","updateType","keyval","appModuleCreateEvent","countedMetadata","kv","duplicateKey","count","canSubmit","createdEvent","createEvent","useAsyncFn","filteredMeta","keyedMetadata","onMetaDataKeyDown","keyboardEvent","addRow","removeRow","formattedStartTime","FormControl","FormLabel","oldEvent","_ev","durationUnit","ButtonGroup","Add","hasDuplicate","evt","Remove","Timestamp","disableDate","horizontal","formatDate","currentTimeStr","rawTimeStr","MultilineMiddleTruncate","selectPlayerName","DataSourceInfoContent","disableSource","durationRef","endTimeRef","playerName","isLiveConnection","Skeleton","MemoDataSourceInfoContent","EmDash","DataSourceInfoView","durationStr","EventIcon","EventOutlinedIcon","SPEED_OPTIONS","formatSpeed","configSpeedSelector","PlaybackSpeedControls","configSpeed","speed","setPlaybackSpeed","setPlaybackConfig","setSpeed","newSpeed","displayedSpeed","ArrowDropDown","filledInputClasses","iconButtonClasses","inputBaseClasses","PlaybackTimeMethodMenu","timeRawString","timeOfDayString","PlaybackTimeDisplayMethod","timezone","onSeek","onPause","isPlaying","timeOutID","currentTimeString","inputText","setInputText","setHasError","validTimeAndMethod","Warning","selectActiveData","PlaybackTimeDisplay","activeDataSelector","RepeatAdapter","play","repeatEnabled","EventTick","left","right","MemoEventTick","EventsOverlay","getStartTime","getEndTime","PlaybackBarHoverTicks","width","hoverTimeDisplay","scaleBounds","displayHoverTime","HoverBar","selectHoveredEvents","PlaybackControlsTooltipContent","hoveredEvents","timeFromStart","tooltipItems","metaKey","metaValue","STRIPE_WIDTH","animatedBackground","ProgressPlot","availableRanges","clampedRanges","ranges","mergedRanges","interpolateValue","scaleValue","minA","maxA","minB","maxB","defaultRenderSlider","Slider","fraction","renderSlider","onHoverOver","onHoverOut","elRef","getValueAtMouse","scaled","mouseDown","setMouseDown","mouseDownRef","mouseInside","setMouseInside","mouseInsideRef","elRect","selectRanges","selectPresence","Scrubber","hoverComponentId","presence","hoverInfo","setHoverInfo","latestHoverInfo","latestStartTime","latestEndTime","clientX","clientY","popperRef","popperProps","ARROW_SEEK_BIG_MS","ARROW_SEEK_DEFAULT_MS","ARROW_SEEK_SMALL_MS","DIRECTION","jumpSeek","directionSign","modifierKeys","timeMs","deltaMs","selectEventsSupported","selectPlaybackRepeat","PlaybackControls","pause","getTimeInfo","playUntil","createEventDialogOpen","setCreateEventDialogOpen","setRepeat","toggleRepeat","togglePlayPause","end","current","seekForwardAction","targetTime","seekBackwardAction","toggleCreateEventDialog","disableControls","accordionSummaryClasses","ProblemIcon","severity","ProblemDetails","details","tip","content","AccordionDetails","ProblemsList","Accordion","AccordionSummary","RemountOnValueChange","Parent","Noop","Sidebar","anchor","activeTab","setActiveTab","SelectedComponent","Badge","mosiacLeftSidebarSplitPercentage","mosiacRightSidebarSplitPercentage","Sidebars","leftItems","selectedLeftKey","onSelectLeftKey","setLeftSidebarSize","rightItems","selectedRightKey","onSelectRightKey","setRightSidebarSize","mosaicValue","setMosaicValue","defaultLeftPercentage","defaultRightPercentage","onChangeMosaicValue","AccountSyncGraphic","SigninForm","SignInFormModal","useStudioLogsSettingsTree","logsConfig","itemDetailByPath","settingsRoot","miscRoot","channelName","studioSpacePrefix","pkgName","srcPath","component","pkgNode","componentNode","leafId","enable","pathStr","StudioLogsSettings","logSettings","LayoutManagerContext","useLayoutManager","EMPTY_UNSAVED_LAYOUTS","SAVE_INTERVAL_MS","selectCurrentLayout","CurrentLayoutSyncAdapter","layoutManager","unsavedLayouts","setUnsavedLayouts","debouncedUnsavedLayouts","debouncedUnsavedLayoutActions","useAsync","unsavedLayoutsSnapshot","updateAppURLState","urlState","newURL","k","v","parseAppURLState","ds","layoutId","timeString","dsParams","cleanKey","windowAppURLState","selectCanSeek","selectUrlState","updateUrl","newState","newStateUrl","useStateToURLSynchronization","playerUrlState","stablePlayerUrlState","canSeek","debouncedCurrentTime","URLStateSyncAdapter","SyncAdapters","syncAdapters","topicToFzfResult","str","indices","offset","selectSortedTopics","TopicListItem","MemoTopicListItem","TopicList","filteredTopics","changeGlobalKey","newKey","oldKey","keys","Variable","editedName","setEditedName","setExpanded","deleteVariable","onChangeValue","onBlur","activeElementIsChild","isDuplicate","InputBase","ANIMATION_RESET_DELAY_MS","VariablesList","globalVariableNames","skipAnimation","timeoutId","previousGlobalVariablesRef","changedVariables","setChangedVariables","newChangedVariables","timerId","useFeatures","ExperimentalFeatureItem","feature","enabled","setEnabled","FormControlLabel","ExperimentalFeatureSettings","features","LinkHandlerContext","TextContentRoot","shape","typography","shadows","TextContent","allowMarkdownHtml","handleLink","linkRenderer","linkProps","ExtensionMarketplaceContext","useExtensionMarketplace","extensionMarketplace","ExtensionDetails","installed","isInstalled","setIsInstalled","downloadExtension","installExtension","uninstallExtension","marketplace","readmeUrl","changelogUrl","canInstall","canUninstall","readmeContent","changelogContent","install","isDesktopApp","uninstall","displayNameForNamespace","namespace","ExtensionListEntry","description","publisher","version","ExtensionsSettings","focusedExtension","setFocusedExtension","marketplaceEntries","refreshMarketplaceEntries","marketplaceMap","installedEntries","marketplaceEntry","namespacedEntries","filteredMarketplaceEntries","LaunchPreferenceValue","MESSAGE_RATES","LANGUAGE_OPTIONS","formatTimezone","tz","zoneAbbr","offsetStr","ColorSchemeSettings","setColorScheme","DarkMode","Brightness5","Computer","TimezoneSettings","setTimezone","detectItem","fixedItems","timezoneItems","allItems","TimeFormat","orientation","exampleTime","LaunchDefault","preference","setPreference","sanitizedPreference","Web","QuestionAnswerOutlined","MessageFramerate","setMessageRate","rate","AutoUpdate","updatesEnabled","setUpdatedEnabled","RosPackagePath","rosPackagePath","setRosPackagePath","rosPackagePathPlaceholder","LanguageSettings","i18n","selectedLanguage","setSelectedLanguage","onChangeLanguage","lang","language","aboutItems","selectWorkspaceInitialActiveTab","AppSettingsDialog","_activeTab","initialActiveTab","crashReportingEnabled","setCrashReportingEnabled","telemetryEnabled","setTelemetryEnabled","smUp","supportsAppUpdates","handleTabChange","InfoOutlined","WarningAmber","link","selectWorkspacePrefsDialogOpen","WorkspaceDialogs","prefsDialogOpen","NativeAppMenuContext","useNativeAppMenu","selectHasUrlState","useDefaultWebLaunchPreference","hasUrlState","launchPreference","setLaunchPreference","useElectronFilesToOpen","fileList","setFileList","update","useSyncSourceFromUrl","targetUrlState","currentUserRequired","unappliedSourceArgs","setUnappliedSourceArgs","useSyncLayoutFromUrl","setSelectedLayoutId","unappliedLayoutArgs","setUnappliedLayoutArgs","useSyncTimeFromUrl","unappliedTime","setUnappliedTime","useInitialDeepLinkStateMounted","useInitialDeepLinkState","deepLinks","currentUserRequiredParam","useNativeAppMenuEvent","eventName","nativeAppMenu","migrateV0WorkspaceState","oldState","_version","v0State","createWorkspaceContextStore","WorkspaceContextProvider","activeElementIsInput","keyboardEventHasModifier","DEFAULT_DEEPLINKS","selectPlayerIsPresent","selectIsPlaying","selectPause","selectPlay","selectPlayUntil","selectWorkspaceDataSourceDialog","selectWorkspaceSidebarItem","selectWorkspaceLeftSidebarItem","selectWorkspaceLeftSidebarOpen","selectWorkspaceLeftSidebarSize","selectWorkspaceRightSidebarItem","selectWorkspaceRightSidebarOpen","selectWorkspaceRightSidebarSize","WorkspaceContent","sidebarItem","dataSourceDialog","leftSidebarItem","rightSidebarItem","allowedDropExtensions","extensions","enableStudioLogsSidebar","workspaceExtensions","openHandle","arrayBuffer","matchedSource","ext","openFiles","otherFiles","filesToOpen","dropHandler","showEventsTab","leftSidebarItems","rightSidebarItems","getMessagePipeline","PanelStateContextProvider","Workspace","showOpenDialogOnStartup","isPlayerPresent","showSignInForm","initialItem","ColorSchemeThemeProvider","systemSetting","useMedia","isDark","ThemeProvider","DocumentTitleAdapter","NativeWindowContext","useNativeWindow","IDB_KEY","IDB_STORE","useIndexedDbRecents","initialRecents","recents","setRecents","newRecentsRef","save","recentsToSave","newRecent","exists","savedRecent","haveUnsavedRecents","addRecent","record","fullRecord","AnalyticsMetricsCollector","#metadata","#analytics","_time","_speed","_subscriptions","_bytes","_metadata","EmptyAliasMap","aliasBlocks","blocks","mapping","mappings","mappedTopic","aliasMessages","mappedMessages","aliasPublishedTopics","mappedTopics","mappedValues","aliasSubscribedTopics","subcriptions","subscriptionsByTopic","mapped","aliasProgress","progress","memos","aliasTopics","aliasTopicStats","stats","mappedStats","invertAliasMap","aliasMap","inverted","mergeAliases","maps","inputs","inverseMapping","merged","extensionId","aliases","sourceTopicName","existingMapping","mergedValues","buildAliases","mapper","map","aliasPlayerState","aliasSubscriptions","TopicAliasingPlayer","#player","#inputs","#pendingSubscriptions","#subscriptions","#skipAliasing","#listener","aliasFunctions","variables","#onPlayerState","aliasedSubscriptions","publishers","speedFraction","MemoizedLibGenerator","#datatypes","#topics","#fn","#cached","lib","hasTransformerErrors","nodeData","basicDatatypes","def","definition","maybePlainObject","rawVal","UserNodePlayer","#memoizedNodeDatatypes","#memoizedNodeTopics","#nodeSubscriptions","#unusedNodeRuntimeWorkers","#setUserNodeDiagnostics","#addUserNodeLogs","#nodeTransformRpc","#globalVariables","#userNodeActions","#rosLibGenerator","#typesLibGenerator","#playerState","#problemStore","#lastMessageByInputTopic","#userNodeIdsNeedUpdate","#globalVariablesChanged","#protectedState","#emitLock","userNodeActions","generateTypesLib","#getTransformWorker","#getTopics","nodeTopics","#getDatatypes","nodeDatatypes","allDatatypes","userNodeDatatypes","#lastBlockRequest","#getMessages","inputMessages","nodeRegistrations","identity","outputMessages","messagePromises","nodeRegistration","messagePromise","#getBlocks","fullRegistrations","reg","allInputTopics","outputBlocks","messagesByTopic","outTopic","outputMessage","userNodes","prevNode","newNode","maxNodeRegistrationCacheCount","#resetWorkersUnlocked","#setSubscriptionsUnlocked","lastActive","#createNodeRegistration","userNode","cacheEntry","sourceCode","transformMessage","inputTopics","outputTopic","transpiledCode","projectCode","outputDatatype","problemKey","buildMessageProcessor","rpc","worker","#queueEmitState","port","Rpc","userNodeDiagnostics","userNodeLogs","allDiagnostics","messageProcessor","blockProcessor","#getRosLib","#getTypesLib","allNodeRegistrations","validNodeRegistrations","playerTopics","allNodeOutputs","changedTopicsRequireEmitState","top","newDatatypes","didUpdate","shouldReset","inputTopicsForRecompute","userNodeId","inputTopic","messagesForRecompute","messageForRecompute","computed","recomputed","currentFrameMessages","playerProgress","nodeSubscriptions","realTopicSubscriptions","EMPTY_USER_NODES","userNodesSelector","selectTopicAliasFunctions","catalog","PlayerManager","playerSources","nativeWindow","metricsCollector","layoutStorage","basePlayer","setBasePlayer","setSelectedSource","topicAliasFunctions","globalVariablesRef","initialTopicAliasFunctions","initialGlobalVariables","topicAliasPlayer","userNodePlayer","sourceId","newPlayer","sourceLayout","curFile","multiFile","permission","createSelectRecentCallback","MessagePipeline","recentId","foundRecent","NotificationModal","subText","displayPropsBySeverity","detailsElement","severityToToastAppearance","SendNotificationToastAdapter","notificationDetails","setNotificationDetails","_type","anchorWithOffset","origin","useContainerStyles","CloseSnackbarAction","closeSnackbar","Snackbar","StudioToastProvider","containerClasses","LayoutStorageContext","useLayoutStorage","UserProfileStorageContext","useUserProfileStorage","defaultPlaybackConfig","trimConfigById","panelIdsInsideTabPanels","configs","prevConfigById","newConfigById","currentSavedProps","override","oldConfig","saveFullPanelConfig","perPanelFunc","newProps","fullConfig","panelConfig","saveConfigsPayload","newPanelsState","prevConfig","res","originalId","createTabPanelWithSingleTab","idToReplace","idsToRemove","layoutWithInlinedTabs","panelIdsNotInNewTab","leaf","tabLayout","tabPanelConfig","nestedPanelConfigs","createTabPanelWithMultipleTabs","moveTab","changeLayoutPayload","newConfigs","dragWithinSameTab","sourceTabConfig","sourceTabChildConfigs","currentTabLayout","updates","newTree","dragToMainFromTab","panelConfigs","currentNode","dragToTabFromMain","targetTabConfig","dragToTabFromTab","fromTabConfigs","toTabConfigs","tabConfig","activeLayout","dragPayload","originalSavedProps","toMainFromTab","toTabfromMain","toTabfromTab","withinSameTab","defaultLayout","sim2realLayout","IncompatibleLayoutVersionAlert","isDesktop","showDesktopText","DialogContentText","MAX_SUPPORTED_LAYOUT_VERSION","CurrentLayoutProvider","getUserProfile","setUserProfile","layoutStateListeners","addLayoutStateListener","removeLayoutStateListener","setLayoutStateInternal","layoutStateRef","incompatibleLayoutVersionError","setIncompatibleLayoutVersionError","setLayoutState","selectedPanelIdsListeners","addSelectedPanelIdsListener","removeSelectedPanelIdsListener","saveToProfile","layoutVersion","performAction","oldData","newData","updatedLayout","layouts","closedId","originalIsSelected","beforePanelIds","afterPanelIds","activateExtension","unwrappedExtensionSource","require","fullId","aliasFunction","createExtensionRegistryStore","loaders","mockMessageConverters","foxeFileData","namespacedLoader","loader","extensionList","allContributionPoints","contributionPoints","ExtensionCatalogProvider","refreshExtensions","MARKETPLACE_URL","ExtensionMarketplaceProvider","getAvailableExtensions","getMarkdown","RemoteLayoutStorageContext","useRemoteLayoutStorage","layoutPermissionIsShared","layoutIsShared","layoutAppearsDeleted","NamespacedLayoutStorage","#migration","migrateUnnamespacedLayouts","importFromNamespace","WriteThroughLayoutCache","#cacheByNamespace","#getOrCreateCache","cache","isLayoutEqual","computeLayoutSyncOperations","localLayouts","remoteLayouts","ops","remoteLayoutsById","localLayout","remoteLayout","replacePanelInLayout","oldId","tabPanelIds","DEFAULT_PUBLISH_SETTINGS","migrateLegacyToNew3DConfig","legacyConfig","migrateLegacyToNew3DPanels","layoutData","legacy3DPanels","migrateLegacyToNewImageConfig","migrateLegacyToNewImagePanels","legacyImagePanels","migratePanelsState","migrateLayout","baseline","updateOrFetchLayout","remote","LayoutManager","#local","#remote","#emitter","#busyCount","#withBusyStatus","_prototype","_propertyKey","descriptor","method","online","local","#notifyChangeListeners","existingLocal","unmigratedData","newWorking","updatedBaseline","isRename","#currentSync","abortSignal","#syncWithRemoteImpl","syncOperations","localOps","remoteOps","op","#performLocalSyncOperations","#performRemoteSyncOperations","operations","operation","cleanups","newBaseline","cleanup","delay","SYNC_INTERVAL_BASE_MS","SYNC_INTERVAL_MAX_MS","LayoutManagerProvider","remoteLayoutStorage","useNetworkState","visibilityState","enableSyncing","controller","failures","getBuiltin","getDebug","PanelCatalogProvider","showDebugPanels","extensionPanels","wrappedExtensionPanels","PanelWrapper","panelProps","allPanelsInfo","allPanels","visiblePanels","panelList","panelsByType","byType","DEFAULT_PROFILE","LOCAL_STORAGE_KEY","UserProfileLocalStorageProvider","newProfile","LaunchPreferenceScreen","globalPreference","setGlobalPreference","setSessionPreference","rememberPreference","setRememberPreference","launchInWeb","launchInDesktop","toggleRememberPreference","Grid","LaunchingInDesktopScreen","cleanWebURL","openWeb","desktopURL","LaunchPreference","globalLaunchPreference","sessionLaunchPreference","activePreference","hasParams","contextMenuHandler","App","dataSources","extensionLoaders","enableLaunchPreferenceScreen","enableGlobalCss","extraProviders","MaybeLaunchPreference","CssBaseline","DndProvider","USE_DEFAULT_FORMATTER","timeFormatter","groupDigits","obj","maybeTime","nsec","rng","installDevtoolsFormatters","waitForFonts","font","appBar","dataSourceInfo","general","incompatibleLayoutVersion","openDialog","panelConfigVersionGuard","panelSettings","plot","settingsEditor","threeDee","translations","defaultNS","initI18n","DATABASE_BASE_NAME","METADATA_STORE_NAME","EXTENSION_STORE_NAME","IdbExtensionStorage","#db","db","records","transaction","parsePackageName","qualifiedName","validatePackageInfo","parsedPublisher","IdbExtensionLoader","#storage","zip","srcText","pkgInfoText","rawInfo","normalizedPublisher","parseJsonSchema","rootJsonSchema","rootTypeName","addFieldsRecursive","keyPath","postprocessObject","fieldName","fieldSchema","alternative","prevPostprocess","decoded","base64","nestedTypeName","postprocessNestedObject","fieldValue","itemSchema","postprocessArrayItem","postprocessValue","protobufScalarToRosPrimitive","stripLeadingDot","protobufDefinitionsToDatatypes","definitions","fullName","typeForSimpleField","flatbufferString","unchecked","typeForField","simpleType","enums","enumVal","parseFlatbufferSchema","schemaName","schemaArray","schemaBuffer","rawSchema","typeIndex","schemaIndex","object","toObject","buffer","byteBuffer","table","parseProtobufSchema","schemaData","descriptorSet","rootType","fixTimeType","prevToObject","newToObject","sec","deserialize","parsedDefinitionsToDatatypes","parsedDefinitions","rootName","parseChannel","textDecoder","parsedDatatypes","reader","#problemsById","#problems","predicate","rootDatatypeName","seenDatatypeNames","datatypeNameStack","currentDatatypeName","currentDatatype","msgDefinition","JsonMessageWriter","Buffer","WorkerSocketAdapter","#worker","#connectionClosed","wsUrl","protocols","#sendToWorker","textEncoder","SUBSCRIPTION_WARNING_SUPPRESSION_MS","ZERO_TIME","GET_ALL_PARAMS_REQUEST_ID","GET_ALL_PARAMS_PERIOD_MS","ROS_ENCODINGS","SUPPORTED_PUBLICATION_ENCODINGS","FALLBACK_PUBLICATION_ENCODING","SUPPORTED_SERVICE_ENCODINGS","FoxgloveWebSocketPlayer","#sourceId","#url","#name","#client","#id","#serverCapabilities","#playerCapabilities","#supportedEncodings","#closed","#topicsStats","#parsedMessages","#receivedBytes","#metricsCollector","#hasReceivedMessage","#presence","#numTimeSeeks","#profile","#urlState","#startTime","#endTime","#clockTime","#serverPublishesTime","#unresolvedSubscriptions","#resolvedSubscriptionsByTopic","#resolvedSubscriptionsById","#channelsByTopic","#channelsById","#unsupportedChannelIds","#recentlyCanceledSubscriptions","#parameters","#getParameterInterval","#openTimeout","#connectionAttemptTimeout","#unresolvedPublications","#publicationsByTopic","#serviceCallEncoding","#servicesByName","#serviceResponseCbs","#publishedTopics","#subscribedTopics","#advertisedServices","#nextServiceCallId","#open","#resetSessionState","#emitState","newSessionId","maybeRosDistro","rosDistro","isRos1","rosDataTypes","dataTypes","dataType","msgDef","#updateDataTypes","#setupPublishers","problemId","statusLevelToProblemSeverity","newChannels","parsedChannel","schemaEncoding","existingChannel","resolvedChannel","#updateTopicsAndDatatypes","#processUnresolvedSubscriptions","removedChannels","chanInfo","subId","subscriptionId","receiveTime","#getCurrentTime","timestamp","mappedParameters","param","c","newParameters","p","services","requestType","responseType","parsedRequest","parsedResponse","requestMsgDef","requestMessageWriter","resolvedService","serviceIds","serviceId","srv","responseCallback","newMap","publisherIds","subscriberIds","providerIds","topicsSet","uniquePublications","currentPublications","removedPublications","newPublications","publication","#unadvertiseChannel","#advertiseChannel","isByteArray","paramValueToSent","clientChannel","replacer","_key","serviceName","serviceCallRequest","encoding","encodingProblemId","msgdefProblemId","messageWriter","channelId","problemIds","updatedDatatypes","maybeRos","types","knownTypes","fullTypeName","dataTypeToFullName","FoxgloveWebSocketDataSourceFactory","NoopMetricsCollector","TIME_ZERO","IteratorCursor","#iter","#lastIteratorResult","#abort","iterator","abort","durationMs","firstResult","cutoffTime","BlockLoader","#source","#blocks","#start","#end","#blockDurationNanos","#maxCacheSize","#problemManager","#stopped","#activeChangeCondvar","#abortController","totalNs","blockCount","blockTopics","needTopics","#removeUnusedBlockTopics","totalBytesRemoved","blockBytesRemoved","#load","#calculateProgress","totalBlockSizeBytes","#cacheSize","blockId","topicsToFetch","existingBlock","endBlockId","endIdx","cursorStartTime","#blockIdToStartTime","cursorEndTime","#blockIdToEndTime","iteratorArgs","currentBlockId","untilTime","sizeInBytes","iterResult","msgTopic","messageSizeInBytes","removedSize","thisBlock","blockIndex","VecQueue","#readPos","#writePos","#buffer","#addCapacity","oldLen","newLen","oldCount","sortedIndexByTuple","list","mid","midKey","minIndexBy","collection","compare","minIdx","CachingIterableSource","#cachedTopics","#cache","#loadedRangesCache","#initResult","#totalSizeBytes","#maxTotalSizeBytes","#maxBlockSizeBytes","maxEnd","maxEndNanos","#recomputeLoadedRangeCache","readHead","cacheBlockIndex","cacheIndex","#FindStartCacheItemIndex","cachedItem","sourceReadStart","nextBlockIndex","nextBlock","sourceReadEnd","sourceMessageIterator","pendingIterResults","newBlock","insertIndex","receiveTimeNs","pendingIterResult","pendingSizeInBytes","#maybePurgeCache","out","needsTopics","cacheBlock","readIdx","prevBlock","sourceBackfill","sourceStartNs","rangeNs","prevRange","activeBlock","oldestIdx","oldestBlock","prevItem","DEFAULT_READ_AHEAD_DURATION","BufferedIterableSource","#readDone","#aborted","#readSignal","#writeSignal","#readHead","#producer","#readAheadDuration","#startProducer","sourceIterator","readUntil","self","DEFAULT_CACHE_SIZE_BYTES","START_DELAY_MS","MIN_MEM_CACHE_BLOCK_SIZE_NS","MAX_BLOCKS","SEEK_ON_START_NS","IterablePlayer","#urlParams","#nextState","#runningState","#isPlaying","#speed","#enablePreload","#lastTickMillis","#lastSeekEmitTime","#providerTopics","#providerTopicStats","#providerDatatypes","#capabilities","#allTopics","#preloadTopics","#progress","#messages","#hasError","#lastRangeMillis","#lastMessageEvent","#lastStamp","#seekTarget","#currentTime","#iterableSource","#bufferedSource","#playbackIterator","#blockLoader","#blockLoadingProcess","#untilTime","urlParams","enablePreload","#emitStateImpl","#setState","#startPlayImpl","newSubscriptions","allTopics","preloadTopics","_publishers","_payload","#runState","#stateInitialize","#stateStartPlay","#stateIdle","#stateSeekBackfill","#statePlay","#stateClose","#stateResetPlaybackIterator","#setError","profile","publishersByTopic","uniqueTopics","existingTopic","startStr","endStr","#startBlockLoading","#resetPlaybackIterator","stopTime","tickTimeout","seekAckTimeout","#tick","tickTime","durationMillis","rangeMillis","msgEvents","aborted","rangeChangeHandler","abortSignalTransferHandler","msgPort","port1","port2","WorkerIterableSource","#args","#thread","initialize","messageCursorPromise","messageCursor","Ros1LocalBagDataSourceFactory","rosLog","CAPABILITIES","Problem","#hostname","#rosNode","#providerTopicsStats","#services","#requestedPublishers","#requestedSubscriptions","#requestTopicsTimeout","#emitTimer","hostname","os","net","httpServer","tcpSocketCreate","tcpServer","listenHostname","rosNode","callerId","#addProblem","#requestTopics","skipEmit","#clearProblem","#clearPublishProblems","#topicsChanged","#updateConnectionGraph","providerTopics","#addInternalSubscriptions","availableTopicsByTopicName","topicNames","availTopic","_header","_reader","#getRosDatatypes","_pub","#handleMessage","external","#handleInternalMessage","validPublishers","existingPub","advertiseOptions","advertiseProblemId","messageDefinition","typesByName","maybeClockMsg","seconds","graph","Ros1SocketDataSourceFactory","Ros2LocalBagDataSourceFactory","bagConnectionsToDatatypes","connections","ros2","connection","collateNodeDetails","detail","isClockMessage","isRecord","RosbridgePlayer","#rosClient","#isRefreshing","#messageReadersByDatatype","#topicSubscriptions","#topicPublishers","#advertisements","#parsedTopics","#serviceTypeCache","#rosVersion","rosClient","topicsStallWarningTimeout","topicsMissingDatatypes","datatypeDescriptions","messageReaders","parsedDefinition","#refreshSystemState","providerDatatypes","messageReader","msgSize","innerMessage","opts","#getServiceType","serviceTypePromise","serviceType","proxy","_speedFraction","roslibTopic","fetchedNodes","publications","fulfilled","RosbridgeDataSourceFactory","UlogLocalDataSourceFactory","initWorkers","RemoteDataSourceFactory","#validateUrl","initWorker","supportedExtensions","DEFAULT_VELODYNE_PORT","RPM","PROBLEM_SOCKET_ERROR","TOPIC_NAME","TOPIC","DATATYPES","#port","#socket","#seq","#totalBytesReceived","#topic","#topicStats","#packets","rinfo","topOfHour","rawPacket","numPackets","raw","rawPacketToRos","packet","_request","_globalVariables","microSecSinceTopOfHour","VelodyneDataSourceFactory","portStr","McapLocalDataSourceFactory","SampleNuscenesDataSourceFactory","bagUrl","SceneExtension","renderable","renderFrameId","fixedFrameId","srcTime","frameId","DEFAULT_CAMERA_STATE","PublishSettings","#handlePublishToolChange","publish","category","MISSING_TRANSFORM","missingTransformMessage","srcFrameId","dstFrameId","makePose","xyzrpyToPose","xyz","rpy","o","vec3Identity","vec3FromValues","y","z","vec3Clone","quatIdentity","quatFromValues","w","quatClone","q","mat4Identity","mat4FromValues","m00","m01","m02","m03","m10","m11","m12","m13","m20","m21","m22","m23","m30","m31","m32","m33","mat4Clone","m","approxEq","v1","v2","epsilon","quatAproxEq","q1","q2","poseApproxEq","p1","p2","getRotationNoScaling","mat","trace","S","ArrayMap","#list","greaterThanIndex","newEntry","lessThanIndex","Transform","#position","#rotation","#matrix","matrixOrPosition","rotation","mat4","quat","vec3","pose","matrix","compareTime","percentOf","totalDuration","targetDuration","interpolate","MAX_DURATION","DEG2RAD","RAD2DEG","tempLower","tempUpper","tempVec3","tempVec4","tempTransform","tempMatrix","temp2Matrix","FALLBACK_FRAME_ID","CoordinateFrame","#parent","#transforms","parent","maxStorageTime","maxCapacity","capacityOverfillPercentage","frame","ancestor","transform","overfillIndex","removeBeforeTime","outLower","outUpper","maxDelta","transformCount","latestTime","latestTf","tf","earliestTime","earliestTf","lteTime","lteTf","gtTime","gtTf","srcFrame","copyPose","curSrcFrame","commonAncestor","rootFrame","dstTime","lower","upper","lowerTime","lowerTf","upperTime","upperTf","parentFrame","childFrame","curFrame","quaternion","rotationMatrix","euler","eulerFromMatrixUnscaled","quaternionFromEuler","invert","c1","c2","c3","s1","s2","s3","DEFAULT_MAX_CAPACITY_PER_FRAME","AddTransformResult","DEFAULT_FRAME_IDS","TransformTree","#frames","#maxStorageTime","#maxCapacityPerFrame","maxCapacityPerFrame","parentFrameId","updated","cycleDetected","curParentFrame","#checkParentForCycle","childFrameId","#removeEmptyAncestors","candidate","childrenByParentId","parentId","rootFrameId","frameMap","rootFrames","frameEntry","addFrame","depth","allFrames","rootsToCounts","rootId","tree","tempPose","updatePose","transformTree","poseApplied","rosPrimitiveToTypescriptTypeMap","typedArrayMap","safeString","generateTypesInterface","src","isConstant","isArray","typedArray","rosPrimitive","sigil","generateTypesByTopicInterface","typesByTopic","emptyLib","generateEmptyTypesLib","ros_lib_filename","ros_lib_dts","areSame","t1","t2","secDiff","fixTime","subtractTimes","sec1","nsec1","sec2","nsec2","DiagnosticSeverity","Sources","ErrorCodes","PlayerPresence","PlayerCapabilities","createPanelStateStore","defaultTitle","updateSettingsTreeSelector","usePanelSettingsTreeUpdate","updateStoreTree","updateSettingsTree","updateSharedDataSelector","updateDefaultTitleSelector","useSharedPanelState","updateSharedData","sharedData","useDefaultPanelTitle","updateDefaultTitle","hasSameKeys","keyA","keyB","createHasSameKeySelector","selectLayoutConfigById","selectPanelTypesInUse","panelTypesInUse","globalWithHandler","setReportErrorHandler","AppEvent","muiCache","ThemeContainer","_ref","muiTheme","meta","RESPONSE","ERROR","createLinkedChannels","_transfer","#channel","#messageId","#pendingCallbacks","#receivers","#onChannelMessage","transferables","callback","transfer","fallbackCopy","downloadTextFile","fileName","downloadFiles","urls","AppError","extraInfo","stringifiedExtraInfo","DIGITS_WITHOUT_DECIMAL_POINT_RE","DIGITS_WITH_DECIMAL_POINT_RE","THOUSAND_YEARS_IN_NANOSEC","parseFuzzyRosTime","trimmedStamp","nanos","format","formatDuration","parseTimeStr","newMomentTimeObj","todTimeRegex","getValidatedTimeAndMethodFromString","isInvalidRawTime","isInvalidTodTime","DEFAULT_STUDIO_NODE_PREFIX","useJsonTreeTheme","TAB_PANEL_TYPE","__filename","PANEL_TITLE_CONFIG_KEY","getPanelIdForType","rnd","getPanelTypeFromId","isTabPanel","isTabPanelConfig","getPathFromNode","first","second","mapTemplateIdsToNewIds","templateIds","getLayoutWithNewPanelIds","panelIdMap","compactLayout","prunedChildren","replaceLeafLayouts","replacerFn","inlineTabPanelLayouts","preserveTabPanelIds","tabFreeLayout","getValidTabPanelConfig","getParentTabPanelByPanelId","memo","savedPanelId","replaceMaybeTabLayoutWithNewPanelIds","getSaveConfigsPayloadForAddedPanel","getPanelIdsInsideTabPanels","templateId","relatedConfig","tabLayouts","tabProps","DEFAULT_TAB_PANEL_CONFIG","getAllPanelIds","layoutPanelIds","validateTabPanelConfig","updateTabPanelLayout","updatedTabs","removePanelFromTabPanel","createAddUpdates","newPath","before","addPanelToTab","insertedPanelId","destinationPosition","safeTabConfig","reorderTabWithinTabPanel","sourceIndex","targetIndex","nextSourceTabs","movedActiveTab","movedToBeforeActiveTab","movedFromBeforeActiveTab","nextActiveTabIdx","moveTabBetweenTabPanels","sourceConfig","targetConfig","nextTabsSource","nextTabsTarget","nextActiveTabIdxSource","nextActiveTabIdxTarget","replaceAndRemovePanels","panelArgs","panelIdToRemove","pathToNode","getConfigsForNestedPanelsInsideTab","panelIdToReplace","tabPanelId","panelIdsToRemove","overwriteFetch","originalFetch","init","replacementError","getTopicsByTopicName","constantsByDatatype","extractTypeFromStudioEnumAnnotation","enumValuesByDatatypeAndField","currentResult","constants","lastType","fieldConstants","defaultNotificationHandler","addNotification","setNotificationHandler","unsetNotificationHandler","formatTimeRaw","DURATION_20_YEARS_SEC","isAbsoluteTime","formatFrame","getTimestampForMessageEvent","timestampMethod","getTimestampForMessage","inWebWorker","inSharedWorker","enforceFetchIsBlocked","canFetch"],"sourceRoot":""}