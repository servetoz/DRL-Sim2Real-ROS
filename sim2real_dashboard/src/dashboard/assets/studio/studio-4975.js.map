{"version":3,"file":"studio-4975.js","mappings":"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","sources":["webpack:///../../packages/comlink-transfer-handlers/src/abortSignalTransferHandler.ts","webpack:///../../packages/studio-base/src/players/IterablePlayer/IteratorCursor.ts","webpack:///../../packages/studio-base/src/players/IterablePlayer/WorkerIterableSourceWorker.ts","webpack:///../../packages/studio-base/src/players/IterablePlayer/rosdb3/RosDb3IterableSource.ts","webpack:///../../packages/studio-base/src/players/IterablePlayer/rosdb3/RosDb3IterableSourceWorker.worker.ts","webpack:///../../packages/studio-base/src/util/process.ts","webpack:///webpack/bootstrap","webpack:///webpack/runtime/chunk loaded","webpack:///webpack/runtime/define property getters","webpack:///webpack/runtime/ensure chunk","webpack:///webpack/runtime/get javascript chunk filename","webpack:///webpack/runtime/global","webpack:///webpack/runtime/hasOwnProperty shorthand","webpack:///webpack/runtime/make namespace object","webpack:///webpack/runtime/node module decorator","webpack:///webpack/runtime/publicPath","webpack:///webpack/runtime/importScripts chunk loading","webpack:///webpack/runtime/startup chunk dependencies","webpack:///webpack/startup"],"sourcesContent":["// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { TransferHandler } from \"comlink\";\n\nconst isAbortSignal = (val: unknown): val is AbortSignal => val instanceof AbortSignal;\n\n/**\n * abortSignalTransferHandler implements a Comlink TransferHandler for AbortSignal instances\n *\n * Serialize creates an array with a boolean for whether the signal is already aborted and a message\n * port to send an abort signal.\n *\n * Deserialize creates a new abort controller and aborts it when the abort message is sent over the\n * message port.\n *\n * Reference: https://developer.mozilla.org/en-US/docs/Web/API/AbortSignal\n */\nconst abortSignalTransferHandler: TransferHandler<AbortSignal, [boolean, MessagePort]> = {\n  canHandle: isAbortSignal,\n  deserialize: ([aborted, msgPort]) => {\n    const controller = new AbortController();\n\n    if (aborted) {\n      controller.abort();\n    } else {\n      msgPort.onmessage = () => {\n        controller.abort();\n      };\n    }\n\n    return controller.signal;\n  },\n  serialize: (abortSignal) => {\n    const { port1, port2 } = new MessageChannel();\n    abortSignal.addEventListener(\"abort\", () => {\n      port1.postMessage(\"aborted\");\n    });\n\n    return [[abortSignal.aborted, port2], [port2]];\n  },\n};\n\nexport { abortSignalTransferHandler };\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { compare, add as addTime } from \"@foxglove/rostime\";\nimport { Time } from \"@foxglove/studio\";\n\nimport type { IMessageCursor, IteratorResult } from \"./IIterableSource\";\n\nconst TIME_ZERO = Object.freeze({ sec: 0, nsec: 0 });\n\n/// IteratorCursor implements a IMessageCursor interface on top of an AsyncIterable\nclass IteratorCursor implements IMessageCursor {\n  #iter: AsyncIterableIterator<Readonly<IteratorResult>>;\n  // readUntil reads from the iterator inclusive of end time. To do this, it reads from the iterator\n  // until it receives a receiveTime after end time to signal it has received all the messages\n  // inclusive of end time. Since iterators are read once, this last result must be stored for the\n  // next readUntil call otherwise it would be lost.\n  #lastIteratorResult?: IteratorResult;\n  #abort?: AbortSignal;\n\n  public constructor(\n    iterator: AsyncIterableIterator<Readonly<IteratorResult>>,\n    abort?: AbortSignal,\n  ) {\n    this.#iter = iterator;\n    this.#abort = abort;\n  }\n\n  public async next(): ReturnType<IMessageCursor[\"next\"]> {\n    if (this.#abort?.aborted === true) {\n      return undefined;\n    }\n\n    const result = await this.#iter.next();\n    return result.value;\n  }\n\n  public async nextBatch(durationMs: number): Promise<IteratorResult[] | undefined> {\n    const firstResult = await this.next();\n    if (!firstResult) {\n      return undefined;\n    }\n\n    if (firstResult.type === \"problem\") {\n      return [firstResult];\n    }\n\n    const results: IteratorResult[] = [firstResult];\n\n    let cutoffTime: Time = TIME_ZERO;\n    switch (firstResult.type) {\n      case \"stamp\":\n        cutoffTime = addTime(firstResult.stamp, { sec: 0, nsec: durationMs * 1e6 });\n        break;\n      case \"message-event\":\n        cutoffTime = addTime(firstResult.msgEvent.receiveTime, { sec: 0, nsec: durationMs * 1e6 });\n        break;\n    }\n\n    for (;;) {\n      const result = await this.next();\n      if (!result) {\n        return results;\n      }\n\n      results.push(result);\n\n      if (result.type === \"problem\") {\n        break;\n      }\n      if (result.type === \"stamp\" && compare(result.stamp, cutoffTime) > 0) {\n        break;\n      }\n      if (result.type === \"message-event\" && compare(result.msgEvent.receiveTime, cutoffTime) > 0) {\n        break;\n      }\n    }\n    return results;\n  }\n\n  public async readUntil(end: Time): ReturnType<IMessageCursor[\"readUntil\"]> {\n    // Assign to a variable to fool typescript control flow analysis which does not understand\n    // that this value could change after the _await_\n    const isAborted = this.#abort?.aborted;\n    if (isAborted === true) {\n      return undefined;\n    }\n\n    const results: IteratorResult[] = [];\n\n    // if the last result is still past end time, return empty results\n    if (\n      this.#lastIteratorResult?.type === \"stamp\" &&\n      compare(this.#lastIteratorResult.stamp, end) >= 0\n    ) {\n      return results;\n    }\n\n    if (\n      this.#lastIteratorResult?.type === \"message-event\" &&\n      compare(this.#lastIteratorResult.msgEvent.receiveTime, end) > 0\n    ) {\n      return results;\n    }\n\n    if (this.#lastIteratorResult) {\n      results.push(this.#lastIteratorResult);\n      this.#lastIteratorResult = undefined;\n    }\n\n    for (;;) {\n      const result = await this.#iter.next();\n      if (this.#abort?.aborted === true) {\n        return undefined;\n      }\n\n      if (result.done === true) {\n        break;\n      }\n\n      const value = result.value;\n      if (value.type === \"stamp\" && compare(value.stamp, end) >= 0) {\n        this.#lastIteratorResult = value;\n        break;\n      }\n      if (value.type === \"message-event\" && compare(value.msgEvent.receiveTime, end) > 0) {\n        this.#lastIteratorResult = value;\n        break;\n      }\n      results.push(value);\n    }\n\n    return results;\n  }\n\n  public async end(): ReturnType<IMessageCursor[\"end\"]> {\n    await this.#iter.return?.();\n  }\n}\n\nexport { IteratorCursor };\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport * as Comlink from \"comlink\";\n\nimport { abortSignalTransferHandler } from \"@foxglove/comlink-transfer-handlers\";\nimport { MessageEvent } from \"@foxglove/studio\";\n\nimport type {\n  GetBackfillMessagesArgs,\n  IIterableSource,\n  IMessageCursor,\n  Initalization,\n  IteratorResult,\n  MessageIteratorArgs,\n} from \"./IIterableSource\";\nimport { IteratorCursor } from \"./IteratorCursor\";\n\nexport class WorkerIterableSourceWorker implements IIterableSource {\n  protected _source: IIterableSource;\n\n  public constructor(source: IIterableSource) {\n    this._source = source;\n  }\n\n  public async initialize(): Promise<Initalization> {\n    return await this._source.initialize();\n  }\n\n  public messageIterator(\n    args: MessageIteratorArgs,\n  ): AsyncIterableIterator<Readonly<IteratorResult>> & Comlink.ProxyMarked {\n    return Comlink.proxy(this._source.messageIterator(args));\n  }\n\n  public async getBackfillMessages(\n    args: Omit<GetBackfillMessagesArgs, \"abortSignal\">,\n    // abortSignal is a separate argument so it can be proxied by comlink since AbortSignal is not\n    // clonable (and needs to signal across the worker boundary)\n    abortSignal?: AbortSignal,\n  ): Promise<MessageEvent[]> {\n    return await this._source.getBackfillMessages({\n      ...args,\n      abortSignal,\n    });\n  }\n\n  public getMessageCursor(\n    args: Omit<MessageIteratorArgs, \"abort\">,\n    abort?: AbortSignal,\n  ): IMessageCursor & Comlink.ProxyMarked {\n    const iter = this._source.messageIterator(args);\n    const cursor = new IteratorCursor(iter, abort);\n    return Comlink.proxy(cursor);\n  }\n}\n\nComlink.transferHandlers.set(\"abortsignal\", abortSignalTransferHandler);\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport { ROS2_TO_DEFINITIONS, Rosbag2, SqliteSqljs } from \"@foxglove/rosbag2-web\";\nimport { stringify } from \"@foxglove/rosmsg\";\nimport { Time, add as addTime } from \"@foxglove/rostime\";\nimport { MessageEvent } from \"@foxglove/studio\";\nimport {\n  MessageDefinitionsByTopic,\n  ParsedMessageDefinitionsByTopic,\n  PlayerProblem,\n  Topic,\n  TopicStats,\n} from \"@foxglove/studio-base/players/types\";\nimport { RosDatatypes } from \"@foxglove/studio-base/types/RosDatatypes\";\n\nimport {\n  IIterableSource,\n  IteratorResult,\n  Initalization,\n  MessageIteratorArgs,\n  GetBackfillMessagesArgs,\n} from \"../IIterableSource\";\n\nexport class RosDb3IterableSource implements IIterableSource {\n  #files: File[];\n  #bag?: Rosbag2;\n  #start: Time = { sec: 0, nsec: 0 };\n  #end: Time = { sec: 0, nsec: 0 };\n\n  public constructor(files: File[]) {\n    this.#files = files;\n  }\n\n  public async initialize(): Promise<Initalization> {\n    const res = await fetch(\n      // foxglove-depcheck-used: babel-plugin-transform-import-meta\n      new URL(\"@foxglove/sql.js/dist/sql-wasm.wasm\", import.meta.url).toString(),\n    );\n    const sqlWasm = await (await res.blob()).arrayBuffer();\n    await SqliteSqljs.Initialize({ wasmBinary: sqlWasm });\n\n    const dbs = this.#files.map((file) => new SqliteSqljs(file));\n    const bag = new Rosbag2(dbs);\n    await bag.open();\n    this.#bag = bag;\n\n    const [start, end] = await this.#bag.timeRange();\n    const topicDefs = await this.#bag.readTopics();\n    const messageCounts = await this.#bag.messageCounts();\n    let hasAnyMessages = false;\n    for (const count of messageCounts.values()) {\n      if (count > 0) {\n        hasAnyMessages = true;\n        break;\n      }\n    }\n    if (!hasAnyMessages) {\n      throw new Error(\"Bag contains no messages\");\n    }\n\n    const problems: PlayerProblem[] = [];\n    const topics: Topic[] = [];\n    const topicStats = new Map<string, TopicStats>();\n    const datatypes: RosDatatypes = new Map();\n    const messageDefinitionsByTopic: MessageDefinitionsByTopic = {};\n    const parsedMessageDefinitionsByTopic: ParsedMessageDefinitionsByTopic = {};\n\n    for (const topicDef of topicDefs) {\n      const numMessages = messageCounts.get(topicDef.name);\n\n      topics.push({ name: topicDef.name, schemaName: topicDef.type });\n      if (numMessages != undefined) {\n        topicStats.set(topicDef.name, { numMessages });\n      }\n\n      const parsedMsgdef = ROS2_TO_DEFINITIONS.get(topicDef.type);\n      if (parsedMsgdef == undefined) {\n        problems.push({\n          severity: \"warn\",\n          message: `Topic \"${topicDef.name}\" has unsupported datatype \"${topicDef.type}\"`,\n          tip: \"ROS 2 .db3 files do not contain message definitions, so only well-known ROS types are supported in Foxglove Studio. As a workaround, you can convert the db3 file to mcap using the mcap CLI. For more information, see: https://foxglove.dev/docs/studio/connection/ros2\",\n        });\n        continue;\n      }\n\n      const fullParsedMessageDefinitions = [parsedMsgdef];\n      const messageDefinition = stringify(fullParsedMessageDefinitions);\n      datatypes.set(topicDef.type, { name: topicDef.type, definitions: parsedMsgdef.definitions });\n      messageDefinitionsByTopic[topicDef.name] = messageDefinition;\n      parsedMessageDefinitionsByTopic[topicDef.name] = fullParsedMessageDefinitions;\n    }\n\n    this.#start = start;\n    this.#end = end;\n\n    return {\n      topics: Array.from(topics.values()),\n      topicStats,\n      start,\n      end,\n      problems,\n      profile: \"ros2\",\n      datatypes,\n      publishersByTopic: new Map(),\n    };\n  }\n\n  public async *messageIterator(\n    opt: MessageIteratorArgs,\n  ): AsyncIterableIterator<Readonly<IteratorResult>> {\n    if (this.#bag == undefined) {\n      throw new Error(`Rosbag2DataProvider is not initialized`);\n    }\n\n    const topics = opt.topics;\n    if (topics.length === 0) {\n      return;\n    }\n\n    const start = opt.start ?? this.#start;\n    const end = opt.end ?? this.#end;\n\n    // Add 1 nsec to the end time because rosbag2 treats the time range as non-inclusive\n    // of the exact end time.\n    const inclusiveEndTime = addTime(end, { sec: 0, nsec: 1 });\n    const msgIterator = this.#bag.readMessages({\n      startTime: start,\n      endTime: inclusiveEndTime,\n      topics,\n    });\n    for await (const msg of msgIterator) {\n      yield {\n        type: \"message-event\",\n        msgEvent: {\n          topic: msg.topic.name,\n          receiveTime: msg.timestamp,\n          message: msg.value,\n          sizeInBytes: msg.data.byteLength,\n          schemaName: msg.topic.type,\n        },\n      };\n    }\n  }\n\n  public async getBackfillMessages(_args: GetBackfillMessagesArgs): Promise<MessageEvent[]> {\n    return [];\n  }\n}\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\nimport * as Comlink from \"comlink\";\n\nimport { IterableSourceInitializeArgs } from \"@foxglove/studio-base/players/IterablePlayer/IIterableSource\";\nimport { WorkerIterableSourceWorker } from \"@foxglove/studio-base/players/IterablePlayer/WorkerIterableSourceWorker\";\n\nimport { RosDb3IterableSource } from \"./RosDb3IterableSource\";\n\nexport function initialize(args: IterableSourceInitializeArgs): WorkerIterableSourceWorker {\n  const files = args.file ? [args.file] : args.files;\n  if (!files) {\n    throw new Error(\"files required\");\n  }\n  const source = new RosDb3IterableSource(files);\n  const wrapped = new WorkerIterableSourceWorker(source);\n  return Comlink.proxy(wrapped);\n}\n\nComlink.expose(initialize);\n","// This Source Code Form is subject to the terms of the Mozilla Public\n// License, v2.0. If a copy of the MPL was not distributed with this\n// file, You can obtain one at http://mozilla.org/MPL/2.0/\n\n// Provide a shim for global process variable users\n// We avoid using the npm process module since it has unfavorable performance for process.nextTick\n// and uses setTimeout(..., 0). Instead we use queueMicrotask which is much faster.\nconst process = {\n  // We want to be able to use Function type for _fn_ param\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  nextTick: (fn: Function, ...args: unknown[]): void => {\n    queueMicrotask(() => {\n      fn(...args);\n    });\n  },\n\n  title: \"browser\",\n  browser: true,\n  env: {},\n  argv: [],\n};\n\n// ts-prune-ignore-next\nexport default process;\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\tloaded: false,\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Flag the module as loaded\n\tmodule.loaded = true;\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n// the startup function\n__webpack_require__.x = () => {\n\t// Load entry module and return exports\n\t// This entry module depends on other loaded chunks and execution need to be delayed\n\tvar __webpack_exports__ = __webpack_require__.O(undefined, [7979,670,7547,6788], () => (__webpack_require__(85909)))\n\t__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n\treturn __webpack_exports__;\n};\n\n","var deferred = [];\n__webpack_require__.O = (result, chunkIds, fn, priority) => {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar [chunkIds, fn, priority] = deferred[i];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = (chunkId) => {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce((promises, key) => {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks and sibling chunks for the entrypoint\n__webpack_require__.u = (chunkId) => {\n\t// return url for filenames based on template\n\treturn \"studio-\" + chunkId + \".js\";\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.nmd = (module) => {\n\tmodule.paths = [];\n\tif (!module.children) module.children = [];\n\treturn module;\n};","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript)\n\t\tscriptUrl = document.currentScript.src;\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) {\n\t\t\tvar i = scripts.length - 1;\n\t\t\twhile (i > -1 && !scriptUrl) scriptUrl = scripts[i--].src;\n\t\t}\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","__webpack_require__.b = self.location + \"\";\n\n// object to store loaded chunks\n// \"1\" means \"already loaded\"\nvar installedChunks = {\n\t4975: 1\n};\n\n// importScripts chunk loading\nvar installChunk = (data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\tfor(var moduleId in moreModules) {\n\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t}\n\t}\n\tif(runtime) runtime(__webpack_require__);\n\twhile(chunkIds.length)\n\t\tinstalledChunks[chunkIds.pop()] = 1;\n\tparentChunkLoadingFunction(data);\n};\n__webpack_require__.f.i = (chunkId, promises) => {\n\t// \"1\" is the signal for \"already loaded\"\n\tif(!installedChunks[chunkId]) {\n\t\tif(true) { // all chunks have JS\n\t\t\timportScripts(__webpack_require__.p + __webpack_require__.u(chunkId));\n\t\t}\n\t}\n};\n\nvar chunkLoadingGlobal = self[\"webpackChunk\"] = self[\"webpackChunk\"] || [];\nvar parentChunkLoadingFunction = chunkLoadingGlobal.push.bind(chunkLoadingGlobal);\nchunkLoadingGlobal.push = installChunk;\n\n// no HMR\n\n// no HMR manifest","var next = __webpack_require__.x;\n__webpack_require__.x = () => {\n\treturn Promise.all([7979,670,7547,6788].map(__webpack_require__.e, __webpack_require__)).then(next);\n};","// run startup\nvar __webpack_exports__ = __webpack_require__.x();\n"],"names":["abortSignalTransferHandler","val","aborted","msgPort","controller","abortSignal","port1","port2","TIME_ZERO","IteratorCursor","#iter","#lastIteratorResult","#abort","iterator","abort","durationMs","firstResult","results","cutoffTime","result","end","value","WorkerIterableSourceWorker","source","args","iter","cursor","RosDb3IterableSource","#files","#bag","#start","#end","files","sqlWasm","dbs","file","bag","start","topicDefs","messageCounts","hasAnyMessages","count","problems","topics","topicStats","datatypes","messageDefinitionsByTopic","parsedMessageDefinitionsByTopic","topicDef","numMessages","parsedMsgdef","fullParsedMessageDefinitions","messageDefinition","opt","inclusiveEndTime","msgIterator","msg","_args","initialize","wrapped","fn","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","module","__webpack_modules__","__webpack_exports__","deferred","chunkIds","priority","i","notFulfilled","fulfilled","j","key","r","exports","definition","chunkId","promises","obj","prop","scriptUrl","document","scripts","installedChunks","installChunk","data","moreModules","runtime","parentChunkLoadingFunction","chunkLoadingGlobal","next"],"sourceRoot":""}